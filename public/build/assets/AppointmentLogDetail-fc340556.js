import{A as AppLayout,N as Navbar}from"./AppLayout-02188963.js";import{P as PageHeader}from"./PageHeader-990117fa.js";import{d as defineComponent,H as Head,L as Link,_ as _export_sfc,o as openBlock,c as createElementBlock,b as createBaseVNode,t as toDisplayString,f as createCommentVNode,F as Fragment,r as renderList,i as createTextVNode,w as withDirectives,v as vModelText,E as withKeys,y as pushScopeId,z as popScopeId,A as createStaticVNode,p as getDefaultExportFromCjs,a as axios$1,e as createVNode,l as resolveComponent,h as createBlock,m as withCtx}from"./app-5a739dd9.js";import{V as ValidationErrors}from"./ValidationErrors-bf47aed9.js";import{B as Breadcrums}from"./Breadcrums-4d6b2de8.js";const ChatComponent_vue_vue_type_style_index_0_scoped_a98a9d04_lang="",_sfc_main$7=defineComponent({components:{Head,ValidationErrors,Link},props:["appointment"],data(){return{fetching:!1,messages:[],message:"",attachment_file:"",attachment_file_url:"",disable:!1,showStartedButton:!0}},async created(){Echo.private(`chat-message.${this.appointment.id}`).listen(".chat-message",c=>{this.messages.push(c.message),this.$nextTick(()=>{this.scrollToEnd()})}),await this.getChatMessages()},methods:{getChatMessages(){this.fetching=!0,axios.get(this.route("getApiChatMessages",{appointment_id:this.appointment.id})).then(c=>{this.messages=c.data.data,this.fetching=!1,this.$nextTick(()=>{this.scrollToEnd()})})},sendMessage(){if(this.disable=!0,!this.message&&!this.attachment_file){this.$toast.error("Please type message or attach a file"),this.disable=!1;return}const c={"Content-Type":"multipart/form-data"};let O=new FormData;O.append("appointment_id",this.appointment.id),O.append("message",this.message),O.append("attachment_file",this.attachment_file),axios.post(this.route("postApiSendMessage"),O,{headers:c}).then(y=>{y.data.success&&(this.disable=!1,this.message="",this.attachment_file="",this.attachment_file_url="")})},processAttachmentFile(c){this.attachment_file=c.target.files[0],this.attachment_file_url=URL.createObjectURL(c.target.files[0])},scrollToEnd(){const c=this.$refs.chatContainer;c.scrollTop=c.scrollHeight},updateAppointmentIsStarted(){this.$page.props.auth.logged_in_as=="lawyer"&&axios.post(this.route("appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)}),this.$page.props.auth.logged_in_as=="law_firm"&&axios.post(this.route("law_firm.appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)})}}}),_withScopeId$2=c=>(pushScopeId("data-v-a98a9d04"),c=c(),popScopeId(),c),_hoisted_1$6={key:0,class:"chat-ui"},_hoisted_2$6=createStaticVNode('<ul class="m-b-0 px-3 skeleton-structure" type="none" id="style-2" data-v-a98a9d04><div data-v-a98a9d04><div data-v-a98a9d04><li class="clearfix" data-v-a98a9d04><div class="d-flex flex-row justify-content-end my-4" data-v-a98a9d04><div class="float-right msg-bubble" style="width:60%;height:54px;" data-v-a98a9d04></div></div></li><li class="clearfix" data-v-a98a9d04><div class="d-flex flex-row justify-content-end my-4" data-v-a98a9d04><div class="float-right msg-bubble" style="width:40%;height:54px;" data-v-a98a9d04></div></div></li><li class="clearfix" data-v-a98a9d04><div class="d-flex my-4" data-v-a98a9d04><div class="msg-bubble" style="width:80%;height:54px;" data-v-a98a9d04></div></div></li><li class="clearfix" data-v-a98a9d04><div class="d-flex flex-row justify-content-end my-4" data-v-a98a9d04><div class="float-right msg-bubble" style="width:50%;height:54px;" data-v-a98a9d04></div></div></li><li class="clearfix" data-v-a98a9d04><div class="d-flex my-4" data-v-a98a9d04><div class="msg-bubble" style="width:70%;height:54px;" data-v-a98a9d04></div></div></li><li class="clearfix" data-v-a98a9d04><div class="d-flex my-4" data-v-a98a9d04><div class="msg-bubble" style="width:30%;height:54px;" data-v-a98a9d04></div></div></li></div></div></ul>',1),_hoisted_3$6=[_hoisted_2$6],_hoisted_4$6={key:1},_hoisted_5$5={class:"row"},_hoisted_6$5={class:"col-12 mb-4 d-flex justify-content-end flex-wrap"},_hoisted_7$5={class:"chat-ui"},_hoisted_8$5={class:"m-b-0 px-3",type:"none",id:"style-2",style:{height:"500px",overflow:"auto"},ref:"chatContainer"},_hoisted_9$5={key:0,class:"clearfix"},_hoisted_10$5={class:"d-flex flex-row justify-content-end my-4"},_hoisted_11$5={class:"float-right msg-bubble"},_hoisted_12$5=_withScopeId$2(()=>createBaseVNode("br",null,null,-1)),_hoisted_13$5={key:0},_hoisted_14$5=["src"],_hoisted_15$5={key:1,class:"clearfix"},_hoisted_16$5={class:"d-flex my-4"},_hoisted_17$5={class:"msg-bubble"},_hoisted_18$5=_withScopeId$2(()=>createBaseVNode("br",null,null,-1)),_hoisted_19$5={key:0},_hoisted_20$5=["src"],_hoisted_21$5={class:"d-flex align-items-center form-control"},_hoisted_22$5={class:"upload-btn-wrapper align-items-center"},_hoisted_23$5=_withScopeId$2(()=>createBaseVNode("input",{type:"hidden",name:"icon",class:"image",value:""},null,-1)),_hoisted_24$5=["placeholder","disabled"],_hoisted_25$5=["disabled"],_hoisted_26$5=_withScopeId$2(()=>createBaseVNode("i",{class:"bi bi-send"},null,-1)),_hoisted_27$5=[_hoisted_26$5],_hoisted_28$5={key:0,class:"d-flex align-items-end mt-3"},_hoisted_29$5={class:"border border-3 border-primary me-2"},_hoisted_30$5=["src"],_hoisted_31$5={key:0};function _sfc_render$7(c,O,y,m,d,E){return c.fetching?(openBlock(),createElementBlock("div",_hoisted_1$6,_hoisted_3$6)):(openBlock(),createElementBlock("div",_hoisted_4$6,[createBaseVNode("div",_hoisted_5$5,[createBaseVNode("div",_hoisted_6$5,[c.showStartedButton&&!c.appointment.is_started?(openBlock(),createElementBlock("button",{key:0,type:"button",onClick:O[0]||(O[0]=(...p)=>c.updateAppointmentIsStarted&&c.updateAppointmentIsStarted(...p)),class:"btn btn-primary ms-lg-3 ms-0 px-5",plain:""},toDisplayString(c.__("start chat")),1)):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_7$5,[createBaseVNode("ul",_hoisted_8$5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.messages,p=>(openBlock(),createElementBlock("div",{key:p.id},[createBaseVNode("div",null,[p.sender_type==c.$page.props.auth.logged_in_as&&c.$page.props.auth.user[c.$page.props.auth.logged_in_as].id==p.sender_id?(openBlock(),createElementBlock("li",_hoisted_9$5,[createBaseVNode("div",_hoisted_10$5,[createBaseVNode("div",_hoisted_11$5,[createBaseVNode("span",null,toDisplayString(p.message),1),createTextVNode(),_hoisted_12$5,p.is_attachment?(openBlock(),createElementBlock("span",_hoisted_13$5,[createBaseVNode("img",{src:p.attachment_url,height:"100",alt:""},null,8,_hoisted_14$5)])):createCommentVNode("",!0)])])])):(openBlock(),createElementBlock("li",_hoisted_15$5,[createBaseVNode("div",_hoisted_16$5,[createBaseVNode("div",_hoisted_17$5,[createBaseVNode("span",null,toDisplayString(p.message),1),createTextVNode(),_hoisted_18$5,p.is_attachment?(openBlock(),createElementBlock("span",_hoisted_19$5,[createBaseVNode("img",{src:p.attachment_url,height:"100",alt:""},null,8,_hoisted_20$5)])):createCommentVNode("",!0)])])]))])]))),128))],512),createBaseVNode("div",_hoisted_21$5,[createBaseVNode("div",_hoisted_22$5,[_hoisted_23$5,createBaseVNode("input",{type:"file",id:"attachment",ref:"attachment",onChange:O[1]||(O[1]=p=>c.processAttachmentFile(p)),class:"custom-file-input","aria-describedby":"IconError","aria-invalid":"true"},null,544)]),withDirectives(createBaseVNode("input",{placeholder:c.__("enter here"),type:"text",class:"w-100 border-0",onKeyup:O[2]||(O[2]=withKeys((...p)=>c.sendMessage&&c.sendMessage(...p),["enter"])),disabled:c.disable,"onUpdate:modelValue":O[3]||(O[3]=p=>c.message=p)},null,40,_hoisted_24$5),[[vModelText,c.message]]),createBaseVNode("button",{type:"button",class:"btn btn-primary me-2",onClick:O[4]||(O[4]=(...p)=>c.sendMessage&&c.sendMessage(...p)),disabled:c.disable},_hoisted_27$5,8,_hoisted_25$5)]),c.attachment_file_url?(openBlock(),createElementBlock("div",_hoisted_28$5,[createBaseVNode("div",_hoisted_29$5,[createBaseVNode("img",{src:c.attachment_file_url,width:"100",height:"100",alt:""},null,8,_hoisted_30$5)]),c.attachment_file.name?(openBlock(),createElementBlock("span",_hoisted_31$5,toDisplayString(c.attachment_file.name),1)):createCommentVNode("",!0)])):createCommentVNode("",!0)])]))}const ChatComponent=_export_sfc(_sfc_main$7,[["render",_sfc_render$7],["__scopeId","data-v-a98a9d04"]]);var AgoraRTCSDK_minExports={},AgoraRTCSDK_min={get exports(){return AgoraRTCSDK_minExports},set exports(c){AgoraRTCSDK_minExports=c}};/*! AgoraRTC|BUILD v3.6.11-0-gbdacc5f-dirty */(function(module,exports){(function(c,O){module.exports=O()})(window,function(){return function(c){var O={};function y(m){if(O[m])return O[m].exports;var d=O[m]={i:m,l:!1,exports:{}};return c[m].call(d.exports,d,d.exports,y),d.l=!0,d.exports}return y.m=c,y.c=O,y.d=function(m,d,E){y.o(m,d)||Object.defineProperty(m,d,{enumerable:!0,get:E})},y.r=function(m){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})},y.t=function(m,d){if(1&d&&(m=y(m)),8&d||4&d&&typeof m=="object"&&m&&m.__esModule)return m;var E=Object.create(null);if(y.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:m}),2&d&&typeof m!="string")for(var p in m)y.d(E,p,function(b){return m[b]}.bind(null,p));return E},y.n=function(m){var d=m&&m.__esModule?function(){return m.default}:function(){return m};return y.d(d,"a",d),d},y.o=function(m,d){return Object.prototype.hasOwnProperty.call(m,d)},y.p="",y(y.s=96)}([function(c,O,y){y.r(O);var m,d=y(11),E=y.n(d),p=function(){var w=new Date;return w.toTimeString().split(" ")[0]+":"+w.getMilliseconds()},b=y(14),s=y(2),g=y(1),i=y(48),a=y.n(i),l=y(49),A=y.n(l),k=new Array(32).fill(void 0);function S(w){return k[w]}k.push(void 0,null,!0,!1);var f=k.length;function C(w){var D=S(w);return function(x){x<36||(k[x]=f,f=x)}(w),D}var I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});I.decode();var P=null;function T(){return P!==null&&P.buffer===m.memory.buffer||(P=new Uint8Array(m.memory.buffer)),P}function F(w,D){return I.decode(T().subarray(w,w+D))}function J(w){f===k.length&&k.push(k.length+1);var D=f;return f=k[D],k[D]=w,D}var G=0,H=new TextEncoder("utf-8"),V=typeof H.encodeInto=="function"?function(w,D){return H.encodeInto(w,D)}:function(w,D){var x=H.encode(w);return D.set(x),{read:w.length,written:x.length}},_=null;function n(){return _!==null&&_.buffer===m.memory.buffer||(_=new Int32Array(m.memory.buffer)),_}var L=function(){function w(){a()(this,w)}return A()(w,[{key:"free",value:function(){var D=this.ptr;this.ptr=0,m.__wbg_signmanager_free(D)}},{key:"get_digest",value:function(D){return C(m.signmanager_get_digest(this.ptr,J(D)))}}],[{key:"__wrap",value:function(D){var x=Object.create(w.prototype);return x.ptr=D,x}},{key:"new",value:function(){var D=m.signmanager_new();return w.__wrap(D)}}]),w}(),h=!1,t=null,j,r=0,v="free",M=[],B=[],q=0;(t?Promise.resolve(t):new Promise(function(w){h||m||function D(){var x={wbg:{}};x.wbg.__wbindgen_object_drop_ref=function(pe){C(pe)},x.wbg.__wbindgen_string_new=function(pe,te){return J(F(pe,te))},x.wbg.__wbindgen_string_get=function(pe,te){var N=S(te),fe=typeof N=="string"?N:void 0,Ee=fe==null?0:function(_e,ye,u){if(u===void 0){var U=H.encode(_e),$=ye(U.length);return T().subarray($,$+U.length).set(U),G=U.length,$}for(var X=_e.length,ie=($=ye(X),T()),W=0;W<X;W++){var K=_e.charCodeAt(W);if(K>127)break;ie[$+W]=K}if(W!==X){W!==0&&(_e=_e.slice(W)),$=u($,X,X=W+3*_e.length);var ne=T().subarray($+W,$+X);W+=V(_e,ne).written}return G=W,$}(fe,m.__wbindgen_malloc,m.__wbindgen_realloc),he=G;n()[pe/4+1]=he,n()[pe/4+0]=Ee},x.wbg.__wbindgen_throw=function(pe,te){throw new Error(F(pe,te))};for(var ee=Uint8Array.from(atob("55ZBgM/2Bzm2JGhNn//ljJsSorhWUYE66a1Hf8O7pfQGR2zfol8qRP6CDhsi3iG7nFZu9stSyPq/qu2Rr2w8QkTGP6Gm2cg3J5qsQgq5bcHA9mDpGv/b24uEwsixZVl1eGkdV4SB/6ayw2v48hLmNA+w5UlnTCiWwerzESQPidpSUMbamXL3pU815EQm12GhhZ9aWzo568gdZvXevBc/WHfFKQSuTgWva4e4eSmW7UxpH8sY4HlDsCTMu0WwEB8B95XsZwOp3GLgfOQmJBw036DgIKU+XGn4KpIEq77WE/h6R7sZKsFUp+u+2cDnW7IPNe7xfd9areFo0EUh0/9K9CqxUkLqMB5hlgS1fwQHRzKPhQ7gALyc6HwMCPooS0M1NrzjdfH3vUn0PeQ1GBlnrnXgiu8TunfHg5TcbBfPEbxbyiiow1Np+VEBlHNh00PiAWyu024NHaPbDGfMtzu4WF02fgkh8Pxb7bCSpCZndjTytQgAzfZxk2bbe6NoHHFnsviqYzHVpxoPEk7icHRWcZC28d2muthq673KCMQay1fJcPqSTuYhWUZS5eylIguT33lP+TBbOWQI8KtCzBN5FzqILfKzRkzrJ3L192BUF8SILdwmriv10HU9ZlQAyQA1VdegnzOl/dYk2GGsB3724y7w/7aJLHJzEfwrfIzFd5CoAft7ct+zQW2G4Wm2kpoz6uJfgrNyykQgwCO6pkPy1ADrBUuJon9ySjhgcFru6AKa99wTlIhzBw3FKFt9Aa1/1KWWy7W1wAIGzRTs/7rLXRkKFjNqGVXBdoVNTpHFtfEFsuX0X98ISr0Bennlx0h2Yl/CGNb5Kc7i3bio1XJHX24avcMsEAwfdfskCki4/dkStn7QC97YJC3z+7gD84IiEEeGcnn7gHJyeALr0ssbqDUcKqxEyheyFs9FToJziLB+eYw6nMQLmYTrQyrg3b+3YBdgx7pzNEDSyz3tmaPaikwcLSyB/Igo6U/oP/fS2TZLtmN03m4iS76YrDJAgI+2W1GboabuixVcLdxm6SQ4CzUnHSPl1knhcGhW/+OcKa53tB5j5C4wEpiENv6T9PUu4K0YwtEAqFbd/eN2wVAYCKn/nlVA8uiESxCfgs0411mRFk4i1pixJLPP5AFPG9QFZnj6X19TqmhmIhl8D6Q1rOvPCqPZV/z04HjayX4qPzPzP/5NVilN/sHhQe7ulriGmU/3rj5QEuiOymsL7EdCQMc/4mXDPdVrDBfbt6dnv11oLYGmqOP1oSBj02FtsmYrMn9pRg7HJoCh86jAnzuOYn4tGnQ4gw/89sb64NAXcoIbTIjyiHBAQCCK2Yn4I/fNF10rkQlvSvkpqLG2eYpJmpWrcouNDEUtJFR607oNraLdmUKyLc1g7SNpS+ofp1FL6rua/HFSrb5kTF2Vcy2gl+6MACbFRChKoP/un7IbYJuOima/JWFZcs/MXokIx+ijuqjMtVKaYRTzNI5ncPa2y/EXTNdUUFpMhbE7sa39Uoh6Hci/viXy2KFTNbiw+BkWOPnyOr04LjIYKlJ8ud/KvjuvNUGQOHJvj6tpZJxj97tr0OrgZCAxSHGU5JQfqEd/U0QfzGM8Wh3zdsnd9LhoIIRJAtyA2PmjwJk4zTxeYlgwPqAVTU3+9bA1QD+jLZZ3Ffk3MRq+Ar2RT8YN6ASR4bItt3omBj0LJe0zeGY3OzfhljL6LA1m4+IUp+CzeWo0aEjnvRk3iCJeajgdC+NUGB5qh8PWKtBeC58woavnRjvRNphXS4b9M7Aymcfq26B2YY2lS+wLf763OnGJlVdV/srgyAUJJZjarxom4zrYy23kLFB8zFzWuwSMue5Xm1YWape91JGDuRLIctrJWU47/XfLm6Zgei4xOwq1RcjikGuaZtDwcFg9aKtO+JOGJsCjy9AiPnmt+rmdX83GsT3KtTETnLv6ZQcnGtmt4H8AjFgGYePdQc40cj8VAOV8NCLspyW5w63b3g37GXJrzjm9Fym3fh27psjo5RuTs7XCSrNENxKm9jCcXPqWxyuXJSn6dhdWnw5SAnUjixXviWS4HsnYjw4Xt4cSwkqCB9naLstVXt5D2HgG4fzHFNHvnETft0mrhU81IBDTSyNFdDvFEX8cifoc6FcNq7pzXlotl2ZS1FIzNXddZrdXpBNYZPV52gtCok6ePpUR/Y8jyJpE9P3q8dmFVivVGgmKTcBKMDDbzeOfl4MpOGBtBX/Lab/kzqG42sTyOyGUyOoFXYGMUWJ33GPI2KNa/mW8zVl+imshfbj7PiK1qRUn74KjAkH4wjKnu50AONYUaiveSdwnEc1zCjZSJ3dmBKSxhWAcO2PdHBg5m9+JCiPGCVfK9dzoM8Bm7xx9noJiqt4hNiVa5di1Fd1JRN4rnd1DbKglKpAVSoqvJPxmuyH56TFE4BQjhfKbDMZezQJqx+KXDiW1JWGeDYaPVBWPYeZX6STIzC/DjS7UFlqoKgGGAGP17x8wmMRE6O/axG5jDzloCGxCmrymT0ZGCh4g54O1iDYUtmJr7Bo1d+H9RQj2Y10BxcMkLFTIZVjm9e3vtIbeRx0OdXE1Ou37J/WeJZyPXn1fszvp/KonCqVnt862LrxfoB/0sF5gk4Y/f6LVneU5hun9/V1OVre9XrnDBhcVaQa9Ye6gs8sHW9HCNchaFbkUpxSiyxVEFZIlbejbjSPFlkYOLhtQHduwZWRHWA9akqykJNG3PKvOZAaJG5nWQq8+e4K0JF/AXTKIIr4J7zDt8ZR4xb9T2gxjl1nfqzidMRIY5B4rkw0oetta+j8rqkFpTEGA+hU/tw7bDtpkPYvCguwncnCjwULNFT9I9jXx3H4Ws3WWMCit29F7kGq2Ka+rU/MjnuP0lsXkoB1rr8LawHH5gaf8rajq/BhKrGTIfjDiZG5qz+L7SZBZsMSZZ9pM1QhKju+GTD9iC+9HlhfXMtj94gz8U4h7eGXziEO7lo7LwLL6/DVMrGbkv68JYUYhGz2yBm/8cbQEh5vhakbhmpv1K6XYM9rzdsd9bwYcYt3cfKE3m+/NrUa42+RpJBdFg7cAmxsZ7/0TMyVw6Aqu2gzldb2ag4iLrPNEyW1ywaJ2DXMgPi/sjnDzhuo+vIUrc86j4ZLhT4GAN6uqwbnXq5UDzX7TfuB48oMvvE1sK5q6owkdWfklgnC6pSBpK7wl+e3kuvaYnGRGJJMBQuVgWL1awHrVtfOTsSE1vc0ZdG+a/Jbza6pHbyfi5L7FXJAGdQTk0EP3VT54+F7RZ/MJ9fj56aMxzhJRwQJ6df3cM26qSc5bW/zP3PFXypTOBwzCvVtwGQzkGvDW7XGwgLbTNHDpQXOd2BQ5Zd9bjQqGg+S+kIqWZVZCqVLfyFPF9bEOHfPepL6nRDJUD2l5uRnXqeTvidaSIoqS1Fbc6mLPtYnbp6uuts6Qo8TbMzFuI7NuaPuKnQIyVu7vUGJ8jg1uVOjlMNKdVtLPr9/ZEKVZVj7lsFA+nm3zRjjr1DRKhr/wY1CI1iXKVTeQZ0i2PSnN99j4iVTSwNAYQLWWD+KyZ/xRLVxmZQPuSkLeKBRAkavxjWnIFQb1dn72wMSUdcB9cNCNJNdyTkrl44MRR+pUuiVrTAnTlzL33X32eEYwT+vn564yxFJLUDyIMNjJ0nx+GreKSOglI2et0kAwRHKYFclH9GVTiVlB0TWeUJGD+7JYogF7BizjTGyPOUEWQCguIEmtC4fHD5461T80Z3Mp7rhNTI+Cswuknr9hrIZmpRyFSrSrP8R4S1Cf34Tu4RNrDxpofVK9nGTklZPsYM6eiP29Lx264fsX9oLdYhq7vCwcrRMJ1a5d0QHXUYRV5IqTFBoUSpxkQ6IHHL8ckM4NCzwk8K0CA3pj5Jp2a9wZjfKq7R/eukzQFuhMxV2qgHf2E3t7/SA8N7sMvsmF0p3J96QRE3rA85ekH1q8nrBVujlIqahmL0Qto3+JxdqAfnKMCblQGSKVWZgWLMm82MG/9pjhdkMzG7C2GRLGMty2y8NhX1pZWHNbLOmvaC424LNz/Nl5tkPv7fVbCT2ItB+/dx3ZhVhmgSLd1zL+2PsNFmj7VGBruTttezlo1mDKErjY27nTswjf2fY/Uq8lPcVAgRpJM+m7jS/8dk8cdl7fkY7Tuj4TfiSe0tiNSoJgZwom4+9haoBQ65AifaB7pUiTc0MAXCvG+nDydkRIbKx5fL6gAlyMAnBbQf+Qh1naLfzzwLVTP0EEyoenW2W1zKqfMql5rwGlyCB9mSa2s25yHf4SDSBlgEVMJtplpRgegZvDakpWDKgx3UR4W7yKW+RD7bd7rEa/GQmA/q0RYAOIaXfO/2CgEUPtNhPS2uqy29lBYFPPv5SHQ0t/jRxQLBpe09ateAWKypt9TWS7Z5gynOePS5M2NC16AhF0Xz6s7DUjtI0xNho9Y6GK16J5V8HqHypV/OAz7+VBzTaiR57XGH4r62GoAiJqfWOM7okzKCeeSBnOIKPHtwgM0SQbvCvv7rmS6ZAacu4BbXZ5R9gOhdR9H3bi7lWLBNnqqLPIy0k6m4XBhtl40B6z/5AcJxjtKfwvIExl7VsQRqbW8gpPMsmJZfSp3uC35g1AkP+BJlju3RVoFZNo3JR18A5uc60NGD4zvzIdGTAOth4ZAZx0ZGQItHuNcLz/0CiavJdkjD65h4avf1vf7LFZ1uogJz6vLK3uDisXIBIGkXOlIpxTdjjjTQt6Khy50bYbXsG9JBrSUGhsBWpeRUnq2cZWOifhfueY95gFIDAu37oKR3FQ1YxGMg3UMq+L2VN2rtqodelSHof8SyYZVQWs7L0bjtgolId1tAAjHI7J1/+JIRXeUBjjaGGQAU+az9XFfiqn+VRAGG8JDdP/WmEqjhYpcy00LIBIBzCF9I9mbXCv8IX9fhPlI5NqWGO/v0ikpfn+hb5U16FcPYsx+xLb4la6nSbvrTDP5MthPyeLIIY7ZE/rNU4ajgPmI0/3RvD7WtEbo8UGPjnev55N2ELuFpEPzkNu9MzXqq8K0cWxk4lT2DQPi3rDO8x8i5jX7wWQi8e0neCMb0SUO67zRfaekZONGfaFl47LByciUuy5dhqxMPokhTE2WbzxqCyt/s2TqG66R0ocYHmzv9f7tJ+TES8NFyzL3fhNoZoW5IxWNE+stYWutd3LPwa7HKhhRAbl5uCEbEGjrUzTXwbzG0qvpmNtpnYnmKjzTaSAFNCxfw9edcjaxCiRKKIDd6GS/eDsGBgTvJexDfwGmVWm9jadZhee9jRFiZFtL6m7sY1oQa8F9ycxSuPANXCqWkApcaEfQLkt1yyfeRs5yC5O/6XGJ4TEtJmCTPJFRr95au20STIPgkoEF1mzZ+5ZRtWKUYuWJVZDwcA/lTy6oYp0/d0LGPRUXnXRm0qtIXQVdnoVhKZPeWACt9rujRL57MEDi2kHtfV/ucu+k03bN0fQlbalUJ0faY99GC6L8MO8MXTSmqDAxNSpqpIFPhgHgAg0YK/GZhlQjbQXE4tMDEDO9obNfp4W6m8fdznMesSSRINBG5FDf//DkT9pSRQsIdSg4VK7W7j2d2jsQUIyjJmbd/2zCTaqh0Yq0cH6mS/5g/cq3eGOiJbaCNo6oVwGURzXVAeVaGIfJFhd2A59sVp+rVfe1f8B6bVbCLIKgGUgpUokO0vTg6ouAxXGQKtveMhhBT83ukPIRZ02+qF1kvM+nNCVy8uzrB0+W9QIKbMio2m/7zW78xd5Tf9itocpLbRuNC5cuS/GyRGXw6fzFzjM1UITlQ5dlvoyYxuvb7ol4S1MyhkfMNZbif6/xic0wB3uSScez3oFTRbCHBd0cbJL3cLwfQjCBpGBrRVC7174qW4XWnw0eYGSSzTVSEDOlMaTUIGJO+s7/z8JxaZprcEsoB4+vt9/+uwtM/iyqLVPidu8ZTh+F1rsEWKwZhDAg/giVc6VzRq+DJCrhn81b/LYlLJOdgoAjID2VnwgU+mQhCL6KhgIqqiVraD25UIYEqxMcZ1aRcZvHa8x5gh5onPtsVcl53Xek9BOYqkyj64acX921zwqoY0lmNA81NE7BzVts3cwWDZ4Dk6uuzwtfJuJc7vVS+fdVDEg3ATwC9oG5/Vb1swTyzTsl2V4m+93bSQo5STFG5AruTDWTym6Lxtt4OrAeIVgdoyTJL+keHiHTNiL0/nO5oYwftSQK1aYBuA0e12t/FVN+LsCk0L/hfCCcke89LuP4d46qnFo3NLpHb+NFrvekXVT4GiZgMW2H0orIY0TpS15wlxVUaGCUo7YSN0yWDRU5+p41dCOs5/vXq1do7K+Byjj35/mPlQ+VEDqqF7OIBQrXfHgCXYPy8ye3Ih3io+tYA6nK0/2clIERrpA0AMHKLTGEO7q/IzIcOCwYN9W/ISH4v4uk9MhzNu7Fg2IPCq5CQF1GLuzQu+wNv2h94NIA2UJydawv5X2bHkZjv+kB/WQCYjxUNEU8ssUdxDZstpv2qNAHmI6BMD84olxMiwFdK5J80zc9x7de/cz3ZNIkkGIpMCZJqKKkaLVo1MLnR/h/hQeUvfqJmvkPeIre3EjnliNkKJKL0KNaupHzY7Eoztaj0cNOhJ5dxIRB2is3kLcSK1FZswRJR0B5OXX+Q4UlFIrhR10lIge3Fg5DnaGoZoOyFaaHztrdF251JubDsCZRDSWA0y6ysykO+h4jhXtuWF7D5Wp7B4Hx3EQvKsmPPZYcLevowjlWghHbRBEhwPI3bzjhNWXlqtym5ObYAeYxuHyvyYue2X4651f7Om3+m8KT7Y/JqLWXwgayCdzxHuJidti1ITuf/oXzeCfTRbG5ytXlDk/epX061W6BO074jI7nV518OkYtRJDnPqdDFAf0uWcATfk0h17+gP7GHjy0Rc0Ive9XmvA6gCkoMjNjMEA7GQ3xy7e12DzfNpIfND7GKKojMifTrvkDXrfa3o4wNYktY6/VlBdHtrcH9F7uMWICej/BjZXVX83WFGcVHx3nOXxSL59kE9bSmHc3Xp8iDbPuSG5GIRp3fTFHnmTzzGedl6al2gUbGFKtkC0jFNtKTk2rr8LEObiGgfCoSpTWknvAYDQBoj93s0KiRNPOqgY++Xka2cQiDwqUsLl8/i57YC/V6sy5/NvhViRRZgCzcyjNHGzZsYA5YMtUntyfC1gNFP7cL3AwVA+326NJI7MQJoxTqcHL/YhntsnYTR5R6GVVvFYIlW8Nv9qn3daoGXMz0MoAsXpCzbiHZ0XWkfw2qlJkmZjgQtMAEhHXNgokGRPfOprmtlvNZaNlGB1EjQTVX1Y4tCyJFZhdhID4CowB23uQF16NifyxH+DGnQrnxeklnG7UQV2BRVdr6ZEKZYv7Gj+PbpojzAskvbdtaFsataqPrLDoejjc6ZfPA5zA0iYcCvcNjzuy9SuT0uG8NWMTLv2OsImL++PQV1sifUENAwi4O3yBvzTy4J77B7mMBpjCYGXAyjFGFZL4eAazSmvZ8thJ0FFW+keLHL+ft1dQBKmXY6JatelGebcIC/PyLBHdfX9bRcauGg4xEO7mMl8AjlcPMczkPniNQpiQFqcDJYrFGoxMV2hskxMn0bRQT8Ajc6w6sQYkGl0CQUImPrGfie9dsk4mrCLMIFOqcm0WT8O8AiREEGmooBTO7WI0qk506NsV7ffvc0rVJERJKcyRyCmFZdTSn/SrBfjV7SXT3pQlgluoY4FBUCDDkzwBgjkrE1oFUA3ls+xVP10w5jjBIMwKBSQqRVAEDXw+Dyj+jH3ila8czULWsCKhWd4qGsMFN7++OGBAz9eXHjAO9m++mTXF6qiyG35Q+61yjYQKsBrjR4NNexrwVGqBwAZA6cr5mp8AhoyzPomJ6TLfWEJjEeRI3QsX5oQkNuyF7u650QFka+VjFeNRY6ALklleTW9I0v4ABKDCXTGkjv80vqVNk+FTL0bJK7ndSjjMJD7OBFIEywBPJFrxTdyzocmxEgG0zu1VDgsQuXITYCx1RRty89A/F+CdSAlbMlIkptCC0GrF/jFS8PAU+6TNV1eBqJrCr9BgH1mth8FtdfE7druR+xyZKn5idfUKzGW6ACGF4M61IRoSs9o6xmaj3dnAVQvFWUsMcR6MI3xTKJNyMxkhXhhvT0IxialnG7i/BBzXfMXYh5jl4BXzCSNlxU4+aboEgIDr48/+pfj8J3WcNccFfzV6eiX05qkNktmafoBcxrEsrM8WQV0VVSRybQyXPOqJ1yndwBI6BOGO9oGxGDAd+HcKaZlptCMJsR1Cp3m7F9HpBFSu/NYVj+WSDY7jWSFBlTBSCFyyPEUn8S9NmBVa+mwGVsz0Q+fxe23w1w6wVO7sVnZqRpmXJeXg72QFkl7Qda1lBzn/FW+rRwLvFxCsuad67Wmzab1RJdzPGsuq8AzW6tL+JiwW/VPUSBbBmV1+EjqQ28x1u9W5Eoy7zhsU8NT87CtNbZ0lPEpsoWMewxC80kPanfWPrQXmixWDXXz7uf1kBTr1J/iYuls7fUsyAChXjKcKOaCF4ySqkhMTGmjNqYiG5joBUi/SZpWvgxk28pyIPhf28YULINiqmbWPBKuTCLFruV7JfRgGM87XfNEFc7tgnYx503k/0UXJfpmjx6wKbKcvV5fqrctx+OrIn++TxRxSKlTScEIwd2vG5mg/p5wsQDpiD+X91XbkReKLB25Jvp/IJaJh715RXqBzwCwlY3URonyy+oZoTD8Ym8XMMv/dMllh0LCFZkZFn2gYcLG9iO+I5S/GyxwjajQLQtwH7o+n50vimC+ES8ePOpPDwlu4oG8KhS7NL/OTdIWPIHbSa6/9DfjOq9W66EpaK57R78PpEzVNLkTP2L6lllqDT6SDhIDIvQS3SQbxG96khXgvW/rME+tiXFXi+BC0udi9keyGlc3sLBN3CP3QXzswhBGTxvz2LmRMkU3rLuSkYR1Gzr7vj1VxTN1y1iciA0DswsPZ38eB6X10Uzk6HZqjzBK+EJ5osJJJ/s3b0MFRIWYlM15TPm1uzeOk1zQ96quClQLEZbpxmV/eAduIotXUYQZjWAkTulBJt7kw9uEnLo7OpZrf8k+0ZQP0agcOTLbfrekHji86Mxr7rTwve82mePKoAkkEthE45VI+f1VqpyWNW1kbBbVVfuatKt6MEKqyTUyxSFGHk81kY7CxkgMNexiikN0+IeiUNsfuktjfOAiMfDhbTe4rtxSEPvO4CCUGaktA58TGnSO8rHdCicmGkNrwWsnXgUWjhp8bllNcnQN10TbwxYPAwQKW/JJiYQadr4THXO+vWudiq3I47vqmEM/Ab3Dlq11Q7RmRWntYOEyESbTI8PZYwbtsmjcSwBtTAIHQ5h3I633h3FpOkT2c0PlMjzj0Q/OuqaTVt639fowVppqvSlNcK5KupBnrxfKHQK+SoKSuaO8PNMkYkbcEAc9F0I4uzPfRVP/q5QkvJVsVoJ8BEWW/q1+kivHEMQfb+J2NfJjSTG+WhjHjL8eqi7FgfVewxwmqG9IOnTkwDjAHUaJMIyhVkadW/+GQjLyNP4zyHcLAdWcB5zQ2kc/blAx2RKfG+ON3RfC+iQ5Th7V2i5abkoy0pjfyOwTjIvaq9slSCtoNGBZggBDOiWwau0CX4NAIThFyqu9VWCLr8TsqhQZvQP+xrywovGs6A079U7YBjhEXyQw4Q3rbQY1EQnxTPXNlHfn9vQnuhsJnzx6PZrCqry8fidPz2U1scmAMVPHxa/injIf+hDziEU02xWm9ou67OgebktON9V6wwVotoNOzVNJhiDBlHbktBwOjX1BlJHybLox5y/7NhR7uc8f85O6xdxueabhwtJjYcBzac56v6RbuI9IRvPzOnNbltj8Hh0ftwwhWyHAyiEat0oDSEVZ925jmxJKAqTo4/uHnkozgMDsnkzXPXBDJ1sDTawXy23mXuTJOYV6ZVWrervMaGGGQpgQjAnfP7KPZro+OKt/MpnoM0NeGQgIFAiH7dU7Nl1QbcMiwO6/5nIosJtrFB8w1kpqb6OjI9BgZHG1nzTMGA++HNrl4WQNcq3SajD4C9utQYAu/fETPFMMJeCDwHRCnPuRAlqJ5t0E5h3Wlh1Nw57LQ36kDjC3lS9w0a89eI8ym6BzEA25Cdz3LQAyz94Fvjqp7MyHrpm3PzmsV/tbSLF9NJBjFmzWPQ8Tfgvj3fi8dg78tXvEatqtUhLxsNp2VCU6IzSqafxWw93+Wk47skJv5qxM+tv7CrpYKvWLEylJNEXlh7GHm9UenNf2/szZOl+54P4ZWksh1r6+rphL68QYhmqW7DqKVrc2rjzPYcvFDmKtCGL/F62i3riMV9z+LoLnuVaMn4dtpNNFmQEQ4uEhDfLYU4x8G2OHCz7gnxLCa4zE4CFo9m/+ECmdzziVumHM/P00/BESH2rxUYMBL8/9NRG5fiskFJr4AO0qNUKUCgTRgEiFsTbGXtP4DTTzc8ZAmfNJuJQE5Kp7W7U7QZnBXKepfSHkYTEqgOhqo95Jw9i56kYGt4BWwX50mC27CCW92SVMl4tbUEhBDSB36zgztz5Zts0563Kjc34B+6ZUnMIk+BiQNvqSkZHnk3rHNSaYthO72IWLIxij0hcv7n228yc82FsQLK9jmptjY6estDfH3OSMaAj+poCLKwRFXvXWb6jwM9mG4nu1yug0Cc4L89w4EYek6dnV17VBfIxB2dmFFQdp0kqx3BM9gdMAr0KS7WLOSf3cn5eDItDLP2UW7MWaIR+GJ0EGcEL3ejBdu0to6vDh04JcRMNU55usmSn3jp74myzWE3azMIT96wr39F62c3G/ldGskbqTIMTk3gMg61vNBQ0cJSIxVdcgNb3xFDowwVyIqYz54F8Rqg0uQE4FIiUGZxJhND/AWhkukqIqLLZEpxj07kPBN6Zb2pWht/X5JrC8yJzPlvFhfJndQ4jcgjFyhvymr/a17uxTKHpKNWDEoL4nNa9/Prf7TYRw6Gyo6vcwYcUHk17SMb9aEdVnx24msNCDEKbj0OVzRaA3gFJeXZPObqJKvWqFlavGpxXnP+4ZYTl0Dmcri6vMdwX687ApG+ygiGHZDwNzU68F4JMPQ9JB45vLkCsE2w50QNP1kJZlI56dVGzfK1MyRqP4J6VshesfOT4hzR6MYq373IoONlLvENdYXN6pTxo5eRzQkwk2tZ1zmZqczCytqTEhpweKcBCCZ/FhizgLm8/x5ScBlO0wEXHZm90mpmL1gR/J2CUnz3wDU99YFFKqm01AZ8q2S5Fnh81CbD687c7K2OjWlZgdvEJA9M0JT3eKdIRd9GCx6g1TO5PWTE8OOphUDKdazyYnmMqFhFxfJ//cWJTsgYbol2a7Ob/Q69Fy3kb9K7aZLzH+Kl/uCzWnqTOrQonVL7LTFPr7wbTaepfAl5zSgMInjrGXY+Gspw+fCNgEU1zyC0Suum6VFyHBjdKWft7strrOXqOSQwxsYXp4F013mN9gZyu4Hc84A4dzIHN5UNXmxNn+vPjS82JM6klySWB9pLCzLBUgXiMDllaG6fT2PSBv/b+yaruyWBVcpsOKuEaQ37W3A3t9YFRcgB5rFMDjwOn3c0lfsg+5V+dBX2EmWLTSelNZkeq67CFnxaKtnlsAJRPBqYvoWVZcJKn0zSelrO2TwnailO7zgAHaMRmQYbXo9beBs16JWf7V8LjYGS/DYUKTTE1zKECC/pK1EKf6mxIgmV+mJ+Mc8h04qep+okIIEXaN351J3N0VUk7cEEaOLE1rFF3W4vqRcodPfbLqINF6QtTsfny1+O46J5ahlamZEyxglZtpjEkKd9yKDsgwnzqoAPN5o76IsI+FRaBc8u1qLBWxpKU615chTVegNFR5V4o1T2JGwVkueD6CjAhOplPnRyv8sauMnMy2wEMARR6AmCQ8S5ebL0nCEqjSztMoUyAEjQ6FDYqkGweu48DkBR5HjwlBloKVawYcDezxKBH8WWnMpJKZj1Ol+OHMmg5iq9xDswLx0iTNkujgatOkeRU0c/GmSSH+7GTTMLQJdj51l3EkojjEwWOjw8XBOm88GqC4bWPEE+U/5XYtZNJG/X4FYjgIvVd69RYVbMEMfPSKJ825e3XQ6RBesp/G+lkMk4VIxRakyUBPLO1u0UYnNG9ExAnPdOO0OfFvcPOL9rBJO8bR+q9Lp9/i+fH32KkaNR2WgoxQY3FY+rS2NUvtCOgZAaF9vny16WG/3zeUtRP9V28PcGivAHAwwCcRk0D0iohjAfgL/EKXJkr8gIFqbNq7lXUFRKqMbpBa182ol77SqJq1M5setGUJuSBKqYBYKdDZv3XdT/u6J5aKKkLvA5ez6PuWX0RT7kELSKDKfg9w9nwSmMmJHjbnr0blM2WvpiirR/nLid6SRN9+5KoLUb+pLw3QzD8JlS3X2q0m4BNRxfltr5KWqryOuuGDt6IOHSE8/zqGXMiTqgrUOfDH58NoWe0te4mFc1GxswvhZXWJZmaWaMJo2SBnuXa7+jIfFbnhNH74Z6jygwcqXsldYfI/Zh8BZbqTh2I7Hu44dilfbX8Uh18NVB3phRnTwpUonKquUs/iZXRnDFjtEmKg2YRQm2CP1FWRb/B92HqJlHT7Hs/Tpl3RrlxvkoskpNlW53/6Ujse0fkHLNeUm97TlDsaRXpfZkR1uWMTwhPv4oYM2Bv941R+c7nQ0yBdFNVQpZRkpejmIfjFrdQUA7DPwR69aq6Pzmk3IXarIMKG6R4MBdkB3j3HWxohnZLWpaNy/BMxS+84e4vPPfO/7+nLWVZsdpUY/nGDkQts0NGnRpZK/lW60tmncMoTepY5fMbow1GyKhqSXLbOZkz59l8DG9v9ZHPwA1roKz3MW/j2tN/U+lPQVYXTa6h1ePQkSWR2bp9OHmCCvT6s8v9PVG2ufK7dkbpY500gNx7fdArzH3yCjY33Fa5TbOuybLNdW8juJyJtikDn+5jMnMzIWP/+v12XkaXj195xk6eOKuvA5zeKk1i1PrSnmWA46Ca2ldgNqJ0rvLqM9X2EPn/QuMjLnLg0iVJ4H4r5S2PgpGdSdfVoiX/rBAq6yVDc30v8DOUae4oquSM0YDCIafLQ+hvEmB5b/f+QsTFtAR0zIVWeLyYbmrx3g9gHhVRfelCz9/exh19AGsyXcwuSaBiCzQIoctYvyhhkdCsC/cdZDce/1Fav35JQt+RJFAjiMRQhCdE4eS3SmfsREHe9LZa0ElOLhxxvs5uS/SnMYssyK9FxiucRjjOqfaIp2N8CmuNJqg3WvtMk+MlbAYeji9K94rx6U7nj9L1TGhVcAyz+Gb4sib21AW94HRzWbTrRKEkx5+KLE69Vc+8Cj1Vu2GkZ1AA2E4kaJ2aTjsEL2C0srAINXRAjnxwI3p5ED0NRYn9sT1iY9GPBJwhhd6WXEJ/Z44D0rufaDOA8dUj1SIqywRs2b7SjYcCYS8eefkwdWlpN0DvnecdwHVc3TqyCcUy7K2PMS2l2KZHzZfLCTCPaPq/NVc/Nlc5hVJoFvnNUpKWZcTsxVeHfH1mnELREECq9YES9v6FcvONCxXLQmf0k3S2dyNmsxbvlXM0u7lSqkx81md0rad3E33PPuPpDGM9UiBhSeJn3Sejmx+LdLCiZYcVxow59nCqrUmXGAbsR4O7wVQzyHdL6DX5s8k5BjHXlONz0PaIqS89xMhkYetMw6w7JZ5c/oJBH2jdZPbS6KbR0RpEe16BATLzU4QiHybxArrjBM8MKKP8Zz6MVbg/d8yb76U8nQzCK4Eqa5ombBm7/6xo2dR9O/ByfcU6qDu+efdLFAP4LiCr6C3aihDPjigUYuy0voLuX3Flevl7xXRtRZ4Vc48j2tgA7tK0wqv4OjLwCzZJn9lYIQuScQBEFMBjA6Vj8FTp4h3OphB6g0uA13nTnVLmKQ+zfELl+6znWX5nCWvbwak0t3q4qwWK3MAPKE2vqDEeCsFKvmJ2Ws+VOqnrA+ekCk9jaszBsZd71InADWijT4SHnyVmc55dv5ivXl1fED4vwNrxbiZHWeGinS3ImcoDAT1vGiLpP/D3NaiIPq9A2h5DT5SgaCVCh0JKu7DKsHjW9ZAACRxHgTSo5jrVWUJfGKweg2auQuittVidB+JaCdwYd0x9oJ4jyI5UygrB9Nzi2gbLVcCnpu+1ytsiWCbJb1Xxas8FhG/EX86taG6flZZauhaGnpRyfBB5ojGdsdPBVHEtb8R951oaNTvKXK7CddSeWaeOi2FIDPEhWhAk19RzuR9wSKEwvvi8nQFz649+fUlBMuDL7VmUBSsC1ExWwqY+uSdNKowEkpsBb+/KpWl6oGxymyR/e4uKjipBJrVPXg0nE2j6HL2JbCHNh01lV+/+6FUglhV8GTypzdvdfhYc7t0ZYtkyH/17wDakU7r1GAdUIXXmtxamhK2FdelBa4BPryblCC9gJG9htJue9LMrNS7mM6gbRA1xSFnWNsziDuGZeS3Dcu4bjsWaIebrgNnxpl/pLGxV5EtkFwDeh8fPyfPU8CZAM/Ljk3+Vi7jUtNZmZM8+f7d4wlUIkTHiAULRUKu0ODFIeyk20BiqLB7vvAT342SIDP+z5FPaa6Tjyqh/AsX2jFhbeIXKxDMb8fid0jHAWk6JKhswbtvtP6bDz+lYjvXIPwV1Y+nyft2uM8c1aUxmDHAUmZnJBvZXT43mxjXDHP05R1/dKfoExcgcYzv3wO5mazi7ugS01z6oUmByKtfQ6fA2+MQynPCoDHcp1eDtag/E3HQpHMWAgGkNh9wWR5Y48YG0W4CgvOrngI111j/x+MIuH5xFlVkxqptSjW+hnVbt9qxtXndEH5RtnxWfd9eP+kli/x3LU1WGsZVAkVElXD274LBGK0bMveEUbj/6EpnocEnvRSlglpE4GiAO5S4JdYb4uYd6oeK8vuZvTQaWMS3dEIJ2ssCxWz8DqYmc/b38ynz0DWCCeF1gCyipaLG2Kq9wqfHz3S6m7CS+H42nmDYAz2dYcx77M8purGOS5tQ4aykJXIDQBwHjIGSU+52M+1OV53rp4B3JbIXecQWEjfk9gkVoz8T6HJbIhFgm3quNMk+cIyRHlj/BdURXY8o7H7dBQfsdpLJhAsxS/1JtMkY8JoP4YdyOxzJY5x/+A9scOTXvPVoQAMqgmP899s6GvRtzNFGXLX7VHSnUj7VPO8K1qxaS/a/6v/YhRlUtNgnqnth3Jo/DKbdhdPn6HgB9YjU5GuN1uPyUXZJDZYfFwMfdqNPVoI8d1csoHMK5tquGoK060mIwBHMk3pFGqBosajr9g/5kBPrrtuIIEPFZnaAKSCQqLdeQq2B6Bs8WxD8+DfzGJ2nu0Xeb58spPoiHZAVV+I5lRUseUE0IA4E844UzFYADNYcLBW3zsP7aWzLnUZoQPuIDR3FX3bkM5mCunvXaPSi4PRkKnItEv8/OYiq8RSKQcaTwxX9YgdNbgPuXLwb5ARofv0Zj3WpHhNnlTq2Qu/lwvM3PUaqv8L7kpFqQR9aRaXfFanbLgbyxJ2kAx9oA1kRMyH3JXI06oQhRiZQ1LtWz+QKKxme0zAgI2q6/dmYApsA7WGeBae5+Y3eqkqDjXyS7Q+LzYgrM3EiqGHsibaKZKgFecxpGiMLXY5+kkuDKBdMkj2Bd8uTKI+aTWpu97gNp78fm891zYuT68sIEzE5JggpWjlWFSpzYayxvnOxJ3JYK/q8WbCy14KhtCFhdLOxCEAvyqXN3K+oP52ZzdxHiCAac5LX2TO5CTmkxp6zCT5JZDIBgnnmQU8GBowEvogfPni17fE1sljd55P2C4mWCNDr8l3hMH+4zpyZqp3iFbJx20nGtU+9LJozl0OxNrk/c0C9chEe+k4vUECnUaXbS8JqdnymqbZ1SCI+4+1BYMW4nzYKDLaqL3Nm08C/Ug7zNg2BuwhWepXrkqaRX58LCWLPDQyUzn369E1drtekeuNcI4SgdmyQZ/7xhXZ6sOKg9G/HEiJQsriRQThvHz4BhaFaXic4nlrz4LhUthGBLbnnB6tufJizYx4c6b2rY1E63pLDA8QdZsTOD7euNMku1a0T2nNQ9rOPBYPDyksaP+EmKTvqcgRycKMtzhHh37mAqVERuzIIMs/zXE9jGBpJBBWb8KCPZne6Sxw0+UFlY6/VeXJUHunHXY1csfc40Tw95XrkpLzxqX/LrsaYM7Y0UQ/Qe6PTjMQUXDseSMhYwHTXCohySQ+1fIjz/yjZWRFI1/a4d9eQzWLoGjz8O8ldPhzhpWFwwlaR0T1gpMP3VeHvDOx4RJocHJOSRQ+H4/nHJsiuXWDKowYZZW8Jk9vUiw2jExedn7glAsC/bgN1NrgIp1y+y3tmLd2V9x7yKVC+QK6MOFq19dlQflj350qUavBULMCTn0BvCRQY4q6VjniU6XHISUsaApCVoQeevAOuCUFcnwWfK+44XDo1qSpPF1wcnbH7N9aO+AzD212PgFlGkXlaQ3Gbfz9XIUMjulgGUREelr6IX+tR2K9H/yep959z5WLXlZ81Z8HCIV8CyU0JKYzkIeFqf6o2ywb2O73oRi7i8F6Vcn2zU1VWZpLfSXgTNkRtqM7r5s13UimLWtAVZs97rLcMRlwXzYp98ZnKvQLj/dpKn8nfNnU9V2Bp90frlQedeKt6zd4mPR53FKQ1J4r95n1G8ph0XG37DC9b185sWbnoyC4Q1iUvyy5IOxBrIqbqn/JSUWzdrlOiZGDJrU5IGuzUl5TaupUTIgFeLfT6uh0gIEJ5nZQ/8XjB0mmEZxTvocrU/BFoOaUvV/N48W3W/aQu5nR3KwsSByfSDAEq6qBqTVTkZtkaAd/1Rie2jkdRlZvxFMu0MGnLc0SHPII8eOz/bjfIhSQhAb38dSRcFmfRb+fpDrDHeazED6EHNayy0kESoRG+XFbJa6xWB6OlbwHVDwdO9Ka7bIOqLRHpZjwXmv/2DR9nu+2xwxE39cBHq/7Vv99HcvH8ZJeGmgHr8mBKQmOCTkvLkxf5k4FrqZuNpaRNhCB3puFuF5d2nnQbhgAaANLMCYAiGsJhX2bFM/r3BGhR/dkGPXeBQUJ4tTARQnVqA07mW/42Dv2k7Wa7hWU/wv7FTIWLwWyHX0Vqdg4BHrlJ7zh+b+T6fH+W3d53LS5rkXK5GIctMIttK+osfGYIvOD0BkkXBJR0EYUmteToIxpoaMVKZmCRC2BbmBLdUTIZiI1kVYKYnq9Q5xMGODu+6vCT2ofvYE0pmGbQ9Ln6wnBDYZUD/BL9rmiPn3n28Zs33OsHUQcLp2vjUEV5sOBLO2ScyescGu0N58y1q1NSNJuXCzI4fu4RWJtSIn3P3+9eAsMo/2NupFeaf70/usLGd2Z0F27EjLoIj+nmJ4/Q5edPFhVNpPURQrUzPALNNzEvx3e82rDtPpbZjugv7Abm2q2vMGwz5W+hGH0hkCzXdZhPFbLk0sR5vVhScLgAPdZIVZIjTuzwIKVuWmvpMr7Gwxgiglpy8ecfOAZcCpXRzG6lNuRB64D4G9AWD9vQi/crWV4Xq5VjJnRjQc3g4bJe+MmksjEctghn27n5i5PHZvW/gM0BsXzo8Pou6yOLnp49dGXpK/oLAbOdOel9h+kDqEtZunvsXa9EFomdl0QbDvk+H58SjszCVqVOXSgDpOdZjXWfZpFL6S/fd1Lq8FQS3LklgiNhdvE5GzgSO8uq3gtj8I2o+JzucnrUSrtoxa6IejmVQLGzF3rSCy3fdhBPhZnDdgctC89dRJ+PTfW4ga5WWAyaWspzFg5251FoByB8LUbD3AxhvV6M1ARNXRJ4NhPe2j9WOlu5I2KmCMGvGP5CbHAyZk3YhiuIdtDgOvre9Cz0yOWvHH5FpZQzqzyHE5XkTTFMU2JhG1nvne9SCi9zNvPnGj9h/bQXgpue78rpogXJl8oDSfMwz9fp4ocyOxEV1JCEslSsRvodEzPbUsMUYWDERNzR6f45Ku6EmW3qdD48dcFQtc9rr2wF3o85edZ/2SY0BSkOdQX1ahwPVBP554Q1Z4lbd0d/vrRCO5k3QBWOb3iML0vI4MRkiKwqt735Q2fkq0Xl1pI3nk4ll51cSEHOrFTctkxwLOiQl6HJh2q3iqHFmtOCSo0A4YLl+mllolm7FLpe/79gMoe7A5cbFPCbX9Z3GhI43FgBbWoq8pwaIoDlklRimVauOx355pv7v26P0MLrgiqWTOxJaIGO/UhHf7GSOm0r1O5m1sPYYn1bathmEkYfrQLiEWQ2/3IjunsIxgAmi6t4JsxalYxE4YyvD59EpzvswOjZUvSgkHwPZonVtaiMTLXnV3p0dKpCSSz38Kv8QbNFzqLbwbBBRUHw/nHSxNipNm5vtjfkuf06jWRwkctgu8wZqKwS/7IcGnFtmwnbJFPhpGcyV9GVFzCCG+TOeNgAWxOUPgmtLdD8JawVVDV+e3iR8kHuaZXIknncI/3uFnblTd2P/OdWvxl+9CXbqJb1CS8osg2fg/qaA9KvM3FQoZQ79JRZC/Upm90ABPCGzksTWJ7Xy9VHpnPZCgGzAVbJhmurq8tm24BjBvnm1GOKfotvCqXyIXFE1bYTRS1WtzgZrGWgR/oOUDnNgDPXqUfTmyFPfNCD9MX22hvuBans/Kl1DustiTunl9Kravj0NG1Ds5nkTqlQSYOfhgvRIowimmWAYWma55eqvaQL9GvHmuH/hIVB/tiN6s7yOW2iahReL8dNddIbMJ6BLVguJ4n1dnquV3ZNqi6V0H/Vn00j0cE80ERsZTgsHPJ0eUjxYik+eDtaEHnyAsYeR2AjRcGw=="),function(pe){return pe.charCodeAt(0)}),Y=new Uint8Array([177,156,215,89,13,111,230,1]),Z=new Uint8Array(ee.length),oe=new Uint8Array(256),de=0;de<256;de++)oe[de]=de;var le,ce=0;for(de=0;de<256;de++){ce=(ce+oe[de]+Y[de%Y.length])%256;var re=[oe[ce],oe[de]];oe[de]=re[0],oe[ce]=re[1]}de=0,ce=0;for(var ge=0;ge<0+ee.length;ge++){ce=(ce+oe[de=(de+1)%256])%256;var o=[oe[ce],oe[de]];oe[de]=o[0],oe[ce]=o[1],le=oe[(oe[de]+oe[ce])%256],ge>=0&&(Z[ge-0]=ee[ge-0]^le)}return h=!0,new Promise(function(pe){(function(te,N){return WebAssembly.instantiate(te,N)})(Z.buffer,x).then(function(te){h=!1,m=te.instance.exports,D.__wbindgen_wasm_module=te.module,pe()})})}().then(function(){t=L.new(),w(t)})})).then(function(w){j=w});var Q=!0;setInterval(function(){Object(s.getParameter)("UPLOAD_LOG")&&z.info("console log upload")},9e5);var z=function(){var w,D,x,ee,Y,Z,oe=null,de=["DEBUG","INFO","WARNING","ERROR","NONE"],le=0,ce=function(o,pe,te){var N={};Array.isArray(o)||(o=[o]),o=o.map(function(he){return{log_item_id:r++,log_level:he.log_level,payload_str:he.payload}}),N={timestamp:Date.now(),sdk_version:s.VERSION,process_id:Object(g.getProcessId)(),payload:JSON.stringify(o)},j?N.hash=j.get_digest("".concat(N.payload).concat(N.process_id).concat(N.timestamp)):te&&te();try{var fe=oe,Ee=oe||"https://".concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2");Object(b.post)(Ee,N,function(he){he==="OK"?pe&&pe(he):te&&te(he)},function(he){te&&te(he)},fe?{withCredentials:!0}:{withCredentials:!0,"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})}catch(he){te&&te(he)}},re=function(o,pe){if(Object(s.getParameter)("UPLOAD_LOG"))try{pe=Array.prototype.slice.call(pe);var te="";if(pe.forEach(function(N){E()(N)==="object"&&(N=JSON.stringify(N)),te=te+N+" "}),M.push({payload:te,log_level:o}),Q)return;v==="free"&&function N(fe){v="uploading",setTimeout(function(){ce(fe,function(){q=0,M.length!==0?(B=M.length<10?M.splice(0,M.length):M.splice(0,10),N(B)):v="free"},function(){setTimeout(function(){N(B)},q++<2?200:1e4)})},3e3)}(B=M.length<10?M.splice(0,M.length):M.splice(0,10))}catch{}};D=function(){for(var o=[0],pe=0;pe<arguments.length;pe++)o.push(arguments[pe]);w.apply(this,o)},x=function(){for(var o=[1],pe=0;pe<arguments.length;pe++)o.push(arguments[pe]);w.apply(this,o)},ee=function(){for(var o=[2],pe=0;pe<arguments.length;pe++)o.push(arguments[pe]);w.apply(this,o)},Y=function(){for(var o=[3],pe=0;pe<arguments.length;pe++)o.push(arguments[pe]);w.apply(this,o)};var ge={};return Z=function(o){ge[o]||(ee.apply(void 0,arguments),ge[o]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,stopWaitJoin:function(){Q=!1},enableLogUpload:function(){Object(s.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(s.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(o){oe=o?"https://".concat(o,"/ls/?h=").concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v2"):"https://".concat(Object(s.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v2")},setLogLevel:function(o){o>4?o=4:o<0&&(o=0),le=o},log:w=function(){var o=arguments[0],pe=arguments;if(pe[0]=p()+" Agora-SDK ["+(de[o]||"DEFAULT")+"]:",re(o,pe),!(o<le))switch(o){case 0:case 1:console.log.apply(console,pe);break;case 2:console.warn.apply(console,pe);break;case 3:console.log.apply(console,pe);break;default:return void console.log.apply(console,pe)}},debug:D,info:x,warning:ee,deprecate:Z,error:Y}}();O.default=z},function(c,O,y){y.r(O),y.d(O,"report",function(){return _}),y.d(O,"SESSION_INIT",function(){return C}),y.d(O,"JOIN_CHOOSE_SERVER",function(){return I}),y.d(O,"JOIN_GATEWAY",function(){return P}),y.d(O,"PUBLISH",function(){return T}),y.d(O,"SUBSCRIBE",function(){return F}),y.d(O,"getProcessId",function(){return V});var m=y(46),d=y.n(m),E=y(7),p=y.n(E),b=y(2),s=y(0),g=y(14),i=y(28),a=y.n(i),l=y(47);function A(n,L){var h=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);L&&(t=t.filter(function(j){return Object.getOwnPropertyDescriptor(n,j).enumerable})),h.push.apply(h,t)}return h}function k(n){for(var L=1;L<arguments.length;L++){var h=arguments[L]!=null?arguments[L]:{};L%2?A(Object(h),!0).forEach(function(t){d()(n,t,h[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(h)):A(Object(h)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(h,t))})}return n}var S,f,C="session_init",I="join_choose_server",P="join_gateway",T="publish",F="subscribe",J=new(y.n(l)).a,G={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},H=null,V=function(){return H||(H="process-"+a()(),s.default.info("processId: "+H)),H},_=(f=0,(S={list:{},setProxyServer:function(n){J.setProxy(n),S.proxyServerURL=n},getUrl:function(){return S.proxyServerURL?"https://".concat(S.proxyServerURL,"/rs/?h=").concat(Object(b.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(b.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message")},getBackUrl:function(){return S.proxyServerURL?"https://".concat(S.proxyServerURL,"/rs/?h=").concat(Object(b.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"https://".concat(Object(b.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message")},getSessionStartTime:function(n){return S.list[n]?S.list[n].startTime:(s.default.DEBUG("[getSessionStartTime]: session ".concat(n," no exit")),0)},sessionInit:function(n,L){var h=p()({},G);h.startTime=+new Date,h.sid=n,h.cname=L.cname,S.list[n]=h;var t=p()({},{willUploadConsoleLog:Object(b.getParameter)("UPLOAD_LOG"),areaVersion:"global"},L.extend),j=p()({},h);j.eventType=C,j.appid=L.appid,j.browser=navigator.userAgent,j.build=b.BUILD,j.lts=+new Date,j.elapse=j.lts-j.startTime,j.extend=JSON.stringify(t),j.mode=L.mode,j.process=V(),j.success=L.succ,j.version=b.VERSION,delete j.startTime,S.send({type:"Session",data:j}),S._flushInvokeReport(n)},joinChooseServer2:function(n,L,h){if(S.list[n]){S.list[n].uid||(L.uid&&(S.list[n].uid=parseInt(L.uid)),L.cid&&(S.list[n].cid=parseInt(L.cid)),L.vid&&(S.list[n].vid=parseInt(L.vid)));var t=p()({},S.list[n]);t.eventType=I;var j=L.lts;t.lts=Date.now(),t.eventElapse=t.lts-j,t.chooseServerAddr=L.csAddr,t.errorCode=L.ec,t.elapse=t.lts-t.startTime,t.success=L.succ,t.chooseServerIp=L.chooseServerIp||"",t.chooseServerAddrList=JSON.stringify(L.serverList),delete t.startTime,S.send({type:"JoinChooseServer",data:t})}},joinChooseServer:function(n,L,h){if(S.list[n]){h&&(L.uid&&(S.list[n].uid=parseInt(L.uid)),L.cid&&(S.list[n].cid=parseInt(L.cid)),L.vid&&(S.list[n].vid=parseInt(L.vid)));var t=p()({},S.list[n]);t.eventType=I;var j=L.lts;t.lts=Date.now(),t.eventElapse=t.lts-j,t.chooseServerAddr=L.csAddr,t.errorCode=L.ec,t.elapse=t.lts-t.startTime,t.success=L.succ,t.chooseServerIp=L.chooseServerIp||"",t.chooseServerAddrList=JSON.stringify(L.serverList),delete t.startTime,S.send({type:"JoinChooseServer",data:t})}},reqUserAccount:function(n,L){L.vid&&(S.list[n].vid=parseInt(L.vid));var h=p()({},S.list[n]),t=L.lts;h.eventType="req_user_account",h.lts=Date.now(),h.success=L.success,h.serverAddress=L.serverAddress,h.stringUid=L.stringUid,h.uid=L.uid,h.errorCode=L.errorCode,h.elapse=h.lts-h.startTime,h.eventElapse=h.lts-t,h.extend=typeof L.extend=="string"?L.extend:JSON.stringify(L.extend),delete h.startTime,S.send({type:"ReqUserAccount",data:h})},joinGateway:function(n,L){L.vid&&(S.list[n].vid=parseInt(L.vid)),L.uid&&(S.list[n].uid=parseInt(L.uid));var h=p()({},S.list[n]),t=L.lts;h.eventType=P,h.firstSuccess=L.firstSuccess,h.lts=Date.now(),h.gatewayAddr=L.addr,h.success=L.succ,h.errorCode=L.ec,h.elapse=h.lts-h.startTime,h.eventElapse=h.lts-t,delete h.startTime,S.send({type:"JoinGateway",data:h})},publish:function(n,L){var h=p()({},S.list[n]);h.eventType=T;var t=L.lts;h.lts=Date.now(),h.eventElapse=h.lts-t,h.elapse=h.lts-h.startTime,h.success=L.succ,h.errorCode=L.ec,h.audio=L.audio,h.video=L.video,h.screenshare=L.screenshare,h.publishRequestid=L.publishRequestid,h.p2pid=L.p2pid,L.videoName&&(h.videoName=L.videoName),L.audioName&&(h.audioName=L.audioName),L.screenName&&(h.screenName=L.screenName),delete h.startTime,S.send({type:"Publish",data:h}),S._flushInvokeReport(n)},subscribe:function(n,L){var h=p()({},S.list[n]);h.eventType=F;var t=L.lts;h.lts=Date.now(),h.eventElapse=h.lts-t,h.elapse=h.lts-h.startTime,h.errorCode=L.ec,h.success=L.succ,h.subscribeRequestid=L.subscribeRequestid,h.p2pid=L.p2pid,isFinite(L.peerid)?h.peer=L.peerid:h.peerSuid=""+L.peerid,typeof L.video=="boolean"&&(h.video=L.video),typeof L.audio=="boolean"&&(h.audio=L.audio),delete h.startTime,S.send({type:"Subscribe",data:h}),S._flushInvokeReport(n)},firstRemoteFrame:function(n,L){var h=p()({},S.list[n]);h.eventType="first_remote_frame";var t=L.lts;h.lts=Date.now(),h.eventElapse=h.lts-t,h.elapse=h.lts-h.startTime,h.width=L.width,h.height=L.height,h.success=L.succ,h.errorCode=L.ec,isFinite(L.peerid)?h.peer=L.peerid:h.peerSuid=""+L.peerid,delete h.startTime,S.send({type:"FirstFrame",data:h})},firstVideoReceived:function(n,L){var h=p()({},S.list[n]);h.eventType="first_video_received",h.lts=Date.now(),h.peer=L.peerid,h.uid=L.uid,h.elapse=L.elapse,h.subscribeElapse=L.subscribeElapse,h.subscribeRequestid=L.subscribeRequestid,h.p2pid=L.p2pid,S.send({type:"FirstVideoReceived",data:h})},firstAudioReceived:function(n,L){var h=p()({},S.list[n]);h.eventType="first_audio_received",h.lts=Date.now(),h.peer=L.peerid,h.uid=L.uid,h.elapse=L.elapse,h.subscribeElapse=L.subscribeElapse,h.subscribeRequestid=L.subscribeRequestid,h.p2pid=L.p2pid,S.send({type:"FirstAudioReceived",data:h})},firstVideoDecode:function(n,L){var h=p()({},S.list[n]);h.eventType="first_video_decode",h.lts=Date.now(),h.peer=L.peerid,h.uid=L.uid,h.elapse=L.elapse,h.videowidth=L.width,h.videoheight=L.height,h.subscribeElapse=L.subscribeElapse,h.subscribeRequestid=L.subscribeRequestid,h.p2pid=L.p2pid,S.send({type:"FirstVideoDecode",data:h})},firstAudioDecode:function(n,L){var h=p()({},S.list[n]);h.eventType="first_audio_decode",h.lts=Date.now(),h.uid=L.uid,h.peer=L.peerid,h.elapse=L.elapse,h.subscribeElapse=L.subscribeElapse,h.subscribeRequestid=L.subscribeRequestid,h.p2pid=L.p2pid,S.send({type:"FirstAudioDecode",data:h})},onAddAudioStream:function(n,L){var h=p()({},S.list[n]);h.eventType="on_add_audio_stream",h.lts=Date.now(),h.uid=L.uid,h.peer=L.peerid,S.send({type:"OnAddAudioStream",data:h})},onAddVideoStream:function(n,L){var h=p()({},S.list[n]);h.eventType="on_add_video_stream",h.lts=Date.now(),h.uid=L.uid,h.peer=L.peerid,S.send({type:"OnAddVideoStream",data:h})},onUpdateStream:function(n,L){var h=p()({},S.list[n]);h.eventType="on_update_stream",h.lts=Date.now(),h.uid=L.uid,h.peer=L.peerid,h.audio=L.audio,h.video=L.video,S.send({type:"OnUpdateStream",data:h})},onRemoveStream:function(n,L){var h=p()({},S.list[n]);h.eventType="on_remove_stream",h.lts=Date.now(),h.uid=L.uid,h.peer=L.peerid,S.send({type:"OnRemoveStream",data:h})},streamSwitch:function(n,L){var h=p()({},S.list[n]);h.eventType="stream_switch",h.lts=Date.now(),h.isDual=L.isdual,h.elapse=h.lts-h.startTime,h.success=h.succ,delete h.startTime,S.send({type:"StreamSwitch",data:h})},audioSendingStopped:function(n,L){var h=p()({},S.list[n]);h.eventType="audio_sending_stopped",h.lts=Date.now(),h.elapse=h.lts-h.startTime,h.reason=L.reason,h.success=L.succ,delete h.startTime,S.send({type:"AudioSendingStopped",data:h})},videoSendingStopped:function(n,L){var h=p()({},S.list[n]);h.eventType="video_sending_stopped",h.lts=Date.now(),h.elapse=h.lts-h.startTime,h.reson=L.reason,h.success=L.succ,delete h.startTime,S.send({type:"VideoSendingStopped",data:h})},requestProxyAppCenter:function(n,L){var h=p()({},S.list[n]),t=L.lts;h.eventType="request_proxy_appcenter",h.lts=Date.now(),h.eventElapse=h.lts-t,h.elapse=h.lts-h.startTime,h.extend=L.extend+"",h.APAddr=L.APAddr,h.workerManagerList=L.workerManagerList,h.response=L.response,h.errorCode=L.ec,h.success=L.succ,delete h.startTime,S.send({type:"RequestProxyAppCenter",data:h})},requestProxyWorkerManager:function(n,L){var h=p()({},S.list[n]),t=L.lts;h.eventType="request_proxy_worker_manager",h.lts=Date.now(),h.eventElapse=h.lts-t,h.elapse=h.lts-h.startTime,h.extend=L.extend,h.workerManagerAddr=L.workerManagerAddr,h.response=L.response,h.errorCode=L.ec,h.success=L.succ,delete h.startTime,S.send({type:"RequestProxyWorkerManager",data:h})},requestWorkerEvent:function(n,L){var h=p()({},S.list[n]),t=h.startTime,j=Date.now();delete(h=k({},h,{},L,{elapse:j-t,lts:j,productType:"WebRTC"})).startTime,S.send({type:"WorkerEvent",data:h})},requestApWorkerEvent:function(n,L){var h=p()({},S.list[n]),t=h.startTime,j=Date.now();h=k({},h,{},L,{elapse:j-t,lts:j}),S.send({type:"APWorkerEvent",data:h})},sendCustomReportMessage:function(n,L,h){var t={type:"UserAnalytics",data:k({sid:n},L)},j=S.getUrl(),r=!!S.proxyServerURL;Object(g.post)(j,t,function(v){h&&h()},function(v){var M=S.getBackUrl();Object(g.post)(M,t,function(B){h&&h()},function(B){h&&h("Failed")},r?{timeout:Object(b.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(b.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},r?{timeout:Object(b.getParameter)("CUSTOMER_REPORT_TIMEOUT")}:{timeout:Object(b.getParameter)("CUSTOMER_REPORT_TIMEOUT"),"Cache-Control":"no-cache, no-store",Pragma:"no-cache",Expires:"0"})},joinChannelTimeOut:function(n){S.send({type:"JoinChannelTimeout",data:k({},n)})},peerPublishStatus:function(n){S.send({type:"PeerPublishStatus",data:k({},n)})},joinWebProxyAP:function(n){S.send({type:"JoinWebProxyAP",data:k({},n)})},webSocketQuit:function(n){S.send({type:"WebSocketQuit",data:k({},n)})}}).reportApiInvoke=function(n,L){var h=L.tag,t=L.name,j=L.getStates,r=L.options,v=L.timeout,M=v===void 0?6e4:v,B=L.callback,q=L.reportResult,Q=q===void 0||q,z=Date.now(),w=0,D=f++,x=function(){return k({tag:h,invokeId:D,sid:n,name:t,apiInvokeTime:z,options:r},j&&{states:(Z=j(),Object.keys(Z).reduce(function(oe,de){var le=oe;return Z[de]!=null&&(le[de]=Z[de]),le},{}))});var Z},ee=!!Object(b.getParameter)("SHOW_REPORT_INVOKER_LOG");ee&&s.default.info("".concat(t," start"));var Y=setTimeout(function(){_._sendApiInvoke(k({},x(),{error:"API_INVOKE_TIMEOUT",success:!1}))},M);return function(Z,oe){if(clearTimeout(Y),++w>1&&(Z="EXECUTOR_INVOKE_".concat(w)),Z)return _._sendApiInvoke(k({},x(),{success:!1,error:Z},j&&{states:j()})),ee&&s.default.info("".concat(t," onFailure"),Z),B&&B(Z);_._sendApiInvoke(k({},x(),{success:!0},Q&&{result:oe},{},j&&{states:j()})),ee&&s.default.info("".concat(t," onSuccess")),B&&B(null,oe)}},S._cachedItems=[],S._cacheInvokeReport=function(n){n.lts||(n.lts=Date.now()),S._cachedItems.push(n),S._cachedItems.length>50&&S._cachedItems.shift()},S._flushInvokeReport=function(n){if(S._cachedItems.length){var L=S._cachedItems;S._cachedItems=[],s.default.debug("Flush cached event reporting:",L.length),L.forEach(function(h,t){h.sid=n,setTimeout(function(){S._sendApiInvoke(h)},5e3+500*t)})}},S._sendApiInvoke=function(n){var L=n.tag,h=n.invokeId,t=n.sid,j=n.name,r=n.result,v=n.states,M=n.options,B=n.error,q=n.success,Q=n.apiInvokeTime,z=n.lts,w=Object(b.getParameter)("NOT_REPORT_EVENT");if(!(L&&w instanceof Array&&w.indexOf(L)!==-1))if(S.list[t]){var D=S.list[t],x=D.startTime,ee=D.cname,Y=D.uid,Z=D.cid,oe=(z=z||Date.now())-x,de=z-Q,le="";if(M)try{le=JSON.stringify(M)}catch{le=M.toString()}var ce=k({invokeId:h,sid:t,cname:ee,cid:Z,lts:z,uid:Y,success:q,elapse:oe,apiName:j,execElapse:de},M!==void 0&&{options:le},{},v!==void 0&&{execStates:JSON.stringify(v)},{},B!==void 0&&{errorCode:JSON.stringify(B)},{},r!==void 0&&{execResult:JSON.stringify(r)});S.send({type:"ApiInvoke",data:ce})}else S._cacheInvokeReport(arguments[0])},S.sendCache=[],S.sendTimer=null,S.send=function(n){if(n.data){var L=n.data;S._lastLts&&S._lastLts>=L.lts&&(L.lts=S._lastLts+1),S._lastLts=L.lts}if(S.sendCache.push(n),S.sendTimer===null)return function h(){S.sendTimer=setTimeout(function(){if(S.sendCache.length!==0){var t=S.sendCache.length<10?S.sendCache.splice(0,S.sendCache.length):S.sendCache.splice(0,10),j=S.list[t[0].data.sid].vid;return J.sendReportList(t,j),h()}S.sendTimer=null},Object(b.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},S)},function(c,O,y){Object.defineProperty(O,"__esModule",{value:!0}),O.BUILD="v3.6.11-0-gbdacc5f-dirty",O.VERSION="3.6.11";var m=0*Date.now()+11499+86604+5615+6547+846;O.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,100,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},O.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var d={AREA_SETTING:["NORTH_AMERICA","OVERSEA"],WEBCS_DOMAIN:["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],LOG_UPLOAD_SERVER:"logservice-oversea.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1-oversea.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"statscollector-2-oversea.agora.io",ENABLE_LIVE_SERVER_LIST:!1,LIVE_SERVER_LIST:[],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,GATEWAY_DOMAINS:["edge.agora.io"],WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,LIVESTREAMING_ALIGN:!0,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e7,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,REPORT_STATS_TIMEOUT:3e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,TICKET_RENEW_TIMEOUT:828e5,LIVE_STREAMING_TIMEOUT:12e4,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,FORCE_CHANGED_GATEWAY_FLAG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",CHROME_NEW_STATS:!1,AP_BACKOFF_MAX_TIME:8,SET_DEFAULT_TURNSERVER:!0,TURN_SERVER_PASSWORD:m.toString(),PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",NGINX:"webrtc-cloud-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CR:!0,CRL:10,CRI:6,CUSTOMER_REPORT_TIMEOUT:5e3,LIVE_STREAMING_ADDRESS:"",CHOOSE_SERVER_FRAGEMENT_LENGTH:4,PLAN:"plan-b"};d.AREA_SETTING=["CHINA","GLOBAL"],d.WEBCS_DOMAIN=["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],d.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],d.PROXY_CS=["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],d.CDS_AP=["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],d.ACCOUNT_REGISTER=["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],d.UAP_AP=["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],d.LOG_UPLOAD_SERVER="logservice.agora.io",d.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",d.EVENT_REPORT_BACKUP_DOMAIN="web-3.statscollector.sd-rtn.com",d.GATEWAY_DOMAINS=["edge.agora.io","edge.sd-rtn.com"],d.NGINX="webrtc-cloud-proxy.sd-rtn.com",d.PROXY_SERVER_TYPE3=["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],O.setParameter=function(E,p){return d[E]!==void 0&&(d[E]=p,!0)},O.getParameter=function(E){return d[E]!==void 0?d[E]:null}},function(c,O,y){y.r(O),y.d(O,"checkValidObject",function(){return s}),y.d(O,"checkValidString",function(){return g}),y.d(O,"checkValidNumber",function(){return i}),y.d(O,"checkValidArray",function(){return a}),y.d(O,"checkValidFloatNumber",function(){return l}),y.d(O,"checkValidBoolean",function(){return A}),y.d(O,"checkValidEnum",function(){return b}),y.d(O,"checkValidUID",function(){return k}),y.d(O,"isValidString",function(){return S}),y.d(O,"isValidNumber",function(){return f}),y.d(O,"isValidBoolean",function(){return I}),y.d(O,"isASCII",function(){return F}),y.d(O,"isInteger",function(){return J}),y.d(O,"isNumber",function(){return G}),y.d(O,"isString",function(){return H}),y.d(O,"isArray",function(){return V}),y.d(O,"isEmpty",function(){return _}),y.d(O,"isValidToken",function(){return P}),y.d(O,"isValidChannelName",function(){return T});var m=y(11),d=y.n(m),E=y(10),p=y(0),b=function(n,L,h){for(var t=0;t<h.length;t++)if(n===h[t])return!0;throw new Error("".concat(L," can only be set as ").concat(JSON.stringify(h)))},s=function(n,L){if(!n)throw new Error("Invalid param: ".concat(L||"param"," cannot be empty"));if(d()(n)!=="object")throw new Error("".concat(L||"This paramter"," is of the object type"));return!0},g=function(n,L,h,t,j){if(_(h)&&(h=1),t=t||255,_(j)&&(j=!0),_(n))throw new Error("".concat(L||"param"," cannot be empty"));if(!S(n,h,t,j))throw new Error("Invalid ".concat(L||"string param",": Length of the string: [").concat(h,",").concat(t,"].").concat(j?" ASCII characters only.":""))},i=function(n,L,h,t){if(_(h)&&(h=1),t=t||1e4,_(n))throw new Error("".concat(L||"param"," cannot be empty"));if(!f(n,h,t))throw new Error("Invalid ".concat(L||"number param",": The value range is [").concat(h,",").concat(t,"]. integer only"))},a=function(n,L){if(!Array.isArray(n))throw new Error("".concat(L," should be an array"))},l=function(n,L,h,t){if(n==null)throw new Error("".concat(L||"param"," cannot be null"));if(_(h)&&(h=0),t=t||1e4,_(n))throw new Error("".concat(L||"param"," cannot be empty"));if(!C(n,h,t))throw new Error("Invalid ".concat(L||"number param",": The value range is [").concat(h,",").concat(t,"]."))},A=function(n,L){if(_(n))throw new Error("".concat(L||"param"," cannot be empty"));if(!I(n))throw new Error("Invalid ".concat(L||"boolean param",": The value is of the boolean type."))},k=function(n){if(!Object(E.is32Uint)(n)&&!S(n,1,255))throw p.default.error("Invalid UID ".concat(n," ").concat(d()(n))),new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")},S=function(n,L,h,t){return L||(L=0),h||(h=Number.MAX_SAFE_INTEGER),_(t)&&(t=!0),H(n)&&(!t||F(n))&&n.length>=L&&n.length<=h},f=function(n,L,h){return J(n)&&n>=L&&n<=h},C=function(n,L,h){return G(n)&&n>=L&&n<=h},I=function(n){return typeof n=="boolean"},P=function(n){return S(n,1,2047)},T=function(n){return H(n)&&/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n)},F=function(n){if(typeof n=="string"){for(var L=0;L<n.length;L++){var h=n.charCodeAt(L);if(h<0||h>255)return!1}return!0}},J=function(n){return typeof n=="number"&&n%1==0},G=function(n){return typeof n=="number"},H=function(n){return typeof n=="string"},V=function(n){return n instanceof Array},_=function(n){return n==null}},function(c,O,y){y.r(O),y.d(O,"getBrowserInfo",function(){return I}),y.d(O,"getBrowserVersion",function(){return l}),y.d(O,"getBrowserOS",function(){return A}),y.d(O,"isChrome",function(){return m}),y.d(O,"isSafari",function(){return d}),y.d(O,"isFireFox",function(){return p}),y.d(O,"isOpera",function(){return b}),y.d(O,"isEdge",function(){return E}),y.d(O,"isQQBrowser",function(){return s}),y.d(O,"isWeChatBrowser",function(){return g}),y.d(O,"isLegacyChrome",function(){return S}),y.d(O,"isSupportedPC",function(){return i}),y.d(O,"isSupportedMobile",function(){return a}),y.d(O,"getChromeKernelVersion",function(){return C}),y.d(O,"isChromeKernel",function(){return k});var m=function(){var P=I();return P.name&&P.name==="Chrome"},d=function(){var P=I();return P.name&&P.name==="Safari"},E=function(){var P=I();return P.name&&P.name==="Edge"},p=function(){var P=I();return P.name&&P.name==="Firefox"},b=function(){var P=I();return P.name&&P.name==="OPR"},s=function(){var P=I();return P.name&&P.name==="QQBrowser"},g=function(){var P=I();return P.name&&P.name==="MicroMessenger"},i=function(){var P=A();return P==="Linux"||P==="Mac OS X"||P==="Mac OS"||P.indexOf("Windows")!==-1},a=function(){var P=A();return P==="Android"||P==="iOS"},l=function(){return I().version},A=function(){return I().os},k=function(){return!!navigator.userAgent.match(/chrome\/[\d]+/i)};function S(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var f,C=function(){var P=navigator.userAgent.match(/chrome\/[\d]+/i);return P&&P[0]&&P[0].split("/")[1]},I=(f=function(){var P,T=navigator.userAgent,F=T.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];F[1]==="Chrome"&&(P=T.match(/(OPR(?=\/))\/?(\d+)/i))!=null&&(F=P),F[1]==="Safari"&&(P=T.match(/version\/(\d+)/i))!=null&&(F[2]=P[1]),~T.toLowerCase().indexOf("qqbrowser")&&(P=T.match(/(qqbrowser(?=\/))\/?(\d+)/i))!=null&&(F=P),~T.toLowerCase().indexOf("micromessenger")&&(P=T.match(/(micromessenger(?=\/))\/?(\d+)/i))!=null&&(F=P),~T.toLowerCase().indexOf("edge")&&(P=T.match(/(edge(?=\/))\/?(\d+)/i))!=null&&(F=P),~T.toLowerCase().indexOf("trident")&&(P=/\brv[ :]+(\d+)/g.exec(T)||[])!=null&&(F=[null,"IE",P[1]]);var J=void 0,G=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var H in G){var V=G[H];if(V.r.test(navigator.userAgent)){J=V.s;break}}return{name:F[1],version:F[2],os:J}}(),function(){return f})},function(c,O,y){y.r(O),y.d(O,"APErrorCode",function(){return m}),y.d(O,"GatewayErrorCode",function(){return d}),y.d(O,"StringUidErrorCode",function(){return E}),y.d(O,"JOIN_GS_TRYNEXT_LIST",function(){return p}),y.d(O,"JOIN_CS_RETRY_LIST",function(){return b}),y.d(O,"JOIN_PROXY_RETRY_LIST",function(){return s}),y.d(O,"INJECT_STREAM_STATUS",function(){return g}),y.d(O,"WEBSOCKET_CLOSE_REASON",function(){return i});var m={1010100:"NO_FLAG_SET",1010101:"FLAG_SET_BUT_EMPTY",1010102:"INVALID_FALG_SET",2010005:"INVALID_VENDOR_KEY",2010007:"INVALID_CHANNEL_NAME",2010008:"INTERNAL_ERROR",2010009:"NO_AUTHORIZED",2010010:"DYNAMIC_KEY_TIMEOUT",2010011:"NO_ACTIVE_STATUS",2010013:"DYNAMIC_KEY_EXPIRED",2010014:"STATIC_USE_DYANMIC_KEY",2010015:"DYNAMIC_USE_STATIC_KEY",2010016:"USER_OVERLOAD",2010018:"FORBIDDEN_REGION",2010019:"CANNOT_MEET_AREA_DEMAND"},d={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",2011:"ERR_NOT_JOINED",2012:"WARN_REPEAT_JOIN",2013:"ERR_INVALID_VENDOR_KEY",2014:"ERR_INVALID_CHANNEL_NAME",2015:"ERR_INVALID_STRINGUID",2016:"ERR_TOO_MANY_USERS",2017:"ERR_SET_CLIENT_ROLE_TIMEOUT",2018:"ERR_SET_CLIENT_ROLE_NO_PERMISSION",2019:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",2020:"ERR_PUBLISH_REQUEST_INVALID",2021:"ERR_SUBSCRIBE_REQUEST_INVALID",2022:"ERR_NOT_SUPPORTED_MESSAGE",2023:"ERR_ILLEAGAL_PLUGIN",2028:"ILLEGAL_AES_PASSWORD",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},E={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},p=["ERR_NO_VOCS_AVAILABLE","ERR_NO_VOS_AVAILABLE","ERR_JOIN_CHANNEL_TIMEOUT","WARN_LOOKUP_CHANNEL_TIMEOUT","WARN_OPEN_CHANNEL_TIMEOUT","ERR_VOM_SERVICE_UNAVAILABLE","ERR_TOO_MANY_USERS","ERR_MASTER_VOCS_UNAVAILABLE","ERR_INTERNAL_ERROR"],b=["NO_SERVICE_AVAILABLE"],s=["NO_SERVICE_AVAILABLE","REQUEST_PROXY_SERVER_FAILED","REQUEST_PROXY_SERVER_TIME_OUT"],g={INJECT_STREAM_STATUS_START_SUCCESS:0,INJECT_STREAM_STATUS_START_ALREADY_EXISTS:1,INJECT_STREAM_STATUS_START_UNAUTHORIZED:2,INJECT_STREAM_STATUS_START_TIMEDOUT:3,INJECT_STREAM_STATUS_START_FAILED:4,INJECT_STREAM_STATUS_STOP_SUCCESS:5,INJECT_STREAM_STATUS_STOP_NOT_FOUND:6,INJECT_STREAM_STATUS_STOP_UNAUTHORIZED:7,INJECT_STREAM_STATUS_STOP_TIMEDOUT:8,INJECT_STREAM_STATUS_STOP_FAILED:9,INJECT_STREAM_STATUS_BROKEN:10},i={WS_DISCONNECT:"WS_DISCONNECT"};O.default={FAILED:"FAILED",INVALID_KEY:"INVALID_KEY",INVALID_CLIENT_MODE:"INVALID_CLIENT_MODE",INVALID_CLIENT_CODEC:"INVALID_CLIENT_CODEC",CLIENT_MODE_CODEC_MISMATCH:"CLIENT_MODE_CODEC_MISMATCH",WEB_API_NOT_SUPPORTED:"WEB_API_NOT_SUPPORTED",INVALID_PARAMETER:"INVALID_PARAMETER",NO_TRACK_IN_STREAM:"NO_TRACK_IN_STREAM",INVALID_OPERATION:"INVALID_OPERATION",INVALID_LOCAL_STREAM:"INVALID_LOCAL_STREAM",INVALID_REMOTE_STREAM:"INVALID_REMOTE_STREAM",INVALID_DYNAMIC_KEY:"INVALID_DYNAMIC_KEY",DYNAMIC_KEY_TIMEOUT:"DYNAMIC_KEY_TIMEOUT",NO_VOCS_AVAILABLE:"NO_VOCS_AVAILABLE",NO_VOS_AVAILABLE:"ERR_NO_VOS_AVAILABLE",JOIN_CHANNEL_TIMEOUT:"ERR_JOIN_CHANNEL_TIMEOUT",NO_AVAILABLE_CHANNEL:"NO_AVAILABLE_CHANNEL",LOOKUP_CHANNEL_TIMEOUT:"LOOKUP_CHANNEL_TIMEOUT",LOOKUP_CHANNEL_REJECTED:"LOOKUP_CHANNEL_REJECTED",OPEN_CHANNEL_TIMEOUT:"OPEN_CHANNEL_TIMEOUT",OPEN_CHANNEL_REJECTED:"OPEN_CHANNEL_REJECTED",REQUEST_DEFERRED:"REQUEST_DEFERRED",STREAM_ALREADY_PUBLISHED:"STREAM_ALREADY_PUBLISHED",STREAM_NOT_YET_PUBLISHED:"STREAM_NOT_YET_PUBLISHED",JOIN_TOO_FREQUENT:"JOIN_TOO_FREQUENT",SOCKET_ERROR:"SOCKET_ERROR",SOCKET_DISCONNECTED:"SOCKET_DISCONNECTED",PEERCONNECTION_FAILED:"PEERCONNECTION_FAILED",CONNECT_GATEWAY_ERROR:"CONNECT_GATEWAY_ERROR",SERVICE_NOT_AVAILABLE:"SERVICE_NOT_AVAILABLE",JOIN_CHANNEL_FAILED:"JOIN_CHANNEL_FAILED",PUBLISH_STREAM_FAILED:"PUBLISH_STREAM_FAILED",UNPUBLISH_STREAM_FAILED:"UNPUBLISH_STREAM_FAILED",SUBSCRIBE_STREAM_FAILED:"SUBSCRIBE_STREAM_FAILED",UNSUBSCRIBE_STREAM_FAILED:"UNSUBSCRIBE_STREAM_FAILED",NO_SUCH_REMOTE_STREAM:"NO_SUCH_REMOTE_STREAM",ERR_FAILED:"1",ERR_INVALID_VENDOR_KEY:"101",ERR_INVALID_CHANNEL_NAME:"102",WARN_NO_AVAILABLE_CHANNEL:"103",WARN_LOOKUP_CHANNEL_TIMEOUT:"104",WARN_LOOKUP_CHANNEL_REJECTED:"105",WARN_OPEN_CHANNEL_TIMEOUT:"106",WARN_OPEN_CHANNEL_REJECTED:"107",WARN_REQUEST_DEFERRED:"108",ERR_DYNAMIC_KEY_TIMEOUT:"109",ERR_INVALID_DYNAMIC_KEY:"110",ERR_NO_VOCS_AVAILABLE:"2000",ERR_NO_VOS_AVAILABLE:"2001",ERR_JOIN_CHANNEL_TIMEOUT:"2002",IOS_NOT_SUPPORT:"IOS_NOT_SUPPORT",WECHAT_NOT_SUPPORT:"WECHAT_NOT_SUPPORT",SHARING_SCREEN_NOT_SUPPORT:"SHARING_SCREEN_NOT_SUPPORT",STILL_ON_PUBLISHING:"STILL_ON_PUBLISHING",LOW_STREAM_ALREADY_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",LOW_STREAM_NOT_YET_PUBLISHED:"LOW_STREAM_ALREADY_PUBLISHED",HIGH_STREAM_NOT_VIDEO_TRACE:"HIGH_STREAM_NOT_VIDEO_TRACE",NOT_FIND_DEVICE_BY_LABEL:"NOT_FIND_DEVICE_BY_LABEL",ENABLE_DUALSTREAM_FAILED:"ENABLE_DUALSTREAM_FAILED",DISABLE_DUALSTREAM_FAILED:"DISABLE_DUALSTREAM_FAILED",PLAYER_NOT_FOUND:"PLAYER_NOT_FOUND",ELECTRON_NOT_SUPPORT_SHARING_SCREEN:"ELECTRON_NOT_SUPPORT_SHARING_SCREEN",BAD_ENVIRONMENT:"BAD_ENVIRONMENT",LOAD_AUDIO_FAILED:"LOAD_AUDIO_FAILED"}},function(c,O,y){y.d(O,"b",function(){return m}),y.d(O,"a",function(){return d}),y.d(O,"c",function(){return E}),y(0);var m=function(p,b,s){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight","VideoPublishDuration","AudioPublishDuration"].indexOf(b)>-1&&(typeof s=="string"||isFinite(s)))return p[b]=""+s},d=function(p){var b={};return p.forEach(function(s){s.id&&s.type&&(s.id.indexOf("send")===-1&&s.type.toLowerCase().indexOf("outbound")===-1&&s.id.indexOf("outbound_rtp")===-1&&s.id.indexOf("OutboundRTP")===-1||(s.mediaType==="audio"?(m(b,"audioSendBytes",s.bytesSent),m(b,"audioSendPackets",s.packetsSent),m(b,"audioSendPacketsLost",s.packetsLost)):(m(b,"videoSendBytes",s.bytesSent),m(b,"videoSendPackets",s.packetsSent),m(b,"videoSendPacketsLost",s.packetsLost),m(b,"videoSendFrameRate",s.googFrameRateSent),m(b,"videoSendResolutionWidth",s.googFrameWidthSent),m(b,"videoSendResolutionHeight",s.googFrameHeightSent))))}),b},E=function(p){var b={};return p.forEach(function(s){s.id&&s.type&&(s.id.indexOf("recv")===-1&&s.type.toLowerCase().indexOf("inbound")===-1&&s.id.indexOf("inbound_rtp")===-1&&s.id.indexOf("inbound-rtp")===-1&&s.id.indexOf("InboundRTP")===-1||(s.mediaType==="audio"?(m(b,"audioReceiveBytes",s.bytesReceived),m(b,"audioReceivePackets",s.packetsReceived),m(b,"audioReceivePacketsLost",s.packetsLost)):(m(b,"videoReceiveBytes",s.bytesReceived),m(b,"videoReceivePacketsLost",s.packetsLost),m(b,"videoReceivePackets",s.packetsReceived),m(b,"videoReceiveFrameRate",s.googFrameRateReceived),m(b,"videoReceiveDecodeFrameRate",s.googFrameRateDecoded),m(b,"videoReceiveResolutionWidth",s.googFrameWidthReceived),m(b,"videoReceiveResolutionHeight",s.googFrameHeightReceived))))}),b}},function(c,O){function y(){return c.exports=y=Object.assign||function(m){for(var d=1;d<arguments.length;d++){var E=arguments[d];for(var p in E)Object.prototype.hasOwnProperty.call(E,p)&&(m[p]=E[p])}return m},y.apply(this,arguments)}c.exports=y},function(c,O,y){y.d(O,"b",function(){return d}),y.d(O,"e",function(){return p}),y.d(O,"a",function(){return b}),y.d(O,"d",function(){return s}),y.d(O,"c",function(){return g});var m=y(0),d=function(){var i={dispatcher:{}};return i.dispatcher.eventListeners={},i.addEventListener=function(a,l){i.dispatcher.eventListeners[a]===void 0&&(i.dispatcher.eventListeners[a]=[]),i.dispatcher.eventListeners[a].push(l)},i.hasListeners=function(a){return!(!i.dispatcher.eventListeners[a]||!i.dispatcher.eventListeners[a].length)},i.on=i.addEventListener,i.removeEventListener=function(a,l){var A;i.dispatcher.eventListeners[a]&&(A=i.dispatcher.eventListeners[a].indexOf(l))!==-1&&i.dispatcher.eventListeners[a].splice(A,1)},i.dispatchEvent=function(a){var l;for(l in i.dispatcher.eventListeners[a.type])if(i.dispatcher.eventListeners[a.type]&&i.dispatcher.eventListeners[a.type].hasOwnProperty(l)&&typeof i.dispatcher.eventListeners[a.type][l]=="function")try{i.dispatcher.eventListeners[a.type][l](a)}catch(A){m.default.debug("[".concat(i.clientId,"] Error in ").concat(a.type," event"),A)}},i.dispatchSocketEvent=function(a){var l;for(l in i.dispatcher.eventListeners[a.type])i.dispatcher.eventListeners[a.type]&&i.dispatcher.eventListeners[a.type].hasOwnProperty(l)&&typeof i.dispatcher.eventListeners[a.type][l]=="function"&&i.dispatcher.eventListeners[a.type][l](a.msg)},i},E=function(i){var a={};return a.type=i.type,a},p=function(i){var a=E(i);return a.stream=i.stream,a.reason=i.reason,a.msg=i.msg,a},b=function(i){var a=E(i);return a.uid=i.uid,a.attr=i.attr,a.stream=i.stream,a},s=function(i){var a=E(i);return a.msg=i.msg,a},g=function(i){var a=E(i);return a.url=i.url,a.uid=i.uid,a.status=i.status,a.reason=i.reason,a}},function(c,O,y){var m,d=this&&this.__extends||(m=function(G,H){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,_){V.__proto__=_}||function(V,_){for(var n in _)_.hasOwnProperty(n)&&(V[n]=_[n])})(G,H)},function(G,H){function V(){this.constructor=G}m(G,H),G.prototype=H===null?Object.create(H):(V.prototype=H.prototype,new V)}),E=this&&this.__awaiter||function(G,H,V,_){return new(V||(V=Promise))(function(n,L){function h(r){try{j(_.next(r))}catch(v){L(v)}}function t(r){try{j(_.throw(r))}catch(v){L(v)}}function j(r){var v;r.done?n(r.value):(v=r.value,v instanceof V?v:new V(function(M){M(v)})).then(h,t)}j((_=_.apply(G,H||[])).next())})},p=this&&this.__generator||function(G,H){var V,_,n,L,h={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return L={next:t(0),throw:t(1),return:t(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function t(j){return function(r){return function(v){if(V)throw new TypeError("Generator is already executing.");for(;h;)try{if(V=1,_&&(n=2&v[0]?_.return:v[0]?_.throw||((n=_.return)&&n.call(_),0):_.next)&&!(n=n.call(_,v[1])).done)return n;switch(_=0,n&&(v=[2&v[0],n.value]),v[0]){case 0:case 1:n=v;break;case 4:return h.label++,{value:v[1],done:!1};case 5:h.label++,_=v[1],v=[0];continue;case 7:v=h.ops.pop(),h.trys.pop();continue;default:if(n=h.trys,!((n=n.length>0&&n[n.length-1])||v[0]!==6&&v[0]!==2)){h=0;continue}if(v[0]===3&&(!n||v[1]>n[0]&&v[1]<n[3])){h.label=v[1];break}if(v[0]===6&&h.label<n[1]){h.label=n[1],n=v;break}if(n&&h.label<n[2]){h.label=n[2],h.ops.push(v);break}n[2]&&h.ops.pop(),h.trys.pop();continue}v=H.call(G,h)}catch(M){v=[6,M],_=0}finally{V=n=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}([j,r])}}},b=this&&this.__importDefault||function(G){return G&&G.__esModule?G:{default:G}};Object.defineProperty(O,"__esModule",{value:!0});var s=b(y(69)),g=y(2),i=b(y(0)),a=y(3),l=y(14),A=y(10),k=function(G){function H(V,_){var n=G.call(this)||this;return n._state=P.RELAY_STATE_IDLE,n._onStatus=function(L){i.default.debug("["+n.clientId+"] ChannelMediaStatus: "+JSON.stringify(L)),L&&L.command&&(L.command==="onAudioPacketReceived"&&n.emit("event",I.PACKET_RECEIVED_AUDIO_FROM_SRC),L.command==="onVideoPacketReceived"&&n.emit("event",I.PACKET_RECEIVED_VIDEO_FROM_SRC),L.command==="onSrcTokenPrivilegeDidExpire"&&(n._state=P.RELAY_STATE_FAILURE,n.emit("state",P.RELAY_STATE_FAILURE,T.SRC_TOKEN_EXPIRED)),L.command==="onDestTokenPrivilegeDidExpire"&&(n._state=P.RELAY_STATE_FAILURE,n.emit("state",P.RELAY_STATE_FAILURE,T.DEST_TOKEN_EXPIRED,L.channelName?{came:L.channelName}:null)))},n._onClose=function(){return E(n,void 0,void 0,function(){var L;return p(this,function(h){switch(h.label){case 0:if(i.default.debug("["+this.clientId+"] ChannelMediaSocket onClose"),this.emit("event",I.NETWORK_DISCONNECTED),this.state=P.RELAY_STATE_IDLE,!this._prevChannelMediaConfig)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.startChannelMediaRelay(this._prevChannelMediaConfig)];case 2:return h.sent(),[3,4];case 3:return(L=h.sent())instanceof J&&(L.message===f.WS_ABORT||L.message===f.AP_REQUEST_ABORT)?[2]:(this.emit("state",P.RELAY_STATE_FAILURE,T.SERVER_CONNECTION_LOST),[3,4]);case 4:return[2]}})})},n.token=V.appId,n.appId=V.appId,n.cname=V.cname,n.uid=V.uid,n.sid=V.sid,n.clientId=_,n}return d(H,G),Object.defineProperty(H.prototype,"state",{get:function(){return this._state},set:function(V){var _=this._state;this._state=V,_!==V&&this.emit("state",V)},enumerable:!0,configurable:!0}),H.prototype.startChannelMediaRelay=function(V){return E(this,void 0,void 0,function(){return p(this,function(_){switch(_.label){case 0:if(this.state!==P.RELAY_STATE_IDLE)throw new J(f.BAD_STATE);return this.state=P.RELAY_STATE_CONNECTING,[4,this._connect()];case 1:return _.sent(),i.default.debug("["+this.clientId+"] startChannelMediaRelay: connect success"),[4,this._sendStartRelayMessage(V)];case 2:return _.sent(),this._prevChannelMediaConfig=V,[2]}})})},H.prototype.updateChannelMediaRelay=function(V){return E(this,void 0,void 0,function(){return p(this,function(_){switch(_.label){case 0:if(this.state!==P.RELAY_STATE_RUNNING)throw new J(f.BAD_STATE);return[4,this._sendUpdateMessage(V)];case 1:return _.sent(),this._prevChannelMediaConfig=V,[2]}})})},H.prototype.stopChannelMediaRelay=function(){return E(this,void 0,void 0,function(){return p(this,function(V){switch(V.label){case 0:return[4,this._sendStopRelayMessage()];case 1:return V.sent(),i.default.debug("["+this.clientId+"] stopChannelMediaRelay: send stop message success"),this.state=P.RELAY_STATE_IDLE,this.dispose(),[2]}})})},H.prototype.dispose=function(){i.default.debug("["+this.clientId+"] disposeChannelMediaRelay"),this.state=P.RELAY_STATE_IDLE,this.emit("dispose"),this._signal&&this._signal.dispose(),this._prevChannelMediaConfig=null,this.removeEvent()},H.prototype._requestOneAP=function(V){var _=this;return new Promise(function(n,L){var h={command:"convergeAllocateEdge",sid:_.sid,appId:_.appId,token:"",ts:+new Date,version:g.VERSION,cname:_.cname,uid:_.uid+"",seq:1,requestId:1},t={service_name:"tele_channel",json_body:JSON.stringify(h)},j="https://"+V;l.post(j,t,function(r){var v=null,M=null;try{v=JSON.parse(r)}catch(B){L(new J(f.AP_JSON_PARSE_ERROR,B))}v.code!==0&&L(new J(f.AP_REQUEST_ERROR,v));try{M=JSON.parse(v.json_body)}catch(B){L(new J(f.AP_JSON_PARSE_ERROR,B))}M.code!==200&&L(new J(f.AP_REQUEST_ERROR,M)),M.servers?n(M.servers):L(new J(f.AP_JSON_PARSE_ERROR,M))},function(r){return L(r)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})})},H.prototype._requestAP=function(){var V=this,_=g.getParameter("UAP_AP");return new Promise(function(n,L){setTimeout(function(){L(new J(f.AP_REQUEST_TIMEOUT))},5e3),V.on("dispose",function(){L(new J(f.AP_REQUEST_ABORT))}),_.forEach(function(h){h+="/api/v1",V._requestOneAP(h).then(function(t){i.default.debug("["+V.clientId+"] startChannelMediaRelay request AP "+h+" success: "+JSON.stringify(t));var j=t[0],r="wss://"+j.address.replace(/\./g,"-")+".edge.agora.io:"+j.wss;n(r)}).catch(function(t){i.default.debug("["+V.clientId+"] startChannelMediaRelay request AP "+h+" failed: "+JSON.stringify(t))})})})},H.prototype._connectWebsocket=function(V){return this._signal=new F(this.appId,this.cname,this.uid,this.sid),this._signal.connect(V)},H.prototype._connect=function(){return E(this,void 0,void 0,function(){var V;return p(this,function(_){switch(_.label){case 0:return[4,this._requestAP()];case 1:return V=_.sent(),[4,this._connectWebsocket(V)];case 2:return _.sent(),this._signal.on("close",this._onClose.bind(this)),this._signal.on("status",this._onStatus.bind(this)),this.emit("event",I.NETWORK_CONNECTED),[2]}})})},H.prototype._sendStartRelayMessage=function(V){return E(this,void 0,void 0,function(){var _,n,L,h,t,j;return p(this,function(r){switch(r.label){case 0:return this._checkSignal(),_=this._genMessage(C.StopPacketTransfer),[4,this._signal.request(_)];case 1:return r.sent(),[4,this._signal.waitStatus("Normal Quit")];case 2:return r.sent(),i.default.debug("["+this.clientId+"] startChannelMediaRelay: StopPacketTransfer success"),n=this._genMessage(C.SetSdkProfile,V),[4,this._signal.request(n)];case 3:return r.sent(),i.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSdkProfile success"),L=this._genMessage(C.SetSourceChannel,V),[4,this._signal.request(L)];case 4:return r.sent(),[4,this._signal.waitStatus("SetSourceChannelStatus")];case 5:return r.sent(),this.emit("event",I.PACKET_JOINED_SRC_CHANNEL),i.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceChannel success"),h=this._genMessage(C.SetSourceUserId,V),[4,this._signal.request(h)];case 6:return r.sent(),i.default.debug("["+this.clientId+"] startChannelMediaRelay: SetSourceUserId success"),t=this._genMessage(C.SetDestChannel,V),[4,this._signal.request(t)];case 7:return r.sent(),[4,this._signal.waitStatus("SetDestChannelStatus")];case 8:return r.sent(),this.emit("event",I.PACKET_JOINED_DEST_CHANNEL),i.default.debug("["+this.clientId+"] startChannelMediaRelay: SetDestChannel success"),j=this._genMessage(C.StartPacketTransfer,V),[4,this._signal.request(j)];case 9:return r.sent(),this.emit("event",I.PACKET_SENT_TO_DEST_CHANNEL),this.state=P.RELAY_STATE_RUNNING,i.default.debug("["+this.clientId+"] startChannelMediaRelay: StartPacketTransfer success"),[2]}})})},H.prototype._sendReconnectMessage=function(V){return E(this,void 0,void 0,function(){var _;return p(this,function(n){switch(n.label){case 0:return this._checkSignal(),_=this._genMessage(C.Reconnect,V),[4,this._signal.request(_)];case 1:return n.sent(),[2]}})})},H.prototype._sendUpdateMessage=function(V){return E(this,void 0,void 0,function(){var _;return p(this,function(n){switch(n.label){case 0:return this._checkSignal(),_=this._genMessage(C.UpdateDestChannel,V),[4,this._signal.request(_)];case 1:return n.sent(),this.emit("event",I.PACKET_UPDATE_DEST_CHANNEL),i.default.debug("["+this.clientId+"] sendUpdateMessage: UpdateDestChannel success"),[2]}})})},H.prototype._sendStopRelayMessage=function(){return E(this,void 0,void 0,function(){var V;return p(this,function(_){switch(_.label){case 0:return this._checkSignal(),V=this._genMessage(C.StopPacketTransfer),[4,this._signal.request(V)];case 1:return _.sent(),i.default.debug("["+this.clientId+"] sendStopRelayMessage: StopPacketTransfer success"),[2]}})})},H.prototype._genMessage=function(V,_){var n=this,L=[],h=[],t=[],j={appId:this.appId,cname:this.cname,uid:this.uid+"",sdkVersion:g.VERSION,sid:this.sid,ts:+new Date,requestId:0,seq:0,allocate:!0,clientRequest:{}},r=null;switch(V){case C.SetSdkProfile:return j.clientRequest={command:"SetSdkProfile",type:"multi_channel"},j;case C.SetSourceChannel:return r=_.getSrcChannelMediaInfo(),j.clientRequest={command:"SetSourceChannel",uid:r.uid+"",channelName:r.channelName,token:r.token||this.appId},j;case C.SetSourceUserId:return r=_.getSrcChannelMediaInfo(),j.clientRequest={command:"SetSourceUserId",uid:this.uid+""},j;case C.SetDestChannel:return _.getDestChannelMediaInfos().forEach(function(v){L.push(v.channelName),h.push(v.uid+""),t.push(v.token||n.appId)}),j.clientRequest={command:"SetDestChannel",channelName:L,uid:h,token:t},j;case C.StartPacketTransfer:return j.clientRequest={command:"StartPacketTransfer"},j;case C.Reconnect:return j.clientRequest={command:"Reconnect"},j;case C.StopPacketTransfer:return j.clientRequest={command:"StopPacketTransfer"},j;case C.UpdateDestChannel:return _.getDestChannelMediaInfos().forEach(function(v){L.push(v.channelName),h.push(v.uid+""),t.push(v.token||n.appId)}),j.clientRequest={command:"UpdateDestChannel",channelName:L,uid:h,token:t},j}},H.prototype._checkSignal=function(){if(!this._signal||!this._signal.isConnect())throw new J(f.WS_DISCONNECTED)},H}(s.default);O.default=k;var S=function(){function G(){this.destChannelMediaInfos=new Map}return G.prototype.setSrcChannelInfo=function(H){a.checkValidObject(H,"srcInfo");var V=H.uid,_=H.channelName,n=H.token;if(n&&!a.isValidToken(n))throw new Error("Invalid token in SrcChannelInfo");if(!a.isValidChannelName(_))throw new Error("Invalid channelName in SrcChannelInfo");if(!A.is32Uint(V))throw new Error("Invalid uid in SrcChannelInfo");this.srcChannelMediaInfo=H},G.prototype.setDestChannelInfo=function(H,V){if(!a.isValidChannelName(H))throw new Error("Invalid channelName in DestChannelInfo");a.checkValidObject(V,"destInfo");var _=V.uid,n=V.token,L=V.channelName;if(n&&!a.isValidToken(n))throw new Error("Invalid token in DestChannelInfo");if(!a.isValidChannelName(L))throw new Error("Invalid channelName in DestChannelInfo");if(!A.is32Uint(_))throw new Error("Invalid uid in DestChannelInfo");this.destChannelMediaInfos.set(H,V)},G.prototype.removeDestChannelInfo=function(H){if(!a.isValidChannelName(H))throw new Error("Invalid channelName when invoke removeDestChannelInfo");this.destChannelMediaInfos.delete(H)},G.prototype.getSrcChannelMediaInfo=function(){return this.srcChannelMediaInfo},G.prototype.getDestChannelMediaInfos=function(){return this.destChannelMediaInfos},G}();O.ChannelMediaRelayConfiguration=S;var f,C,I,P,T,F=function(G){function H(V,_,n,L){var h=G.call(this)||this;return h._onOpen=function(){h.emit("open")},h._onClose=function(t){h.emit("close"),h.dispose()},h._onMessage=function(t){var j=JSON.parse(t.data);if(!j||j.command!=="serverResponse"||!j.requestId)return j&&j.command==="serverStatus"&&j.serverStatus&&j.serverStatus.command?(h.emit("status",j.serverStatus),void h.emit(j.serverStatus.command,j.serverStatus)):void 0;h.emit("req_"+j.requestId,j)},h._requestId=1,h.appId=V,h.cname=_,h.uid=n,h.sid=L,h}return d(H,G),H.prototype.isConnect=function(){return this._ws&&this._ws.readyState===WebSocket.OPEN},H.prototype.sendMessage=function(V){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new J(f.WS_DISCONNECTED);var _=this._requestId++;return V.requestId=_,V.seq=_,this._ws.send(JSON.stringify(V)),_},H.prototype.waitStatus=function(V){var _=this;return new Promise(function(n,L){var h=window.setTimeout(function(){L(new J(f.WAIT_STATUS_TIMEOUT,V))},5e3);_.once(V,function(t){clearTimeout(h),t.state&&t.state!==0?L(new J(f.WAIT_STATUS_ERROR,V)):n()}),_.once("dispose",function(){clearTimeout(h),L(new J(f.WS_ABORT))})})},H.prototype.request=function(V){var _=this;return new Promise(function(n,L){var h=_.sendMessage(V),t=window.setTimeout(function(){_.removeAllListeners("req_"+h),L(new J(f.REQUEST_TIMEOUT))},3e3);_.once("req_"+h,function(j){clearTimeout(t),j&&j.code===200?n(j):L(new J(f.REQUEST_FAILED,j))}),_.once("dispose",function(){clearTimeout(t),L(new J(f.WS_ABORT))})})},H.prototype.connect=function(V){var _=this;return new Promise(function(n,L){_._ws=new WebSocket(V),_._ws.onopen=function(){_._onOpen(),_._prvUrl=V,_._ws.onmessage=_._onMessage,_._ws.onclose=_._onClose,_._startHeartBeatCheck(),n()},_._ws.onclose=function(h){_._ws=null,L(new J(f.CONNECT_FAILED,"websocket error code: "+h.code))},setTimeout(function(){_._ws&&_._ws.readyState!==WebSocket.OPEN&&(_._ws.onopen=null,_._ws.onclose=null,_._ws.close(),_._ws=null,L(new J(f.CONNECT_TIMEOUT)))},5e3),_.once("dispose",function(){L(new J(f.WS_ABORT))})})},H.prototype.dispose=function(){this._clearHeartBeatCheck(),this.emit("dispose"),this.removeEvent(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onmessage=null,this._ws.close()),this._ws=null},H.prototype._sendPing=function(V){if(!this._ws||this._ws.readyState!==WebSocket.OPEN)throw new J(f.WS_DISCONNECTED);var _=this._requestId++;return V.requestId=_,this._ws.send(JSON.stringify(V)),_},H.prototype._startHeartBeatCheck=function(){var V=this;this._heartBeatTimer=window.setInterval(function(){V._sendPing({command:"ping",appId:V.appId,cname:V.cname,uid:V.uid+"",sid:V.sid,ts:+new Date,requestId:0})},3e3)},H.prototype._clearHeartBeatCheck=function(){window.clearInterval(this._heartBeatTimer)},H}(s.default),J=function(G,H,V){G===void 0&&(G=""),this.code=V,this.data=H,this.message=G};O.ChannelMediaError=J,function(G){G.CONNECT_FAILED="connect failed",G.CONNECT_TIMEOUT="connect timeout",G.WS_DISCONNECTED="websocket disconnected",G.REQUEST_TIMEOUT="request timeout",G.REQUEST_FAILED="request failed",G.WAIT_STATUS_TIMEOUT="wait status timeout",G.WAIT_STATUS_ERROR="wait status error",G.BAD_STATE="bad state",G.WS_ABORT="ws abort",G.AP_REQUEST_TIMEOUT="AP request timeout",G.AP_JSON_PARSE_ERROR="AP json parse error",G.AP_REQUEST_ERROR="AP request error",G.AP_REQUEST_ABORT="AP request abort"}(f=O.CHANNEL_MEDIA_ERROR||(O.CHANNEL_MEDIA_ERROR={})),function(G){G[G.SetSdkProfile=0]="SetSdkProfile",G[G.SetSourceChannel=1]="SetSourceChannel",G[G.SetSourceUserId=2]="SetSourceUserId",G[G.SetDestChannel=3]="SetDestChannel",G[G.StartPacketTransfer=4]="StartPacketTransfer",G[G.StopPacketTransfer=5]="StopPacketTransfer",G[G.UpdateDestChannel=6]="UpdateDestChannel",G[G.Reconnect=7]="Reconnect",G[G.SetVideoProfile=8]="SetVideoProfile"}(C||(C={})),function(G){G[G.NETWORK_DISCONNECTED=0]="NETWORK_DISCONNECTED",G[G.NETWORK_CONNECTED=1]="NETWORK_CONNECTED",G[G.PACKET_JOINED_SRC_CHANNEL=2]="PACKET_JOINED_SRC_CHANNEL",G[G.PACKET_JOINED_DEST_CHANNEL=3]="PACKET_JOINED_DEST_CHANNEL",G[G.PACKET_SENT_TO_DEST_CHANNEL=4]="PACKET_SENT_TO_DEST_CHANNEL",G[G.PACKET_RECEIVED_VIDEO_FROM_SRC=5]="PACKET_RECEIVED_VIDEO_FROM_SRC",G[G.PACKET_RECEIVED_AUDIO_FROM_SRC=6]="PACKET_RECEIVED_AUDIO_FROM_SRC",G[G.PACKET_UPDATE_DEST_CHANNEL=7]="PACKET_UPDATE_DEST_CHANNEL",G[G.PACKET_UPDATE_DEST_CHANNEL_REFUSED=8]="PACKET_UPDATE_DEST_CHANNEL_REFUSED",G[G.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE=9]="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(I=O.CHANNEL_MEDIA_RELAY_EVENT||(O.CHANNEL_MEDIA_RELAY_EVENT={})),function(G){G[G.RELAY_STATE_IDLE=0]="RELAY_STATE_IDLE",G[G.RELAY_STATE_CONNECTING=1]="RELAY_STATE_CONNECTING",G[G.RELAY_STATE_RUNNING=2]="RELAY_STATE_RUNNING",G[G.RELAY_STATE_FAILURE=3]="RELAY_STATE_FAILURE"}(P=O.CHANNEL_MEDIA_RELAY_STATE||(O.CHANNEL_MEDIA_RELAY_STATE={})),function(G){G[G.RELAY_OK=0]="RELAY_OK",G[G.SERVER_ERROR_RESPONSE=1]="SERVER_ERROR_RESPONSE",G[G.SERVER_NO_RESPONSE=2]="SERVER_NO_RESPONSE",G[G.NO_RESOURCE_AVAILABLE=3]="NO_RESOURCE_AVAILABLE",G[G.FAILED_JOIN_SRC=4]="FAILED_JOIN_SRC",G[G.FAILED_JOIN_DEST=5]="FAILED_JOIN_DEST",G[G.FAILED_PACKET_RECEIVED_FROM_SRC=6]="FAILED_PACKET_RECEIVED_FROM_SRC",G[G.FAILED_PACKET_SENT_TO_DEST=7]="FAILED_PACKET_SENT_TO_DEST",G[G.SERVER_CONNECTION_LOST=8]="SERVER_CONNECTION_LOST",G[G.INTERNAL_ERROR=9]="INTERNAL_ERROR",G[G.SRC_TOKEN_EXPIRED=10]="SRC_TOKEN_EXPIRED",G[G.DEST_TOKEN_EXPIRED=11]="DEST_TOKEN_EXPIRED",G[G.RELAY_ALREADY_START=12]="RELAY_ALREADY_START",G[G.RELAY_NOT_START=13]="RELAY_NOT_START",G[G.OPERATION_ABORT=14]="OPERATION_ABORT"}(T=O.CHANNEL_MEDIA_RELAY_ERROR||(O.CHANNEL_MEDIA_RELAY_ERROR={}))},function(c,O,y){y.r(O),y.d(O,"isLiveTranscodingValid",function(){return T}),y.d(O,"generateSessionId",function(){return C}),y.d(O,"audioLevelHelper",function(){return k}),y.d(O,"vsResHack",function(){return I}),y.d(O,"is32Uint",function(){return P}),y.d(O,"safeCall",function(){return a}),y.d(O,"random",function(){return J}),y.d(O,"popBanTip",function(){return V}),y.d(O,"lengthInUtf8Bytes",function(){return G}),y.d(O,"audioTimerLoop",function(){return H}),y.d(O,"generateId",function(){return f}),y.d(O,"uint8ArrayToBase64",function(){return l}),y.d(O,"base64ToUint8Array",function(){return A});var m=y(11),d=y.n(m),E=y(4),p=y(0),b=y(28),s=y.n(b),g=y(25),i=y(15),a=function(){var _=arguments[0];if(typeof _=="function"){var n=Array.prototype.slice.call(arguments,1);_.apply(null,n)}},l=function(_){for(var n="",L=0;L<_.length;L+=1)n+=String.fromCharCode(_[L]);return window.btoa(n)},A=function(_){for(var n=window.atob(_),L=new Uint8Array(new ArrayBuffer(n.length)),h=0;h<n.length;h+=1)L[h]=n.charCodeAt(h);return L},k=function(_){return this.audioContext=Object(g.a)(),this.sourceNode=_.otWebkitAudioSource||this.audioContext.createMediaStreamSource(_),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var n=0,L=0;L<this.timeDomainData.length;L++)n=Math.max(n,Math.abs(this.timeDomainData[L]-128));return n/128}return p.default.warning("can't find analyser in audioLevelHelper"),0},this},S=1e4;function f(){return++S}function C(){return s()().replace(/-/g,"").toUpperCase()}var I=function(_,n,L){try{p.default.debug("start vsResHack",_);var h=document.createElement("video");h.setAttribute("autoplay",""),h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(h);var t=!1;h.addEventListener("playing",function(j){E.isFireFox()?h.videoWidth&&(t=!0,p.default.debug("[vsResHack] get stream resolution: ","".concat(h.videoWidth," x ").concat(h.videoHeight),_),n(h.videoWidth,h.videoHeight),h.srcObject=null,h.remove()):(t=!0,p.default.debug("[vsResHack] get stream resolution: ","".concat(h.videoWidth," x ").concat(h.videoHeight),_),n(h.videoWidth,h.videoHeight),h.srcObject=null,h.remove())}),Object(i.setSrcObject)(h,_),h.play().catch(function(){}),setTimeout(function(){!t&&h&&(n(h.videoWidth,h.videoHeight),h.srcObject=null,h.remove())},4e3)}catch(j){L(j)}},P=function(_){return typeof _=="number"&&0<=_&&_<=4294967295},T=function(_){var n=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var L in _)if(L==="lowLatency"&&typeof _[L]!="boolean"||L==="userConfigExtraInfo"&&d()(_[L])!=="object"||L==="transcodingUsers"&&!F(_[L])||!~n.indexOf(L)&&typeof _[L]!="number")throw new Error("Param ["+L+"] is inValid");return!0},F=function(_){for(var n=0;n<_.length;n++)for(var L in _[n])if(typeof _[n][L]!="number")throw new Error("Param user["+n+"] - ["+L+"] is inValid");return!0},J=function(_){isNaN(_)&&(_=1e3);var n=+new Date,L=(n=(9301*n+49297)%233280)/233280;return Math.ceil(L*_)},G=function(_){var n=encodeURIComponent(_).match(/%[89ABab]/g);return _.length+(n?n.length:0)},H=function(_,n){var L=1/n,h=Object(g.a)(),t=h.createGain();t.gain.value=0,t.connect(h.destination);var j=!1;return function r(){var v=h.createOscillator();v.onended=r,v.connect(t),v.start(0),v.stop(h.currentTime+L),_(h.currentTime),j&&(v.onended=function(){})}(),function(){j=!0}},V=function(){if(!document.getElementById("agora-ban-tip")){var _=document.createElement("div");_.id="agora-ban-tip",_.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(_);var n=document.createElement("div");n.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",_.append(n);var L=document.createElement("div");L.style="height: 76px; display: flex; justify-content: center; align-items: center;";var h=document.createElement("span");h.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",h.innerText="!";var t=document.createElement("span");t.innerText="This browser does not support webRTC",L.append(h),L.append(t);var j=document.createElement("div");j.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",j.innerText="OK",n.append(L),n.append(j),j.onclick=function(){var r=document.getElementById("agora-ban-tip");r.parentNode.removeChild(r)}}}},function(c,O){function y(m){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?c.exports=y=function(d){return typeof d}:c.exports=y=function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},y(m)}c.exports=y},function(c,O,y){c.exports=y(64)},function(c,O,y){var m=y(12),d=y.n(m),E=y(17),p=y.n(E),b=y(11),s=y.n(b),g=y(32),i=y.n(g),a=y(7),l=y.n(a),A=y(22),k=y(8),S=function(w){w&&w.apply(this,[].slice.call(arguments,1))},f=y(0),C=y(1),I=y(10),P=y(14),T=y(2),F=function(w){var D=Object(k.b)(w);D.needReconnect=!0,D.isTimeout=!1,D.isInit=!0,D.sendbytes=0,D.recvbytes=0,D.startTime=Date.now(),D.lastMsgTime=null,D.clientId=w.clientId,D.hostIndex=0,D.requestID=0,w.host instanceof Array?D.host=w.host:D.host=[w.host],D.getSendBytes=function(){return D.sendbytes},D.getRecvBytes=function(){return D.recvbytes},D.getDuration=function(){return Math.ceil((Date.now()-D.startTime)/1e3)},D.getURL=function(){return D.connection.url},D.reconnect=function(){D.isInit=!0,D.creatConnection()},D.connectNext=function(){D.isInit=!0,++D.hostIndex,f.default.debug("["+D.clientId+"] Gateway length:"+D.host.length+" current index:"+D.hostIndex),D.hostIndex>=D.host.length?D.dispatchEvent(Object(k.d)({type:"recover"})):D.creatConnection()},D.replaceHost=function(Y){D.host=Y||D.host,D.hostIndex=0,D.creatConnection()},D.creatConnection=function(){D.needReconnect=!0,D.lts=new Date().getTime(),D.connection=new WebSocket("wss://"+D.host[D.hostIndex]),D.connection.binaryType="arraybuffer",D.turnConfig={};var Y=w.proxyServerType;if(D.connection.url&&Y!==3&&Y!==4&&Y!==5){var Z=D.connection.url.match(/wss\:\/\/([^:]+):(\d+)/),oe=D.host[D.hostIndex].split(":"),de=D.connection.url.match(/h=([^:]+)&p=(\d+)/);Z?(D.turnConfig.url=Z[1],Object(T.getParameter)("TURN_ENABLE_TCP")&&(D.turnConfig.tcpport=parseInt(Z[2])+30),Object(T.getParameter)("TURN_ENABLE_UDP")&&(D.turnConfig.udpport=parseInt(Z[2])+30)):de?(D.turnConfig.url=de[1],Object(T.getParameter)("TURN_ENABLE_TCP")&&(D.turnConfig.tcpport=parseInt(de[2])+30),Object(T.getParameter)("TURN_ENABLE_UDP")&&(D.turnConfig.udpport=parseInt(de[2])+30)):oe&&(D.turnConfig.url=oe[0],Object(T.getParameter)("TURN_ENABLE_TCP")&&(D.turnConfig.tcpport=parseInt(oe[1])+30),Object(T.getParameter)("TURN_ENABLE_UDP")&&(D.turnConfig.udpport=parseInt(oe[1])+30))}D.connection.onopen=function(le){D.needReconnect=!0,D.isTimeout=!1,D.isInit=!1,D.sendbytes=0,D.recvbytes=0,D.startTime=Date.now(),Object(P.resetHTTPByetsCount)(),clearTimeout(D.timeoutCheck),D.dispatchEvent(Object(k.d)({type:"onopen",event:le,socket:D}))},D.connection.onmessage=function(le){if(le.data instanceof ArrayBuffer)D.dispatchEvent({type:"onBinaryData",data:le.data});else{D.recvbytes+=Object(I.lengthInUtf8Bytes)(le.data);var ce=JSON.parse(le.data);D.lastMsgTime=Date.now(),ce.hasOwnProperty("_id")?D.dispatchEvent(Object(k.d)({type:ce._id,msg:ce})):ce.hasOwnProperty("_type")&&D.dispatchSocketEvent(Object(k.d)({type:ce._type,msg:ce._message}))}},D.connection.onclose=function(le){D.needReconnect?D.isTimeout||D.isInit?(f.default.debug("["+D.clientId+"] websockect connect timeout"),C.report.joinGateway(w.sid,{lts:D.lts,succ:!1,ec:"timeout",addr:D.connection.url}),D.connectNext()):(D.dispatchEvent(Object(k.d)({type:"disconnect",event:le})),D.requests&&D.requests instanceof Array&&(D.requests.map(function(ce){ce.callback("REQUEST_ABORT")}),D.requests=[])):(f.default.debug("["+D.clientId+"] websockect closeed"),S(w.onFailure,le),clearTimeout(D.timeoutCheck),D.dispatchEvent(Object(k.d)({type:"close",event:le})),D.connection.onopen=void 0,D.connection.onclose=void 0,D.connection.onerror=void 0,D.connection.onmessage=void 0,D.connection=void 0)},D.connection.onerror=function(le){},setTimeout(function(){D.connection&&D.connection.readyState!=WebSocket.OPEN&&(D.isTimeout=!0,D.connection.close())},5e3)},D.creatConnection(),D.sendMessage=function(Y,Z){if(D.connection&&D.connection.readyState==WebSocket.OPEN){var oe=JSON.stringify(Y);D.sendbytes+=Object(I.lengthInUtf8Bytes)(oe),D.connection.send(oe)}else Z({error:"Gateway not connected"})},D.disconnect=function(){D.needReconnect=!0,D.connection.close()},D.close=function(){D.needReconnect=!1,D.connection.onclose=void 0,D.connection.close(),clearInterval(D.requestTimer),D.requests&&D.requests instanceof Array&&(D.requests.map(function(Y){Y.callback("REQUEST_ABORT")}),D.requests=[])},D.sendSignalCommand=function(Y,Z){Y._id="_request_"+D.requestID,D.requestID+=1,Y._type!=="publish_stats"&&Y._type!=="subscribe_stats"&&Y._type!=="publish_stats_low"&&D.on(Y._id,function(oe){oe.msg&&Z&&Z(oe.msg._result,oe.msg.message),delete D.dispatcher.eventListeners[Y._id]}),D.sendMessage(Y,function(oe){oe.reason="NOT_CONNECTED",Z&&Z(oe.reason,oe)})},D.requests=[];var x=function(Y){var Z=D.requests.findIndex(function(de){return de.id===Y.type});if(Z>=0)var oe=D.requests.splice(Z,1)[0];oe&&D.dispatcher.eventListeners[Y.type]?(delete D.dispatcher.eventListeners[Y.type],Y.msg&&oe.callback&&oe.callback(Y.msg._result,Y.msg._message)):f.default.warning("Detached Response",Y.type,Y.msg)},ee=function(Y){var Z=this,oe=D.requests.findIndex(function(de){return de.id===Z.id});oe>=0&&(Z=D.requests.splice(oe,1)[0]),Z&&D.dispatcher.eventListeners[Y.type]?(delete D.dispatcher.eventListeners[Y.type],Y.reason="NOT_CONNECTED",Z.callback&&Z.callback(Y.reason,Y)):f.default.warning("handleSendError",Z)};return D.sendRequest=function(Y,Z){Y=l()({_id:"_request_"+D.requestID},Y),D.requestID+=1;var oe={id:Y._id,timeoutCounter:0,stalledAt:Date.now(),message:Y,callback:Z};D.requests.push(oe),D.addEventListener(Y._id,x),D.sendMessage(Y,ee.bind(oe))},D.checkRequestTimeout=function(){for(var Y=Math.ceil(Object(T.getParameter)("SIGNAL_REQUEST_TIMEOUT")/Object(T.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),Z=D.requests.length-1;Z>=0;Z--){var oe=D.requests[Z];oe.timeoutCounter>=Y?(D.requests.splice(Z,1),f.default.error("Request Timeout",oe.timeoutCounter,oe.message),oe.callback&&oe.callback("TIMEOUT")):oe.timeoutCounter++}},clearInterval(D.requestTimer),D.requestTimer=setInterval(D.checkRequestTimeout,Object(T.getParameter)("SIGNAL_REQUEST_WATCH_INTERVAL")),D.sendReport=function(Y){D.sendMessage(Y,function(){})},D},J=function(w,D){var x={connect:function(){D.host=w,x.signal=F(D),x.on=x.signal.on,x.dispatchEvent=x.signal.dispatchEvent,x.signal.on("onopen",function(ee){x.signal.onEvent=function(Y){x.dispatchEvent(Object(k.d)({type:Y.event,msg:Y}))},x.dispatchEvent(Object(k.d)({type:"connect",msg:ee}))}),x.signal.on("onError",function(ee){var Y=ee.msg;onError(Y.code,"error")})},getLastMsgTime:function(){return x.signal&&x.signal.lastMsgTime},getSendBytes:function(){return x.signal.getSendBytes()},getRecvBytes:function(){return x.signal.getRecvBytes()},getDuration:function(){return x.signal.getDuration()},disconnect:function(){x.signal.disconnect()},close:function(){x.signal.close()},getURL:function(){return x.signal.getURL()},reconnect:function(){x.signal.reconnect()},connectNext:function(){x.signal.connectNext()},replaceHost:function(ee){x.signal.replaceHost(ee)},emitSimpleMessage:function(ee,Y){x.signal.sendSignalCommand(ee,Y)},emitRequest:function(ee,Y){x.signal.sendRequest(ee,Y)},emitReport:function(ee){x.signal.sendReport(ee)}};return x.connect(),x},G=y(23),H=y(5),V=y(20),_=y(4),n={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",K_SERVICE_NOT_READY:"tryNext",K_SERVICE_TOO_HEAVY:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},L={googActualEncBitrate:"A_aeb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googAvailableReceiveBandwidth:"A_arb",googTargetEncBitrate:"A_teb",googBucketDelay:"A_bd",googTransmitBitrate:"A_tb",googCodecName:"A_cn",bytesSent:"bytesSent",packetsLost:"packetsLost",packetsSent:"packetsSent",googAdaptationChanges:"A_ac",googAvgEncodeMs:"A_aem",googEncodeUsagePercent:"A_eup",googFirsReceived:"A_fr",googFrameHeightInput:"A_fhi",googFrameHeightSent:"A_fhs",googFrameRateInput:"A_fri",googFrameRateSent:"A_frs",googFrameWidthInput:"A_fwi",googFrameWidthSent:"A_fws",googNacksReceived:"A_nr",googPlisReceived:"A_pr",googRtt:"A_rtt",aecDivergentFilterFraction:"A_adff",audioInputLevel:"A_ail",googEchoCancellationReturnLoss:"A_ecrl",googEchoCancellationReturnLossEnhancement:"A_ecrle",googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_relrm",googTargetDelayMs:"A_tdm",bytesReceived:"bytesReceived",packetsReceived:"packetsReceived",googDecodeMs:"A_dm",googMaxDecodeMs:"A_mdm",googRenderDelayMs:"A_rdm",googFrameWidthReceived:"A_fwr",googFrameHeightReceived:"A_fhr",googFrameRateReceived:"A_frr",googFrameRateDecoded:"A_frd",googFrameRateOutput:"A_fro",googJitterBufferMs:"A_jbm",googCurrentDelayMs:"A_cdm",googMinPlayoutDelayMs:"A_mpdm",googNacksSent:"A_ns",googPlisSent:"A_ps",googFirsSent:"A_fs",audioOutputLevel:"A_aol",googAccelerateRate:"A_ar",googDecodingCNG:"A_dcng",googDecodingCTN:"A_dctn",googDecodingCTSG:"A_dctsg",googDecodingNormal:"A_dn",googDecodingPLC:"A_dplc",googDecodingPLCCNG:"A_dplccng",googExpandRate:"A_er",googJitterReceived:"A_jr",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sdr",googSpeechExpandRate:"A_ser",uplink_fraction_lost:"B_ufl",uplink_cumulative_lost:"B_ucl",uplink_available_bandwidth:"B_uab",period_fir:"B_fir",access_delay:"B_acd",uplink_network_quality:"B_unq",downlink_network_quality:"B_dnq",pub_audio_lost_ratio_400ms:"B_palr4",pub_video_lost_ratio_400ms:"B_pvlr4",e2e_delay:"B_ed",audio_delay:"B_ad",video_delay:"B_vd",stream_type:"B_st",e2e_audio_lost_ratio_400ms:"B_ealr4",e2e_video_lost_ratio_400ms:"B_evlr4",downlink_estimate_bandwidth:"B_deb",peer_publish_audio_duration:"B_ppad",peer_publish_video_duration:"B_ppvd"},h={};for(var t in L){var j=L[t];h[j]&&f.default.error("Key Conflict: ".concat(j,": ").concat(L[j],"| ").concat(t)),h[j]=t}var r=function(w){return L[w]||w},v=function(w){return h[w]||w},M=y(9),B=y.n(M),q=y(54),Q=function w(D){var x=!1,ee=function(u){return{_type:"control",_message:u}},Y=function(u,U){var $={};return Object.keys(U).forEach(function(X){Object(T.getParameter)("STATS_FILTER")[X]||($[r(X)]=U[X])}),{_type:"subscribe_related_stats",_message:{stream_type:"high",stream_id:u,stats:$}}},Z=function(u){return{_type:"publish",_message:u}},oe=function(u,U){var $={};return Object.keys(U).forEach(function(X){Object(T.getParameter)("STATS_FILTER")[X]||($[r(X)]=U[X])}),{_type:"subscribe_stats",_message:{stream_id:u,stats:$}}},de=w.DISCONNECTED,le=w.CONNECTING,ce=w.CONNECTED,re=w.DISCONNECTING,ge=de,o=Object(k.b)(D);Object.defineProperty(o,"state",{set:function(u){var U=ge;ge=u,Object(V._setClientConnectionStateRecord)(o.clientId,u),u!==w.CONNECTED&&u!==w.DISCONNECTING&&(o.hasJoined=!1),U!==u&&o.dispatchEvent({type:"connection-state-change",prevState:w.connetionStateMap[U],curState:w.connetionStateMap[u]})},get:function(){return ge}}),o.socket=void 0,o.state=de,o.mode=D.mode,o.role=D.role,o.codec=D.codec,o.config={},o.timers={},o.timer_counter={},o.localStreams={},o.remoteStreams={},o.remoteMuteState={},o.attemps=1,o.p2p_attemps=1,o.audioLevel={},o.activeSpeaker=void 0,o.reconnectMode="tryNext",o.rejoinAttempt=0,o.hasChangeBGPAddress=!1,o.traffic_stats={},o.clientId=D.clientId,o.pingpongCounter=0,o.hasInvokeLeave=!1,o.p2ps=new Map,o.liveStreams=new Map,o.injectLiveStreams=new Map,o.remoteStreamsInChannel=new Set,o.subscribeRequestId=new Map,o.publishRequestId=0,o.hasJoined=!1,o.isFirstSuccess=!0,o.peerPublishDurationMap=new Map,function(u){var U=S;u.makeRequest=function($,X,ie){if(u.socket===void 0)return f.default.debug("[".concat(u.clientId,"] No socket available")),void U(ie,H.default.INVALID_OPERATION);try{u.socket.emitRequest($,function(W,K){var ne;W==="success"?typeof X=="function"&&X(K):typeof ie=="function"&&(ne=K&&K.error_code&&H.GatewayErrorCode[K.error_code]?H.GatewayErrorCode[K.error_code]:K&&K.error_str?K.error_str:K&&K.error_code?"UNKNOW_ERROR_".concat(K.error_code):W,ie(ne,K))})}catch(W){f.default.debug("[".concat(u.clientId,"] Socket emit message failed ").concat(JSON.stringify($))),f.default.debug("[".concat(u.clientId,"] "),W),U(ie,H.default.SOCKET_ERROR)}},u.makeReport=function($){u.socket===void 0&&f.default.debug("[".concat(u.clientId,"] No socket available"));try{u.socket.emitReport($)}catch{f.default.debug("[".concat(u.clientId,"] Socket emit report failed ").concat(JSON.stringify($)))}}}(o),o.inChannelInfo={joinAt:null,duration:0},o._sendMessage=function(u,U){switch(u){case"SubscribeStats":o.makeReport(oe.apply(void 0,i()(U)));break;case"SubscribeRelatedStats":o.makeReport(Y.apply(void 0,i()(U)))}};var pe=S;o.p2pCounter=Object(I.random)(1e5),o.generateP2PId=function(){return++o.p2pCounter},o.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},o.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},o.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},o.configPublisher=function(u){o.config=u},o.getGatewayInfo=function(u,U){o.makeRequest({_type:"gateway_info"},u,U)},o.setClientRole=function(u,U){f.default.debug("[".concat(o.clientId,"] setClientRole to ").concat(u));var $=C.report.reportApiInvoke(o.joinInfo.sid,{name:"_setClientRole",callback:U});o.makeRequest({_type:"set_client_role",_message:{role:u}},function(){o.role=u,o.dispatchEvent({type:"client-role-changed",role:u}),$&&$(null,{role:u})},function(X,ie){if(ie&&ie.code&&(X=H.GatewayErrorCode[ie.code]||"UNKNOW_ERROR_"+ie.code),X==="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE")return $&&$(null);f.default.error("set Client role error to "+u+": "+X),$&&$(X)})},o.join=function(u,U,$,X){o.hasInvokeLeave=!1,u.useProxyServer&&(o.hasChangeBGPAddress=!0);var ie=new Date().getTime(),W=u.uid;if(o.inChannelInfo.joinAt&&(o.inChannelInfo.duration+=ie-o.inChannelInfo.joinAt),o.inChannelInfo.joinAt=ie,o.state!==le)return f.default.error("[".concat(o.clientId,"] GatewayClient.join Failed: state "),o.state),X&&X(H.default.INVALID_OPERATION),void C.report.joinGateway(u.sid,{lts:ie,succ:!1,ec:H.default.INVALID_OPERATION,addr:null});if(W!=null&&parseInt(W)!==W)return f.default.error("[".concat(o.clientId,"] Input uid is invalid")),o.state=de,X&&X(H.default.INVALID_PARAMETER),void C.report.joinGateway(u.sid,{lts:ie,succ:!1,ec:H.default.INVALID_PARAMETER,addr:null});var K=z.register(o,{uid:W,cname:u&&u.cname});if(K)return o.state=de,X&&X(K),void C.report.joinGateway(u.sid,{lts:ie,succ:!1,ec:K,addr:null});o.joinInfo=l()({},u),o.uid=W,o.key=U,o.pingpongCounter=0,Ee(u,function(ne){if(u.useLocalAccessPoint)try{var se=o.socket.signal.connection.url.match(/wss\:\/\/([^:]+):(\d+)/)[1];Object(T.setParameter)("EVENT_REPORT_DOMAIN",se),Object(T.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",se),Object(T.setParameter)("LOG_UPLOAD_SERVER","".concat(se,":6444"))}catch(ue){f.default.debug("[".concat(o.clientId,"] LocalAccessPoint error: ").concat(ue))}if(o.state===re||o.state===de)return X&&X("LEAVE_BEFORE_JOIN_SUCCESS");o.state=ce,f.default.debug("[".concat(o.clientId,"] Connected to gateway server")),clearInterval(o.pingTimer),o.pingTimer=setInterval(function(){var ue=Object(T.getParameter)("PING_PONG_TIME_OUT");if(++o.pingpongCounter>=ue){var ae=Date.now();o.socket&&f.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(ae-o.socket.getLastMsgTime(),"ms")),o.socket&&o.socket.getLastMsgTime()&&ae-o.socket.getLastMsgTime()>Object(T.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(o.pingpongCounter=0,o.socket.close(),o.socket.dispatchEvent(Object(k.d)({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var me=Date.now();o.makeRequest({_type:"ping"},function(){o.pingpongCounter=0;var ve=Date.now()-me;Object(T.getParameter)("REPORT_STATS")&&o.makeRequest({_type:"ping_back",_message:{pingpongElapse:ve}})},function(ve,Re){ve!=="TIMEOUT"&&(f.default.error("Ping Error ".concat(ve," ").concat(JSON.stringify(Re))),Re&&Re.error_code&&o.socket&&o.socket.signal&&o.socket.signal.connection&&o.socket.signal.connection.readyState===WebSocket.OPEN&&(f.default.info("Disconnecting websocket connection"),o.socket.signal.connection.close()))})},3e3),function(ue,ae){var me=ue.role,ve=l()({},o.joinInfo.apResponse),Re={session_id:o.joinInfo.sid,app_id:D.appId,channel_key:o.key,channel_name:o.joinInfo.cname,sdk_version:T.VERSION,browser:navigator.userAgent,process_id:Object(C.getProcessId)(),mode:o.mode,codec:o.codec,role:me,has_changed_gateway:Object(T.getParameter)("FORCE_CHANGED_GATEWAY_FLAG")||o.hasChangeBGPAddress,ap_response:ve,optionalInfo:o.joinInfo.optionalInfo,extend:Object(T.getParameter)("JOIN_EXTEND"),details:{}};if(o.joinInfo.hasOwnProperty("stringUid")&&(Re.string_uid=o.joinInfo.stringUid),o.socket&&o.socket.signal&&o.socket.signal&&(ve.addresses&&ve.addresses[o.socket.signal.hostIndex]&&(Re.ap_response.ticket=ve.addresses[o.socket.signal.hostIndex].ticket,delete ve.addresses),Object(T.getParameter)("SET_DEFAULT_TURNSERVER")&&o.socket.signal.turnConfig)){var Ie={username:o.joinInfo.uid.toString(),credential:o.joinInfo.token,forceturn:Object(T.getParameter)("FORCE_TURN")};Ie.url=o.socket.signal.turnConfig.url,o.socket.signal.turnConfig.tcpport&&(Ie.tcpport=""+o.socket.signal.turnConfig.tcpport),o.socket.signal.turnConfig.udpport&&(Ie.udpport=""+o.socket.signal.turnConfig.udpport),o.joinInfo.turnServers.find(function(Se){if(Se.url===Ie.url)return!0})||o.joinInfo.turnServers.push(Ie)}o.joinInfo.proxyServerType===3&&(Re.plugin="web_cloud_proxy",Re.details.cservice_map="1"),o.joinInfo.aesmode&&o.joinInfo.aespassword?(Re.aes_mode=o.joinInfo.aesmode,Re.aes_encrypt=!0,o.joinInfo.aes_salt&&(Re.aes_salt=o.joinInfo.aes_salt),Object(q.encryptRSA)(o.joinInfo.aespassword).then(function(Se){Re.aes_secret=Se,o.dispatchEvent({type:"join-message-hook",joinMessage:Re}),ae(null,{_type:"join",_message:Re})}).catch(function(Se){f.default.error("[".concat(o.clientId,"] encrypt password failed "),Se),ae("ENCRYPT_PASSWORD_FAILED")})):(o.dispatchEvent({type:"join-message-hook",joinMessage:Re}),ae(null,{_type:"join",_message:Re}))}({role:o.role},function(ue,ae){if(ue)return X&&X(ue);o.makeRequest(ae,function(me){if(C.report.joinGateway(u.sid,{lts:ie,succ:!0,ec:null,vid:u.vid,uid:u.uid,addr:o.socket.getURL(),firstSuccess:o.isFirstSuccess}),o.joinSuccessLts=Date.now(),o.isFirstSuccess=!1,o.rejoinAttempt=0,o.hasJoined=!0,$&&$(me.uid),me.return_vosip===!0||Object(T.getParameter)("ENABLE_LIVE_SERVER_LIST")===!0){var ve=null;try{ve=o.socket.signal.connection.url}catch(Re){f.default.debug("[".concat(o.clientId,"] Can not get gateway ip: ").concat(Re))}ve?Object(T.setParameter)("LIVE_SERVER_LIST",[ve]):Object(T.setParameter)("LIVE_SERVER_LIST",[])}o.dispatchEvent({type:"join"}),clearInterval(o.timers.trafficStats),o.timers.trafficStats=setInterval(function(){o.makeRequest({_type:"traffic_stats"},function(Re){var Ie={};for(var Se in Re)Ie[v(Se)]=Re[Se];if(Ie.peer_delay&&Ie.peer_delay.length){var Te=[];Ie.peer_delay.forEach(function(Oe){var Ce={};for(var Ne in Oe)Ce[v(Ne)]=Oe[Ne];Te.push(Ce)}),Ie.peer_delay=Te}o.traffic_stats=Ie,o.traffic_stats.timestamp=Date.now();var be=o.joinInfo.stringUid,Ae=o.localStreams[W]||o.localStreams[be];Ae&&(Ae.traffic_stats={access_delay:Ie.access_delay}),Ie.peer_delay&&Ie.peer_delay.forEach(function(Oe){var Ce=o.remoteStreams[Oe.peer_uid];Ce&&(Ce.traffic_stats={access_delay:Ie.access_delay,e2e_delay:Oe.e2e_delay,audio_delay:Oe.audio_delay,video_delay:Oe.video_delay})}),o.dispatchEvent({type:"after-getTrafficStats",trafficStats:Ie})})},3e3)},function(me,ve){if(f.default.error("[".concat(o.clientId,"] User join failed [").concat(me,"]")),me==="ERR_JOIN_BY_MULTI_IP"){try{C.report.joinGateway(u.sid,{lts:ie,succ:!1,ec:"ERR_JOIN_BY_MULTI_IP",addr:o.socket.getURL()})}catch{}return o.dispatchEvent({type:"onMultiIP",option:ve.option})}n[me]&&o.rejoinAttempt<4?o._doWithAction(n[me],$,X):X&&X(me),C.report.joinGateway(u.sid,{lts:ie,succ:!1,ec:me,addr:o.socket&&o.socket.getURL()})})})}),this.remoteMuteState={},o.resetAudioVolumeIndication()},o.leave=function(u,U){var $=z.unregister(o);switch($&&f.default.debug("[".concat(o.clientId,"] "),$),o.p2ps.clear(),o.state){case de:return f.default.debug("[".concat(o.clientId,"] Client Already in DISCONNECTED status")),void pe(u);case re:return f.default.debug("[".concat(o.clientId,"] Client Already in DISCONNECTING status")),void pe(U,H.default.INVALID_OPERATION);case le:return o.socket&&o.socket.close(),o.socket=void 0,f.default.info("[".concat(o.clientId,"] Client connecting, Leave channel success")),o.state=de,u&&u()}for(var X in o.state=re,o.channelMediaConfig&&(o.channelMediaRelayController&&o.channelMediaRelayController.dispose(),o.channelMediaConfig,o.channelMediaRelayController=null),clearInterval(o.pingTimer),o.timers)o.timers.hasOwnProperty(X)&&clearInterval(o.timers[X]);for(var X in o.inChannelInfo.joinAt&&(o.inChannelInfo.duration+=Date.now()-o.inChannelInfo.joinAt,o.inChannelInfo.joinAt=null),o.hasJoined?o.makeRequest({_type:"leave"},function(K){o.socket.close(),o.socket=void 0,f.default.info("[".concat(o.clientId,"] Leave channel success")),o.state=de,u&&u(K)},function(K){K!=="TIMEOUT"&&K!=="REQUEST_ABORT"&&(f.default.error("[".concat(o.clientId,"] Leave Channel Failed"),K),o.state=ce,U&&U(K))}):(o.socket&&(o.socket.close(),o.socket=void 0),f.default.info("[".concat(o.clientId,"] Leave channel before joined")),o.state=de,u&&u()),o.localStreams)if(o.localStreams.hasOwnProperty(X)){var ie=o.localStreams[X];delete o.localStreams[X],ie.pc!==void 0&&(ie.pc.close(),ie.pc=void 0)}ye()},o.publish=function(u,U,$,X){var ie=new Date().getTime(),W=!1;if(u.publishLTS=ie,s()(u)!=="object"||u===null)return f.default.error("[".concat(o.clientId,"] Invalid local stream")),X&&X(H.default.INVALID_LOCAL_STREAM),void C.report.publish(o.joinInfo.sid,{lts:ie,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:H.default.INVALID_LOCAL_STREAM});if(!u.stream&&u.url===void 0)return f.default.error("[".concat(o.clientId,"] Invalid local media stream")),X&&X(H.default.INVALID_LOCAL_STREAM),void C.report.publish(o.joinInfo.sid,{lts:ie,succ:!1,audio:!1,video:!1,screenshare:!1,audioName:"",videoName:"",screenName:"",ec:H.default.INVALID_LOCAL_STREAM});if(o.state!==ce)return f.default.error("[".concat(o.clientId,"] User is not in the session")),X&&X(H.default.INVALID_OPERATION),void C.report.publish(o.joinInfo.sid,{lts:ie,succ:!1,audio:u.hasAudio(),video:u.hasVideo(),screenshare:u.hasScreen(),audioName:u.hasAudio()&&u.audioName,videoName:u.hasVideo()&&u.videoName,screenName:u.hasScreen()&&u.screenName,ec:H.default.INVALID_OPERATION});var K=u.getAttributes()||{};if(u.local&&o.localStreams[u.getId()]===void 0&&(u.hasAudio()||u.hasVideo()||u.hasScreen())){var ne=o.generateP2PId();if(o.p2ps.set(ne,u),u.p2pId=ne,u.url!==void 0)he(Z({state:"url",audio:u.hasAudio(),video:u.hasVideo(),attributes:u.getAttributes()},u.url),function(ue,ae){ue==="success"?(u.getUserId()!==ae&&u.setUserId(ae),o.localStreams[ae]=u,u.onClose=function(){o.unpublish(u)}):f.default.error("[".concat(o.clientId,"] Publish local stream failed"),ue)});else{o.localStreams[u.getId()]=u,u.connectionSpec={callback:function(ue){ue||X&&X("CANNOT_GET_OFFER"),u.optimizationMode==="motion"&&u.pc.setRtpSenderParameters("maintain-framerate"),u.optimizationMode==="detail"&&u.pc.setRtpSenderParameters("maintain-resolution"),o.makeRequest(Z({state:"offer",stream_type:U.streamType==1?"low":"high",p2p_id:ne,sdp:ue,audio:u.audio||u.screenAudio,video:u.screen||u.video,screen:u.screen,attributes:u.getAttributes(),dtx:u.DTX,hq:u.highQuality,lq:u.lowQuality,stereo:u.stereo,speech:u.speech,codec:o.codec,extend:Object(T.getParameter)("PUB_EXTEND")}),function(ae){u.getUserId()!==ae.uid&&u.setUserId(ae.uid),f.default.info("[".concat(o.clientId,"] Local stream published with uid"),ae.uid),u.onClose=function(){o.unpublish(u)},u._onAudioUnmute=function(){o.makeReport(ee({action:"unmute_local_audio",stream_id:u.getId()}))},u._onVideoUnmute=function(){o.makeReport(ee({action:"unmute_local_video",stream_id:u.getId()}))},u._onAudioMute=function(){o.makeReport(ee({action:"mute_local_audio",stream_id:u.getId()}))},u._onVideoMute=function(){o.makeReport(ee({action:"mute_local_video",stream_id:u.getId()}))},u.getId()===u.getUserId()&&(u.isAudioOn()||u.hasAudio()&&(f.default.debug("[".concat(o.clientId,"] local stream audio mute")),u._onAudioMute()),u.isVideoOn()||(u.hasVideo()||u.hasScreen())&&(f.default.debug("[".concat(o.clientId,"] local stream video mute")),u._onVideoMute())),u.pc.oniceconnectionstatechange=function(me){if(me==="failed"){if(o.timers[u.getId()]!=null&&(clearInterval(o.timers[u.getId()]),clearInterval(o.timers[u.getId()]+"_RelatedStats")),f.default.error("[".concat(o.clientId,"] Publisher connection is lost -- streamId: ").concat(u.getId(),", p2pId: ").concat(ne)),o.p2ps.delete(ne),f.default.debug("[".concat(o.clientId,"] publish p2p failed: "),o.p2ps),!W)return W=!0,C.report.publish(o.joinInfo.sid,{lts:ie,succ:!1,audio:u.hasAudio(),video:u.hasVideo(),screenshare:u.hasScreen(),audioName:u.hasAudio()&&u.audioName,videoName:u.hasVideo()&&u.videoName,screenName:u.hasScreen()&&u.screenName,ec:H.default.PEERCONNECTION_FAILED,publishRequestid:o.publishRequestId||0,p2pid:ne}),o.dispatchEvent(Object(k.a)({type:"pubP2PLost",stream:u})),X&&X(H.default.PEERCONNECTION_FAILED);o.dispatchEvent(Object(k.a)({type:"pubP2PLost",stream:u}))}else if(me==="connected"&&(f.default.debug("[".concat(o.clientId,"] publish p2p connected: "),o.p2ps),u.getId()===u.getUserId()&&(u._isAudioMuted()?o.makeReport(ee({action:"mute_local_audio",stream_id:u.getId()})):o.makeReport(ee({action:"unmute_local_audio",stream_id:u.getId()})),u._isVideoMuted()?o.makeReport(ee({action:"mute_local_video",stream_id:u.getId()})):o.makeReport(ee({action:"unmute_local_video",stream_id:u.getId()}))),!W))return W=!0,C.report.publish(o.joinInfo.sid,{lts:ie,succ:!0,audio:u.hasAudio(),video:u.hasVideo(),screenshare:u.hasScreen(),audioName:u.hasAudio()&&u.audioName,videoName:u.hasVideo()&&u.videoName,screenName:u.hasScreen()&&u.screenName,ec:null,publishRequestid:o.publishRequestId||0,p2pid:ne}),$&&$()},u.pc.processSignalingMessage(ae.sdp)},function(ae,me){f.default.error("Publish Failed: ".concat(ae)),C.report.publish(o.joinInfo.sid,{lts:ie,succ:!1,audio:u.hasAudio(),video:u.hasVideo(),screenshare:u.hasScreen(),audioName:u.hasAudio()&&u.audioName,videoName:u.hasVideo()&&u.videoName,screenName:u.hasScreen()&&u.screenName,ec:ae,publishRequestid:o.publishRequestId||0,p2pid:ne}),ae!="TIMEOUT"&&(o.processPublishFailure(u),X&&X(ae))})},audio:u.hasAudio(),video:u.hasVideo(),screen:u.hasScreen(),optimizationMode:u.optimizationMode,isSubscriber:!1,stunServerUrl:o.stunServerUrl,turnServers:o.joinInfo.turnServers,maxAudioBW:K.maxAudioBW,minVideoBW:K.minVideoBW,maxVideoBW:K.maxVideoBW,mode:o.mode,codec:o.codec,isVideoMute:u.userMuteVideo||u.peerMuteVideo,isAudioMute:u.userMuteAudio||u.peerMuteAudio,maxFrameRate:u.attributes.maxFrameRate,agoraStream:u,clientId:o.clientId,isCloudProxy3:o.joinInfo.proxyServerType===3,onNoIceCandidate:function(){o.dispatchEvent({type:"no_ice_candidate",stream:u})}},u.pc=Object(G.a)(u.connectionSpec),u.pc.addStream(u.stream),f.default.debug("[".concat(o.clientId,"] PeerConnection add stream :"),u.stream),u.pc.onnegotiationneeded=function(ue){u.optimizationMode==="motion"&&u.pc.setRtpSenderParameters("maintain-framerate"),u.optimizationMode==="detail"&&u.pc.setRtpSenderParameters("maintain-resolution");var ae={state:"negotiation",stream_type:U.streamType===1?"low":"high",p2p_id:ne,sdp:ue};o.makeRequest(Z(ae),function(me){f.default.debug("Negotating Stream ".concat(u.getId())),u.pc.processSignalingMessage(me.sdp)},function(me,ve){f.default.error("Negotiation failed ".concat(me),ve,ae)})},clearInterval(o.timers[u.getId()]),o.timers[u.getId()]=setInterval(function(){if(Object(T.getParameter)("REPORT_STATS")){var ue=0;u&&u.pc&&u.pc.getStats&&u.pc.getStatsRate(function(ae){ae.forEach(function(me){if(me&&me.id&&!(/_recv$/.test(me.id)||/^time$/.test(me.id)||~me.type.toLowerCase().indexOf("inbound"))&&u.getUserId()){if(me.id.indexOf("outbound_rtp")===-1&&me.id.indexOf("OutboundRTP")===-1&&me.type.toLowerCase().indexOf("outbound")===-1||me.mediaType!=="video"||(me.googFrameWidthSent=u.videoWidth+"",me.googFrameHeightSent=u.videoHeight+""),me.mediaType==="video")try{var ve=u.stream.getVideoTracks()[0];me.A_vstd=ve.enabled?"0":"1"}catch{}if(me.mediaType==="audio")try{var Re=u.stream.getAudioTracks()[0];me.A_astd=Re.enabled?"0":"1"}catch{}if(u.getId()==u.getUserId()){var Ie=200*ue;ue++,setTimeout(function(){var Se=o.socket&&o.socket.getLastMsgTime()&&Date.now()-o.socket.getLastMsgTime();Se>Object(T.getParameter)("REPORT_STATS_TIMEOUT")?f.default.debug("PublishStats report blocked by REPORT_STATS_TIMEOUT ".concat(Se)):o.makeReport(function(Te){var be={};return Object.keys(Te).forEach(function(Ae){Object(T.getParameter)("STATS_FILTER")[Ae]||(be[r(Ae)]=Te[Ae])}),{_type:"publish_stats",_message:{stream_type:"high",stats:be}}}(me))},Ie)}else Ie=200*ue,ue++,setTimeout(function(){var Se=o.socket&&o.socket.getLastMsgTime()&&Date.now()-o.socket.getLastMsgTime();Se>Object(T.getParameter)("REPORT_STATS_TIMEOUT")?f.default.debug("PublishStatsLow report blocked by REPORT_STATS_TIMEOUT ".concat(Se)):o.makeReport(function(Te){var be={};return Object.keys(Te).forEach(function(Ae){Object(T.getParameter)("STATS_FILTER")[Ae]||(be[r(Ae)]=Te[Ae])}),{_type:"publish_stats",_message:{stream_type:"low",stats:be}}}(me))},Ie)}})})}},3e3);var se=function(){Object(T.getParameter)("REPORT_STATS")&&u&&u.pc&&u.pc.getVideoRelatedStats&&u.pc.getVideoRelatedStats(function(ue){var ae,me,ve=o.socket&&o.socket.getLastMsgTime()&&Date.now()-o.socket.getLastMsgTime();ve>Object(T.getParameter)("REPORT_STATS_TIMEOUT")?f.default.debug("PublishRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(ve)):u.getId()===u.getUserId()?o.makeReport((ae=ue,me={},Object.keys(ae).forEach(function(Re){Object(T.getParameter)("STATS_FILTER")[Re]||(me[r(Re)]=ae[Re])}),{_type:"publish_related_stats",_message:{stream_type:"high",stats:me}})):o.makeReport(function(Re){var Ie={};return Object.keys(Re).forEach(function(Se){Object(T.getParameter)("STATS_FILTER")[Se]||(Ie[r(Se)]=Re[Se])}),{_type:"publish_related_stats",_message:{stream_type:"low",stats:Ie}}}(ue))})};se(),clearInterval(o.timers[u.getId()+"_RelatedStats"]),o.timers[u.getId()+"_RelatedStats"]=setInterval(se,1e3)}}},o.unpublish=function(u,U,$,X){if(s()(u)!=="object"||u===null)return f.default.error("[".concat(o.clientId,"] Invalid local stream")),void pe(X,H.default.INVALID_LOCAL_STREAM);if(o.state!==ce)return f.default.error("[".concat(o.clientId,"] User not in the session")),void pe(X,H.default.INVALID_OPERATION);if(o.timers[u.getId()]!=null&&(clearInterval(o.timers[u.getId()]),clearInterval(o.timers[u.getId()+"_RelatedStats"])),o.socket!==void 0)if(u.local&&o.localStreams[u.getId()]!==void 0){delete o.localStreams[u.getId()];var ie={stream_id:u.getUserId(),stream_type:U.streamType===1?"low":"high"};o.makeRequest({_type:"unpublish",_message:ie}),(u.hasAudio()||u.hasVideo()||u.hasScreen())&&u.url===void 0&&u.pc!==void 0&&(u.pc.close(),u.pc=void 0),u.onClose=void 0,u._onAudioMute=void 0,u._onAudioUnute=void 0,u._onVideoMute=void 0,u._onVideoUnmute=void 0,o.p2ps.delete(u.p2pId),$&&$()}else f.default.error("[".concat(o.clientId,"] Invalid local stream")),pe(X,H.default.INVALID_LOCAL_STREAM);else f.default.error("[".concat(o.clientId,"] User not in the session")),pe(X,H.default.INVALID_OPERATION)},o.subscribe=function(u,U,$){var X=new Date().getTime();u.subscribeLTS=X;var ie=!1;if(f.default.info("[".concat(o.clientId,"] Gatewayclient ").concat(o.uid," Subscribe ").concat(u.getId(),": ").concat(JSON.stringify(u.subscribeOptions))),s()(u)!=="object"||u===null)return f.default.error("[".concat(o.clientId,"] Invalid remote stream")),$&&$(H.default.INVALID_REMOTE_STREAM),void C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:H.default.INVALID_REMOTE_STREAM});if(o.state!==ce&&(f.default.error("[".concat(o.clientId,"] User is not in the session")),!ie))return ie=!0,C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:H.default.INVALID_OPERATION}),$&&$(H.default.INVALID_OPERATION);if(!u.local&&o.remoteStreams.hasOwnProperty(u.getId()))if(u.hasAudio()||u.hasVideo()||u.hasScreen()){var W=o.generateP2PId();o.p2ps.set(W,u),u.p2pId=W,u.pc=Object(G.a)({callback:function(K){K||$&&$("CANNOT_GET_OFFER");var ne={stream_id:u.getId(),audio:!u.subscribeOptions||u.subscribeOptions.audio,video:!u.subscribeOptions||u.subscribeOptions.video,codec:o.codec,p2p_id:W,sdp:K,tcc:Object(T.getParameter)("SUBSCRIBE_TCC"),extend:Object(T.getParameter)("SUB_EXTEND")};o.makeRequest({_type:"subscribe",_message:ne},function(se){u.pc.processSignalingMessage(se.sdp)},function(se,ue){f.default.error("[".concat(o.clientId,"] Subscribe remote stream Failed: ").concat(se,", closing stream "),u.getId(),ue),C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:se}),se!="TIMEOUT"&&(o.processSubscribeFailure(u),$&&$(se))})},nop2p:!0,audio:!0,video:!0,screen:u.hasScreen(),isSubscriber:!0,stunServerUrl:o.stunServerUrl,turnServers:o.joinInfo.turnServers,isVideoMute:u.userMuteVideo,isAudioMute:u.userMuteAudio,uid:u.getId(),agoraStream:u,clientId:o.clientId}),u.pc.onaddstream=function(K,ne){if(u._onAudioUnmute=function(){o.makeReport(ee({action:"unmute_remote_audio",stream_id:u.getId()}),function(){},function(){})},u._onAudioMute=function(){o.makeReport(ee({action:"mute_remote_audio",stream_id:u.getId()}),function(){},function(){})},u._onVideoUnmute=function(){o.makeReport(ee({action:"unmute_remote_video",stream_id:u.getId()}),function(){},function(){})},u._onVideoMute=function(){o.makeReport(ee({action:"mute_remote_video",stream_id:u.getId()}),function(){},function(){})},ne==="ontrack"&&K.track.kind==="video"||ne==="onaddstream"){f.default.info("[".concat(o.clientId,"] Remote stream subscribed with uid "),u.getId());var se=o.remoteStreams[u.getId()];if(o.remoteStreams[u.getId()].stream=ne==="onaddstream"?K.stream:K.streams[0],o.remoteStreams[u.getId()].hasVideo()){if(Object(_.isFireFox)()||Object(_.isSafari)()){var ue=o.remoteStreams[u.getId()].stream;Object(I.vsResHack)(ue,function(ve,Re){u.videoWidth=ve,u.videoHeight=Re},function(ve){return f.default.warning("[".concat(o.clientId,"] vsResHack failed: ")+ve)})}}else{var ae=o.remoteStreams[u.getId()];ae.peerMuteVideo=!0,o._adjustPCMuteStatus(ae)}se&&se.isPlaying()&&se.elementID&&(f.default.debug("[".concat(o.clientId,"] Reload Player ").concat(se.elementID," StreamId ").concat(se.getId())),u.audioOutput=se.audioOutput,se.stop(),u.play(se.elementID,se.playOptions)),delete u.audioLevelHelper;var me=Object(k.e)({type:"stream-subscribed",stream:o.remoteStreams[u.getId()]});o.dispatchEvent(me)}},clearInterval(o.timers[u.getId()]),o.timers[u.getId()]=setInterval(function(){if(Object(T.getParameter)("REPORT_STATS")){var K=0;u&&u.pc&&u.pc.getStats&&u.pc.getStatsRate(function(ne){ne.forEach(function(se){if(se&&se.id){if(/_send$/.test(se.id)||/^time$/.test(se.id)||/^bweforvideo$/.test(se.id))return;se.id.indexOf("inbound_rtp")===-1&&se.id.indexOf("inbound-rtp")===-1&&se.type.toLowerCase().indexOf("inbound")===-1||se.mediaType!=="video"||(se.googFrameWidthReceived=u.videoWidth+"",se.googFrameHeightReceived=u.videoHeight+"");var ue=200*K;K++;var ae=u.getId();setTimeout(function(){var me=o.socket&&o.socket.getLastMsgTime()&&Date.now()-o.socket.getLastMsgTime();if(me>Object(T.getParameter)("REPORT_STATS_TIMEOUT"))f.default.debug("SubscribeStats report blocked by REPORT_STATS_TIMEOUT ".concat(me));else{if(se.mediaType==="video")try{var ve=u.stream.getVideoTracks()[0];se.A_vrtd=ve.enabled?"0":"1",u.player&&u.player.freezeTimeCounterList.length>0&&(se.A_vrft=u.player.freezeTimeCounterList.splice(0,1)[0].toString())}catch{}if(se.mediaType==="audio")try{var Re=u.stream.getAudioTracks()[0];se.A_artd=Re.enabled?"0":"1"}catch{}o.makeReport(oe(ae,se))}},ue)}})})}},3e3),clearInterval(o.timers[u.getId()+"_RelatedStats"]),o.timers[u.getId()+"_RelatedStats"]=setInterval(function(){if(Object(T.getParameter)("REPORT_STATS")&&u&&u.pc){var K=o.socket&&o.socket.getLastMsgTime()&&Date.now()-o.socket.getLastMsgTime();if(K>Object(T.getParameter)("REPORT_STATS_TIMEOUT"))return void f.default.debug("SubscribeRelatedStats report blocked by REPORT_STATS_TIMEOUT ".concat(K));u.pc.getVideoRelatedStats&&u.pc.getVideoRelatedStats(function(ne){u.player&&(u.hasVideo()&&!u.peerMuteVideo&&(ne.isFreeze=u.player.freezeCount>u.player.lastFreezeCount),u.player.lastFreezeCount=u.player.freezeCount),o.makeReport(Y(u.getId(),ne))}),u.pc.getAudioRelatedStats&&u.pc.getAudioRelatedStats(function(ne){o.makeReport(Y(u.getId(),ne))})}},1e3),o.audioLevel[u.getId()]=0,clearInterval(o.timers[u.getId()+"audio"]),o.timers[u.getId()+"audio"]=setInterval(function(){o.hasListeners("active-speaker")&&u&&u.pc&&u.pc.state==="established"&&u.pc.getStats&&u.pc.getStats(function(K){K.forEach(function(ne){if(ne.mediaType==="audio"){if(ne.audioOutputLevel>5e3)for(var se in o.audioLevel[u.getId()]<20&&(o.audioLevel[u.getId()]+=1),o.audioLevel)se!==""+u.getId()&&o.audioLevel[se]>0&&(o.audioLevel[se]-=1);var ue=Object.keys(o.audioLevel).sort(function(me,ve){return o.audioLevel[ve]-o.audioLevel[me]});if(o.activeSpeaker!==ue[0]){var ae=Object(k.a)({type:"active-speaker",uid:ue[0]});o.dispatchEvent(ae),o.activeSpeaker=ue[0],f.default.debug("[".concat(o.clientId,"] Update active speaker: ").concat(o.activeSpeaker))}}})},50)},50),u.pc.oniceconnectionstatechange=function(K){if(K==="failed")o.timers[u.getId()]!=null&&(clearInterval(o.timers[u.getId()]),clearInterval(o.timers[u.getId()]+"audio")),f.default.error("[".concat(o.clientId,"] Subscriber connection is lost -- streamId: ").concat(u.getId(),", p2pId: ").concat(W)),f.default.debug("[".concat(o.clientId,"] subscribe p2p failed: "),o.p2ps),ie||(ie=!0,$&&$(H.default.PEERCONNECTION_FAILED),C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:H.default.PEERCONNECTION_FAILED,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W})),o.remoteStreams[u.getId()]&&o.p2ps.has(W)&&(o.p2ps.delete(W),o.dispatchEvent(Object(k.a)({type:"subP2PLost",stream:u})));else if(K==="connected"&&(f.default.debug("[".concat(o.clientId,"] subscribe p2p connected: "),o.p2ps),!ie)){ie=!0,C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!0,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:null,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W}),o._adjustPCMuteStatus(u);var ne=!1,se=!1,ue=!1,ae=setInterval(function(){ne&&se||(u.pc?u.pc.getStats(function(Se){Se.forEach(function(Te){if((Te.id.indexOf("recv")!==-1||Te.type&&Te.type.toLowerCase().indexOf("inbound")!==-1||Te.id.indexOf("inbound_rtp")!==-1||Te.id.indexOf("inbound-rtp")!==-1||Te.id.indexOf("InboundRTP")!==-1)&&Te.mediaType==="audio"){if((Te.googDecodingNormal>0||Te.audioOutputLevel>0)&&!ne){ne=!0,o.dispatchEvent({type:"first-audio-frame-decode",stream:u}),ne&&se&&clearInterval(ae);var be=Date.now(),Ae=C.report.getSessionStartTime(o.joinInfo.sid);C.report.firstAudioDecode(o.joinInfo.sid,{peerid:u.uintId,uid:o.uid,elapse:be-Ae,subscribeElapse:be-u.subscribeLTS,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W})}parseInt(Te.packetsReceived)>0&&!se&&(se=!0,o.dispatchEvent({type:"first-audio-packet-received",stream:u}),ne&&se&&clearInterval(ae),be=Date.now(),Ae=C.report.getSessionStartTime(o.joinInfo.sid),C.report.firstAudioReceived(o.joinInfo.sid,{peerid:u.uintId,uid:o.uid,elapse:be-Ae,subscribeElapse:be-u.subscribeLTS,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W}))}})},100):clearInterval(ae))},100),me=!1,ve=!1,Re=setInterval(function(){me&&ve||(u.pc?u.pc.getStats(function(Se){Se.forEach(function(Te){if((Te.id.indexOf("recv")!==-1||Te.type&&Te.type.toLowerCase().indexOf("inbound")!==-1||Te.id.indexOf("inbound_rtp")!==-1||Te.id.indexOf("inbound-rtp")!==-1||Te.id.indexOf("InboundRTP")!==-1)&&Te.mediaType==="video"){if((Te.framesDecoded>0||Te.googFramesDecoded>0)&&!me){me=!0,o.dispatchEvent({type:"first-video-frame-decode",stream:u}),me&&ve&&clearInterval(Re);var be=Date.now(),Ae=C.report.getSessionStartTime(o.joinInfo.sid);u.firstFrameTime=new Date().getTime()-u.subscribeLTS,C.report.firstVideoDecode(o.joinInfo.sid,{peerid:u.uintId,width:parseInt(Te.googFrameWidthReceived)||0,height:parseInt(Te.googFrameHeightReceived)||0,uid:o.uid,elapse:be-Ae,subscribeElapse:be-u.subscribeLTS,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W})}Te.packetsReceived>0&&!ve&&(ve=!0,o.dispatchEvent({type:"first-video-packet-received",stream:u}),me&&ve&&clearInterval(Re),be=Date.now(),Ae=C.report.getSessionStartTime(o.joinInfo.sid),C.report.firstVideoReceived(o.joinInfo.sid,{peerid:u.uintId,uid:o.uid,elapse:be-Ae,subscribeElapse:be-u.subscribeLTS,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:W}))}})},100):clearInterval(Re))},100),Ie=setInterval(function(){if(!ue){var Se=u.getId(),Te=o.traffic_stats;if(Te&&Te.peer_delay){var be=Te.peer_delay.find(function(ke){return ke.peer_uid==Se});if(be){if(ue=!0,o.peerPublishDurationMap.get(u.getId()))return void clearInterval(Ie);var Ae=be.peer_publish_audio_duration,Oe=be.peer_publish_video_duration;if(Ae===void 0||Oe===void 0)return;o.peerPublishDurationMap.set(u.getId(),!0);var Ce=C.report.getSessionStartTime(o.joinInfo.sid),Ne=(Ae||Oe)+(Date.now()-Te.timestamp),we=Date.now();C.report.peerPublishStatus({audiotag:Ae?1:-1,videotag:Oe?1:-1,lts:we,sid:o.joinInfo.sid,cname:o.joinInfo.cname,cid:o.joinInfo.cid,uid:o.joinInfo.uid,elapse:we-Ce,peer:u.uintId,peerPublishDuration:Ne,joinChannelSuccessElapse:we-o.joinSuccessLts,subscribeElapse:we-u.subscribeLTS}),clearInterval(Ie)}}}},1e3);return u.sid=o.joinInfo.sid,U&&U()}}}else f.default.error("[".concat(o.clientId,"] Invalid remote stream")),ie||(ie=!0,$&&$(H.default.INVALID_REMOTE_STREAM),C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:H.default.INVALID_REMOTE_STREAM}));else f.default.error("[".concat(o.clientId,"] No such remote stream")),ie||(ie=!0,$&&$(H.default.NO_SUCH_REMOTE_STREAM),C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!1,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:H.default.NO_SUCH_REMOTE_STREAM}))},o.subscribeChange=function(u,U,$){var X=Date.now();f.default.info("[".concat(o.clientId,"] Gatewayclient ").concat(o.uid," SubscribeChange ").concat(u.getId(),": ").concat(JSON.stringify(u.subscribeOptions))),o._adjustPCMuteStatus(u);var ie={stream_id:u.getId(),audio:u.subscribeOptions.audio,video:u.subscribeOptions.video};o.makeRequest({_type:"subscribe_change",_message:ie},function(W){var K=Object(k.e)({type:"stream-subscribe-changed",stream:o.remoteStreams[u.getId()]});C.report.subscribe(o.joinInfo.sid,{lts:X,succ:!0,video:u.subscribeOptions&&u.subscribeOptions.video,audio:u.subscribeOptions&&u.subscribeOptions.audio,peerid:u.getId(),ec:null,subscribeRequestid:o.subscribeRequestId.get(u.getId())||0,p2pid:o.p2ps.get(u.getId())}),o.dispatchEvent(K),U&&U()},function(W,K){f.default.error("[".concat(o.clientId,"] Subscribe Change Failed ").concat(u.getId()),W,K),$&&$(W,K)})},o.processPublishFailure=function(u){u.publishLTS=null,u.p2pId&&o.p2ps.get(u.p2pId)===u&&o.p2ps.delete(u.p2pId),o.localStreams[u.getUserId()]===u&&delete o.localStreams[u.getUserId()],o.localStreams[u.getId()]===u&&delete o.localStreams[u.getId()],u.pc&&(u.pc.processSignalingMessage=function(){},u.pc.oniceconnectionstatechange=function(){},u.pc.close(),delete u.pc),delete u.onClose,delete u._onAudioUnmute,delete u._onVideoUnmute,delete u._onAudioMute,delete u._onVideoMute,delete u._onAudioUnmute},o.processSubscribeFailure=function(u){u.p2pId&&o.p2ps.get(u.p2pId)===u&&o.p2ps.delete(u.p2pId),u.pc&&(u.pc.onaddstream=function(){},u.pc.processSignalingMessage=function(){},u.pc.oniceconnectionstatechange=function(){},u.pc.close(),delete u.pc),delete u.onClose,delete u._onAudioUnmute,delete u._onVideoUnmute,delete u._onAudioMute,delete u._onVideoMute,delete u._onAudioUnmute},o._adjustPCMuteStatus=function(u){f.default.debug("[".concat(o.clientId,"]: use _adjustPCMuteStatus: ").concat(u.getId())),f.default.debug("[".concat(o.clientId,"]: video: ").concat(u.video,", audio: ").concat(u.audio,", suboption: ").concat(JSON.stringify(u.subscribeOptions),",userMuteVideo: ").concat(u.userMuteVideo,", peerMuteVideo: ").concat(u.peerMuteVideo,", userMuteAudio: ").concat(u.userMuteAudio,", peerMuteAudio: ").concat(u.peerMuteAudio)),!u.local&&u.pc&&u.pc.peerConnection.getReceivers&&u.pc.peerConnection.getReceivers().forEach(function(U){if(U&&U.track&&U.track.kind==="audio"){var $=!u.userMuteAudio&&!u.peerMuteAudio;u.subscribeOptions&&!u.subscribeOptions.audio&&($=!1),f.default.debug("[".concat(o.clientId,"]: set receiver audio track: ").concat($)),U.track.enabled=!!$}else if(U&&U.track&&U.track.kind==="video"){var X=!u.userMuteVideo&&!u.peerMuteVideo;u.subscribeOptions&&!u.subscribeOptions.video&&(X=!1),f.default.debug("[".concat(o.clientId,"]: set receiver video track: ").concat(X)),U.track.enabled=!!X}})},o.unsubscribe=function(u,U,$){if(s()(u)!=="object"||u===null)return f.default.error("[".concat(o.clientId,"] Invalid remote stream")),void pe($,H.default.INVALID_REMOTE_STREAM);if(o.state!==ce)return f.default.error("[".concat(o.clientId,"] User is not in the session")),void pe($,H.default.INVALID_OPERATION);if(o.timers[u.getId()]!=null&&(clearInterval(o.timers[u.getId()]),clearInterval(o.timers[u.getId()]+"audio")),o.audioLevel[u.getId()]!=null&&delete o.audioLevel[u.getId()],o.timer_counter[u.getId()]!=null&&delete o.timer_counter[u.getId()],o.remoteStreams.hasOwnProperty(u.getId())){if(!o.socket)return f.default.error("[".concat(o.clientId,"] User is not in the session")),void pe($,H.default.INVALID_OPERATION);if(u.local)return f.default.error("[".concat(o.clientId,"] Invalid remote stream")),void pe($,H.default.INVALID_REMOTE_STREAM);u.close(),u.stop();var X={stream_id:u.getId()};o.makeRequest({_type:"unsubscribe",_message:X}),u.pc!==void 0&&(u.pc.close(),u.pc=void 0),u.onClose=void 0,u._onAudioMute=void 0,u._onAudioUnute=void 0,u._onVideoMute=void 0,u._onVideoUnmute=void 0,delete u.subscribeOptions,o.p2ps.delete(u.p2pId),f.default.info("[".concat(o.clientId,"] Unsubscribe stream success")),U&&U()}else pe($,H.default.NO_SUCH_REMOTE_STREAM)},o.setRemoteVideoStreamType=function(u,U){if(f.default.debug("[".concat(o.clientId,"] Switching remote video stream ").concat(u.getId()," to ").concat(U)),s()(u)==="object"&&u!==null)if(o.state===ce){if(!u.local){switch(U){case o.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case o.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case o.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}var $={stream_id:u.getId(),stream_type:U};o.makeRequest({_type:"switch_video_stream",_message:$},function(){f.default.debug("SwitchVideoStream Success ".concat($.stream_id," ").concat($.stream_type))},function(X,ie){f.default.error("SwitchVideoStream Error ".concat(X," ").concat($.stream_id," ").concat($.stream_type),ie)})}}else f.default.error("[".concat(o.clientId,"] User is not in the session"));else f.default.error("[".concat(o.clientId,"] Invalid remote stream"))},o.renewToken=function(u,U,$){u?o.key?o.state!==ce?(f.default.debug("[".concat(o.clientId,"] Client is not connected. Trying to rejoin")),o.key=u,o.rejoin(),U&&U()):(f.default.debug("[".concat(o.clientId,"] renewToken from ").concat(o.key," to ").concat(u)),o.key=u,o.makeRequest({_type:"renew_token",_message:{token:u}},U,$)):(f.default.error("[".concat(o.clientId,"] Client is previously joined without token")),$&&$(H.default.INVALID_PARAMETER)):(f.default.error("[".concat(o.clientId,"] Invalid Token ").concat(u)),$&&$(H.default.INVALID_PARAMETER))},o.setStreamFallbackOption=function(u,U){if(f.default.debug("[".concat(o.clientId,"] Set stream fallback option ").concat(u.getId()," to ").concat(U)),s()(u)==="object"&&u!==null)if(o.state===ce){if(!u.local){switch(U){case o.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case o.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case o.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}var $={stream_id:u.getId(),fallback_type:U};o.makeRequest({_type:"set_fallback_option",_message:$},function(){f.default.debug("SetStreamFallbackOption success ".concat($.stream_id," ").concat(U))},function(X,ie){f.default.error("Failed to SetStreamFallbackOption ".concat($.stream_id," ").concat(U," ").concat(X),ie)})}}else f.default.error("[".concat(o.clientId,"] User is not in the session"));else f.default.error("[".concat(o.clientId,"] Invalid remote stream"))},o.enableAudioVolumeIndicator=function(u,U){o.audioVolumeIndication.enabled=!0,o.audioVolumeIndication.interval=u,o.audioVolumeIndication.smooth=U,o.resetAudioVolumeIndication()},o.resetAudioVolumeIndication=function(){if(clearInterval(o.timers.audioVolumeIndication),clearInterval(o.timers.audioVolumeSampling),o.audioVolumeIndication.enabled&&o.audioVolumeIndication.interval){var u=Math.floor(1e3*o.audioVolumeIndication.smooth/100);clearInterval(o.timers.audioVolumeSampling),o.timers.audioVolumeSampling=setInterval(function(){o.audioVolumeSampling||(o.audioVolumeSampling={});var U={};for(var $ in o.remoteStreams){var X=o.remoteStreams[$];if(X.stream&&X.hasAudio()){var ie=X.getAudioLevel();ie>0&&ie<1&&(ie*=100);var W=o.audioVolumeSampling[$]||[];for(W.push(ie);W.length>u;)W.shift();U[$]=W}}o.audioVolumeSampling=U},100),clearInterval(o.timers.audioVolumeIndication),o.timers.audioVolumeIndication=setInterval(function(){if(o.socket&&o.socket.signal&&o.socket.signal.connection&&o.socket.signal.connection.readyState===WebSocket.OPEN){var U=[];for(var $ in o.remoteStreams)if(o.audioVolumeSampling&&o.audioVolumeSampling[$]){var X=o.audioVolumeSampling[$],ie=0;X.forEach(function(se){ie+=se});var W={uid:$,level:Math.floor(ie/X.length)};W.level&&U.push(W)}var K=U.sort(function(se,ue){return se.level-ue.level});f.default.debug("[".concat(o.clientId,"] volume-indicator "),JSON.stringify(K)),o.audioVolumeIndication.sortedAudioVolumes=K;var ne=Object(k.a)({type:"volume-indicator",attr:K});o.dispatchEvent(ne)}},o.audioVolumeIndication.interval)}},o.closeGateway=function(){f.default.debug("[".concat(o.clientId,"] close gateway")),o.state=de,o.socket.close(),N()},o.startChannelMediaRelay=function(){var u=p()(d.a.mark(function U($){var X,ie,W,K;return d.a.wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:if(!o.channelMediaRelayController){ne.next=2;break}throw new M.ChannelMediaError("RELAY_ALREADY_START","",M.CHANNEL_MEDIA_RELAY_ERROR.RELAY_ALREADY_START);case 2:return X=function(se){o.dispatchEvent({type:"channel-media-relay-event",code:se})},ie=function(se,ue,ae){se===M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE&&ue===M.CHANNEL_MEDIA_RELAY_ERROR.SERVER_CONNECTION_LOST&&(o.channelMediaRelayController.dispose(),o.channelMediaRelayController=null),o.dispatchEvent({type:"channel-media-relay-state",state:se,code:ue,data:ae})},o.channelMediaRelayController=new B.a(o.joinInfo,o.clientId),o.channelMediaRelayController.on("event",X),o.channelMediaRelayController.on("state",ie),ne.prev=7,ne.next=10,o.channelMediaRelayController.startChannelMediaRelay($);case 10:ne.next=22;break;case 12:throw ne.prev=12,ne.t0=ne.catch(7),f.default.debug("[".concat(o.clientId,"] startChannelMediaRelay exception: ").concat(JSON.stringify(ne.t0))),W=M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,K="",K=ne.t0 instanceof M.ChannelMediaError?ne.t0.data==="SetSourceChannelStatus"||ne.t0.data&&ne.t0.data.serverResponse&&ne.t0.data.serverResponse.command==="SetSourceChannel"?"FAILED_JOIN_SRC":ne.t0.data==="SetDestChannelStatus"||ne.t0.data&&ne.t0.data.serverResponse&&ne.t0.data.serverResponse.command==="SetDestChannel"?"FAILED_JOIN_DEST":ne.t0.data&&ne.t0.data.serverResponse&&ne.t0.data.serverResponse.command==="StartPacketTransfer"?"FAILED_PACKET_SENT_TO_DEST":ne.t0.message===M.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||ne.t0.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":ne.t0.message===M.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||ne.t0.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":ne.t0.message===M.CHANNEL_MEDIA_ERROR.AP_REQUEST_TIMEOUT?"NO_RESOURCE_AVAILABLE":ne.t0.message===M.CHANNEL_MEDIA_ERROR.WS_ABORT||ne.t0.message===M.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",o.dispatchEvent({type:"channel-media-relay-state",state:W,code:M.CHANNEL_MEDIA_RELAY_ERROR[K]}),o.channelMediaRelayController&&(o.channelMediaRelayController.dispose(),o.channelMediaConfig=null,o.channelMediaRelayController=null),o.dispatchEvent({type:"channel-media-relay-state",state:M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new M.ChannelMediaError(K,null,M.CHANNEL_MEDIA_RELAY_ERROR[K]);case 22:o.dispatchEvent({type:"channel-media-relay-state",state:M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_RUNNING,code:M.CHANNEL_MEDIA_RELAY_ERROR.RELAY_OK}),o.channelMediaConfig=$;case 24:case"end":return ne.stop()}},U,null,[[7,12]])}));return function(U){return u.apply(this,arguments)}}(),o.updateChannelMediaRelay=function(){var u=p()(d.a.mark(function U($){var X,ie;return d.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(o.channelMediaRelayController){W.next=2;break}throw new M.ChannelMediaError("RELAY_NOT_START",null,M.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return W.prev=2,W.next=5,o.channelMediaRelayController.updateChannelMediaRelay($);case 5:W.next=18;break;case 7:throw W.prev=7,W.t0=W.catch(2),f.default.debug("[".concat(o.clientId,"] updateChannelMediaRelay exception: ").concat(JSON.stringify(e))),X=M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,ie="",ie=e instanceof M.ChannelMediaError?e.message===M.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===M.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":e.message===M.CHANNEL_MEDIA_ERROR.WS_ABORT||e.message===M.CHANNEL_MEDIA_ERROR.AP_REQUEST_ABORT?"OPERATION_ABORT":"INTERNAL_ERROR":"INTERNAL_ERROR",o.dispatchEvent({type:"channel-media-relay-event",code:M.CHANNEL_MEDIA_RELAY_EVENT.PACKET_UPDATE_DEST_CHANNEL_REFUSED}),o.dispatchEvent({type:"channel-media-relay-state",state:X,code:M.CHANNEL_MEDIA_RELAY_ERROR[ie]}),o.channelMediaRelayController&&(o.channelMediaRelayController.dispose(),o.channelMediaConfig=null,o.channelMediaRelayController=null),o.dispatchEvent({type:"channel-media-relay-state",state:M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new M.ChannelMediaError(ie,null,M.CHANNEL_MEDIA_RELAY_ERROR[ie]);case 18:o.channelMediaConfig=$;case 19:case"end":return W.stop()}},U,null,[[2,7]])}));return function(U){return u.apply(this,arguments)}}(),o.stopChannelMediaRelay=p()(d.a.mark(function u(){var U,$;return d.a.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(o.channelMediaRelayController){X.next=2;break}throw new M.ChannelMediaError("RELAY_NOT_START",null,M.CHANNEL_MEDIA_RELAY_ERROR.RELAY_NOT_START);case 2:return X.prev=2,X.next=5,o.channelMediaRelayController.stopChannelMediaRelay();case 5:X.next=17;break;case 7:throw X.prev=7,X.t0=X.catch(2),f.default.debug("[".concat(o.clientId,"] stopChannelMediaRelay exception: ").concat(JSON.stringify(e))),U=M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_FAILURE,$="",$=e instanceof M.ChannelMediaError?e.message===M.CHANNEL_MEDIA_ERROR.REQUEST_TIMEOUT||e.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_TIMEOUT?"SERVER_NO_RESPONSE":e.message===M.CHANNEL_MEDIA_ERROR.REQUEST_FAILED||e.message===M.CHANNEL_MEDIA_ERROR.WAIT_STATUS_ERROR?"SERVER_ERROR_RESPONSE":"INTERNAL_ERROR":"INTERNAL_ERROR",o.dispatchEvent({type:"channel-media-relay-state",state:U,code:M.CHANNEL_MEDIA_RELAY_ERROR[$]}),o.channelMediaRelayController&&(o.channelMediaRelayController.dispose(),o.channelMediaConfig=null,o.channelMediaRelayController=null),o.dispatchEvent({type:"channel-media-relay-state",state:M.CHANNEL_MEDIA_RELAY_STATE.RELAY_STATE_IDLE}),new M.ChannelMediaError($,null,M.CHANNEL_MEDIA_RELAY_ERROR[$]);case 17:o.channelMediaConfig=null,o.channelMediaRelayController=null;case 19:case"end":return X.stop()}},u,null,[[2,7]])})),o.sendMetadata=function(u,U){o.makeRequest(function($){return{_type:"send_metadata",_message:{session_id:o.joinInfo.sid,metadata:window.btoa(unescape(encodeURIComponent($)))}}}(u),function(){f.default.debug("[".concat(o.clientId,'] send metadata "').concat(u,'" success')),U&&U(null)},function($){f.default.error("[".concat(o.clientId,'] send metadata "').concat(u,'" failed'),$),U&&U($)})},o._reportWebsocketCloseEvent=function(u,U){try{var $=C.report.getSessionStartTime(o.joinInfo.sid),X=Date.now();C.report.webSocketQuit({lts:X,sid:o.joinInfo.sid,cname:o.joinInfo.cname,cid:o.joinInfo.cid,uid:o.joinInfo.uid,elapse:X-$,succ:u,errorCode:U,ip:null})}catch(ie){f.default.debug("[".concat(o.clientId,"]: _reportWebsocketCloseEvent exception, ").concat(ie))}};var te=function(){f.default.debug("[".concat(o.clientId,"] Reconnect gateway")),o.state=de,o.socket.close(),N(),o.reconnectMode="recover",o.state=le,fe()};o.recover=te;var N=function(){for(var u in o.dispatchEvent({type:"before-clear-connection"}),o.timers)o.timers.hasOwnProperty(u)&&clearInterval(o.timers[u]);for(var u in o.remoteStreams)if(o.remoteStreams.hasOwnProperty(u)){var U=o.remoteStreams[u],$=Object(k.a)({type:"stream-removed",uid:U.getId(),stream:U});o.dispatchEvent($)}o.p2ps.clear(),ye(),_e(),clearInterval(o.pingTimer)};o.rejoin=function(){o.socket&&(clearInterval(o.pingTimer),o.socket.close(),o.socket=void 0),o.state=le,fe()};var fe=function(u,U){o.dispatchEvent(Object(k.a)({type:"rejoin-start"})),u=u||function($){f.default.info("[".concat(o.clientId,"] User ").concat($," is re-joined to ").concat(o.joinInfo.cname)),o.dispatchEvent(Object(k.a)({type:"rejoin"})),o.channelMediaConfig&&o.startChannelMediaRelay(o.channelMediaConfig).then(function(){f.default.debug("[".concat(o.clientId,"] restartChannelMediaRelay success"))}).catch(function(X){f.default.debug("[".concat(o.clientId,"] restartChannelMediaRelay failed: ").concat(JSON.stringify(X)))}),o.liveStreams&&o.liveStreams.size&&o.liveStreams.forEach(function(X,ie){X&&o.setLiveTranscoding(o.transcoding),o.startLiveStreaming(ie,X)}),o.injectLiveStreams&&o.injectLiveStreams.size&&o.injectLiveStreams.forEach(function(X,ie){o.addInjectStreamUrl(ie,X)})},U=U||function($){f.default.error("[".concat(o.clientId,"] Re-join to channel failed "),$),o.dispatchEvent(Object(k.e)({type:"error",reason:$}))},o.key?(++o.rejoinAttempt,o.join(o.joinInfo,o.key,u,U)):f.default.error("[".concat(o.clientId,"] Connection recover failed [Invalid channel key]"))},Ee=function(u,U,$){if(o.onConnect=U,o.socket){if(o.dispatchEvent({type:"reconnect"}),o.reconnectMode==="retry")f.default.debug("[".concat(o.clientId,"] Retry current gateway")),o.socket.reconnect();else if(o.reconnectMode==="tryNext")f.default.debug("[".concat(o.clientId,"] Try next gateway")),o.socket.connectNext();else if(o.reconnectMode==="recover"){f.default.debug("[".concat(o.clientId,"] Recover gateway")),f.default.debug("[".concat(o.clientId,"] Try to reconnect choose server and get gateway list again ")),o.reconnectingCS=!0;var X=o.joinInfo&&o.joinInfo.sid;Object(V.getGatewayList)(o.joinInfo,function(W){f.default.debug("[".concat(o.clientId,"] session:  ").concat(X," get gateway list success")),o.joinInfo.apResponse=W.res,o.reconnectingCS?o.socket.replaceHost(W.gateway_addr):f.default.debug("[".concat(o.clientId,"] session:  ").concat(X," already leave"))})}}else ie=u.gatewayAddr,o.socket=J(ie,{sid:o.joinInfo.sid,clientId:o.clientId,proxyServerType:o.joinInfo.proxyServerType}),o.socket.on("start-connection",function(W){o.ticket=W&&W.msg&&W.msg.ticket}),o.socket.on("on_uplink_stats",function(W){var K={};for(var ne in W)K[v(ne)]=W[ne];if(o.OutgoingAvailableBandwidth=K.uplink_available_bandwidth,o.localStreams[o.uid]){var se=o.localStreams[o.uid].uplinkStats;se&&se.period_fir===K.period_fir||f.default.debug("[".concat(o.clientId,"]: Period fir change to: ").concat(K.period_fir)),o.localStreams[o.uid].uplinkStats=K}}),o.socket.on("connect",function(){o.dispatchEvent({type:"connected"}),o.attemps=1,o.onConnect()}),o.socket.on("recover",function(){o.state=le,f.default.debug("[".concat(o.clientId,"] Try to reconnect choose server and get gateway list again ")),o.reconnectingCS=!0;var W=o.joinInfo&&o.joinInfo.sid;Object(V.getGatewayList)(o.joinInfo,function(K){f.default.debug("[".concat(o.clientId,"] session:  ").concat(W," get gateway list success")),o.reconnectingCS?o.socket.replaceHost(K.gateway_addr):f.default.debug("[".concat(o.clientId,"] session:  ").concat(W," already leave"))})}),o.socket.on("disconnect",function(W){if(f.default.debug("[".concat(o.clientId,"] Receive disconnect message")),o.state!==de){o.state=de,o._reportWebsocketCloseEvent(-1,H.WEBSOCKET_CLOSE_REASON.WS_DISCONNECT);var K=Object(k.e)({type:"error",reason:H.default.SOCKET_DISCONNECTED});if(o.dispatchEvent(K),o.p2ps.size===0?o.reconnectMode="tryNext":o.reconnectMode="retry",N(),o.channelMediaRelayController&&o.channelMediaRelayController.dispose(),o.channelMediaRelayController=null,x!=1){var ne,se=(ne=o.attemps,1e3*Math.min(30,Math.pow(2,ne)-1));if(f.default.error("[".concat(o.clientId,"] Disconnect from server [").concat(JSON.stringify(W),"], attempt to recover [#").concat(o.attemps,"] after ").concat(se/1e3," seconds")),o.hasInvokeLeave)return f.default.debug("[".concat(o.clientId,"] No reconnection because Client.leave has been invoked")),void(o.hasInvokeLeave=!1);setTimeout(function(){o.attemps++,o.state=le,o.inChannelInfo&&Date.now()-o.inChannelInfo.joinAt>Object(T.getParameter)("TICKET_RENEW_TIMEOUT")?(f.default.debug("Recovering to renew ticket"),te()):fe()},se)}else{var ue=z.unregister(o);ue&&f.default.debug("[".concat(o.clientId,"] "),ue)}}}),o.socket.on("on_add_audio_stream",function(W){if(f.default.info("[".concat(o.clientId,"] Newly added audio stream with uid ").concat(W.uid)),o.joinInfo.stringUid&&typeof W.uid!="string"&&f.default.error("StringUID is Mixed with UintUID"),o.remoteStreamsInChannel.has(W.uid)||o.remoteStreamsInChannel.add(W.uid),o.remoteStreams[W.uid]===void 0){var K=Object(A.a)({streamID:W.uid,local:!1,audio:W.audio,video:W.video,uintUID:W.uint_id||W.uid});K.peerMuteVideo=!0,o.remoteStreams[W.uid]=K;var ne=Object(k.e)({type:"stream-added",stream:K});o.dispatchEvent(ne);var se=o.remoteMuteState[W.uid];se&&se.audio&&(ne=Object(k.a)({type:"mute-audio",uid:W.uid}),o.dispatchEvent(ne)),se&&se.video&&(ne=Object(k.a)({type:"mute-video",uid:W.uid}),o.dispatchEvent(ne))}C.report.onAddAudioStream(o.joinInfo.sid,{peerid:W.uint_id||W.uid,uid:o.uid})}),o.socket.on("on_update_stream",function(W){f.default.info("[".concat(o.clientId,"] on_update_stream:"),W);var K=o.remoteStreams[W.uid];if(o.joinInfo.stringUid&&typeof W.uid!="string"&&f.default.error("StringUID is Mixed with UintUID"),K){K.audio=W.audio,K.video=W.video,K.screen=W.screen,K.pc&&o._adjustPCMuteStatus(K);var ne=Object(k.e)({type:"stream-updated",stream:K});o.dispatchEvent(ne)}else f.default.debug("[".concat(o.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(W.uid));C.report.onUpdateStream(o.joinInfo.sid,{peerid:W.uint_id||W.uid,audio:W.audio,video:W.video,uid:o.uid})}),o.socket.on("on_add_video_stream",function(W){if(f.default.info("[".concat(o.clientId,"] Newly added remote stream with uid ").concat(W.uid,".")),o.joinInfo.stringUid&&typeof W.uid!="string"&&f.default.error("StringUID is Mixed with UintUID"),o.remoteStreamsInChannel.has(W.uid)||o.remoteStreamsInChannel.add(W.uid),o.remoteStreams[W.uid]===void 0){var K=Object(A.a)({streamID:W.uid,local:!1,audio:W.audio,video:W.video,uintUID:W.uint_id||W.uid});o.remoteStreams[W.uid]=K;var ne=Object(k.e)({type:"stream-added",stream:K});o.dispatchEvent(ne);var se=o.remoteMuteState[W.uid];se&&se.audio&&(ne=Object(k.a)({type:"mute-audio",uid:W.uid}),o.dispatchEvent(ne)),se&&se.video&&(ne=Object(k.a)({type:"mute-video",uid:W.uid}),o.dispatchEvent(ne))}else{var ue=o.remoteStreams[W.uid];if(ue.video=!0,ue.peerMuteVideo=!1,ue.pc&&o._adjustPCMuteStatus(ue),f.default.info("[".concat(o.clientId,"] Stream changed: enable video ").concat(W.uid)),ue.stream!==void 0&&ue.isPlaying()){var ae=ue.player.elementID;ue.stop(),ue.play(ae,ue.playOptions)}}C.report.onAddVideoStream(o.joinInfo.sid,{peerid:W.uint_id||W.uid,uid:o.uid})}),o.socket.on("on_remove_stream",function(W){f.default.info("[".concat(o.clientId,"] on_remove_stream:"),W),o.remoteStreamsInChannel.has(W.uid)&&o.remoteStreamsInChannel.delete(W.uid);var K=o.remoteStreams[W.uid];if(K){delete o.remoteStreams[W.uid],delete o.remoteMuteState[W.uid];var ne=Object(k.e)({type:"stream-removed",stream:K});o.dispatchEvent(ne),K.close(),K.pc!==void 0&&(K.pc.close(),K.pc=void 0,o.p2ps.delete(K.p2pId)),C.report.onRemoveStream(o.joinInfo.sid,{peerid:W.uint_id||W.uid,uid:o.uid})}else f.default.error("ERROR stream ",W.uid," not found onRemoveStream ",W)}),o.socket.on("on_publish_stream",function(W){f.default.info("[".concat(o.clientId,"] on_publish_stream:"),W);var K=o.localStreams[W.uid];o.dispatchEvent({type:"streamPublished",stream:K,proxy:W.proxy}),C.report.reportApiInvoke(o.joinInfo.sid,{name:"on_publish_stream",options:{proxy:W.proxy}})()}),o.socket.on("mute_audio",function(W){f.default.info("[".concat(o.clientId,"] rcv peer mute audio: ").concat(W.uid)),o.remoteMuteState[W.uid]=o.remoteMuteState[W.uid]||{audio:!1,video:!1},o.remoteMuteState[W.uid].audio=!0;var K=Object(k.a)({type:"mute-audio",uid:W.uid}),ne=o.remoteStreams[W.uid];ne?(ne.peerMuteAudio=!0,ne.pc&&o._adjustPCMuteStatus(ne),o.dispatchEvent(K)):f.default.debug("Ignoring event ".concat(W.type),W)}),o.socket.on("unmute_audio",function(W){f.default.info("[".concat(o.clientId,"] rcv peer unmute audio: ").concat(W.uid)),o.remoteMuteState[W.uid]=o.remoteMuteState[W.uid]||{audio:!1,video:!1},o.remoteMuteState[W.uid].audio=!1;var K=Object(k.a)({type:"unmute-audio",uid:W.uid}),ne=o.remoteStreams[W.uid];ne?(ne.peerMuteAudio=!1,ne.pc&&o._adjustPCMuteStatus(ne),o.dispatchEvent(K)):f.default.debug("Ignoring event ".concat(W.type),W)}),o.socket.on("mute_video",function(W){f.default.info("[".concat(o.clientId,"] rcv peer mute video: ").concat(W.uid)),o.remoteMuteState[W.uid]=o.remoteMuteState[W.uid]||{audio:!1,video:!1},o.remoteMuteState[W.uid].video=!0;var K=Object(k.a)({type:"mute-video",uid:W.uid}),ne=o.remoteStreams[W.uid];ne?(ne.peerMuteVideo=!0,ne.player&&(ne.player.peerVideoReady=!1),ne.pc&&o._adjustPCMuteStatus(ne),o.dispatchEvent(K)):f.default.debug("Ignoring event ".concat(W.type),W)}),o.socket.on("unmute_video",function(W){f.default.info("[".concat(o.clientId,"] rcv peer unmute video: ").concat(W.uid)),o.remoteMuteState[W.uid]=o.remoteMuteState[W.uid]||{audio:!1,video:!1},o.remoteMuteState[W.uid].video=!1;var K=Object(k.a)({type:"unmute-video",uid:W.uid}),ne=o.remoteStreams[W.uid];ne?(ne.peerMuteVideo=!1,ne.pc&&o._adjustPCMuteStatus(ne),o.dispatchEvent(K)):f.default.debug("Ignoring event ".concat(W.type),W)}),o.socket.on("on_crypt_error",function(W){f.default.warning("[".concat(o.clientId,"] stream crypt error"));var K=Object(k.a)({type:"crypt-error",cryptType:W.crypt_type});o.dispatchEvent(K)}),o.socket.on("on_user_banned",function(W){f.default.info("[".concat(o.clientId,"] user banned uid: ").concat(W.uid," error: ").concat(W.error_code));var K=Object(k.a)({type:"client-banned",uid:W.uid,attr:W.error_code});o.dispatchEvent(K),x=!0}),o.socket.on("on_stream_fallback_update",function(W){f.default.info("[".concat(o.clientId,"] stream fallback peerId: ").concat(W.stream_id," type: ").concat(W.stream_type));var K=Object(k.a)({type:"stream-fallback",uid:W.stream_id,stream:W.stream_id,attr:W.stream_type});o.dispatchEvent(K)}),o.socket.on("stream_recover",function(W){f.default.info("[".concat(o.clientId,"] stream recover uid: ").concat(W.id," peerId: ").concat(W.peerid," type: ").concat(W.type));var K=Object(k.a)({type:"stream-recover",uid:W.id,stream:W.peerid,attr:W.type});o.dispatchEvent(K)}),o.socket.on("on_p2p_lost",function(W){f.default.debug("[".concat(o.clientId,"] p2plost: "),W,"p2ps:",o.p2ps);var K,ne="DTLS failed";(K=o.localStreams[W.uid]||o.remoteStreams[W.uid])?(K.pc&&K.pc.offerCandidates&&K.pc.offerCandidates.length===0&&(ne="NO_CANDIDATES_IN_OFFER"),W.event==="publish"&&C.report.publish(o.joinInfo.sid,{lts:K.publishLTS,succ:!1,audio:K.hasAudio(),video:K.hasVideo(),screenshare:K.hasScreen(),audioName:K.hasAudio()&&K.audioName,videoName:K.hasVideo()&&K.videoName,screenName:K.hasScreen()&&K.screenName,ec:ne,publishRequestid:o.publishRequestId||0,p2pid:o.p2ps.get(K.getId())}),W.event==="subscribe"&&C.report.subscribe(o.joinInfo.sid,{lts:K.subscribeLTS,succ:!1,video:K.subscribeOptions&&K.subscribeOptions.video,audio:K.subscribeOptions&&K.subscribeOptions.audio,peerid:W.uid+"",ec:ne,subscribeRequestid:o.subscribeRequestId.get(K.getId())||0,p2pid:o.p2ps.get(K.getId())})):f.default.warning("P2PLost Stream Not found",W),f.default.debug("[".concat(o.clientId,"] p2plost:"),W.p2pid),(K=o.p2ps.get(W.p2pid))&&(o.p2ps.delete(W.p2pid),K.local?o.dispatchEvent(Object(k.a)({type:"pubP2PLost",stream:K,attr:ne})):o.remoteStreams[K.getId()]&&o.dispatchEvent(Object(k.a)({type:"subP2PLost",stream:K,attr:ne})))}),o.socket.on("on_token_privilege_will_expire",function(W){f.default.debug("[".concat(o.clientId,"] Received Message onTokenPrivilegeWillExpire")),o.dispatchEvent(Object(k.a)({type:"onTokenPrivilegeWillExpire"}))}),o.socket.on("on_token_privilege_did_expire",function(){f.default.warning("[".concat(o.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),o.closeGateway(),o.dispatchEvent(Object(k.a)({type:"onTokenPrivilegeDidExpire"}))}),o.socket.on("enable_local_video",function(W){f.default.info("[".concat(o.clientId,"] enable_local_video:"),W),o.dispatchEvent(Object(k.a)({type:"enable-local-video",uid:W.uid}))}),o.socket.on("disable_local_video",function(W){f.default.info("[".concat(o.clientId,"] disable_local_video:"),W),o.dispatchEvent(Object(k.a)({type:"disable-local-video",uid:W.uid}))}),o._doWithAction=function(W,K,ne){W==="tryNext"?function(se,ue){f.default.debug("[".concat(o.clientId,"] Connect next gateway")),o.state=de,o.socket.close(),N(),o.reconnectMode="tryNext",o.state=le,fe(se,ue)}(K,ne):W==="retry"?function(se,ue){f.default.debug("[".concat(o.clientId,"] Reconnect gateway")),o.state=de,o.socket.close(),N(),o.reconnectMode="retry",o.state=le,fe(se,ue)}(K,ne):W==="quit"?(f.default.debug("[".concat(o.clientId,"] quit gateway")),o.state=de,o.socket.close(),N()):W==="recover"&&te()},o.socket.on("on_notification",function(W){if(f.default.debug("[".concat(o.clientId,"] Receive notification: "),W),H.GatewayErrorCode[W.code]==="ERR_JOIN_BY_MULTI_IP")return o.dispatchEvent({type:"onMultiIP",option:W.option});W.detail?o._doWithAction(n[H.GatewayErrorCode[W.code]]):W.action&&o._doWithAction(W.action)}),o.socket.on("on_user_offline",function(W){f.default.info("[".concat(o.clientId,"] on_user_offline:"),W);var K=Object(k.a)({type:"peer-leave",uid:W.uid});if(o.remoteStreamsInChannel.has(W.uid)&&o.remoteStreamsInChannel.delete(W.uid),o.remoteStreams.hasOwnProperty(W.uid)&&(K.stream=o.remoteStreams[W.uid]),K.reason=W.reason,o.dispatchEvent(K),f.default.info("[".concat(o.clientId,"] remove remoteMuteState "),W.uid),delete o.remoteMuteState[W.uid],o.remoteStreams.hasOwnProperty(W.uid)){f.default.info("[".concat(o.clientId,"] closing stream on peer leave"),W.uid);var ne=o.remoteStreams[W.uid];ne.close(),delete o.remoteStreams[W.uid],C.report.onRemoveStream(o.joinInfo.sid,{peerid:W.uint_id||W.uid,uid:o.uid}),ne.pc!==void 0&&(ne.pc.close(),ne.pc=void 0,o.p2ps.delete(ne.p2pId))}o.timers.hasOwnProperty(W.uid)&&(clearInterval(o.timers[W.uid]),clearInterval(o.timers[W.uid]+"_RelatedStats"),delete o.timers[W.uid]),o.audioLevel[W.uid]!=null&&delete o.audioLevel[W.uid],o.timer_counter[W.uid]!=null&&delete o.timer_counter[W.uid]}),o.socket.on("onUplinkStats",function(W){}),o.socket.on("liveStreamingStarted",function(W){var K=Object(k.c)({type:"liveStreamingStarted",url:W.url});o.dispatchEvent(K)}),o.socket.on("liveStreamingFailed",function(W){var K=Object(k.c)({type:"liveStreamingFailed",url:W.url});o.dispatchEvent(K)}),o.socket.on("liveStreamingStopped",function(W){var K=Object(k.c)({type:"liveStreamingStopped",url:W.url});o.dispatchEvent(K)}),o.socket.on("liveTranscodingUpdated",function(W){var K=Object(k.c)({type:"liveTranscodingUpdated",reason:W.reason});o.dispatchEvent(K)}),o.socket.on("streamInjectedStatus",function(W){var K=Object(k.c)({type:"streamInjectedStatus",url:W.url,uid:W.uid,status:W.status});o.dispatchEvent(K)}),o.socket.on("on_user_online",function(W){o.joinInfo.stringUid&&typeof W.uid!="string"&&f.default.error("StringUID is Mixed with UintUID"),o.dispatchEvent({type:"peer-online",uid:W.uid})}),o.socket.on("receive_metadata",function(W){o.joinInfo.stringUid&&typeof W.uid!="string"&&f.default.error("StringUID is Mixed with UintUID");var K=decodeURIComponent(escape(window.atob(W.metadata)));f.default.debug("[".concat(o.clientId,"] received ").concat(W.uid," metadata: ").concat(K)),o.dispatchEvent({type:"receive-metadata",uid:W.uid,metadata:K})});var ie},he=function(u,U){if(o.socket!==void 0)try{o.socket.emitSimpleMessage(u,function($,X){U&&U($,X)})}catch($){f.default.error("[".concat(o.clientId,"] Error in sendSimpleSdp [").concat($,"]"))}else f.default.error("[".concat(o.clientId,"] Error in sendSimpleSdp [socket not ready]"))},_e=function(){for(var u in o.localStreams)if(o.localStreams[u]!==void 0){var U=o.localStreams[u];delete o.localStreams[u],U.pc!==void 0&&(U.pc.close(),U.pc=void 0)}},ye=function(){for(var u in o.remoteStreamsInChannel.clear(),o.remoteStreams)if(o.remoteStreams.hasOwnProperty(u)){var U=o.remoteStreams[u];U.isPlaying()&&U.stop(),U.close(),delete o.remoteStreams[u],U.pc!==void 0&&(U.pc.close(),U.pc=void 0)}};return o},z={_gatewayClients:{},register:function(w,D){if(!D.uid){var x="NO_UID_PROVIDED";return f.default.error("[".concat(w.clientId,"] "),x,D),x}if(D.cname)return this._gatewayClients[D.cname]&&this._gatewayClients[D.cname][D.uid]&&this._gatewayClients[D.cname][D.uid]!==w?(x="UID_CONFLICT",f.default.error("[".concat(w.clientId,"] "),x,D),x):(f.default.debug("[".concat(w.clientId,"] register client Channel"),D.cname,"Uid",D.uid),this._gatewayClients[D.cname]||(this._gatewayClients[D.cname]={}),this._gatewayClients[D.cname][D.uid]=w,null);var x="NO_CHANNEL_PROVIDED";return f.default.error("[".concat(w.clientId,"] "),x,D),x},unregister:function(w){var D=w&&w.uid,x=w.joinInfo&&w.joinInfo.cname;if(!D||!x){var ee="INVALID_GATEWAYCLIENT";return f.default.error("[".concat(w.clientId,"] "),ee),ee}if(this._gatewayClients[x]&&this._gatewayClients[x][D])return this._gatewayClients[x][D]!==w?(ee="GATEWAYCLIENT_UID_CONFLICT",f.default.error("[".concat(w.clientId,"] "),ee),ee):(f.default.debug("[".concat(w.clientId,"] unregister client "),w.uid),delete this._gatewayClients[x][D],null);var ee="GATEWEAY_CLIENT_UNREGISTERED";f.default.error("[".concat(w.clientId,"] "),ee)}};Q.DISCONNECTED=0,Q.CONNECTING=1,Q.CONNECTED=2,Q.DISCONNECTING=3,Q.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"},O.a=Q},function(c,O,y){y.r(O),y.d(O,"post",function(){return a}),y.d(O,"postFormData",function(){return i}),y.d(O,"shouldUseHttps",function(){return l}),y.d(O,"getHTTPSendBytes",function(){return b}),y.d(O,"getHTTPRecvBytes",function(){return s}),y.d(O,"resetHTTPByetsCount",function(){return g});var m=y(2),d=y(10),E=0,p=0,b=function(){return E},s=function(){return p},g=function(){E=0,p=0},i=function(A,k,S,f,C){var I=new XMLHttpRequest;if(I.timeout=k.timeout||Object(m.getParameter)("HTTP_CONNECT_TIMEOUT"),I.open("POST",A,!0),C)for(var P in C)P=="withCredentials"?I.withCredentials=!0:I.setRequestHeader(P,C[P]);I.onload=function(J){p+=Object(d.lengthInUtf8Bytes)(I.responseText),I.status!==200?f&&f({httpErrorCode:"httpcode-xhr.status"},A):S&&S(I.responseText)},I.onerror=function(J){f&&f(J,A)},I.ontimeout=function(J){f&&f(J,A)};var T=JSON.stringify(k);E+=Object(d.lengthInUtf8Bytes)(T);var F=new FormData;F.append("request",T),I.send(F)},a=function(A,k,S,f,C){var I=new XMLHttpRequest;if(I.timeout=k.timeout||Object(m.getParameter)("HTTP_CONNECT_TIMEOUT"),I.open("POST",A,!0),I.setRequestHeader("Content-type","application/json; charset=utf-8"),C)for(var P in C)P=="withCredentials"?I.withCredentials=!0:I.setRequestHeader(P,C[P]);I.onload=function(F){p+=Object(d.lengthInUtf8Bytes)(I.responseText),I.status!==200?f&&f({httpErrorCode:"httpcode-xhr.status"},A):S&&S(I.responseText)},I.onerror=function(F){f&&f(F,A)},I.ontimeout=function(F){f&&f(F,A)};var T=JSON.stringify(k);E+=Object(d.lengthInUtf8Bytes)(T),I.send(T)},l=function(){return document.location.protocol=="https:"}},function(c,O,y){y.r(O),y.d(O,"RTCPeerConnection",function(){return G}),y.d(O,"getUserMedia",function(){return p}),y.d(O,"attachMediaStream",function(){return b}),y.d(O,"reattachMediaStream",function(){return s}),y.d(O,"setSrcObject",function(){return A}),y.d(O,"getSrcObject",function(){return k}),y.d(O,"webrtcDetectedBrowser",function(){return g}),y.d(O,"webrtcDetectedVersion",function(){return i}),y.d(O,"webrtcMinimumVersion",function(){return a}),y.d(O,"webrtcTesting",function(){return H}),y.d(O,"webrtcUtils",function(){return C});var m=y(11),d=y.n(m),E=y(4),p=null,b=null,s=null,g=null,i=null,a=null,l=null,A=null,k=null,S=null,f={addStream:null},C={log:function(){},extractVersion:function(V,_,n){var L=V.match(_);return L&&L.length>=n&&parseInt(L[n])}};if((typeof window>"u"?"undefined":d()(window))=="object"?(window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)?(A=function(V,_){"mozSrcObject"in V?V.mozSrcObject=_:(V._srcObject=_,V.src=_?URL.createObjectURL(_):null)},k=function(V){return"mozSrcObject"in V?V.mozSrcObject:V._srcObject}):(A=function(V,_){V.srcObject=_},k=function(V){return V.srcObject}),p=window.navigator&&window.navigator.getUserMedia):(A=function(V,_){V.srcObject=_},k=function(V){return V.srcObject}),b=function(V,_){A(V,_)},s=function(V,_){A(V,k(_))},typeof window<"u"&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var I in C.log("This appears to be Firefox"),g="firefox",i=C.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),a=31,S=mozRTCPeerConnection,f)f[I]=S.prototype[I];if(l=function(V,_){if(i<38&&V&&V.iceServers){for(var n=[],L=0;L<V.iceServers.length;L++){var h=V.iceServers[L];if(h.hasOwnProperty("urls"))for(var t=0;t<h.urls.length;t++){var j={url:h.urls[t]};h.urls[t].indexOf("turn")===0&&(j.username=h.username,j.credential=h.credential),n.push(j)}else n.push(V.iceServers[L])}V.iceServers=n}var r=new S(V,_);for(var v in f)r[v]=f[v];return r},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),p=function(V,_,n){var L=function(h){if(d()(h)!=="object"||h.require)return h;var t=[];return Object.keys(h).forEach(function(j){if(j!=="require"&&j!=="advanced"&&j!=="mediaSource"){var r=h[j]=d()(h[j])==="object"?h[j]:{ideal:h[j]};if(r.min===void 0&&r.max===void 0&&r.exact===void 0||t.push(j),r.exact!==void 0&&(typeof r.exact=="number"?r.min=r.max=r.exact:h[j]=r.exact,delete r.exact),r.ideal!==void 0){h.advanced=h.advanced||[];var v={};typeof r.ideal=="number"?v[j]={min:r.ideal,max:r.ideal}:v[j]=r.ideal,h.advanced.push(v),delete r.ideal,Object.keys(r).length||delete h[j]}}}),t.length&&(h.require=t),h};return i<38&&(C.log("spec: "+JSON.stringify(V)),V.audio&&(V.audio=L(V.audio)),V.video&&(V.video=L(V.video)),C.log("ff37: "+JSON.stringify(V))),navigator.mozGetUserMedia(V,_,n)},navigator.getUserMedia=p,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:J,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(V){V([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i<41){var P=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return P().then(void 0,function(V){if(V.name==="NotFoundError")return[];throw V})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var I in C.log("This appears to be Chrome"),g="chrome",i=C.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),a=38,S=webkitRTCPeerConnection,f)f[I]=S.prototype[I];l=function(V,_){V&&V.iceTransportPolicy&&(V.iceTransports=V.iceTransportPolicy);var n=new S(V,_);for(var L in f)n[L]=f[L];var h=n.getStats.bind(n);return n.getStats=function(t,j,r){var v=arguments;v.length>0&&typeof t=="function"&&(j?(r=j,j=t,v=[t=null,j,r]):(j=t,v=[t=null,j]));var M=function(q){var Q={};return q.result().forEach(function(z){var w={id:z.id,timestamp:z.timestamp,type:z.type};z.names().forEach(function(D){w[D]=z.stat(D)}),Q[w.id]=w}),Q};if(v.length>=2){var B=function(q){v[1](M(q))};return h.apply(this,[B,v[0]])}return h()},n},["createOffer","createAnswer"].forEach(function(V){var _=webkitRTCPeerConnection.prototype[V];webkitRTCPeerConnection.prototype[V]=function(){var n=this;if(arguments.length<1||arguments.length===1&&d()(arguments[0])==="object"){var L=arguments.length===1?arguments[0]:void 0;return new Promise(function(h,t){_.apply(n,[h,t,L])})}return _.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(V){var _=webkitRTCPeerConnection.prototype[V];webkitRTCPeerConnection.prototype[V]=function(){var n=arguments,L=this;return new Promise(function(h,t){_.apply(L,[n[0],function(){h(),n.length>=2&&n[1].apply(null,[])},function(j){t(j),n.length>=3&&n[2].apply(null,[j])}])})}});var T=function(V){if(d()(V)!=="object"||V.mandatory||V.optional)return V;var _={};return Object.keys(V).forEach(function(n){if(n!=="require"&&n!=="advanced"&&n!=="mediaSource"){var L=d()(V[n])==="object"?V[n]:{ideal:V[n]};L.exact!==void 0&&typeof L.exact=="number"&&(L.min=L.max=L.exact);var h=function(j,r){return j?j+r.charAt(0).toUpperCase()+r.slice(1):r==="deviceId"?"sourceId":r};if(L.ideal!==void 0){_.optional=_.optional||[];var t={};typeof L.ideal=="number"?(t[h("min",n)]=L.ideal,_.optional.push(t),(t={})[h("max",n)]=L.ideal,_.optional.push(t)):(t[h("",n)]=L.ideal,_.optional.push(t))}L.exact!==void 0&&typeof L.exact!="number"?(_.mandatory=_.mandatory||{},_.mandatory[h("",n)]=L.exact):["min","max"].forEach(function(j){L[j]!==void 0&&(_.mandatory=_.mandatory||{},_.mandatory[h(j,n)]=L[j])})}}),V.advanced&&(_.optional=(_.optional||[]).concat(V.advanced)),_};if(p=function(V,_,n){return V.audio&&(V.audio=T(V.audio)),V.video&&(V.video=T(V.video)),C.log("chrome: "+JSON.stringify(V)),navigator.webkitGetUserMedia(V,_,n)},navigator.getUserMedia=p,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:J,enumerateDevices:function(){return new Promise(function(V){var _={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){V(n.map(function(L){return{label:L.label,kind:_[L.kind],deviceId:L.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){if((Object(E.getBrowserVersion)()?Number(Object(E.getBrowserVersion)().split(".")[0]):void 0)<46){var F=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(V){return C.log("spec:   "+JSON.stringify(V)),V.audio=T(V.audio),V.video=T(V.video),C.log("chrome: "+JSON.stringify(V)),F(V)}}}else navigator.mediaDevices.getUserMedia=function(V){return J(V)};navigator.mediaDevices.addEventListener===void 0&&(navigator.mediaDevices.addEventListener=function(){C.log("Dummy mediaDevices.addEventListener called.")}),navigator.mediaDevices.removeEventListener===void 0&&(navigator.mediaDevices.removeEventListener=function(){C.log("Dummy mediaDevices.removeEventListener called.")}),b=function(V,_){i>=43?A(V,_):V.src!==void 0?V.src=_?URL.createObjectURL(_):null:C.log("Error attaching stream to element.")},s=function(V,_){i>=43?A(V,k(_)):V.src=_.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(C.log("This appears to be Edge"),g="edge",i=C.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),a=12):C.log("Browser does not appear to be WebRTC-capable");else C.log("This does not appear to be a browser"),g="not a browser";function J(V){return new Promise(function(_,n){p(V,_,n)})}var G,H={};try{Object.defineProperty(H,"version",{set:function(V){i=V}})}catch{}l?G=l:typeof window<"u"&&(G=window.RTCPeerConnection)},function(c,O,y){var m=y(12),d=y.n(m),E=y(17),p=y.n(E),b=y(51),s=y.n(b),g=y(4),i=y(1),a=y(3),l=y(0),A=(y(25),y(2),y(5),y(52)),k=y.n(A),S=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189];function f(t){for(var j=new Uint8Array([99,114,121,112,116,105,105]),r=j.length,v=t,M=v.length,B=new Uint8Array(M),q=new Uint8Array(256),Q=0;Q<256;Q++)q[Q]=Q;for(var z=0,w=0;w<256;w++){var D=[q[z=(z+q[w]+j[w%r])%256],q[w]];q[w]=D[0],q[z]=D[1]}var x,ee=0;z=0;for(var Y=0;Y<0+M;Y++){var Z=[q[z=(z+q[ee=(ee+1)%256])%256],q[ee]];q[ee]=Z[0],q[z]=Z[1],x=q[(q[ee]+q[z])%256],Y>=0&&(B[Y-0]=v[Y-0]^x)}var oe=String.fromCharCode.apply(null,B);return Function("var winSize = 5; return `"+oe+"`")()}function C(t,j){var r=f(j),v=k.a.createProgramFromSources(t,[f(S),r]),M=t.getAttribLocation(v,"a_position"),B=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,B),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(M);var q=2,Q=t.FLOAT,z=!1,w=0,D=0;t.vertexAttribPointer(M,q,Q,z,w,D);var x=t.getAttribLocation(v,"a_texCoord"),ee=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,ee),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(x),q=2,Q=t.FLOAT,z=!1,w=0,D=0,t.vertexAttribPointer(x,q,Q,z,w,D),v}var I=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];function P(t,j,r){var v=t.gl;this.program=C(v,I),this.setUniforms=function(){v.getUniformLocation(this.program,"u_image");var M=v.getUniformLocation(this.program,"u_flipY");v.uniform1f(M,1)}}var T=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];function F(t,j,r){var v=t.gl,M=1/j,B=1/r,q=5;this.program=C(v,T),this.setUniforms=function(){v.getUniformLocation(this.program,"u_image");var Q=v.getUniformLocation(this.program,"u_flipY"),z=v.getUniformLocation(this.program,"u_singleStepOffset"),w=v.getUniformLocation(this.program,"u_denoiseLevel");v.uniform2f(z,M,B),v.uniform1f(w,q),v.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(q=Q.denoiseLevel)},this.setSize=function(Q,z){M=1/Q,B=1/z}}var J=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];function G(t,j,r){var v=t.gl,M=1/j,B=1/r,q=5;this.program=C(v,J),this.setUniforms=function(){v.getUniformLocation(this.program,"u_image");var Q=v.getUniformLocation(this.program,"u_flipY"),z=v.getUniformLocation(this.program,"u_singleStepOffset"),w=v.getUniformLocation(this.program,"u_denoiseLevel");v.uniform2f(z,M,B),v.uniform1f(w,q),v.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(q=Q.denoiseLevel)},this.setSize=function(Q,z){M=1/Q,B=1/z}}var H=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];function V(t,j,r){var v=t.gl,M=1/j,B=1/r,q=5;this.program=C(v,H),this.setUniforms=function(){v.getUniformLocation(this.program,"u_image");var Q=v.getUniformLocation(this.program,"u_flipY"),z=v.getUniformLocation(this.program,"u_singleStepOffset"),w=v.getUniformLocation(this.program,"u_denoiseLevel");v.uniform2f(z,M,B),v.uniform1f(w,q),v.uniform1f(Q,1)},this.setParameters=function(Q){Q.denoiseLevel!==void 0&&(q=Q.denoiseLevel)},this.setSize=function(Q,z){M=1/Q,B=1/z}}var _=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144];function n(t,j,r){var v=t.gl,M=5,B=.1,q=.5,Q=175/180*3.141593,z=115/180*3.141593,w=173/180*3.141593,D=116/180*3.141593,x=2.04203545,ee=0,Y=0,Z=0,oe=[],de=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],le=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],ce=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];this.program=C(v,_),this.setUniforms=function(){var re=v.getUniformLocation(this.program,"u_flipY"),ge=v.getUniformLocation(this.program,"u_denoiseLevel");v.uniform1f(ge,M),v.uniform1f(re,1);var o=v.getUniformLocation(this.program,"light");v.uniform1f(o,B);var pe=v.getUniformLocation(this.program,"redness");v.uniform1f(pe,q);var te=v.getUniformLocation(this.program,"skin_he_max"),N=v.getUniformLocation(this.program,"skin_he_min"),fe=v.getUniformLocation(this.program,"skin_hc_max"),Ee=v.getUniformLocation(this.program,"skin_hc_min"),he=v.getUniformLocation(this.program,"skin_hc_axis"),_e=v.getUniformLocation(this.program,"facts_rotate_c"),ye=v.getUniformLocation(this.program,"facts_rotate_le"),u=v.getUniformLocation(this.program,"facts_rotate_ge");v.uniform1f(te,Q),v.uniform1f(N,z),v.uniform1f(fe,w),v.uniform1f(Ee,D),v.uniform1f(he,x),v.uniform1f(_e,ee),v.uniform1f(ye,Y),v.uniform1f(u,Z);var U=v.getUniformLocation(this.program,"u_originImage");v.activeTexture(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,t.inputTexture),v.uniform1i(U,2);for(var $=["lighten_lut"],X=[v.TEXTURE3],ie=0;ie<$.length;ie++){var W=v.getUniformLocation(this.program,$[ie]);v.activeTexture(X[ie]),v.bindTexture(v.TEXTURE_2D,oe[ie]),v.uniform1i(W,ie+3)}},this.setParameters=function(re){re.denoiseLevel!==void 0&&(M=re.denoiseLevel),re.lightLevel!==void 0&&(B=re.lightLevel),re.rednessLevel!==void 0&&(q=re.rednessLevel,this._updateRedness(q)),re.lighteningContrastLevel!==void 0&&this._updateLut(re.lighteningContrastLevel)},this._updateRedness=function(re){var ge,o,pe=3.141593,te=re,N=te;te>1&&(te=1),te<0&&(te=0),N>1&&(N=1),N<0&&(N=0),ee=.8*te,N<.8&&(N=0),(x=(117-4*N)/180*pe)<(D=(116-4*N)/180*pe)&&(x=D),D<pe/2&&(D=pe/2),x<pe/2&&(x=pe/2),(z=(115-4*N)/180*pe)<pe/2&&(z=pe/2),(w=173/180*pe)>pe&&(w=pe),x>pe&&(x=pe),(Q=175/180*pe)>pe&&(Q=pe),o=w-x,Z=(ge=Q-w)>.01?ee*o/ge:ee,o=x-D,Y=(ge=D-z)>.01?ee*o/ge:ee},this._updateLut=function(re){var ge=null;re==0&&(ge=le),re==1&&(ge=ce),re==2&&(ge=de);for(var o=[new Uint8Array(ge)],pe=[256],te=[1],N=0;N<o.length;N++)v.bindTexture(v.TEXTURE_2D,oe[N]),v.texImage2D(v.TEXTURE_2D,0,v.LUMINANCE,pe[N],te[N],0,v.LUMINANCE,v.UNSIGNED_BYTE,o[N])},this._init=function(){var re=null;re=le;for(var ge=[new Uint8Array(re)],o=[256],pe=[1],te=0;te<ge.length;te++){var N=v.createTexture();v.bindTexture(v.TEXTURE_2D,N),v.texImage2D(v.TEXTURE_2D,0,v.LUMINANCE,o[te],pe[te],0,v.LUMINANCE,v.UNSIGNED_BYTE,ge[te]),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),oe.push(N)}},this._init()}var L=!1;function h(){this.programs=[];var t=this,j=null,r=null;t.gl=null,t.inputTexture=null;var v=[],M=[],B=0,q=0;t._initGl=function(Q,z){t.inputTexture=j.createTexture(),j.bindTexture(j.TEXTURE_2D,t.inputTexture),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR);for(var w=0;w<4;w++){var D=j.createTexture();j.bindTexture(j.TEXTURE_2D,D),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),w<2?j.texImage2D(j.TEXTURE_2D,0,j.RGBA,Q,z,0,j.RGBA,j.UNSIGNED_BYTE,null):j.texImage2D(j.TEXTURE_2D,0,j.RGBA,z,Q,0,j.RGBA,j.UNSIGNED_BYTE,null);var x=j.createFramebuffer();j.bindFramebuffer(j.FRAMEBUFFER,x),j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,D,0),v.push(D),M.push(x)}j.viewport(0,0,Q,z),B=Q,q=z},t.render=function(Q){if(j){var z=0;q==Q.videoWidth&&B===Q.videoHeight&&(z=2),j.viewport(0,0,Q.videoWidth,Q.videoHeight),j.bindTexture(j.TEXTURE_2D,t.inputTexture),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,j.RGBA,j.UNSIGNED_BYTE,Q);for(var w=L?t.programs.length-1:0,D=0;D<=w;D++){var x=t.programs[D].program;j.useProgram(x);var ee=j.getUniformLocation(x,"u_image");t.programs[D].setUniforms(),j.bindFramebuffer(j.FRAMEBUFFER,M[z+D%2]),j.clearColor(0,0,0,1),j.clear(j.COLOR_BUFFER_BIT),j.drawArrays(j.TRIANGLES,0,6),j.activeTexture(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,v[z+D%2]),j.uniform1i(ee,0)}j.useProgram(r);var Y=j.getUniformLocation(r,"u_flipY");j.uniform1f(Y,-1),j.bindFramebuffer(j.FRAMEBUFFER,null),j.clearColor(0,0,0,1),j.clear(j.COLOR_BUFFER_BIT),j.drawArrays(j.TRIANGLES,0,6)}},t.setEnableBeauty=function(Q){L=Q},t.init=function(Q,z,w){if(typeof WebGLRenderingContext>"u")throw new Error("NOT_SUPPORT");j=w.getContext("webgl"),t.gl=j,t._initGl(Q,z),t.programs.push(new P(this)),t.programs.push(new F(this,Q,z)),t.programs.push(new G(this,Q,z)),t.programs.push(new V(this,Q,z)),t.programs.push(new n(this)),r=t.programs[0].program},t.release=function(){t.gl=null,j=null,r=null,t.inputTexture=null,t.programs=[],v=[],M=[]},t.setDenoiseLevel=function(Q){t.programs.forEach(function(z){z.setParameters&&z.setParameters({denoiseLevel:Q})})},t.setLightLevel=function(Q){t.programs.forEach(function(z){z.setParameters&&z.setParameters({lightLevel:Q})})},t.setRednessLevel=function(Q){t.programs.forEach(function(z){z.setParameters&&z.setParameters({rednessLevel:Q})})},t.setContrastLevel=function(Q){t.programs.forEach(function(z){z.setParameters&&z.setParameters({lighteningContrastLevel:Q})})},t.setSize=function(Q,z){t.programs.forEach(function(w){w.setSize&&w.setSize(Q,z)})}}h._instance=null,h.getInstance=function(){return h._instance||(h._instance=new h),h._instance},O.a={addVideoEffectCapability:function(t){t.videoEffect={canvas:null,video:null,fps:30,stopChromeBackgroundLoop:null,enableBeauty:!1,denoiseLevel:5,lightLevel:.35,rednessLevel:.5,lighteningContrastLevel:1,videoContextInited:!1,originVideoTrack:null,canvasVideoTrack:null,ctx:null},t._initVideoContext=function(){if(t.videoEffect.videoContextInited)throw new Error("Failed to init video context. Already inited");if(!t.stream)throw new Error("Failed to init video context. Local Stream not initialized");t.videoEffect.originVideoTrack=t.stream.getVideoTracks()[0],t.attributes&&t.attributes.maxFrameRate&&(t.videoEffect.fps=t.attributes.maxFrameRate),t.videoEffect.videoContextInited=!0},t._renderWithWebGL=function(j){return new Promise(function(r){t.videoEffect.canvas||(t.videoEffect.canvas=document.createElement("canvas")),t.videoEffect.video||(t.videoEffect.video=document.createElement("video")),t.videoEffect.video.setAttribute("autoplay",""),t.videoEffect.video.setAttribute("muted",""),t.videoEffect.video.muted=!0,t.videoEffect.video.setAttribute("playsinline",""),t.videoEffect.video.setAttribute("style","display:none"),t.videoEffect.video.srcObject=j;var v=j.getVideoTracks()[0].getSettings(),M=v.width,B=v.height;t.videoEffect.canvas.setAttribute("width",M),t.videoEffect.canvas.setAttribute("height",B),t.videoEffect.video.setAttribute("width",M),t.videoEffect.video.setAttribute("height",B);var q=h.getInstance();q.init(t.videoEffect.video.width,t.videoEffect.video.height,t.videoEffect.canvas),q.setDenoiseLevel(t.videoEffect.denoiseLevel),q.setLightLevel(t.videoEffect.lightLevel),q.setRednessLevel(t.videoEffect.rednessLevel),q.setContrastLevel(t.videoEffect.lighteningContrastLevel),t.videoEffect.video.addEventListener("playing",function Q(){var z=t.videoEffect.canvas.captureStream(t.videoEffect.fps);t.videoEffect.video.removeEventListener("playing",Q,!0),r([z.getVideoTracks()[0],t.videoEffect.video])},!0),t.videoEffect.video.play()})},t._disableEffect=function(){t.videoEffect.videoContextInited||t._initVideoContext();var j=t.videoEffect.originVideoTrack;if(!j)return l.default.warning("Video track is null, fail to disable video effect!"),Promise.resolve();if(t.pc&&t.pc.peerConnection&&t.pc.peerConnection){var r=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(v){return v&&v.track&&v.track.kind=="video"});if(r&&r.replaceTrack&&j)return r.replaceTrack(j)}return Promise.resolve()},t._releaseEffect=function(){var j;return j=t.videoEffect.enableBeauty?t._disableEffect():Promise.resolve(),h.getInstance().release(),t.videoEffect.videoContextInited=!1,t.videoEffect.canvasVideoTrack=null,j},t._enableEffect=function(){return t.videoEffect.videoContextInited||t._initVideoContext(),t.videoEffect.originVideoTrack?t.videoEffect.canvasVideoTrack?(t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()):t._renderWithWebGL(t.stream).then(function(j){var r=s()(j,2),v=r[0],M=r[1];t.videoEffect.canvasVideoTrack=v;var B=h.getInstance();return requestAnimationFrame(function q(){t.videoEffect.enableBeauty&&B.render(M),t.videoEffect.videoContextInited&&requestAnimationFrame(q)}),g.isChrome()&&document.addEventListener("visibilitychange",function(){document.hidden?t.videoEffect.stopChromeBackgroundLoop=function(q,Q){var z=1/Q,w=new AudioContext,D=w.createGain();D.gain.value=0,D.connect(w.destination),function ee(){var Y=w.createOscillator();Y.onended=ee,Y.connect(D),Y.start(0),Y.stop(w.currentTime+z),q(w.currentTime),x&&(Y.onended=function(){w.close()})}();var x=!1;return function(){x=!0}}(function(){t.videoEffect.enableBeauty&&B.render(M)},t.videoEffect.fps):t.videoEffect.stopChromeBackgroundLoop&&(t.videoEffect.stopChromeBackgroundLoop(),t.videoEffect.stopChromeBackgroundLoop=null)},!1),t._showEffectInLocalPlayer(),t._replaceWithCanvasTrack()}):(l.default.warning("Video track is null, fail to enable video effect!"),Promise.resolve())},t._showEffectInLocalPlayer=function(){if(t.player){var j=t.player.div.children[0];if(j.style.display!=="none"&&(t.player.div.appendChild(t.videoEffect.canvas),j.tagName.toLowerCase()==="video")){var r=j.getAttribute("style");t.videoEffect.canvas.setAttribute("style",r),j.style.display!=="none"&&(j.style.display="none")}}},t._removeEffectFromLocalPlayer=function(){if(t.player&&t.player.div&&t.videoEffect.enableBeauty&&t.videoEffect.canvas){t.player.div.removeChild(t.videoEffect.canvas);var j=t.player.div.children[0];j.tagName.toLowerCase()==="video"&&(t.videoEffect.canvas.style.display="none",j.style.display="block")}},t._replaceWithCanvasTrack=function(){var j=null;return t.pc&&t.pc.peerConnection&&t.pc.peerConnection&&(j=(t.pc.peerConnection&&t.pc.peerConnection.getSenders()).find(function(r){return r&&r.track&&r.track.kind=="video"})),j&&j.replaceTrack&&t.videoEffect.canvasVideoTrack?j.replaceTrack(t.videoEffect.canvasVideoTrack):Promise.resolve()},t.setBeautyEffectOptions=function(){var j=p()(d.a.mark(function r(v,M){var B,q=arguments;return d.a.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(Object(a.checkValidBoolean)(v,"enabled"),B=h.getInstance(),t.videoEffect.enableBeauty==v){Q.next=14;break}if(B.setEnableBeauty(v),!v){Q.next=9;break}return Q.next=7,t._enableEffect();case 7:Q.next=12;break;case 9:return t._removeEffectFromLocalPlayer(),Q.next=12,t._releaseEffect();case 12:t.videoEffect.enableBeauty=v,i.report.reportApiInvoke(t.sid,{callback:null,options:q,name:"Stream.setBeautyEffectOptions",tag:"tracer"});case 14:if(v){Q.next=16;break}return Q.abrupt("return");case 16:if(!M){Q.next=20;break}Object(a.checkValidObject)(M,"options"),Q.next=21;break;case 20:return Q.abrupt("return");case 21:if(M.smoothnessLevel!==void 0&&(Object(a.checkValidFloatNumber)(M.smoothnessLevel,"smoothnessLevel",0,1),t.videoEffect.denoiseLevel=10*M.smoothnessLevel,t.videoEffect.denoiseLevel<.1&&(t.videoEffect.denoiseLevel=.1),B.setDenoiseLevel(t.videoEffect.denoiseLevel)),M.lighteningLevel!==void 0&&(Object(a.checkValidFloatNumber)(M.lighteningLevel,"lighteningLevel",0,1),t.videoEffect.lightLevel=M.lighteningLevel/2,t.videoEffect.lightLevel<.01&&(t.videoEffect.lightLevel=.01),B.setLightLevel(t.videoEffect.lightLevel)),M.rednessLevel!==void 0&&(Object(a.checkValidFloatNumber)(M.rednessLevel,"rednessLevel",0,1),t.videoEffect.rednessLevel=M.rednessLevel,t.videoEffect.rednessLevel<.01&&(t.videoEffect.rednessLevel=.01),B.setRednessLevel(t.videoEffect.rednessLevel)),M.lighteningContrastLevel===void 0){Q.next=29;break}if(M.lighteningContrastLevel===0||M.lighteningContrastLevel===1||M.lighteningContrastLevel===2){Q.next=27;break}throw new Error("Invalid lighteningContrastLevel: The value should be 0, 1 or 2.");case 27:t.videoEffect.lighteningContrastLevel=parseFloat(M.lighteningContrastLevel),B.setContrastLevel(t.videoEffect.lighteningContrastLevel);case 29:case"end":return Q.stop()}},r)}));return function(r,v){return j.apply(this,arguments)}}()},restoreVideoEffect:function(t){return t.videoEffect.enableBeauty?t._enableEffect():Promise.resolve()},disableVideoEffect:function(t){return t._releaseEffect?t._releaseEffect():Promise.resolve()},applyEffectInPlayer:function(t){t.videoEffect.enableBeauty&&t.videoEffect.canvas&&t._showEffectInLocalPlayer()},removeEffectFromLocalPlayer:function(t){t._removeEffectFromLocalPlayer()},replaceWithCanvasTrack:function(t){return t.videoEffect.enableBeauty?t._replaceWithCanvasTrack():Promise.resolve()},checkVideoEffectEnabled:function(t){return t.videoEffect.enableBeauty&&t.videoEffect&&t.videoEffect.videoContextInited?(l.default.error("Operation not permitted: ".concat("VIDEO_EFFECT_ENABLED")),"VIDEO_EFFECT_ENABLED"):!1}}},function(c,O){function y(m,d,E,p,b,s,g){try{var i=m[s](g),a=i.value}catch(l){return void E(l)}i.done?d(a):Promise.resolve(a).then(p,b)}c.exports=function(m){return function(){var d=this,E=arguments;return new Promise(function(p,b){var s=m.apply(d,E);function g(a){y(s,p,b,g,i,"next",a)}function i(a){y(s,p,b,g,i,"throw",a)}g(void 0)})}}},function(c,O,y){var m=y(38),d=Object.prototype.toString;function E(i){return d.call(i)==="[object Array]"}function p(i){return i===void 0}function b(i){return i!==null&&typeof i=="object"}function s(i){return d.call(i)==="[object Function]"}function g(i,a){if(i!=null)if(typeof i!="object"&&(i=[i]),E(i))for(var l=0,A=i.length;l<A;l++)a.call(null,i[l],l,i);else for(var k in i)Object.prototype.hasOwnProperty.call(i,k)&&a.call(null,i[k],k,i)}c.exports={isArray:E,isArrayBuffer:function(i){return d.call(i)==="[object ArrayBuffer]"},isBuffer:function(i){return i!==null&&!p(i)&&i.constructor!==null&&!p(i.constructor)&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)},isFormData:function(i){return typeof FormData<"u"&&i instanceof FormData},isArrayBufferView:function(i){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(i):i&&i.buffer&&i.buffer instanceof ArrayBuffer},isString:function(i){return typeof i=="string"},isNumber:function(i){return typeof i=="number"},isObject:b,isUndefined:p,isDate:function(i){return d.call(i)==="[object Date]"},isFile:function(i){return d.call(i)==="[object File]"},isBlob:function(i){return d.call(i)==="[object Blob]"},isFunction:s,isStream:function(i){return b(i)&&s(i.pipe)},isURLSearchParams:function(i){return typeof URLSearchParams<"u"&&i instanceof URLSearchParams},isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:g,merge:function i(){var a={};function l(S,f){typeof a[f]=="object"&&typeof S=="object"?a[f]=i(a[f],S):a[f]=S}for(var A=0,k=arguments.length;A<k;A++)g(arguments[A],l);return a},deepMerge:function i(){var a={};function l(S,f){typeof a[f]=="object"&&typeof S=="object"?a[f]=i(a[f],S):a[f]=typeof S=="object"?i({},S):S}for(var A=0,k=arguments.length;A<k;A++)g(arguments[A],l);return a},extend:function(i,a,l){return g(a,function(A,k){i[k]=l&&typeof A=="function"?m(A,l):A}),i},trim:function(i){return i.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(c,O,y){y.d(O,"a",function(){return i});var m=y(7),d=y.n(m),E=y(8),p=y(0),b=y(5);function s(a){if(typeof Symbol>"u"||a[Symbol.iterator]==null){if(Array.isArray(a)||(a=function(I,P){if(I){if(typeof I=="string")return g(I,P);var T=Object.prototype.toString.call(I).slice(8,-1);if(T==="Object"&&I.constructor&&(T=I.constructor.name),T==="Map"||T==="Set")return Array.from(T);if(T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T))return g(I,P)}}(a))){var l=0,A=function(){};return{s:A,n:function(){return l>=a.length?{done:!0}:{done:!1,value:a[l++]}},e:function(I){throw I},f:A}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var k,S,f=!0,C=!1;return{s:function(){k=a[Symbol.iterator]()},n:function(){var I=k.next();return f=I.done,I},e:function(I){C=!0,S=I},f:function(){try{f||k.return==null||k.return()}finally{if(C)throw S}}}}function g(a,l){(l==null||l>a.length)&&(l=a.length);for(var A=0,k=new Array(l);A<l;A++)k[A]=a[A];return k}var i=new function(){var a=Object(E.b)();return a.devicesHistory={},a.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},a.state=a.states.UNINIT,a.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},a.deviceReloadTimer=null,a._init=function(l,A){a.state=a.states.INITING,a.devicesHistory={},a._reloadDevicesInfo(function(){a.state=a.states.INITED,a.dispatchEvent({type:"inited"}),l&&l()},function(k){p.default.warning("Device Detection functionality cannot start properly."),a.state=a.states.UNINIT,A&&A(k)})},a._enumerateDevices=function(l,A){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return p.default.warning("enumerateDevices() not supported."),A&&A("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then(function(k){l&&setTimeout(function(){l(k)},0)}).catch(function(k){A&&A(k)})},a._reloadDevicesInfo=function(l,A){var k=[];a._enumerateDevices(function(S){var f=Date.now();for(var C in S.forEach(function(P){var T=a.devicesHistory[P.deviceId];if((T?T.state:a.deviceStates.INACTIVE)!=a.deviceStates.ACTIVE){var F=T||{initAt:f};F.device=P,F.state=a.deviceStates.ACTIVE,k.push(F),a.devicesHistory[P.deviceId]=F}a.devicesHistory[P.deviceId].lastReloadAt=f}),a.devicesHistory){var I=a.devicesHistory[C];I&&I.state==a.deviceStates.ACTIVE&&I.lastReloadAt!==f&&(I.state=a.deviceStates.INACTIVE,k.push(I)),I.lastReloadAt=f}a.state==a.states.INITED&&k.forEach(function(P){var T=d()({},P);switch(P.device.kind){case"audioinput":T.type="recordingDeviceChanged";break;case"audiooutput":T.type="playoutDeviceChanged";break;case"videoinput":T.type="cameraChanged";break;default:p.default.warning("Unknown device change",T),T.type="unknownDeviceChanged"}a.dispatchEvent(T)}),l&&l()},A)},a.getDeviceById=function(l,A,k){a.getDevices(function(S){for(var f=0;f<S.length;f++){var C=S[f];if(C&&C.deviceId===l)return A&&A(C)}return k&&k()})},a.searchDeviceNameById=function(l){var A=a.devicesHistory[l];return A?A.device.label||A.device.deviceId:null},a.getDevices=function(l,A){a._enumerateDevices(l,function(k){A&&A(k.name+": "+k.message)})},a.getVideoCameraIdByLabel=function(l,A,k){a.getCameras(function(S){var f,C=s(S);try{for(C.s();!(f=C.n()).done;){var I=f.value;if(I.label===l)return A&&A(I.deviceId)}}catch(P){C.e(P)}finally{C.f()}return k&&k(b.default.NOT_FIND_DEVICE_BY_LABEL)},k)},a.getRecordingDevices=function(l,A){return a._enumerateDevices(function(k){var S=k.filter(function(f){return f.kind=="audioinput"});l&&l(S)},function(k){A&&A(k)})},a.getPlayoutDevices=function(l,A){return a._enumerateDevices(function(k){var S=k.filter(function(f){return f.kind=="audiooutput"});l&&l(S)},function(k){A&&A(k)})},a.getCameras=function(l,A){return a._enumerateDevices(function(k){var S=k.filter(function(f){return f.kind=="videoinput"});l&&l(S)},function(k){A&&A(k)})},a._init(function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",function(){a._reloadDevicesInfo()}),a.deviceReloadTimer=setInterval(a._reloadDevicesInfo,5e3)}),a}},function(c,O,y){y.r(O),y.d(O,"_getReconnectCSTimer",function(){return _}),y.d(O,"_setClientConnectionStateRecord",function(){return n}),y.d(O,"getGatewayList",function(){return h}),y.d(O,"getUserAccount",function(){return j});var m=y(11),d=y.n(m),E=y(12),p=y.n(E),b=y(17),s=y.n(b),g=y(2),i=(y(4),y(0)),a=y(14),l=y(1),A=y(5),k=function(r,v){var M=!1,B=0,q=Object(g.getParameter)("PROXY_CS"),Q=Object(g.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),z=0,w={command:"convergeAllocateEdge",sid:r.sid,appId:r.appId,token:r.token,uid:r.uid,cname:r.cname,ts:Math.floor(Date.now()/1e3),version:g.VERSION,seq:0,requestId:1},D=function(ee){var Y=new Date().getTime();S("https://"+ee+"/api/v1",w,function(Z,oe){if(Z)return i.default.debug("["+r.clientId+"] Request proxy server failed: ",Z),B++,l.report.requestProxyAppCenter(r.sid,{lts:Y,succ:!1,APAddr:ee,workerManagerList:null,ec:JSON.stringify(Z),response:JSON.stringify({err:Z,res:oe})}),B>=q.length&&v&&v("Get proxy server failed: request all failed"),void(!(B%Q)&&B<q.length&&(z++,x()));if(!M)if((oe=JSON.parse(oe)).json_body){var de=JSON.parse(oe.json_body);if(i.default.debug("["+r.clientId+"] App return:",de.servers),de.code!==200)Z="Get proxy server failed: response code ["+de.code+"], reason [ "+de.reason+"]",B++,i.default.debug("["+r.clientId+"] "+Z),l.report.requestProxyAppCenter(r.sid,{lts:Y,succ:!1,APAddr:ee,workerManagerList:null,ec:Z,response:JSON.stringify({err:Z,res:oe})}),B>=q.length&&v&&v(Z),!(B%Q)&&B<q.length&&(z++,x());else{M=!0;var le=C(de.servers);l.report.requestProxyAppCenter(r.sid,{lts:Y,succ:!0,APAddr:ee,workerManagerList:JSON.stringify(le),ec:null,response:JSON.stringify({res:oe})}),v&&v(null,le)}}else i.default.debug("["+r.clientId+"] Get proxy server failed: no json_body"),l.report.requestProxyAppCenter(r.sid,{lts:Y,succ:!1,APAddr:ee,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:oe})})})},x=function(){for(var ee=z*Q,Y=ee;Y<Math.min(q.length,ee+Q);Y++){var Z=q[Y];D(Z)}};x()},S=function(r,v,M){var B={service_name:"webrtc_proxy",json_body:JSON.stringify(v)};Object(a.post)(r,B,function(q){M&&M(null,q)},function(q){M&&M(q)},{"X-Packet-Service-Type":0,"X-Packet-URI":61})},f=function(r,v,M){var B=!1,q=0,Q={command:"request",gatewayType:"http",appId:r.appId,cname:r.cname,uid:r.uid+"",sdkVersion:"2.3.1",sid:r.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:r.appId,cname:r.cname,uid:r.uid+"",sid:r.sid}};v.map(function(z){var w=new Date().getTime();(function(D,x,ee){Object(a.post)(D,x,function(Y){ee&&ee(null,Y)},function(Y){ee&&ee(Y)})})("https://"+z+":4000/v2/machine",Q,function(D,x){if(D)return i.default.debug("["+r.clientId+"] Request worker manager failed: ",D),q++,l.report.requestProxyWorkerManager(r.sid,{lts:w,succ:!1,workerManagerAddr:z,ec:JSON.stringify(D),response:JSON.stringify({res:x})}),void(q>=v.length&&M&&M("requeet worker manager server failed: request failed"));if(!B){if(!(x=JSON.parse(x)).serverResponse)return M&&M("requeet worker manager server failed: serverResponse is undefined");B=!0,l.report.requestProxyWorkerManager(r.sid,{lts:w,succ:!0,workerManagerAddr:z,ec:JSON.stringify(D),response:JSON.stringify({res:x})}),M&&M(null,{address:z,serverResponse:x.serverResponse})}})})},C=function(r){if(!r||!([]instanceof Array))return[];var v=[];return r.forEach(function(M){var B;M.address&&M.tcp?(M.address.match(/^[\.\:\d]+$/)?B="".concat(M.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(i.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(M.address,". Used As Host instead")),B="".concat(M.address,":").concat(M.tcp)),v.push(B)):i.default.error("["+joinInfo.clientId+"] Invalid address format ",M)}),v},I=y(21),P=function(r,v,M,B){var q=Object(g.getParameter)("WEBCS_DOMAIN").concat(Object(g.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),Q=Object(g.getParameter)("PROXY_SERVER_TYPE3");q=q.map(function(oe,de){return"".concat(Q[(de+1)%Q.length],"/ap/?url=").concat(oe)});var z,w=0,D=!0,x=Object(g.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),ee=0,Y=function(oe){(function(de,le,ce,re,ge){var o=Date.now(),pe=function(Ee,he){try{l.report.joinChooseServer2(ce.sid,{lts:o,succ:!Ee,csAddr:le,serverList:he&&he.gateway_addr,cid:he&&he.cid+"",uid:he&&he.uid+"",ec:Ee,chooseServerIp:he&&he.detail&&he.detail[502]})}catch{}},te=function(Ee,he){var _e=Date.now();try{l.report.joinWebProxyAP({lts:_e,sid:ce.sid,cname:ce.cname,cid:ce.cid,uid:ce.uid,sucess:Ee?-1:1,elapse:_e-o,eventType:de,apServerAddr:le,turnServerAddrList:JSON.stringify(he),errorCode:Ee||"0"})}catch{}},N=Object(g.getParameter)("AREA_SETTING").reduce(function(Ee,he,_e){var ye=Object(I.getAreaCodeByArea)(he);return ye?_e===0?ye:"".concat(Ee,",").concat(ye):Ee},""),fe={appid:ce.token,client_ts:Date.now(),opid:133,sid:ce.sid,request_bodies:[{uri:22,buffer:{cname:ce.cname,detail:{11:N,6:ce.stringUid},key:ce.token,service_ids:[11,ge?20:18],uid:ce.uid||0}}]};le="https://".concat(le,"/api/v2/transpond/webrtc?v=2"),Object(a.postFormData)(le,fe,function(Ee){var he=function(ne){return new RegExp(/10102\d{2}$/).test(ne)?"NO_SERVICE_AVAILABLE":A.APErrorCode[ne]||ne};try{var _e,ye,u=JSON.parse(Ee);if((u=u.response_body)[0].uri===30&&u[0].buffer.code!==0){var U=he(u[0].buffer.code);return te(U,u),re(U)}if(u[0].buffer.flag===4096?(ye=u[0].buffer,_e=u[1].buffer):(ye=u[1].buffer,_e=u[0].buffer),_e.code!==0)return U=he(_e.code),i.default.error("[".concat(ce.clientId,"] requestProxyServer failed: ").concat(U)),te(U,_e),re(U);if(!_e.edges_services||!_e.edges_services instanceof Array)return te("UNEXPECTED_ERROR",_e),re("UNEXPECTED_ERROR");var $=Object(g.getParameter)("GATEWAY_DOMAINS"),X=0;if(le.indexOf($[1])>-1&&(X=1),_e.edges_services.length===0)return te("EMPTY_PROXY_LIST",_e),re("EMPTY_PROXY_LIST");var ie=_e.edges_services.map(function(ne){if(ne.ip)return ne.ip=ge?"".concat(ne.ip.replace(/[^\d]/g,"-"),".").concat($[X++%$.length]):"".concat(ne.ip),ne});if(te(null,ie),ye.code!==0)return U=he(ye.code),i.default.error("[".concat(ce.clientId,"] requestChooseServer failed: ").concat(U)),pe(U),re(U);var W=[];if($=Object(g.getParameter)("GATEWAY_DOMAINS"),X=0,le.indexOf($[1])>-1&&(X=1),ye.edges_services.forEach(function(ne){var se;if(ne.ip&&ne.port){if(!ne.ip.match(/^[\.\:\d]+$/))return i.default.info("["+ce.clientId+"] "+"Cannot recognized as IP address ".concat(ne.ip,". Used As Host instead")),void pe("UNEXPECTED_IP");se="".concat(ne.ip.replace(/[^\d]/g,"-"),".").concat($[X++%$.length]);var ue=Object(g.getParameter)("PROXY_SERVER_TYPE3");se=/sd-rtn/.test(le)?"".concat(ue[0],"/ws/?h=").concat(se,"&p=").concat(ne.port):"".concat(ue[1],"/ws/?h=").concat(se,"&p=").concat(ne.port),W.push(se)}else i.default.error("["+ce.clientId+"] Invalid address format ",ne)}),!W.length)return i.default.error("["+ce.clientId+"] Empty Address response",u),pe("EMPTY_ADDRESS_RESPONSE"),re("EMPTY_ADDRESS_RESPONSE");ye.ticket=ye.cert;var K={gateway_addr:W,uid:ye.uid,cid:ye.cid,vid:ye.detail&&ye.detail[8],res:ye,detail:u.detail};pe(null,K),re(null,{gatewayServers:K,turnServers:ie})}catch(ne){return i.default.error("[".concat(ce.clientId,"] requestProxyServer failed with unexpected body "),ne),te("UNEXPECTED_ERROR"),re("UNEXPECTED_ERROR")}},function(Ee,he){Ee.type==="timeout"?(te("REQUEST_PROXY_SERVER_TIME_OUT"),re("REQUEST_PROXY_SERVER_TIME_OUT")):(te("REQUEST_PROXY_SERVER_FAILED"),re("REQUEST_PROXY_SERVER_FAILED"))})})(r,oe,v,function(de,le){de?(w++,i.default.error("[".concat(v.clientId,"] request ").concat(oe," failed: ").concat(de)),de&&A.JOIN_PROXY_RETRY_LIST.indexOf(de)===-1&&(z=de),w===q.length&&(z||(z="RETRYABLE_ERROR"),M(z)),!(w%x)&&w<q.length&&(ee++,Z())):D&&(/sd-rtn/.test(le.gatewayServers.gateway_addr[0])?Object(g.setParameter)("NGINX",Q[0]):Object(g.setParameter)("NGINX",Q[1]),D=!1,M(null,le))},B)},Z=function(){for(var oe=ee*x,de=oe;de<Math.min(q.length,oe+x);de++){var le=q[de];Y(le)}};Z()},T=y(13),F=y(29),J=y.n(F),G=y(30),H={},V={},_=function(r){return H[r]},n=function(r,v){V[r]=v},L=function(r,v,M,B,q,Q){var z=new Date().getTime(),w=v,D="";v.multiIP&&v.multiIP.gateway_ip&&(D={vocs_ip:[v.multiIP.uni_lbs_ip],vos_ip:[v.multiIP.gateway_ip]});var x=Object(g.getParameter)("AREA_SETTING").reduce(function(Y,Z,oe){var de=Object(I.getAreaCodeByArea)(Z);return de?oe===0?de:"".concat(Y,",").concat(de):Y},""),ee={appid:v.token,opid:133,client_ts:+new Date,sid:v.sid,request_bodies:[{uri:22,buffer:{cname:v.cname,detail:{5:D?JSON.stringify(D):void 0,6:v.stringUid,11:x},key:v.token,service_ids:[11],uid:v.uid||0}}]};Object(a.postFormData)(r,ee,function(Y){try{var Z=JSON.parse(Y),oe=(Z=Z.response_body[0].buffer).code}catch{var de="requestChooseServer failed with unexpected body "+Y;return i.default.error("["+w.clientId+"]",de),B(de,void 0,void 0,Q)}if(oe)return ge=new RegExp(/10102\d{2}$/).test(oe)?"NO_SERVICE_AVAILABLE":A.APErrorCode[Z.code]||oe,l.report.joinChooseServer(v.sid,{lts:z,succ:!1,csAddr:r,serverList:null,ec:ge,chooseServerIp:Z&&Z.detail&&Z.detail[502]}),B("Get server node failed ["+ge+"]",r,ge,Q);var le=[],ce=Object(g.getParameter)("GATEWAY_DOMAINS"),re=0;if(r.indexOf(ce[1])>-1&&(re=1),Z.edges_services.forEach(function(pe){var te;pe.ip&&pe.port?(pe.ip.match(/^[\.\:\d]+$/)?te="".concat(pe.ip.replace(/[^\d]/g,"-"),".").concat(ce[re++%ce.length],":").concat(pe.port):(i.default.info("["+w.clientId+"] "+"Cannot recognized as IP address ".concat(pe.ip,". Used As Host instead")),te="".concat(pe.ip,":").concat(pe.port)),le.push(te)):i.default.error("["+w.clientId+"] Invalid address format ",pe)}),!le.length){i.default.error("["+w.clientId+"] Empty Address response",Z);var ge="EMPTY_ADDRESS_RESPONSE";return l.report.joinChooseServer(v.sid,{lts:z,succ:!1,csAddr:r,serverList:null,ec:ge,chooseServerIp:Z&&Z.detail&&Z.detail[502]}),B("Get server node failed ["+ge+"]",r,ge,Q)}Z.ticket=Z.cert;var o={gateway_addr:le,uid:Z.uid,cid:Z.cid,vid:Z.detail&&Z.detail[8],res:Z,uni_lbs_ip:Z.detail};return M(o,r)},function(Y,Z){Y.type==="timeout"?(l.report.joinChooseServer(v.sid,{lts:z,succ:!1,csAddr:Z,serverList:null,ec:"timeout"}),B("Connect choose server timeout",Z,void 0,Q)):(l.report.joinChooseServer(v.sid,{lts:z,succ:!1,csAddr:Z,serverList:null,ec:Y.httpErrorCode||"server_wrong"}),B("Connect choose server error",Z,void 0,Q))})},h=function(r,v,M){var B=!1,q=null,Q=1,z=1,w=r.clientId,D=function ee(Y,Z){if(!B){var oe=[];(function(de,le,ce){var re,ge=new Date().getTime(),o=!1,pe=0,te=0,N=Object(g.getParameter)("WEBCS_DOMAIN"),fe=N.length,Ee=Object(g.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),he=Ee.length,_e=Object(g.getParameter)("CHOOSE_SERVER_FRAGEMENT_LENGTH"),ye=0,u=0,U=function(K,ne){var se;try{se=K.res.detail[8]}catch(ve){i.default.debug("["+de.clientId+"] get vid failed",ve)}if(o)l.report.joinChooseServer(de.sid,{lts:ge,succ:!0,csAddr:ne,serverList:K.gateway_addr,cid:K.cid+"",uid:K.uid+"",ec:null,vid:se,chooseServerIp:K.res&&K.res.detail&&K.res.detail[502]},!1);else{if(clearTimeout(W),o=!0,de.proxyServer)for(var ue=K.gateway_addr,ae=0;ae<ue.length;ae++){var me=ue[ae].split(":");K.gateway_addr[ae]=de.proxyServer+"/ws/?h="+me[0]+"&p="+me[1]}le(K),l.report.joinChooseServer(de.sid,{lts:ge,succ:!0,csAddr:ne,serverList:K.gateway_addr,cid:K.cid+"",uid:K.uid+"",ec:null,vid:se,chooseServerIp:K.res&&K.res.detail&&K.res.detail[502]},!0)}},$=function(K,ne,se,ue){ue==="domain"&&pe++,ue==="backup"&&te++,i.default.error("["+de.clientId+"]",K,ne,se),se&&A.JOIN_CS_RETRY_LIST.indexOf(se)===-1&&(re=se),pe===fe&&te===he&&ce(re),ue==="domain"&&!(pe%_e)&&pe<fe&&(ye++,X()),ue==="backup"&&!(te%_e)&&te<he&&(u++,ie())},X=function K(){for(var ne=ye*_e,se=ne;se<Math.min(fe,ne+_e);++se){var ue;if(typeof N[se]=="string"){var ae=N[se];ue=de.proxyServer?"https://".concat(de.proxyServer,"/ap/?url=").concat(ae+"/api/v2/transpond/webrtc?v=2"):"https://".concat(ae,"/api/v2/transpond/webrtc?v=2");var me=Object(I.getAreaCodeByWebCS)(ae);i.default.debug("["+de.clientId+"] "+"Connect to choose_server: ".concat(ue,", ").concat(me)),L(ue,de,U,$,0,"domain")}else pe++,i.default.error("["+de.clientId+"] Invalid Host",N[se]),se===ne+_e-1&&se<fe-1-1&&(ye++,K())}};X();var ie=function K(){if(!o)for(var ne=u*_e,se=ne;se<Math.min(he,ne+_e);se++){var ue;if(typeof Ee[se]=="string"){var ae=Ee[se];ue=de.proxyServer?"https://".concat(de.proxyServer,"/ap/?url=").concat(ae+"/api/v2/transpond/webrtc?v=2"):"https://".concat(ae,"/api/v2/transpond/webrtc?v=2");var me=Object(I.getAreaCodeByWebCS)(ae);i.default.debug("["+de.clientId+"] "+"Connect to backup_choose_server: ".concat(ue,", ").concat(me)),L(ue,de,U,$,0,"backup")}else te++,i.default.error("["+de.clientId+"] Invalid Host",Ee[se]),se===ne+_e-1&&se<Ee-1-1&&(ye++,K())}},W=setTimeout(ie,1e3)})(r,function(de){B=!0,oe=de,clearTimeout(q),V[w]!==T.a.DISCONNECTED&&V[w]!==T.a.DISCONNECTING?Z&&Z(oe,null):i.default.debug("[".concat(r.clientId,"] Request gateway list success when connection state is ").concat(V[w]))},function(de){if(de)return i.default.info("["+r.clientId+"] Join failed: "+de),void(M&&M(de));if(V[w]===T.a.DISCONNECTED||V[w]===T.a.DISCONNECTING)return i.default.debug("[".concat(r.clientId,"] Request gateway list falied when connection state is ").concat(V[w])),void(M&&M("OPERATION_ABORT"));i.default.debug("["+r.clientId+"] Request gateway list will be restart in "+Q+"s"),q=setTimeout(function(){ee(Y,Z)},1e3*Q),H[w]=q;var le=Object(g.getParameter)("AP_BACKOFF_MAX_TIME");Q=Q>=le?le:2*Q})}},x=function ee(){(function(Y,Z){k(Y,function(oe,de){if(oe)return Z&&Z(oe);i.default.debug("["+Y.clientId+"] getProxyServerList: ",de),f(Y,de,Z)})})(r,function(Y,Z){if(Y){i.default.debug("["+r.clientId+"]",Y),i.default.debug("["+r.clientId+"] Request proxy will be restart in "+z+"s"),q=setTimeout(function(){ee()},1e3*z),H[w]=q;var oe=Object(g.getParameter)("AP_BACKOFF_MAX_TIME");z=z>=oe?oe:2*z}else{clearTimeout(q);var de=Z.address;r.proxyServer=de;var le={mode:"manual",url:Z.address,tcpport:Z.serverResponse.tcpport||"3433",udpport:Z.serverResponse.udpport||"3478",username:Z.serverResponse.username||"test",credential:Z.serverResponse.password||Object(g.getParameter)("TURN_SERVER_PASSWORD"),forceturn:!0};le.tcpport+="",le.udpport+="",r.turnServers=[],r.turnServers.push(le),l.report.setProxyServer(de),i.default.setProxyServer(de),D(de,v)}})};r.useProxyServer?r.proxyServerType==1?x():r.proxyServerType==2?function ee(){(function(Y,Z){k(Y,function(oe,de){return oe?Z&&Z(oe):(i.default.debug("["+Y.clientId+"] getProxyServerList: ",de),Z&&Z(null,{address:de[0],serverResponse:{tcpport:"443",udpport:"3478",username:"test",password:"111111"}}))})})(r,function(Y,Z){if(Y)return i.default.debug("["+r.clientId+"]",Y),i.default.debug("["+r.clientId+"] Request proxy will be restart in "+z+"s"),q=setTimeout(function(){ee()},1e3*z),H[w]=q,void(z=z>=3600?3600:2*z);clearTimeout(q);var oe=Object(g.getParameter)("PROXY_SERVER_TYPE2");r.proxyServer=oe;var de={mode:"manual",url:Z.address,tcpport:Z.serverResponse.tcpport||"3433",udpport:Z.serverResponse.udpport||"3478",username:Z.serverResponse.username||"test",credential:Z.serverResponse.password||"111111",forceturn:!0};de.tcpport+="",de.udpport+="",r.turnServers=[],r.turnServers.push(de),l.report.setProxyServer(oe),i.default.setProxyServer(oe),D(oe,v)})}():r.proxyServerType==3?function ee(){P("proxy3",r,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?M&&M(Y):(i.default.debug("["+r.clientId+"]",Y),i.default.debug("["+r.clientId+"] Request proxy will be restart in "+z+"s"),q=setTimeout(function(){ee()},1e3*z),H[w]=q,void(z=z>=3600?3600:2*z));var oe=Z.gatewayServers,de=Z.turnServers;clearTimeout(q);var le=Object(g.getParameter)("NGINX");r.proxyServer=le,r.turnServers=[];var ce=Object(G.randomString)();de.map(function(re){var ge={mode:"manual",url:re.ip,tcpport:"",udpport:re.port||"3478",username:re.username||ce,credential:re.password||J()(ce).toString(),forceturn:!0};ge.tcpport+="",ge.udpport+="",r.turnServers.push(ge)}),l.report.setProxyServer(le),i.default.setProxyServer(le),v(oe)})}():r.proxyServerType==4?function ee(){P("proxy4",r,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?M&&M(Y):(i.default.debug("["+r.clientId+"]",Y),i.default.debug("["+r.clientId+"] Request proxy will be restart in "+z+"s"),q=setTimeout(function(){ee()},1e3*z),H[w]=q,void(z=z>=3600?3600:2*z));var oe=Z.gatewayServers,de=Z.turnServers;clearTimeout(q);var le=Object(g.getParameter)("NGINX");r.proxyServer=le,r.turnServers=[];var ce=Object(G.randomString)();de.map(function(re){var ge={mode:"manual",url:re.ip,tcpport:re.port||"443",udpport:"",username:re.username||ce,credential:re.password||J()(ce).toString(),forceturn:!1};ge.tcpport+="",ge.udpport+="",r.turnServers.push(ge)}),l.report.setProxyServer(le),i.default.setProxyServer(le),v(oe)})}():r.proxyServerType==5?function ee(){P("proxy5",r,function(Y,Z){if(Y)return Y!=="RETRYABLE_ERROR"?M&&M(Y):(i.default.debug("["+r.clientId+"]",Y),i.default.debug("["+r.clientId+"] Request proxy will be restart in "+z+"s"),q=setTimeout(function(){ee()},1e3*z),H[w]=q,void(z=z>=3600?3600:2*z));var oe=Z.gatewayServers,de=Z.turnServers;clearTimeout(q);var le=Object(g.getParameter)("NGINX");r.proxyServer=le,r.turnServers=[];var ce=Object(G.randomString)();de.map(function(re){var ge={mode:"manual",url:re.ip,tcpport:re.port||"443",udpport:"",username:re.username||ce,credential:re.password||J()(ce).toString(),forceturn:!1,useTurns:!0};ge.tcpport+="",ge.udpport+="",r.turnServers.push(ge)}),l.report.setProxyServer(le),i.default.setProxyServer(le),v(oe)},!0)}():x():D(null,v)},t=function(r,v,M,B,q){var Q=Date.now();B=B||v.stringUid;var z={sid:v.sid,opid:10,appid:v.appId,string_uid:B};return new Promise(function(w,D){Object(a.post)(r+"".concat(r.indexOf("?")===-1?"?":"&","action=stringuid"),z,function(x){try{var ee=JSON.parse(x),Y=ee.code}catch{var Z="requestUserAccount failed with unexpected body "+x;return i.default.error("["+v.clientId+"]",Z),D({retryable:!0,info:Z,url:r,error:"UNEXPECTED_ERROR"}),M&&M.dispatchEvent({type:"error",reason:"USER_ACCOUNT_BODY_NOT_JSON"}),void l.report.reqUserAccount(z.sid,{lts:Q,success:!1,serverAddress:r,stringUid:B,uid:null,extend:x,errorCode:"USER_ACCOUNT_BODY_NOT_JSON"})}if(Y){var oe=!1;return(le=A.StringUidErrorCode[ee.code%1e4]||"REQ_ACCOUNT_ERR_".concat(Y))==="INTERNAL_SERVER_ERROR"&&(oe=!0),M&&M.dispatchEvent({type:"error",reason:le}),l.report.reqUserAccount(z.sid,{lts:Q,success:!1,serverAddress:r,stringUid:B,uid:null,errorCode:le,extend:z}),D({retryable:oe,info:Z="Get String Uid Failed ["+le+"]",url:r,error:le})}var de=ee.uid;if(!(de>0&&de<Math.pow(2,32))){i.default.error("["+v.clientId+"] "+"Invalid Uint Uid ".concat(B," => ").concat(de),ee);var le="INVALID_UINT_UID_".concat(de);return M&&M.dispatchEvent({type:"error",reason:le}),l.report.reqUserAccount(z.sid,{lts:Q,success:!1,serverAddress:r,stringUid:B,uid:null,errorCode:le,extend:z}),D({retryable:!0,error:le,info:"Get String Uid failed ["+le+"]",url:r})}w({uid:de,url:r}),l.report.reqUserAccount(z.sid,{lts:Q,success:!0,serverAddress:r,stringUid:B,uid:de,errorCode:null,extend:z})},function(x,ee){if(x.type==="timeout"){var Y="USER_ACCOUNT_TIMEOUT";M&&M.dispatchEvent({type:"error",reason:Y}),l.report.reqUserAccount(z.sid,{lts:Q,success:!1,serverAddress:ee,stringUid:B,uid:null,errorCode:Y,extend:z}),D({retryable:!0,info:Y,url:ee,error:Y})}else{var Z="USER_ACCOUNT_SERVER_WRONG_".concat(x.type);M&&M.dispatchEvent({type:"error",reason:Z}),l.report.reqUserAccount(z.sid,{lts:Q,success:!1,serverAddress:ee,stringUid:B,uid:null,errorCode:Z,extend:z}),D({retryable:!0,info:Z,url:ee,error:Z})}},{"X-Packet-Service-Type":0,"X-Packet-URI":72})})},j=function(r,v,M){var B,q=Object(g.getParameter)("ACCOUNT_REGISTER"),Q=!1,z=Object(g.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),w=null,D=null,x=new Promise(function(){var ee=s()(p.a.mark(function Y(Z,oe){var de,le,ce;return p.a.wrap(function(re){for(;;)switch(re.prev=re.next){case 0:w=Z,D=oe,B=0;case 3:if(!(B<Object(g.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){re.next=33;break}if(!Q){re.next=6;break}return re.abrupt("return");case 6:return de=q[B%q.length],le=r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(de+"/api/v1"):"https://".concat(de,"/api/v1"),re.prev=8,re.delegateYield(p.a.mark(function ge(){var o;return p.a.wrap(function(pe){for(;;)switch(pe.prev=pe.next){case 0:return r.proxyServer,pe.next=3,t(le,r,v,M);case 3:if(o=pe.sent,!Q){pe.next=6;break}return pe.abrupt("return",{v:void 0});case 6:Q=!0,setTimeout(function(){i.default.debug("Get UserAccount Successfully",o),w(o)},0);case 8:case"end":return pe.stop()}},ge)})(),"t0",10);case 10:if(ce=re.t0,d()(ce)!=="object"){re.next=13;break}return re.abrupt("return",ce.v);case 13:re.next=30;break;case 15:if(re.prev=15,re.t1=re.catch(8),!Q){re.next=19;break}return re.abrupt("return");case 19:if(!re.t1.retryable){re.next=27;break}return(z=Math.ceil(z*Object(g.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(g.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(z=Object(g.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),i.default.error("".concat(re.t1.info," ").concat(re.t1.url," Will Fetch User Account in ").concat(z/1e3," seconds")),re.next=25,new Promise(function(ge){setTimeout(ge,z)});case 25:re.next=30;break;case 27:i.default.error("Get UserAccount Error: ".concat(re.t1.info," ").concat(re.t1.url),re.t1.error),Q=!0,D(re.t1.error);case 30:B++,re.next=3;break;case 33:case"end":return re.stop()}},Y,null,[[8,15]])}));return function(Y,Z){return ee.apply(this,arguments)}}());return x.cancel=function(){Q||(Q=!0,D({info:"Request Cancelled",retryable:!1}))},x.isFinished=function(){return Q},x}},function(c,O,y){var m=this&&this.__spreadArrays||function(){for(var A=0,k=0,S=arguments.length;k<S;k++)A+=arguments[k].length;var f=Array(A),C=0;for(k=0;k<S;k++)for(var I=arguments[k],P=0,T=I.length;P<T;P++,C++)f[C]=I[P];return f},d=this&&this.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(O,"__esModule",{value:!0});var E,p,b=d(y(0));(function(A){A.CHINA="CHINA",A.ASIA="ASIA",A.NORTH_AMERICA="NORTH_AMERICA",A.EUROPE="EUROPE",A.JAPAN="JAPAN",A.INDIA="INDIA",A.OCEANIA="OCEANIA",A.SOUTH_AMERICA="SOUTH_AMERICA",A.AFRICA="AFRICA",A.OVERSEA="OVERSEA",A.GLOBAL="GLOBAL"})(E||(E={})),O.AREAS=E,function(A){A.CHINA="CN",A.ASIA="AS",A.NORTH_AMERICA="NA",A.EUROPE="EU",A.JAPAN="JP",A.INDIA="IN",A.OCEANIA="OC",A.SOUTH_AMERICA="SA",A.AFRICA="AF",A.OVERSEA="OVERSEA",A.GLOBAL="GLOBAL"}(p||(p={}));var s={ASIA:{CODE:p.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:p.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:p.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:p.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:p.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:p.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],NGINX:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:p.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],NGINX:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:p.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:p.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:p.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};O.AREA_DOMAIN_MAP=s;var g={GLOBAL:{ASIA:[E.CHINA,E.JAPAN,E.INDIA],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},i=Object.keys(g[E.GLOBAL]),a=[E.CHINA,E.NORTH_AMERICA,E.EUROPE,E.ASIA,E.JAPAN,E.INDIA,E.OCEANIA,E.SOUTH_AMERICA,E.AFRICA],l=function(A,k){var S,f=[];if(typeof A=="string"&&(A=[A]),k&&!A.includes(E.GLOBAL)&&(f=A),k||(f=A),k&&A.includes(E.GLOBAL)){var C=[E.GLOBAL,E.OVERSEA],I=Object.keys(s);if(k===E.GLOBAL)throw new Error("Can not set excludedArea to 'GLOBAL'");if(k===E.CHINA)f=[E.OVERSEA];else if(S=k,i.includes(S)){var P=function(G){return G===void 0&&(G=""),g[E.GLOBAL][G]||[]}(k),T=m(C,[k],P);f=I.filter(function(G){return!T.includes(G)})}else if(function(G){var H=!1;return i.forEach(function(V){g.GLOBAL[V].includes(G)&&(H=!0)}),H}(k)){var F=function(G){G===void 0&&(G="");var H="";return i.forEach(function(V){g.GLOBAL[V].includes(G)&&(H=V)}),H}(k),J=m(C,[F,k]);f=I.filter(function(G){return!J.includes(G)})}else f=A;f=function(G){var H=[];return a.forEach(function(V){G.includes(V)&&H.push(V)}),H.concat(G.filter(function(V){return!a.includes(V)}))}(f)}return f};O.getAreaCodeByConfig=function(A){var k=A.areaCode,S=A.excludedArea;return S?l(k,S):k},s.CHINA={CODE:p.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]},O.getAreaCodeByWebCS=function(A){for(var k=Object.keys(s),S=0;S<k.length;S++){var f=k[S],C=s[f];if(C.WEBCS_DOMAIN.includes(A)||C.WEBCS_DOMAIN_BACKUP_LIST.includes(A))return C.CODE===p.OVERSEA?p.ASIA+","+p.EUROPE+","+p.AFRICA+","+p.NORTH_AMERICA+","+p.SOUTH_AMERICA+","+p.OCEANIA:C.CODE}},O.getAreaCodeByArea=function(A){return A===E.OVERSEA?p.ASIA+","+p.EUROPE+","+p.AFRICA+","+p.NORTH_AMERICA+","+p.SOUTH_AMERICA+","+p.OCEANIA:p[A]},O.getAreaDomainConfig=function(A){var k={WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],NGINX:[]};return A.map(function(S){var f=s[S];if(f){var C=Object.keys(f);C?C.map(function(I){I!=="CODE"&&(k[I]=k[I].concat(f[I]))}):b.default.info(S+" is not exist")}else b.default.info(S+" is not exist")}),k}},function(c,O,y){y.d(O,"a",function(){return n}),y.d(O,"b",function(){return L});var m=y(7),d=y.n(m),E=y(4),p=y(8),b=function(h){var t=Object(p.b)(h);return t.url=".",t},s=y(0),g=y(15),i=y(5),a=y(2),l=y(1),A=0,k=function(h){var t=b({});t.id=h.id,t.playerId=A++,t.destroyed=!1,t.fit=h.options&&h.options.fit,t.fit!=="contain"&&t.fit!=="cover"&&(t.fit=null),t.url=h.url,t.stream=h.stream.stream,t.peerVideoReady=!1,t.isFreeze=!1,t.freezeTimeCounterList=[],t.freezeCount=0,t.lastFreezeCount=0,t.lastTimeupdateTime=0,t.elementID=h.elementID,t.setAudioOutput=function(le,ce,re){var ge=t.video||t.audio;return ge?ge.setSinkId?void ge.setSinkId(le).then(function(){return s.default.debug("["+t.id+"] "+"video ".concat(t.id," setAudioOutput ").concat(le," SUCCESS")),ge==t.video&&t.audio?t.audio.setSinkId(le):Promise.resolve()}).then(function(){return s.default.debug("["+t.id+"] "+"audio ".concat(t.id," setAudioOutput ").concat(le," SUCCESS")),ce&&ce()}).catch(function(o){return s.default.error("["+t.id+"] VideoPlayer.setAudioOutput",o),re&&re(o)}):(s.default.error("["+t.id+"] ",i.default.WEB_API_NOT_SUPPORTED),re&&re(i.default.WEB_API_NOT_SUPPORTED)):(s.default.error("["+t.id+"] ",i.default.PLAYER_NOT_FOUND),re&&re(i.default.PLAYER_NOT_FOUND))},t.destroy=function(){s.default.debug("[".concat(t.id,"] destroy ").concat(h.stream.local?"local":"remote"," Player ").concat(t.id)),Object(g.setSrcObject)(t.video,null),Object(g.setSrcObject)(t.audio,null),t.video.load(),t.audio.load(),t.video.pause(),t.video.remove(),t.audio.remove(),t.freezeCheckInterval&&clearInterval(t.freezeCheckInterval),t.destroyed=!0,delete t.resizer,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.div.remove()&&t.parentNode.removeChild(t.div),["video","audio"].forEach(function(le){t[le];var ce=v[le];clearTimeout(ce.playDeferTimeout),ce.formerMediaState=null;var re={playerId:t.playerId,stateId:ce.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};v[le]=re;var ge={type:"player-status-change",playerId:t.playerId,mediaType:le,status:re.status,reason:re.reason,isErrorState:!1,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change Triggered by destroy()"),ge),h.stream.dispatchEvent(ge),l.report.reportApiInvoke(h.stream.sid,{name:"Stream.playerStatusChange",options:ge,tag:"tracer"})()})},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),h.stream.video?t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),h.stream.local&&!h.stream.screen?h.stream.mirror?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(t.fit||"cover",";")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):h.stream.video?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):h.stream.screen?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"contain")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(t.fit||"cover"));var j={autoplay:!0,muted:!!h.stream.local||!(!E.isSafari()&&E.getBrowserOS()!=="iOS")&&"video_element_muted",playsinline:!0,controls:!1,volume:null},r=d()({},j,h.options);r.muted!==!0||r.volume||(r.volume=0),t.video.setAttribute("autoplay",""),t.video.setAttribute("muted",""),t.video.muted=!0,t.video.autoplay=!0,r.playsinline&&t.video.setAttribute("playsinline",""),r.controls&&t.video.setAttribute("controls",""),r.contains&&(t.video.controls=!0),Number.isFinite(r.volume)&&(t.video.volume=r.volume),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),r.muted===!0&&t.audio.setAttribute("muted",""),r.muted===!0&&(t.audio.muted=!0),r.playsinline&&t.audio.setAttribute("playsinline",""),Number.isFinite(r.volume)&&(t.audio.volume=r.volume),t.elementID!==void 0?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode;var v={video:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};t.mediaElemExists=function(le){for(var ce=le,re=0;re<Object(a.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&ce;re++)ce=ce.parentNode;return!!ce};var M=function(le){return t.mediaElemExists(le)?le.paused?"paused":"play":"aborted"},B=function(le,ce,re){var ge=M(le),o=!0;return ge==="paused"?(ce==="audio"&&re.muted===!0&&(o=!1),re.autoplay||(o=!1)):ge==="play"?ce==="video"?o=!1:re.muted===!0?le.muted&&(o=!1):le.muted||(o=!1):ge==="aborted"&&(o=!1),o},q=function(le){var ce,re=this;if(re===t.video?ce="video":re===t.audio&&(ce="audio"),ce){if(le.type||s.default.error("[".concat(t.id,"] Unexpected evt"),le),ce==="video"&&re.muted&&re.paused)return s.default.debug("[".concat(t.id,"] auto resume video element")),void re.play();var ge=M(re);clearTimeout(v[ce].playDeferTimeout),v[ce].playDeferTimeout=setTimeout(function(){v[ce].playDeferTimeout=null;var o=v[ce],pe=M(re);if(ge===pe){var te={playerId:t.playerId,stateId:o.stateId+1,playDeferTimeout:null,error:B(re,ce,r),status:M(re),reason:le.type,updatedAt:Date.now()};if(o.status!==te.status){v[ce]=te;var N={type:"player-status-change",playerId:t.playerId,mediaType:ce,status:te.status,reason:te.reason,isErrorState:te.error,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change"),N),h.stream.dispatchEvent(N),l.report.reportApiInvoke(h.stream.sid,{name:"Stream.playerStatusChange",options:N,tag:"tracer"})()}}else s.default.debug("[".concat(t.id,"] Status Change after event Triggered.")+"Stream ".concat(t.id," PlayerId ").concat(t.playerId," mediaType ").concat(ce," Status ").concat(ge,"=>").concat(pe))},Object(a.getParameter)("PLAYER_STATE_DEFER"))}else s.default.error("[".concat(t.id,"] Unknown media element"),re)};t.video.addEventListener("playing",function(le){(function ce(){t.video.videoWidth*t.video.videoHeight>4?s.default.debug("["+t.id+"] video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(ce,50)})()});var Q=0,z=0,w=0;t.freezeCheckInterval=setInterval(function(){Date.now()-t.lastTimeupdateTime>500&&t.peerVideoReady?(t.isFreeze=!0,t.freezeCount+=1):t.isFreeze=!1},500),t.video.addEventListener("playing",q),t.video.addEventListener("canplay",q),t.video.addEventListener("abort",q),t.video.addEventListener("onerror",q),t.video.addEventListener("suspend",q),t.video.addEventListener("stalled",q),t.video.addEventListener("pause",q),t.audio.addEventListener("playing",q),t.audio.addEventListener("canplay",q),t.audio.addEventListener("abort",q),t.audio.addEventListener("onerror",q),t.audio.addEventListener("suspend",q),t.audio.addEventListener("stalled",q),t.audio.addEventListener("pause",q);var D=t.audio,x="audio";if(h.stream.hasVideo()||h.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),E.isEdge()?t.video.srcObject=h.stream.stream:(Object(g.attachMediaStream)(t.video,h.stream.stream),Object(g.attachMediaStream)(t.audio,h.stream.stream)),t.video.addEventListener("timeupdate",function(){var le=Date.now();if((Q+=1)<10)t.lastTimeupdateTime=le;else for(le-t.lastTimeupdateTime>500&&(t.peerVideoReady?z+=le-t.lastTimeupdateTime:t.peerVideoReady=!0),w+=le-t.lastTimeupdateTime,t.lastTimeupdateTime=le;w>=6e3;)w-=6e3,t.freezeTimeCounterList.push(Math.min(6e3,z)),z-=6e3,z=Math.max(z,0)});else{r.muted!==!1&&r.muted!=="video_element_muted"||(t.video.removeAttribute("muted"),t.video.muted=!1),t.video.removeAttribute("autoplay"),t.video.autoplay=!1,t.div.appendChild(t.video),D=t.video,x="video";var ee=v.audio,Y={playerId:t.playerId,stateId:ee.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"audioonly",updatedAt:Date.now()};v.audio=Y;var Z={type:"player-status-change",playerId:t.playerId,mediaType:"audio",status:Y.status,reason:Y.reason,isErrorState:Y.error,streamId:t.id};if(s.default.debug("[".concat(t.id,"] Media Player Status Change"),Z),Promise.resolve().then(function(){return h.stream.dispatchEvent(Z)}),l.report.reportApiInvoke(h.stream.sid,{name:"Stream.playerStatusChange",options:Z,tag:"tracer"})(),window.MediaStream&&(E.isSafari()||E.getBrowserOS()==="iOS")){var oe=new MediaStream(h.stream.stream.getAudioTracks());Object(g.setSrcObject)(t.video,oe)}else Object(g.setSrcObject)(t.video,h.stream.stream)}if(r.autoplay&&D){var de=D.play();de&&de.catch&&de.catch(function(le){if(!t.destroyed&&D){var ce=v[x],re={playerId:t.playerId,stateId:ce.stateId+1,playDeferTimeout:null,error:B(D,x,r),status:M(D),reason:"error",updatedAt:Date.now()};if(ce.status!==re.status){s.default.debug("[".concat(t.id,"] Player ").concat(t.playerId," Status Changed Detected by promise error: ").concat(ce.status,"=>").concat(re.status),le),v[x]=re;var ge={type:"player-status-change",playerId:t.playerId,mediaType:x,status:re.status,reason:re.reason,isErrorState:re.error,streamId:t.id};s.default.debug("[".concat(t.id,"] Media Player Status Change"),ge),h.stream.dispatchEvent(ge),l.report.reportApiInvoke(h.stream.sid,{name:"Stream.playerStatusChange",options:ge,tag:"tracer"})()}}})}return t.setAudioVolume=function(le){var ce=parseInt(le)/100;isFinite(ce)&&(ce<0?ce=0:ce>1&&(ce=1),t.video&&(t.video.volume=ce),t.audio&&(t.audio.volume=ce))},t},S=y(23),f=y(10),C=y(6),I=y(19),P=y(3),T=y(25),F=y(16),J=y(11),G=y.n(J),H=function(h){Object(P.checkValidString)(h,"profileName"),(h=h.toLowerCase()).indexOf("_")===-1&&(h+="_1"),Object(P.checkValidEnum)(h,"profileName",Object.keys(a.SUPPORT_RESOLUTION_LIST));var t=a.SUPPORT_RESOLUTION_LIST[h];t||(h=Object(a.getParameter)("DEFAULT_PROFILE"),t=a.SUPPORT_RESOLUTION_LIST[h]);var j={profileName:h,video:{width:t[0],height:t[1]},attributes:{resolution:"".concat(t[0],"x").concat(t[1]),minFrameRate:t[2],maxFrameRate:t[3],minVideoBW:t[4],maxVideoBW:t[5]}};return t[2]&&(j.video.frameRate=t[2]),t[6]&&t[7]&&(j.screen={width:t[0],height:t[1],frameRate:{min:t[6],max:t[7]}}),j},V=function(h){return Object.keys(a.SUPPORT_RESOLUTION_LIST).filter(function(t){var j=a.SUPPORT_RESOLUTION_LIST[t],r=["width","height","frameRate"];for(var v in r){var M=r[v];if(h[M]&&j[v]&&(typeof h[M].max=="number"&&h[M].max<j[v]||typeof h[M].min=="number"&&h[M].min>j[v]))return!1}return!0}).reverse()},_=function(h){var t=a.AUDIO_PROFILE_SETTINGS[h]||a.AUDIO_PROFILE_SETTINGS.default;return{highQuality:t[0],stereo:t[1],speech:t[2],lowQuality:t[3]}},n=function(h){var t=Object(p.b)();if(t.params=d()({},h),t.stream=h.stream,t.url=h.url,t.onClose=void 0,t.local=!1,t.videoSource=h.videoSource,t.audioSource=h.audioSource,h.video=!(!h.videoSource&&!h.video),t.video=h.video,h.audio=!(!h.audioSource&&!h.audio),t.audio=h.audio,t.screen=!!h.screen,t.screenAudio=!!h.screenAudio,t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=h.videoSize,t.player=void 0,t.audioLevelHelper=null,h.attributes=h.attributes||{},t.attributes=h.attributes,t.microphoneId=h.microphoneId,t.cameraId=h.cameraId,t.facingMode=h.facingMode,t.inSwitchDevice=!1,t.userMuteVideo=!1,t.userMuteAudio=!1,t.peerMuteVideo=!1,t.peerMuteAudio=!1,t.lowStream=null,t.videoWidth=0,t.videoHeight=0,t.streamId=h.streamID,t.userId=null,t.uintId=h.uintUID||null,t.mirror=h.mirror!==!1,t.DTX=h.audioProcessing&&h.audioProcessing.DTX,t.audioProcessing=h.audioProcessing,t.optimizationMode=h.optimizationMode,t.highQuality=!1,t.stereo=!1,t.speech=!1,t.screen||delete t.screen,!(t.videoSize===void 0||t.videoSize instanceof Array&&t.videoSize.length===4))throw Error("Invalid Video Size");function j(){var r={};t.getVideoTrack()===this?(s.default.debug("Video Track Ended"),r.type="videoTrackEnded",r.track=this):t.getAudioTrack()===this?(s.default.debug("Audio Track Ended"),r.type="audioTrackEnded",r.track=this):s.default.debug("Detached Track ended",this.kind,this.label,this),r.type&&t.dispatchEvent(r)}return t.videoSize=[640,480,640,480],h.local!==void 0&&h.local!==!0||(t.local=!0),t.initialized=!t.local,t._streamInitID=null,function(r){r.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},r._initSoundIfNotExists=function(v,M){r.audioMixing.sounds[v]||(r.audioMixing.sounds[v]={soundId:v,state:"IDLE",muted:r.userMuteAudio,filePath:M,volume:r.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},r._initSoundIfNotExists(-1),r.loadAudioBuffer=function(v,M,B){var q=l.report.reportApiInvoke(r.sid,{callback:B,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Object(P.checkValidString)(M,"url",1,1024,!1),Object(P.checkValidString)(v,"id",1,1024,!1);var Q=function(w){s.default.error("[".concat(r.streamId,"] loadAudioBuffer Failed: ")+w),q(i.default.LOAD_AUDIO_FAILED)},z=new XMLHttpRequest;z.open("GET",M,!0),z.responseType="arraybuffer",z.onload=function(){if(z.status>400)Q("".concat(z.status," ").concat(z.statusText));else{var w=z.response;r.audioMixing.audioContextInited||r._initAudioContext(),r.audioMixing.ctx.decodeAudioData(w,function(D){r.audioMixing.buffer[v]=D,q(null)},function(D){s.default.error("[".concat(r.streamId,"] decodeAudioData Failed: "),D),q(D)})}},z.onerror=function(){return Q("load error")},z.ontimeout=function(){return Q("timeout")},z.send()},r.createAudioBufferSource=function(v){var M=l.report.reportApiInvoke(r.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(r.audioMixing.buffer[v.id]){var B=r.audioMixing.buffer[v.id],q=r.audioMixing.ctx.createBufferSource();q.buffer=B;var Q=r.audioMixing.ctx.createGain();if(q.connect(Q),Q.connect(r.audioMixing.mediaStreamDest),q.gainNode=Q,v.loop)q.loop=!0,q.start(0,v.playTime/1e3);else if(v.cycle>1)if(Object(E.isChrome)()){q.loop=!0;var z=v.cycle*B.duration*1e3-(v.playTime||0);q.start(0,v.playTime/1e3,z/1e3)}else s.default.warning("[".concat(r.streamId,"] Cycle Param is ignored by current browser")),q.start(0,v.playTime/1e3);else q.start(0,v.playTime/1e3);var w=r.audioMixing.sounds[v.soundId];return w.source=q,r._flushAudioMixingMuteStatus(),q.addEventListener("ended",function(){q===w.source&&r.dispatchEvent({type:"audioSourceEnded",soundId:v.soundId,source:q,sound:w})}),M(),q}var D="AUDIOBUFFER_NOT_FOUND";return s.default.error("[".concat(r.streamId,"] "),D,v.id),M(!1),!1},r.on("audioSourceEnded",function(v){var M=v.source,B=v.sound;B&&B.state===r.audioMixing.states.BUSY&&!B.pauseAt&&(B.state=r.audioMixing.states.IDLE,B.startAt=null,B.startOffset=null,B.resumeAt=null,B.resumeOffset=null,M.gainNode&&M.gainNode.disconnect&&M.gainNode.disconnect(),M.buffer=null,r.audioMixing.mediaStreamSource.connect(r.audioMixing.mediaStreamDest))}),r.clearAudioBufferSource=function(){r.audioBufferSource.forEach(function(v){v.stop()})},r._isSoundExists=function(v){return!!r.audioMixing.sounds[v.soundId]||(s.default.error("SoundId not exists. #".concat(v.soundId)),!1)},r._initAudioContext=function(){if(r.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!r.stream)throw new Error("Failed to init audio context. Local Stream not initialized");r.audioMixing.ctx=Object(T.a)(),r.audioMixing.mediaStreamSource=r.audioMixing.ctx.createMediaStreamSource(r.stream),r.audioMixing.mediaStreamDest=r.audioMixing.ctx.createMediaStreamDestination(),r.audioMixing.mediaStreamSource.connect(r.audioMixing.mediaStreamDest);var v=r.stream.getVideoTracks()[0];if(v&&r.audioMixing.mediaStreamDest.stream.addTrack(v),r._originStream=r.stream,r._isAudioMuted()?(r._unmuteAudio(),r.stream=r.audioMixing.mediaStreamDest.stream,r._muteAudio()):r.stream=r.audioMixing.mediaStreamDest.stream,r.audioLevelHelper=null,r.pc&&r.pc.peerConnection&&r.pc.peerConnection){var M=(r.pc.peerConnection&&r.pc.peerConnection.getSenders()).find(function(q){return q&&q.track&&q.track.kind=="audio"}),B=r.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];M&&M.replaceTrack&&B&&M.replaceTrack(B)}r.audioMixing.audioContextInited=!0},r._cleanupAudioMixing=function(){if(r.audioMixing.audioContextInited){for(var v in r.audioMixing.sounds){var M=r.audioMixing.sounds[v];M.state!==r.audioMixing.states.BUSY&&M.state!==r.audioMixing.states.PAUSED||r._stopOneEffect({soundId:v})}r.audioLevelHelper=null,r.audioMixing.audioContextInited=!1}},r._reloadInEarMonitoringMode=function(v){if(v){if(!r.audioMixing.inEarMonitoringModes[v])return s.default.error("[".concat(r.streamId,"] Invalid InEarMonitoringMode ").concat(v));r.audioMixing.inEarMonitoring=v}switch(r.audioMixing.audioContextInited||r._initAudioContext(),r.audioMixing.inEarMonitoring){case r.audioMixing.inEarMonitoringModes.FILE:r.audioMixing.mediaStreamSource.connectedToDestination&&(r.audioMixing.mediaStreamSource.disconnect(r.audioMixing.ctx.destination),r.audioMixing.mediaStreamSource.connectedToDestination=!1);case r.audioMixing.inEarMonitoringModes.ALL:for(var M in r.audioMixing.sounds){var B=r.audioMixing.sounds[M];B&&B.source&&!B.source.connectedToDestination&&(B.source.gainNode.connect(r.audioMixing.ctx.destination),B.source.connectedToDestination=!0)}}switch(r.audioMixing.inEarMonitoring){case r.audioMixing.inEarMonitoringModes.MICROPHONE:r.audioMixing.source.forEach(function(q){q.connectedToDestination&&(q.gainNode.disconnect(r.audioMixing.ctx.destination),q.connectedToDestination=!1)});case r.audioMixing.inEarMonitoringModes.ALL:r.audioMixing.mediaStreamSource.connectedToDestination||(r.audioMixing.mediaStreamSource.connect(r.audioMixing.ctx.destination),r.audioMixing.mediaStreamSource.connectedToDestination=!0)}},r._startAudioMixingBufferSource=function(v){r.audioMixing.audioContextInited||r._initAudioContext();var M={soundId:v.soundId,id:v.filePath,loop:v.loop,cycle:v.cycle,playTime:v.playTime||0},B=v.replace,q=r.createAudioBufferSource(M);return q.sound=r.audioMixing.sounds[v.soundId],q?(q.addEventListener("ended",r._audioMixingFinishedListener,{once:!0}),r._reloadInEarMonitoringMode(),B&&r.audioMixing.mediaStreamSource.disconnect(r.audioMixing.mediaStreamDest),q):null},r._stopAudioMixingBufferSource=function(v){var M=r.audioMixing.sounds[v.soundId].source;return M?(M.removeEventListener("ended",r._audioMixingFinishedListener),r.audioMixing.mediaStreamSource.connect(r.audioMixing.mediaStreamDest),M.stop(),M.gainNode&&M.gainNode.disconnect&&M.gainNode.disconnect(),M.buffer=null,M):null},r._flushAudioMixingMuteStatus=function(v){for(var M in r.audioMixing.sounds){var B=r.audioMixing.sounds[M];B&&(v!==void 0&&(B.muted=!!v),B.source&&(B.muted?B.source.gainNode.gain.value=0:B.source.gainNode.gain.value=B.volume/100))}},r._handleAudioMixingInvalidStateError=function(v,M,B){var q=r.audioMixing.sounds[M.soundId],Q=M.soundId===-1?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";s.default.error("[".concat(r.streamId,"] Cannot ").concat(v,": ").concat(Q,", state is ").concat(q.state)),B&&B(Q)},r._handleAudioMixingNoSourceError=function(v,M,B){r.audioMixing.sounds[M.soundId].state=r.audioMixing.states.IDLE;var q=M.soundId===-1?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";s.default.error("[".concat(r.streamId,"] Cannot ").concat(v,": ").concat(q)),B&&B(q)},r._getOneEffectStates=function(v){var M=r.audioMixing.sounds[v.soundId];return function(){return M?{state:M.state,startAt:M.startAt,resumeAt:M.resumeAt,pauseOffset:M.pauseOffset,pauseAt:M.pauseAt,resumeOffset:M.resumeOffset,stopAt:M.stopAt,duration:r._getOneEffectDuration(v),position:r._getOneEffectCurrentPosition(v)}:{}}},r._audioMixingFinishedListener=function(){var v=this.sound;v.state===r.audioMixing.states.IDLE&&r.audioMixing.buffer[v.options.filePath]&&!v.options.cacheResource&&(s.default.debug("Recycled buffer ".concat(v.options.filePath)),delete r.audioMixing.buffer[v.options.filePath]),v.soundId===-1&&r.dispatchEvent({type:"audioMixingFinished"})},r._playOneEffect=function(v,M){Object(P.checkValidObject)(v,"options");var B=v.soundId,q=(v.filePath,v.cacheResource);if(v.cycle,v.loop,v.playTime,v.replace,Object(E.isSafari)()&&Object(E.getBrowserVersion)()<12){var Q="BROWSER_NOT_SUPPORT";return s.default.error("[".concat(r.streamId,"] Cannot _playOneEffect: "),Q),M(Q)}r.audioMixing.audioContextInited||r._initAudioContext(),r._initSoundIfNotExists(B);var z=r.audioMixing.sounds[B];if(z.state===r.audioMixing.states.IDLE){if(v.cycle!==void 0&&!v.cycle>0)return Q="Invalid Parmeter cycle: "+v.cycle,s.default.error("[".concat(r.streamId,"] ").concat(B),Q),M(Q);if(Object(P.isEmpty)(q)&&(v.cacheResource=!0),z.state=r.audioMixing.states.STARTING,z.options=v,r.audioMixing.buffer[v.filePath]){var w=r._startAudioMixingBufferSource(v);if(w)return z.source=w,z.startAt=Date.now(),z.resumeAt=null,z.pauseOffset=null,z.pauseAt=null,z.resumeOffset=null,z.stopAt=null,z.startOffset=v.playTime||0,z.state=r.audioMixing.states.BUSY,r._flushAudioMixingMuteStatus(),M(null);z.state=r.audioMixing.states.IDLE;var D="CREATE_BUFFERSOURCE_FAILED";if(M)return M(D);s.default.error("[".concat(r.streamId,"] "),D)}else r.loadAudioBuffer(v.filePath,v.filePath,function(x){if(x)z.state=r.audioMixing.states.IDLE,M?M(x):s.default.error("[".concat(r.streamId,"] "),x);else{var ee=r._startAudioMixingBufferSource(v);if(ee)return z.source=ee,z.startAt=Date.now(),z.resumeAt=null,z.pauseOffset=null,z.pauseAt=null,z.resumeOffset=null,z.stopAt=null,z.startOffset=v.playTime||0,z.state=r.audioMixing.states.BUSY,r._flushAudioMixingMuteStatus(),M(null);if(z.state=r.audioMixing.states.IDLE,x="CREATE_BUFFERSOURCE_FAILED",M)return M(x);s.default.error("[".concat(r.streamId,"] "),x)}})}else r._handleAudioMixingInvalidStateError("_playEffect",v,M)},r._stopOneEffect=function(v,M){var B=r.audioMixing.sounds[v.soundId];return r._isSoundExists(v)?B.state===r.audioMixing.states.BUSY||B.state===r.audioMixing.states.PAUSED?(r._stopAudioMixingBufferSource(v),B.stopAt=Date.now(),B.state=r.audioMixing.states.IDLE,r.audioMixing.buffer[B.options.filePath]&&!B.options.cacheResource&&(s.default.debug("Recycled buffer ".concat(B.options.filePath)),delete r.audioMixing.buffer[B.options.filePath]),void(M&&M(null))):void r._handleAudioMixingInvalidStateError("_stopOneEffect",v,M):M("SOUND_NOT_EXISTS")},r._pauseOneEffect=function(v,M){var B=r.audioMixing.sounds[v.soundId];if(B.state===r.audioMixing.states.BUSY)return r._stopAudioMixingBufferSource(v)?(B.pauseAt=Date.now(),B.state=r.audioMixing.states.PAUSED,B.resumeAt?B.pauseOffset=B.pauseAt-B.resumeAt+B.resumeOffset:B.pauseOffset=B.pauseAt-B.startAt+B.startOffset,M&&M(null)):void r._handleAudioMixingNoSourceError("_pauseOneEffect",v,M);r._handleAudioMixingInvalidStateError("_pauseOneEffect",v,M)},r._resumeOneEffect=function(v,M){var B=r.audioMixing.sounds[v.soundId];if(B.state===r.audioMixing.states.PAUSED){var q={soundId:v.soundId,filePath:B.options.filePath,cycle:B.options.cycle,loop:B.options.loop,playTime:B.pauseOffset,replace:B.options.replace},Q=r._startAudioMixingBufferSource(q);if(!Q){var z="CREATE_BUFFERSOURCE_FAILED";return M(z),void s.default.error("[".concat(r.streamId,"] "),z)}B.source=Q,B.resumeAt=Date.now(),B.resumeOffset=B.pauseOffset,B.state=r.audioMixing.states.BUSY,B.pauseAt=null,B.pauseOffset=null,M(null)}else r._handleAudioMixingInvalidStateError("_resumeOneEffect",v,M)},r._getOneEffectDuration=function(v){var M=r.audioMixing.sounds[v.soundId];return M.options&&M.options.filePath&&r.audioMixing.buffer[M.options.filePath]?1e3*r.audioMixing.buffer[M.options.filePath].duration:null},r._getOneEffectCurrentPosition=function(v,M){var B=r.audioMixing.sounds[v.soundId];return B.state===r.audioMixing.states.PAUSED?B.pauseOffset%r._getOneEffectDuration(v):B.state===r.audioMixing.states.BUSY?B.resumeAt?(Date.now()-B.resumeAt+B.resumeOffset)%r._getOneEffectDuration(v):(Date.now()-B.startAt+B.startOffset)%r._getOneEffectDuration(v):void(M&&r._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",v))},r._setOneEffectPosition=function(v,M,B){var q=r.audioMixing.sounds[v.soundId];if(q.state===r.audioMixing.states.BUSY){if(!r._stopAudioMixingBufferSource(v))return void r._handleAudioMixingNoSourceError("_setOneEffectPosition",v,B);var Q={soundId:v.soundId,filePath:q.options.filePath,loop:q.options.loop,cycle:q.options.cycle,playTime:M},z=r._startAudioMixingBufferSource(Q);if(!z){var w="CREATE_BUFFERSOURCE_FAILED";return B&&B(w),void s.default.error("[".concat(r.streamId,"] "),w)}q.source=z,q.startAt=Date.now(),q.startOffset=M,q.resumeAt=null,q.resumeOffset=null,q.pauseOffset=null,q.pauseAt=null}else{if(q.state!==r.audioMixing.states.PAUSED)return void r._handleAudioMixingInvalidStateError("_setOneEffectPosition",v,B);q.pauseOffset=M}B&&B(null)},r.startAudioMixing=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:function(Y){if(Y)return M&&M(Y);r.dispatchEvent({type:"audioMixingPlayed"}),M&&M(null)},getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:v});Object(P.checkValidObject)(v,"options");var q=v.filePath,Q=v.cacheResource,z=v.cycle,w=v.loop,D=v.playTime,x=v.replace;Object(P.checkValidString)(q,"filePath",1,Object(a.getParameter)("FILEPATH_LENMAX"),!1),Object(P.checkValidNumber)(D,"playTime",0,1e8),!Object(P.isEmpty)(z)&&Object(P.checkValidNumber)(z,"cycle"),!Object(P.isEmpty)(w)&&Object(P.checkValidBoolean)(w,"loop"),!Object(P.isEmpty)(x)&&Object(P.checkValidBoolean)(x,"replace"),!Object(P.isEmpty)(Q)&&Object(P.checkValidBoolean)(Q,"cacheResource");var ee=d()({soundId:-1},v);r._playOneEffect(ee,B)},r.stopAudioMixing=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:v,getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});r._stopOneEffect({soundId:-1},M)},r.pauseAudioMixing=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:v,getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return r._pauseOneEffect({soundId:-1},M)},r.resumeAudioMixing=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:function(B,q){if(B)return v&&v(B);r.dispatchEvent({type:"audioMixingPlayed"}),v&&v(null)},getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});r._resumeOneEffect({soundId:-1},M)},r.adjustAudioMixingVolume=function(v){var M=l.report.reportApiInvoke(r.sid,{getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});Object(P.checkValidNumber)(v,"volume",0,100),r.audioMixing.sounds[-1].volume=v,r._flushAudioMixingMuteStatus(),M()},r.getAudioMixingDuration=function(){var v=l.report.reportApiInvoke(r.sid,{getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),M=r._getOneEffectDuration({soundId:-1});return v(null,M),M},r.getAudioMixingCurrentPosition=function(){var v=l.report.reportApiInvoke(r.sid,{getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),M=r._getOneEffectCurrentPosition({soundId:-1},!0);return v(null,M),M},r.setAudioMixingPosition=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:M,options:arguments,tag:"tracer",getStates:r._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});Object(P.checkValidNumber)(v,"position",0,1e8),r._setOneEffectPosition({soundId:-1},v,B)},r.playEffect=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:function(w){if(w)return M&&M(w);r.dispatchEvent({type:"effectPlayed"}),M&&M(null)},name:"Stream.playEffect",options:v});Object(P.checkValidObject)(v,"options");var q=v.soundId,Q=v.filePath,z=v.cycle;Object(P.checkValidNumber)(q,"soundId",1,1e4),Object(P.checkValidString)(Q,"filePath",0,Object(a.getParameter)("FILEPATH_LENMAX"),!1),!Object(P.isEmpty)(z)&&Object(P.checkValidNumber)(z,"cycle"),r._playOneEffect(v,B)},r.stopEffect=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:M,getStates:r._getOneEffectStates({soundId:v}),name:"Stream.stopEffect"});Object(P.checkValidNumber)(v,"soundId",1,1e4),r._stopOneEffect({soundId:v},B)},r.stopAllEffects=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:v,name:"Stream.stopAllEffect"}),B=!1,q=0,Q=0,z=function(x){B||(x?(M(x),B=!0):q+=1,q===Q&&(M(null),B=!0))};for(var w in r.audioMixing.sounds){var D=r.audioMixing.sounds[w];D.soundId!==-1&&(D.state!==r.audioMixing.states.BUSY&&D.state!==r.audioMixing.states.PAUSED||(Q++,r._stopOneEffect({soundId:w},z)))}Q||M(null)},r.preloadEffect=function(v,M,B){var q=l.report.reportApiInvoke(r.sid,{callback:B,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});Object(P.checkValidNumber)(v,"soundId",1,1e4),Object(P.checkValidString)(M,"filePath",1,Object(a.getParameter)("FILEPATH_LENMAX"),!1),r._initSoundIfNotExists(v,M),r.audioMixing.buffer[M]?q(null):r.loadAudioBuffer(M,M,q)},r.unloadEffect=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:M,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});Object(P.checkValidNumber)(v,"soundId",1,1e4);var q=r.audioMixing.sounds[v];if(!q){var Q="SOUND_NOT_EXISTS";return s.default.error(Q,v),void B(Q)}var z=q.options?q.options.filePath:q.filePath;if(z)delete r.audioMixing.buffer[z],delete r.audioMixing.sounds[v],B(null);else{var w="SOUND_BUFFER_NOT_FOUND";s.default.error(w,v),B(w)}},r.pauseEffect=function(v,M){var B=l.report.reportApiInvoke(r.sid,{callback:M,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return r._pauseOneEffect({soundId:v},B)},r.pauseAllEffects=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:v,name:"Stream.pauseAllEffects"}),B=!1,q=0,Q=0,z=function(D){B||(D?(M(D),B=!0):q+=1,q===Q&&(M(null),B=!0))};for(var w in r.audioMixing.sounds)w!=="-1"&&r.audioMixing.sounds[w].state===r.audioMixing.states.BUSY&&(Q++,r._pauseOneEffect({soundId:w},z));Q||M(null)},r.resumeEffect=function(v,M){Object(P.checkValidNumber)(v,"soundId",1,1e4);var B=l.report.reportApiInvoke(r.sid,{callback:M,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return r._resumeOneEffect({soundId:v},B)},r.resumeAllEffects=function(v){var M=l.report.reportApiInvoke(r.sid,{callback:v,name:"Stream.resumeAllEffects"}),B=!1,q=0,Q=0,z=function(D){B||(D?(M(D),B=!0):q+=1,q===Q&&(M(null),B=!0))};for(var w in r.audioMixing.sounds)w!=="-1"&&r.audioMixing.sounds[w].state===r.audioMixing.states.PAUSED&&(Q++,r._resumeOneEffect({soundId:w},z));Q||M(null)},r.getEffectsVolume=function(){var v=[];for(var M in r.audioMixing.sounds){var B=r.audioMixing.sounds[M];B&&M!=="-1"&&v.push({soundId:parseInt(M),volume:B.volume})}return v},r.setEffectsVolume=function(v,M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:M});for(var q in Object(P.checkValidNumber)(v,"volume",0,100),r.audioMixing.defaultVolume=v,r.audioMixing.sounds){var Q=r.audioMixing.sounds[q];q!=="-1"&&(Q.volume=v)}r._flushAudioMixingMuteStatus(),B(null)},r.setVolumeOfEffect=function(v,M,B){var q=l.report.reportApiInvoke(r.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:B});Object(P.checkValidNumber)(v,"soundId",0,1e4),Object(P.checkValidNumber)(M,"volume",0,100),r._initSoundIfNotExists(v);var Q=r.audioMixing.sounds[v];Q.volume=M,r._flushAudioMixingMuteStatus(),q(null)}}(t),F.a.addVideoEffectCapability(t),function(r,v){r.videoConstraint={},v.cameraId&&(r.videoConstraint.deviceId={exact:v.cameraId}),v.facingMode&&(r.videoConstraint.facingMode=v.facingMode),r.videoSize&&(r.videoConstraint.width=r.videoSize[0],r.videoConstraint.height=r.videoSize[1]),Object(E.isLegacyChrome)()||(r.videoConstraint.frameRate=30),r.audioConstraint={},v.microphoneId&&(r.audioConstraint.deviceId={exact:v.microphoneId}),Object(E.isLegacyChrome)()||r.audioProcessing&&(r.audioProcessing.AGC!==void 0&&(Object(E.isFireFox)()?r.audioConstraint.autoGainControl=r.audioProcessing.AGC:Object(E.isChrome)()&&(r.audioConstraint.googAutoGainControl=r.audioProcessing.AGC,r.audioConstraint.googAutoGainControl2=r.audioProcessing.AGC)),r.audioProcessing.AEC!==void 0&&(r.audioConstraint.echoCancellation=r.audioProcessing.AEC),r.audioProcessing.ANS!==void 0&&(Object(E.isFireFox)()?r.audioConstraint.noiseSuppression=r.audioProcessing.ANS:Object(E.isChrome)()&&(r.audioConstraint.googNoiseSuppression=r.audioProcessing.ANS))),r.screenConstraint={},v.sourceId&&(r.screenConstraint.sourceId=v.sourceId),v.extensionId&&Object(E.isChrome)()?(r.screenConstraint.extensionId=v.extensionId,r.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:r.screenAttributes.width,maxHeight:r.screenAttributes.height,maxFrameRate:r.screenAttributes.maxFr,minFrameRate:r.screenAttributes.minFr}):(r.screenConstraint.mediaSource="screen",r.screenConstraint.width=r.screenAttributes.width,r.screenConstraint.height=r.screenAttributes.height,r.screenConstraint.frameRate={ideal:r.screenAttributes.maxFr,max:r.screenAttributes.maxFr}),v.mediaSource&&(r.screenConstraint.mediaSource=v.mediaSource),r.setVideoResolution=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(M instanceof Array)){var q=H(M+="");return q&&q.video?(r.videoConstraint=d()(r.videoConstraint,{width:{ideal:q.video.width},height:{ideal:q.video.height}}),v.attributes.resolution=q.attributes.resolution,(Q=r.stream&&r.stream.getVideoTracks&&r.stream.getVideoTracks()[0])&&Q.applyConstraints?(s.default.debug("setVideoResolution applyConstraints",r.videoConstraint),Q.applyConstraints(r.videoConstraint).then(B).catch(B)):B(),!0):(B("NO_PROFILE_".concat(M)),!1)}var Q,z=M[0],w=M[1];r.videoConstraint=d()(r.videoConstraint,{width:{ideal:z},height:{ideal:w}}),v.attributes.resolution="".concat(z,"x").concat(w),(Q=r.stream&&r.stream.getVideoTracks&&r.stream.getVideoTracks()[0])&&Q.applyConstraints?(s.default.debug("setVideoResolution applyConstraints",r.videoConstraint),F.a.disableVideoEffect(r).then(function(){return Q.applyConstraints(r.videoConstraint).then(B).catch(B)}).then(function(){return F.a.restoreVideoEffect(r)})):B()},r.setVideoFrameRate=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(E.isFireFox)())return B("FIREFOX_NOT_SUPPORTED"),!1;if(G()(M)==="object"&&M instanceof Array&&M.length>1){r.videoConstraint=d()(r.videoConstraint,{frameRate:M[0]}),r.attributes.minFrameRate=M[0],r.attributes.maxFrameRate=M[1];var q=r.stream&&r.stream.getVideoTracks&&r.stream.getVideoTracks()[0];return q&&q.applyConstraints?(s.default.debug("setVideoFrameRate applyConstraints",r.videoConstraint),q.applyConstraints(r.videoConstraint).then(B).catch(B)):B(),!0}return B("INVALID_PARAM_".concat(JSON.stringify(M))),!1},r.setVideoBitRate=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return G()(M)==="object"&&M instanceof Array&&M.length>1?(v.attributes.minVideoBW=M[0],v.attributes.maxVideoBW=M[1],r.connectionSpec&&(r.connectionSpec.minVideoBW=M[0],r.connectionSpec.maxVideoBW=M[1]),r.pc&&r.pc.renegotiate&&r.pc.renegotiate(),B(),!0):(B("INVALID_PARAM_".concat(JSON.stringify(M))),!1)},r.setScreenBitRate=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return G()(M)==="object"&&M instanceof Array&&M.length>1?(r.screenAttributes.minVideoBW=M[0],r.screenAttributes.maxVideoBW=M[1],B(),!0):(B("INVALID_PARAM_".concat(JSON.stringify(M))),!1)},r.setScreenProfile=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Object(P.checkValidEnum)(M,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var q=H(M);return q&&q.screen?(r.screenConstraint.mandatory?(r.screenConstraint.mandatory.maxWidth=q.screen.width,r.screenConstraint.mandatory.maxHeight=q.screen.height,q.screen.frameRate&&q.screen.frameRate.min&&q.screen.frameRate.max&&(r.screenConstraint.mandatory.minFrameRate=q.screen.frameRate.min,r.screenConstraint.mandatory.maxFrameRate=q.screen.frameRate.max)):r.screenConstraint=d()(r.screenConstraint,q.screen),r.screenAttributes.width=q.screen.width,r.screenAttributes.height=q.screen.height,r.screenAttributes.minFr=q.screen.frameRate.min,r.screenAttributes.maxFr=q.screen.frameRate.max,B(),!0):(B("NO_SCREEN_PROFILE_".concat(JSON.stringify(M))),!1)},r.setVideoProfileCustom=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});r.setVideoResolution(M[0]),r.setVideoFrameRate([M[1],M[1]]),r.setVideoBitRate([M[2],M[2]]),B()},r.setVideoProfileCustomPlus=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});r.setVideoResolution([M.width,M.height]),v.attributes.resolution="".concat(M.width,"x").concat(M.height),r.setVideoFrameRate([M.framerate,M.framerate]),r.setVideoBitRate([M.bitrate,M.bitrate]),B()},r.setVideoProfile=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),q=H(M);if(!q){var Q="Invalid Profile ".concat(M);throw new Error(Q)}if(r.profile=M,q&&q.video){r.profile=q.profileName,r.videoConstraint=d()(r.videoConstraint,q.video),r.connectionSpec&&q.attributes.maxVideoBW&&(r.connectionSpec.minVideoBW=q.attributes.minVideoBW,r.connectionSpec.maxVideoBW=q.attributes.maxVideoBW),Object(E.isEdge)()&&(r.videoConstraint.frameRate.max=60),Object(E.isFireFox)()&&(r.videoConstraint.frameRate=30),v.attributes=d()(v.attributes,q.attributes),r.pc&&r.pc.renegotiate&&r.pc.renegotiate();var z=r.stream&&r.stream.getVideoTracks&&r.stream.getVideoTracks()[0];return z&&z.applyConstraints?(s.default.debug("setVideoProfile applyConstraints",r.videoConstraint),F.a.disableVideoEffect(r).then(function(){return z.applyConstraints(r.videoConstraint)}).then(function(){return F.a.restoreVideoEffect(r)}).then(function(w){return new Promise(function(D,x){B(w),setTimeout(function(){Object(f.vsResHack)(r.stream,function(ee,Y){r.videoWidth=ee,r.videoHeight=Y,D()},function(ee){s.default.warning("[".concat(r.streamId,"] vsResHack failed: "),ee),x()})},2500)})}).catch(B)):B(),!0}return B("INVALID_VIDEO_PROFILE_".concat(M)),!1},r.setAudioProfile=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Object(P.checkValidEnum)(M,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),r.audioProfile=M;var q=_(M);return r.highQuality=q.highQuality,r.stereo=q.stereo,r.speech=q.speech,r.lowQuality=q.lowQuality,r.stereo&&Object(E.isChrome)()&&(r.audioConstraint.googAutoGainControl=!1,r.audioConstraint.googAutoGainControl2=!1,r.audioConstraint.echoCancellation=!1,r.audioConstraint.googNoiseSuppression=!1),B(),!0},r.setVideoEncoderConfiguration=function(M){Object(P.checkValidObject)(M,"config");var B=l.report.reportApiInvoke(r.sid,{name:"Stream.setVideoEncoderConfiguration",options:M,tag:"tracer"});M.resolution&&(Object(P.checkValidNumber)(M.resolution.width,"config.resolution.width"),Object(P.checkValidNumber)(M.resolution.height,"config.resolution.height"),r.setVideoResolution([M.resolution.width,M.resolution.height])),M.frameRate&&(Object(P.checkValidNumber)(M.frameRate.min,"config.frameRate.min"),Object(P.checkValidNumber)(M.frameRate.max,"config.frameRate.max"),r.setVideoFrameRate([M.frameRate.min,M.frameRate.max])),M.bitrate&&(Object(P.checkValidNumber)(M.bitrate.min,"config.bitrate.min",1,1e7),Object(P.checkValidNumber)(M.bitrate.max,"config.bitrate.max",1,1e7),r.setVideoBitRate([M.bitrate.min,M.bitrate.max])),B()},r.getSupportedProfile=function(M){var B=l.report.reportApiInvoke(r.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:M});if(!r.local){var q="ONLY_LOCAL_STREAM_SUPPORTED";return s.default.error(q),B(q)}if(!r.stream)return q="STREAM_NOT_INIT",s.default.error(q),B(q);if(!r.stream.getVideoTracks)return q="TRACK_NOT_SUPPORT",s.default.error(q),B(q);var Q=r.stream.getVideoTracks()[0];if(!Q)return q="NO_VIDEO_TRACK_FOUND",s.default.error(q),B(q);if(!Q.getCapabilities)return q="GETCAPABILITY_NOT_SUPPORT",s.default.error(q),B(q);var z=Q.getCapabilities(),w=V(z);return B(null,w)}}(t,h),t.getId=function(){return t.streamId},t.getUserId=function(){return t.userId},t.checkDualStreamEnabled=function(){return Object(a.getParameter)("DUALSTREAM_OPERATION_CHECK")&&t.isDualStream?(s.default.error("Operation not permitted: ".concat("DUAL_STREAM_ENABLED")),"DUAL_STREAM_ENABLED"):!1},t.setUserId=function(r){var v=l.report.reportApiInvoke(t.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});t.userId&&s.default.warning("[".concat(t.streamId,"] Stream.userId ").concat(t.userId," => ").concat(r)),t.userId=r,v()},t.getAttributes=function(){return h.screen?t.screenAttributes:h.attributes},t.hasAudio=function(){return!!t.audio},t.hasVideo=function(){return!!t.video},t.hasScreen=function(){return!!t.screen},t.hasScreenAudio=function(){return!!t.screenAudio},t.isVideoOn=function(){return(t.hasVideo()||t.hasScreen())&&!t.userMuteVideo},t.isAudioOn=function(){return t.hasAudio()&&!t.userMuteAudio},t.init=function(r,v){var M=l.report.reportApiInvoke(t.sid,{callback:function(z,w){if(z)return v&&v(z);r&&r(w)},name:"Stream.init",options:arguments,tag:"tracer"}),B=(new Date().getTime(),arguments[2]);if(B===void 0&&(B=2),t.initialized===!0)return M({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(t.local!==!0)return M({type:"warning",msg:"STREAM_NOT_LOCAL"});var q=Math.random().toString().slice(3);t._streamInitID=q,t.videoSource?t.videoName="videoSource":t.video&&(t.videoName=I.a.searchDeviceNameById(h.cameraId)||"default"),t.audioSource?t.audioName="audioSource":t.audio&&(t.audioName=I.a.searchDeviceNameById(h.microphoneId)||"default"),t.screen&&(t.screenName=h.extensionId||"default");try{if(h.audio||h.video||h.screen||h.screenAudio||h.videoSource||h.audioSource){s.default.debug("[".concat(t.streamId,"] Requested access to local media"));var Q={streamId:t.streamId};h.videoSource?Q.videoSource=h.videoSource:h.screen?Q.screen=t.screenConstraint:h.video&&(Q.video=t.videoConstraint),h.audioSource?Q.audioSource=h.audioSource:h.screenAudio?Q.screenAudio=h.screenAudio:h.audio&&(Q.audio=t.audioConstraint),Object(S.b)(Q,function(z){if(Q.screenAudio&&!z.getAudioTracks()[0]&&s.default.warning("[".concat(t.streamId,"] Audio sharing is not selected")),Q.screen&&s.default.debug("[".concat(t.streamId,"] User has granted access to screen sharing")),(Q.video||Q.audio)&&s.default.debug("[".concat(t.streamId,"] User has granted access to local media")),t._streamInitID===null){z.getTracks().forEach(function(D){D.stop()});var w={type:"error",msg:"STREAM_IS_CLOSED",info:"stream is closed and cannot be initialized"};return s.default.error(t.streamId,w.info),void M(w)}if(t._streamInitID!==q)return z.getTracks().forEach(function(D){D.stop()}),w={type:"error",msg:"ABORT_OTHER_INIT",info:"stream initialization is aborted because of another stream.init"},s.default.error(t.streamId,w.info),void M(w);t.dispatchEvent({type:"accessAllowed"}),t.stream=z,t.initialized=!0,t.reloadDeviceName(),t.hasVideo()&&Object(f.vsResHack)(z,function(D,x){t.videoWidth=D,t.videoHeight=x},function(D){s.default.warning("[".concat(t.streamId,"] vsResHack failed: "),D)}),h.screen&&t.stream&&t.stream.getVideoTracks()[0]&&(t.stream.getVideoTracks()[0].onended=function(){t.dispatchEvent({type:"stopScreenSharing"})}),t.stream&&t.stream.getTracks&&t.stream.getTracks().forEach(function(D){D&&!D.onended&&(D.onended=j),D.kind==="video"&&h.optimizationMode&&(D.contentHint=h.optimizationMode,D.contentHint===h.optimizationMode&&s.default.debug("[".concat(t.streamId,"] set content hint to"),h.optimizationMode))}),M()},function(z){var w={type:"error",info:null};switch(z&&(w.msg=z.name||z.code||z,z.message&&(w.info=z.message),z.code&&(w.info?w.info+=". "+z.code:w.info=" "+z.code),z.constraint&&(w.info?w.info+=". Constraint: "+z.constraint:w.info="constraint: "+z.constraint)),w.msg){case"Starting video failed":case"TrackStartError":if(t.videoConstraint&&(delete t.videoConstraint.width,delete t.videoConstraint.height),B>0)return void setTimeout(function(){t.init(function(x){return M(x)},M,B-1)},1);w.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":w.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":w.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":w.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":w.msg="CONSTRAINT_NOT_SATISFIED";break;default:w.msg||(w.msg="UNDEFINED")}var D="Media access ".concat(w.msg).concat(w.info?": "+w.info:"");s.default.error("[".concat(t.streamId,"] "),D),M(w)})}else M({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(z){s.default.error("[".concat(t.streamId,"] Stream init: "),z),M({type:"error",msg:z.message||z})}},t.reloadDeviceName=function(){if(t.stream){if(t.stream.getVideoTracks){var r=t.stream.getVideoTracks()[0];r&&r.label&&(t.videoName=r.label)}if(t.stream.getAudioTracks){var v=t.stream.getAudioTracks()[0];v&&v.label&&(t.audioName=v.label)}}},t.close=function(){var r=l.report.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(s.default.debug("[".concat(t.streamId,"] Close stream with id"),t.streamId),t._originStream)try{t._originStream.getTracks().map(function(q){return q.stop()})}catch{}if(t.stream!==void 0){var v=t.stream.getTracks();for(var M in v)v.hasOwnProperty(M)&&(v[M].stop(),v[M].onended=null);!t.isLowStream&&t.local?F.a.disableVideoEffect(t).then(function(){t.stream=void 0}):(t.stream&&t.stream.clean&&t.stream.clean(),t.stream=void 0)}if(t._originStream){v=t._originStream.getTracks();for(var M in v)v.hasOwnProperty(M)&&(v[M].stop(),v[M].onended=null);!t.isLowStream&&t.local?F.a.disableVideoEffect(t).then(function(){t._originStream=void 0}):(t._originStream&&t._originStream.clean&&t._originStream.clean(),t._originStream=void 0)}if(Object(E.isSafari)()&&t.pc&&t.pc.peerConnection&&t.pc.peerConnection.removeTrack&&t.pc.peerConnection.getSenders){var B=t.pc.peerConnection.getSenders();B.forEach(function(q){q&&(s.default.debug("[".concat(t.streamId,"] Remove Track"),q),t.pc.peerConnection.removeTrack(q))})}t.local&&(t.initialized=!1),t._streamInitID=null,t._onAudioMute=void 0,t._onAudioUnmute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,t.lowStream&&t.lowStream.close(),t.player&&t.player.video&&t.player.video.srcObject&&(t.player.video.srcObject=null),t.player&&t.player.audio&&t.player.audio.srcObject&&(t.player.audio.srcObject=null),r()},t.enableAudio=function(){var r,v=l.report.reportApiInvoke(t.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return s.default.deprecate("[".concat(t.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),t.userMuteAudio||s.default.warning("[".concat(t.streamId,"] User already enableAudio")),t.userMuteAudio=!1,v(null,r=!t.peerMuteAudio&&t._unmuteAudio()),r},t.disableAudio=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});s.default.deprecate("[".concat(t.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),t.userMuteAudio&&s.default.warning("[".concat(t.streamId,"] User already disableAudio")),t.userMuteAudio=!0;var v=t._muteAudio();return r(null,v),v},t.enableVideo=function(){var r,v=l.report.reportApiInvoke(t.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return s.default.deprecate("[".concat(t.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),t.userMuteVideo||s.default.warning("[".concat(t.streamId,"] User already enableVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),v(null,r=!t.peerMuteVideo&&t._unmuteVideo()),r},t.disableVideo=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});s.default.deprecate("[".concat(t.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),t.userMuteVideo&&s.default.warning("[".concat(t.streamId,"] User already disableVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var v=t._muteVideo();return r(null,v),v},t.unmuteAudio=function(){var r,v=l.report.reportApiInvoke(t.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return t.userMuteAudio||s.default.warning("[".concat(t.streamId,"] User already unmuteAudio")),t.userMuteAudio=!1,v(null,r=!t.peerMuteAudio&&t._unmuteAudio()),r},t.muteAudio=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});t.userMuteAudio&&s.default.warning("[".concat(t.streamId,"] User already muteAudio")),t.userMuteAudio=!0;var v=t._muteAudio();return r(null,v),v},t.unmuteVideo=function(){var r,v=l.report.reportApiInvoke(t.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return t.userMuteVideo||s.default.warning("[".concat(t.streamId,"] User already unmuteVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),v(null,r=!t.peerMuteVideo&&t._unmuteVideo()),r},t.muteVideo=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});t.userMuteVideo&&s.default.warning("[".concat(t.streamId,"] User already muteVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var v=t._muteVideo();return r(null,v),v},t._unmuteAudio=function(){return s.default.debug("[".concat(t.streamId,"] Unmuted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!1),!(!t.hasAudio()||!t.initialized||t.stream===void 0||t.stream.getAudioTracks()[0].enabled===!0)&&(t._onAudioUnmute&&t._onAudioUnmute(),t.pc&&(t.pc.isAudioMute=!1),t.stream.getAudioTracks()[0].enabled=!0,!0)},t._isAudioMuted=function(){if(t.stream&&t.hasAudio()){var r=t.stream.getAudioTracks();return r.length>0&&!r[0].enabled}return!1},t._isVideoMuted=function(){if(t.stream&&t.hasVideo()){var r=t.stream.getVideoTracks();return r.length>0&&!r[0].enabled}return!1},t._muteAudio=function(){return s.default.debug("[".concat(t.streamId,"] Muted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!0),!!(t.hasAudio()&&t.initialized&&t.stream!==void 0&&t.stream.getAudioTracks()[0].enabled)&&(t._onAudioMute&&t._onAudioMute(),t.pc&&(t.pc.isAudioMute=!0),t.stream.getAudioTracks()[0].enabled=!1,t.sid&&l.report.audioSendingStopped(t.sid,{succ:!0,reason:"muteAudio"}),!0)},t._unmuteVideo=function(){return s.default.debug("[".concat(t.streamId,"] Unmuted video stream with id"),t.streamId),!(!t.initialized||t.stream===void 0||!t.stream.getVideoTracks().length||t.stream.getVideoTracks()[0].enabled===!0)&&(t._onVideoUnmute&&t._onVideoUnmute(),t.pc&&(t.pc.isVideoMute=!1),t.stream.getVideoTracks()[0].enabled=!0,t.lowStream&&t.lowStream._unmuteVideo(),!0)},t._muteVideo=function(){return s.default.debug("[".concat(t.streamId,"] Muted video stream with id"),t.streamId),!!(t.initialized&&t.stream!==void 0&&t.stream.getVideoTracks().length&&t.stream.getVideoTracks()[0].enabled)&&(t._onVideoMute&&t._onVideoMute(),t.pc&&(t.pc.isVideoMute=!0),t.stream.getVideoTracks()[0].enabled=!1,t.lowStream&&t.lowStream._muteVideo(),t.sid&&l.report.videoSendingStopped(t.sid,{succ:!0,reason:"muteVideo"}),!0)},t.addTrack=function(r){if(t.audio&&r.kind==="audio")s.default.warning("already added audio track");else if(t.video&&r.kind==="video")s.default.warning("already added video track");else{var v=l.report.reportApiInvoke(t.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(t.pc&&t.pc.addTrack(r,t.stream),r.kind=="audio"){t._cleanupAudioMixing();var M=new MediaStream;t.userMuteAudio&&(r.enabled=!1),M.addTrack(r);var B=t.stream.getVideoTracks()[0];B&&M.addTrack(B),t.audio=!0,h.audio=!0,t.stream=M,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream)}else t.userMuteVideo&&(r.enabled=!1),t.stream.addTrack(r),t.video=!0,h.video=!0;r.onended||(r.onended=j),v()}},t.removeTrack=function(r){if(r)if(t.audio||r.kind!=="audio")if(t.video||r.kind!=="video"){var v=l.report.reportApiInvoke(t.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});t.pc&&t.pc.removeTrack(r,t.stream),t.stream.removeTrack(r),t._cleanupAudioMixing(),r.kind==="audio"?(t.audio=!1,h.audio=!1):(t.video=!1,h.video=!1),t.audioLevelHelper=null,r.readyState=="live"&&(r.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(r.kind," Stopped"))),v()}else s.default.warning("already removed video track");else s.default.warning("already removed audio track");else s.default.warning("track doesn't exist.")},t.setAudioOutput=function(r,v,M){var B=l.report.reportApiInvoke(t.sid,{callback:function(q,Q){if(q)return M&&M(q);v&&v(Q)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Object(P.isValidString)(r,1,255)?(t.audioOutput=r,t.player?void t.player.setAudioOutput(r,function(){return B()},B):B()):(s.default.error("[".concat(t.streamId,"] setAudioOutput Invalid Parameter"),r),B(i.default.INVALID_PARAMETER))},t.play=function(r,v,M){typeof v=="function"&&(M=v,v=null),s.default.debug("[".concat(t.streamId,"] play()."),r,v);var B=l.report.reportApiInvoke(t.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:M});if(Object(P.checkValidString)(r,"elementID"),Object(P.isEmpty)(v)||(Object(P.isEmpty)(v.fit)||Object(P.checkValidEnum)(v.fit,"fit",["cover","contain"]),Object(P.isEmpty)(v.muted)||Object(P.checkValidBoolean)(v.muted,"muted")),t.player)s.default.warning("[".concat(t.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),t.resume().then(function(){B(null)}).catch(B);else{t.elementID=r,t.playOptions=v,!t.local||t.video||t.screen?(t.player=new k({id:t.getId(),stream:t,elementID:r,options:v}),t.local&&F.a.applyEffectInPlayer(t)):t.hasAudio()&&(t.player=new k({id:t.getId(),stream:t,elementID:r,options:v}));var q={video:null,audio:null},Q=function z(w){if(q[w.mediaType]=w,q.video&&q.audio)if(t.removeEventListener("player-status-change",z),q.video.isErrorState||q.audio.isErrorState){var D=q.video.isErrorState?q.video:q.audio;B({isErrorState:!0,status:D.status,reason:D.reason,video:q.video,audio:q.audio})}else q.video.status==="aborted"&&q.audio.status==="aborted"?B({status:"aborted",reason:"stop",video:q.video,audio:q.audio}):B(null)};t.on("player-status-change",Q),t.audioOutput&&t.player.setAudioOutput(t.audioOutput),t.audioLevel!==void 0&&t.player.setAudioVolume(t.audioLevel),t._flushAudioMixingMuteStatus(!1)}},t.stop=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});s.default.debug("[".concat(t.streamId,"] Stop stream player with id "),t.streamId),t.player?(F.a.removeEffectFromLocalPlayer(t),t.player.destroy(),delete t.player):s.default.error("[".concat(t.streamId,"] Stream.stop(): Stream is not playing")),t._flushAudioMixingMuteStatus(!0),r()},t.isPlaying=function(){return!!t.player},t.isPaused=function(){return!!t.player&&(!!(t.player.video&&t.player.video.paused&&t.player.mediaElemExists(t.player.video))||!!(t.player.audio&&t.player.audio.paused&&t.player.mediaElemExists(t.player.audio)))},t.resume=function(){var r,v;return t.player?(t.player.video&&t.player.video.play&&(r=t.player.video.play()),r=r||Promise.resolve(),t.player.audio&&t.player.audio.play&&(v=t.player.audio.play()),v=v||Promise.resolve(),Promise.all([r,v])):Promise.reject("NO_PLAYER_FOUND")},t.getVideoTrack=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getVideoTracks){var v=t.stream.getVideoTracks()[0];if(v)return s.default.info("[".concat(t.streamId,"] getVideoTrack"),v),r(),v}s.default.info("[".concat(t.streamId,"] getVideoTrack None")),r(null,"getVideoTrack None")},t.getAudioTrack=function(){var r=l.report.reportApiInvoke(t.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getAudioTracks){var v=t.stream.getAudioTracks()[0];if(v)return s.default.info("[".concat(t.streamId,"] getAudioTracks"),v),r(),v}s.default.info("[".concat(t.streamId,"] getAudioTracks None")),r(null,"getAudioTracks None")},t._hasVideoTracks=function(){return!!(t.stream&&t.stream.getVideoTracks&&t.stream.getVideoTracks()[0])},t._hasAudioTracks=function(){return!!(t.stream&&t.stream.getAudioTracks&&t.stream.getAudioTracks()[0])},t._replaceMediaStreamTrack=function(r,v,M){if(t.stream){if(r.kind=="video"){if(q=t.stream.getVideoTracks()[0])return t.userMuteVideo&&(r.enabled=!1),t.stream.removeTrack(q),t.stream.addTrack(r),s.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(r.kind," SUCCESS")),q.readyState=="live"&&(q.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(q.kind," Stopped"))),v&&v();var B="MEDIASTREAM_TRACK_NOT_FOUND";return s.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(r.kind)),M(B)}if(r.kind=="audio"){var q;if(q=t.stream.getAudioTracks()[0]){t.userMuteAudio&&(r.enabled=!1);var Q=new MediaStream;Q.addTrack(r);var z=t.stream&&t.stream.getVideoTracks()[0];return z&&Q.addTrack(z),t.stream=Q,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream),s.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack SUCCESS")),q.readyState=="live"&&(q.stop(),s.default.debug("[".concat(t.streamId,"] Track ").concat(q.kind," Stopped"))),v&&v()}return B="MEDIASTREAM_TRACK_NOT_FOUND",s.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(r.kind)),M(B)}return B="INVALID_TRACK_TYPE",s.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(B," ").concat(r.kind)),M&&M(B)}return B="NO_STREAM_FOUND",s.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(B)),M&&M(B)},t.replaceTrack=function(r,v,M){var B=l.report.reportApiInvoke(t.sid,{callback:function(q,Q){if(q)return M&&M(q);v&&v(Q)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return r&&r.kind?(t._cleanupAudioMixing(),r.onended||(r.onended=j),t.pc&&t.pc.hasSender&&t.pc.hasSender(r.kind)?void t.pc.replaceTrack(r,function(){return s.default.debug("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(r.kind," SUCCESS")),t._replaceMediaStreamTrack(r,function(q){return B(null,q)},B)},function(q){return s.default.error("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(r.kind," Failed ").concat(q)),B(q)}):t._replaceMediaStreamTrack(r,function(q){return B(null,q)},B)):B("INVALID_TRACK")},t.setAudioVolume=function(r){var v=l.report.reportApiInvoke(t.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});Object(P.checkValidNumber)(r,"level",0,100),t.audioLevel=r,t.player&&t.player.setAudioVolume(r),v()},t.getStats=function(r,v,M){var B=[];B.push(t._getPCStats(M)),B.push(new Promise(function(q){var Q={};t.pc&&t.pc.isSubscriber?window.navigator.userAgent.match("Firefox")!==null&&(Object(C.b)(Q,"videoReceiveResolutionHeight",t.videoHeight),Object(C.b)(Q,"videoReceiveResolutionWidth",t.videoWidth)):t.pc&&!t.pc.isSubscriber&&((Object(E.isSafari)()||Object(E.isFireFox)())&&(Object(C.b)(Q,"videoSendResolutionHeight",t.videoHeight),Object(C.b)(Q,"videoSendResolutionWidth",t.videoWidth)),(Object(E.isSafari)()||Object(E.isFireFox)())&&t.uplinkStats&&Object(C.b)(Q,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),q(Q)})),B.push(new Promise(function(q){var Q={};return t.traffic_stats&&t.pc&&t.pc.isSubscriber?(Object(C.b)(Q,"accessDelay",t.traffic_stats.access_delay),Object(C.b)(Q,"endToEndDelay",t.traffic_stats.e2e_delay),Object(C.b)(Q,"videoReceiveDelay",t.traffic_stats.video_delay),Object(C.b)(Q,"audioReceiveDelay",t.traffic_stats.audio_delay)):t.traffic_stats&&t.pc&&!t.pc.isSubscriber&&Object(C.b)(Q,"accessDelay",t.traffic_stats.access_delay),q(Q)})),Promise.all(B).then(function(q){for(var Q={},z=q.length-1;z>=0;z--){var w=q[z];d()(Q,w)}r&&setTimeout(r.bind(t,Q),0)}).catch(function(q){v&&setTimeout(v.bind(t,q),0)})},t._getPCStats=function(r){return new Promise(function(v,M){if(!t.pc||t.pc.state!=="established"||!t.pc.getStats)return M("PEER_CONNECTION_NOT_ESTABLISHED");t.pc.getStats(function(B){if(!t.pc||t.pc.state!=="established"||!t.pc.getStats)return M("PEER_CONNECTION_STATE_CHANGE");var q=t.pc.isSubscriber?Object(C.c)(B):Object(C.a)(B);return v(q)},r)}).then(function(v){return t.pc.isSubscriber?(Object(E.isFireFox)()||Object(E.isSafari)())&&(v.videoReceiveResolutionHeight&&v.videoReceiveResolutionHeight!=="0"||v.videoReceiveResolutionWidth&&v.videoReceiveResolutionWidth!=="0"||(Object(C.b)(v,"videoReceiveResolutionHeight",t.videoHeight),Object(C.b)(v,"videoReceiveResolutionWidth",t.videoWidth))):((Object(E.isSafari)()||Object(E.isFireFox)())&&(v.videoSendResolutionHeight&&v.videoSendResolutionHeight!=="0"||v.videoSendResolutionWidth&&v.videoSendResolutionWidth!=="0"||(Object(C.b)(v,"videoSendResolutionHeight",t.videoHeight),Object(C.b)(v,"videoSendResolutionWidth",t.videoWidth))),(Object(E.isSafari)()||Object(E.isFireFox)())&&t.uplinkStats&&Object(C.b)(v,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),Promise.resolve(v)})},t.getAudioLevel=function(){if(t.audioLevelHelper)return t.audioLevelHelper.getAudioLevel();if(t.stream){if(t.stream.getAudioTracks().length!==0)return t.audioLevelHelper=new f.audioLevelHelper(t.stream),t.audioLevelHelper.getAudioLevel();s.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else s.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no stream exist"))},t.setVideoProfile("480p_1"),t._switchVideoDevice=function(r,v,M){if(r===t.cameraId)return v&&v();var B={video:d()({},t.videoConstraint,{deviceId:{exact:r}}),audio:!1};s.default.debug("[".concat(t.streamId,"] ").concat(B)),Object(S.b)(B,function(q){try{var Q=function(){t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.cameraId=r,t.videoConstraint.deviceId={exact:r},t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),F.a.restoreVideoEffect(t).then(function(){v&&v()})};F.a.disableVideoEffect(t).then(function(){var z=!1;window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function"&&(z=!0),z?t.replaceTrack(q.getVideoTracks()[0],Q,M):(t.removeTrack(t.stream.getVideoTracks()[0]),t.addTrack(q.getVideoTracks()[0]),Q())})}catch(z){return M&&M(z)}},function(q){return M&&M(q)})},t._switchAudioDevice=function(r,v,M){if(r===t.microphoneId)return v&&v();var B={video:!1,audio:d()({},t.audioConstraint,{deviceId:{exact:r}})};s.default.debug("[".concat(t.streamId,"] "),B);var q=t.stream.getAudioTracks()[0];q&&q.stop(),Object(S.b)(B,function(Q){var z=function(){t._cleanupAudioMixing(),t.userMuteAudio&&(t.stream.getAudioTracks()[0].enabled=!1),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.microphoneId=r,t.audioConstraint.deviceId={exact:r},v&&v()};try{var w=!1;window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function"&&(w=!0),w?t.replaceTrack(Q.getAudioTracks()[0],z,M):(t.removeTrack(t.stream.getAudioTracks()[0]),t.addTrack(Q.getAudioTracks()[0]),z())}catch(D){return M&&M(D)}},function(Q){return M&&M(Q)})},t.switchDevice=function(r,v,M,B){var q=l.report.reportApiInvoke(t.sid,{callback:function(Y,Z){if(Y)return B&&B(Y);M&&M(Z)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Object(P.checkValidString)(v,"deviceId");var Q=function(){return t.inSwitchDevice=!1,q()},z=function(Y){t.inSwitchDevice=!1,s.default.error("[".concat(t.streamId,"] "),Y),q(Y)};if(t.inSwitchDevice)return q("Device switch is in process.");if(t.inSwitchDevice=!0,!t.local)return z("Only the local stream can switch the device.");if(t.screen&&r==="video")return z("The device cannot be switched during screen-sharing.");if(!t.video&&r==="video")return z("Video track not exist.");if(!t.audio&&r==="audio")return z("Audio track not exist.");if(t.videoSource||t.audioSource)return z("The device cannot be switched when using videoSource or audioSource.");var w=!1;for(var D in t.audioMixing.sounds){var x=t.audioMixing.sounds[D];if(x.state!==t.audioMixing.states.IDLE){w=!0;break}}var ee=t.audioMixing.audioContextInited;if(ee&&w)return z("The device cannot be switched when using audio Mixing.");I.a.getDeviceById(v,function(){if(r==="video")t._switchVideoDevice(v,Q,z);else{if(r!=="audio")return z("Invalid type.");t._switchAudioDevice(v,Q,z)}},function(){return z("The device does not exist.")})},t},L=function(h){var t=l.report.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer",getStates:function(){return{audioTrackEnable:h&&h.audioSource?h.audioSource.enabled:null,videoTrackEnable:h&&h.videoSource?h.videoSource.enabled:null}}});Object(P.checkValidObject)(h,"StreamSpec");var j=h.streamID,r=h.audio,v=h.video,M=h.screen,B=h.screenAudio,q=(h.audioSource,h.videoSource,h.cameraId),Q=h.facingMode,z=h.microphoneId,w=h.mirror,D=h.extensionId,x=h.mediaSource,ee=h.audioProcessing,Y=h.optimizationMode;if(!Object(P.isEmpty)(j)&&!Object(f.is32Uint)(j)&&!Object(P.isValidString)(j,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Object(P.checkValidBoolean)(r,"audio"),Object(P.checkValidBoolean)(v,"video"),Object(P.isEmpty)(M)||Object(P.checkValidBoolean)(M,"screen"),Object(P.isEmpty)(B)||Object(P.checkValidBoolean)(B,"screenAudio"),Object(P.isEmpty)(q)||Object(P.checkValidString)(q,"cameraId",0,255,!1),Object(P.isEmpty)(Q)||Object(P.checkValidEnum)(Q,"facingMode",["user","environment","left","right"]),Object(P.isEmpty)(z)||Object(P.checkValidString)(z,"microphoneId",0,255,!1),Object(P.isEmpty)(D)||Object(P.checkValidString)(D,"extensionId"),Object(P.isEmpty)(x)||Object(P.checkValidEnum)(x,"mediaSource",["screen","application","window"]),Object(P.isEmpty)(w)||Object(P.checkValidBoolean)(w,"mirror"),!Object(P.isEmpty)(ee)){var Z=ee.AGC,oe=ee.AEC,de=ee.ANS;Object(P.isEmpty)(Z)||Object(P.checkValidBoolean)(Z,"AGC"),Object(P.isEmpty)(oe)||Object(P.checkValidBoolean)(oe,"AEC"),Object(P.isEmpty)(de)||Object(P.checkValidBoolean)(de,"ANS")}Object(P.isEmpty)(Y)||Object(P.checkValidEnum)(Y,"optimizationMode",["detail","motion"]),s.default.debug("Create stream"),B===!0&&r===!0&&s.default.warning("Do not set both 'screenAudio' and 'audio' to true at the same time"),h.screen&&!Y&&(h.optimizationMode="detail");var le=n(h);return t(),le}},function(c,O,y){y.d(O,"a",function(){return H}),y.d(O,"b",function(){return V});var m=y(4),d=y(7),E=y.n(d),p=y(12),b=y.n(p),s=y(17),g=y.n(s),i=y(0),a=y(15),l=y(2);function A(_){if(typeof Symbol>"u"||_[Symbol.iterator]==null){if(Array.isArray(_)||(_=function(v,M){if(v){if(typeof v=="string")return k(v,M);var B=Object.prototype.toString.call(v).slice(8,-1);if(B==="Object"&&v.constructor&&(B=v.constructor.name),B==="Map"||B==="Set")return Array.from(B);if(B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B))return k(v,M)}}(_))){var n=0,L=function(){};return{s:L,n:function(){return n>=_.length?{done:!0}:{done:!1,value:_[n++]}},e:function(v){throw v},f:L}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h,t,j=!0,r=!1;return{s:function(){h=_[Symbol.iterator]()},n:function(){var v=h.next();return j=v.done,v},e:function(v){r=!0,t=v},f:function(){try{j||h.return==null||h.return()}finally{if(r)throw t}}}}function k(_,n){(n==null||n>_.length)&&(n=_.length);for(var L=0,h=new Array(n);L<n;L++)h[L]=_[L];return h}var S=function(_){var n={},L=a.RTCPeerConnection;n.uid=_.uid,n.isVideoMute=_.isVideoMute,n.isAudioMute=_.isAudioMute,n.isSubscriber=_.isSubscriber,n.clientId=_.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[]};var h={id:"outbound_audio_ssrc_send",type:"ssrc",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},t={id:"outbound_video_ssrc_send",type:"ssrc",mediaType:"",googCodecName:_.codec?_.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},j={id:"inbound_audio_ssrc_recv",type:"ssrc",mediaType:"",googCodecName:"opus",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},r={id:"inbound_video_ssrc_recv",type:"ssrc",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesReceived:"0",googFramesDecoded:"0"},v={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"};n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},_.iceServers instanceof Array?n.pc_config.iceServers=_.iceServers:(_.stunServerUrl&&(_.stunServerUrl instanceof Array?_.stunServerUrl.map(function(w){typeof w=="string"&&w!==""&&n.pc_config.iceServers.push({url:w})}):typeof _.stunServerUrl=="string"&&_.stunServerUrl!==""&&n.pc_config.iceServers.push({url:_.stunServerUrl})),_.turnServers&&(_.turnServers instanceof Array?_.turnServers.map(function(w){w.udpport&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.udpport+"?transport=udp"}),typeof w.tcpport=="string"&&w.tcpport!==""&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.tcpport+"?transport=tcp"}),w.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):i.default.error("[".concat(n.clientId,"] turnServers is not a array")))),_.audio===void 0&&(_.audio=!0),_.video===void 0&&(_.video=!0),n.mediaConstraints=m.isChromeKernel()&&m.getChromeKernelVersion()<103?{mandatory:{OfferToReceiveVideo:_.video,OfferToReceiveAudio:_.audio}}:{offerToReceiveVideo:_.video,offerToReceiveAudio:_.audio},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(l.getParameter)("PLAN"),n.peerConnection=new L(n.pc_config,n.con)}catch{delete n.pc_config.sdpSemantics,n.peerConnection=new L(n.pc_config,n.con);var M=n.peerConnection.getConfiguration();M.sdpSemantics&&Object(l.setParameter)("PLAN",M.sdpSemantics)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,i.default.debug("[".concat(n.clientId,"]Candidates collected: ").concat(n.iceCandidateCount)),n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(l.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(w){var D,x,ee,Y;x=(D=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),ee=D.match(/a=candidate:.+typ\shost.+\r\n/),Y=D.match(/a=candidate:.+typ\srelay.+\r\n/),x===null&&ee===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var B=function(w){return w=w.replace(`a=x-google-flag:conference\r
`,"")},q=function(w){var D,x;if((D=w.match(/m=video.*\r\n/))&&_.minVideoBW&&_.maxVideoBW){x=D[0]+"b=AS:"+_.maxVideoBW+`\r
`;var ee=0,Y=0;_.codec==="h264"?(ee=w.search(/a=rtpmap:(\d+) H264\/90000\r\n/),Y=w.search(/H264\/90000\r\n/)):_.codec==="vp8"?(ee=w.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),Y=w.search(/VP8\/90000\r\n/)):_.codec==="vp9"&&(ee=w.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),Y=w.search(/VP9\/90000\r\n/)),ee!==-1&&Y!==-1&&Y-ee>10&&(x=x+"a=fmtp:"+w.slice(ee+9,Y-1)+" x-google-min-bitrate="+_.minVideoBW+`\r
`),w=(w=(w=w.replace(D[0],x)).replace("a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f","a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f")).replace("a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f","a=fmtp:125 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f"),i.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+_.minVideoBW+" max:"+_.maxVideoBW)}return(D=w.match(/m=audio.*\r\n/))&&_.maxAudioBW&&(x=D[0]+"b=AS:"+_.maxAudioBW+`\r
`,w=w.replace(D[0],x)),w};n.processSignalingMessage=function(w){var D,x=JSON.parse(w);n.incomingMessage=x,n.state==="new"?x.messageType==="OFFER"?(D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)).catch(function(ee){}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="offer-sent"?x.messageType==="ANSWER"?((D={sdp:x.sdp,type:"answer"}).sdp=B(D.sdp),D.sdp=q(D.sdp),_.screen&&_.optimizationMode==="detail"&&(i.default.debug("[".concat(n.client,"] remove screen share abs ext")),D.sdp=D.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),_.isSubscriber&&(D.sdp=D.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)).catch(function(ee){}),n.state="established"):x.messageType==="pr-answer"?(D={sdp:x.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)).catch(function(ee){})):x.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="established"&&(x.messageType==="OFFER"?(D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)).catch(function(ee){}),n.state="offer-received",n.markActionNeeded()):x.messageType==="ANSWER"?((D={sdp:x.sdp,type:"answer"}).sdp=B(D.sdp),D.sdp=q(D.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)).catch(function(ee){})):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var w=g()(b.a.mark(function D(x){var ee,Y,Z;return b.a.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(ee=n.peerConnection.getSenders(),Y=ee.find(function(de){return de.track.kind==="video"})){oe.next=4;break}return oe.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=x,oe.prev=6,i.default.debug("[".concat(n.clientId,"] setParameters"),Z),oe.next=10,Y.setParameters(Z);case 10:oe.next=15;break;case 12:oe.prev=12,oe.t0=oe.catch(6),i.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return oe.stop()}},D,null,[[6,12]])}));return function(D){return w.apply(this,arguments)}}();var Q=0,z=0;return n.getVideoRelatedStats=function(w){n.getStats(function(D){D.forEach(function(x){if(n.isSubscriber){if(x.mediaType==="video"&&x.id&&~x.id.indexOf("recv")){if(m.isChromeKernel()&&+m.getBrowserVersion()>=76){var ee=+x.googFramesReceived-Q,Y=+x.googFramesDecoded-z;n._setStat(r,"googFrameRateReceived",ee),n._setStat(r,"googFrameRateDecoded",Y),n._setStat(r,"googFrameRateOutput",Y),Q=+x.googFramesReceived,z=+x.googFramesDecoded}w&&w({mediaType:"video",peerId:n.uid,isVideoMute:n.isVideoMute,frameRateReceived:x.googFrameRateReceived,frameRateDecoded:x.googFrameRateDecoded,bytesReceived:x.bytesReceived,packetsReceived:x.packetsReceived,packetsLost:x.packetsLost})}}else x.mediaType==="video"&&x.id&&~x.id.indexOf("send")&&w&&w({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:x.googFrameRateInput,frameRateSent:x.googFrameRateSent,googRtt:x.googRtt})})})},n.getAudioRelatedStats=function(w){n.getStats(function(D){D.forEach(function(x){n.isSubscriber&&x.mediaType==="audio"&&x.id&&~x.id.indexOf("recv")&&w&&w({mediaType:"audio",peerId:n.uid,isAudioMute:n.isAudioMute,frameDropped:parseInt(x.googDecodingPLC)+parseInt(x.googDecodingPLCCNG)+"",frameReceived:x.googDecodingCTN,googJitterReceived:x.googJitterReceived,bytesReceived:x.bytesReceived,packetsReceived:x.packetsReceived,packetsLost:x.packetsLost})})})},n.getStatsRate=function(w){n.getStats(function(D){w(D)})},n.getStats=function(w,D){D=(D=D||500)>500?500:D,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<D?w&&w(n.filterStatsCache,n.originStatsCache):(n.lastTimeGetStats=Date.now(),this._getStats(function(x,ee){n.filterStatsCache=x,n.originStatsCache=ee,w&&w(x,ee)}))},n._setStat=function(w,D,x){w.hasOwnProperty(D)&&(x!=null&&x!==1/0&&x==x||(x=0),w[D]=x+"")},n._processGetStatsAfterChrome76=function(w){var D=this;n.lastStats||(n.lastStats=new Map),n.peerConnection.getStats().then(function(x){var ee,Y=[],Z=[],oe=new Map,de=new Date,le=A(x.values());try{for(le.s();!(ee=le.n()).done;){var ce=ee.value;ce.type!="codec"?ce.type!="candidate-pair"?(ce.type==="inbound-rtp"&&ce.mediaType==="video"&&oe.set("inbound-video",ce),ce.type==="inbound-rtp"&&ce.mediaType==="audio"&&oe.set("inbound-audio",ce),ce.type==="outbound-rtp"&&ce.mediaType==="audio"&&oe.set("outbound-audio",ce),ce.type==="outbound-rtp"&&ce.mediaType==="video"&&oe.set("outbound-video",ce),ce.type==="track"&&ce.kind==="video"&&ce.remoteSource&&oe.set("remote-video-track",ce),ce.type==="track"&&ce.kind==="audio"&&ce.remoteSource&&oe.set("remote-audio-track",ce),ce.type==="remote-inbound-rtp"&&ce.mediaType==="video"&&oe.set("remote-inbound-video",ce),ce.type==="remote-inbound-rtp"&&ce.mediaType==="audio"&&oe.set("remote-inbound-audio",ce),ce.type!=="track"||ce.kind!=="video"||ce.remoteSource||oe.set("local-video-track",ce),ce.type!=="track"||ce.kind!=="audio"||ce.remoteSource||oe.set("local-audio-track",ce),ce.type==="media-source"&&ce.kind==="video"&&oe.set("media-source-video",ce),ce.type==="media-source"&&ce.kind==="audio"&&oe.set("media-source-audio",ce)):Z.push(ce):Y.push(ce)}}catch(ye){le.e(ye)}finally{le.f()}oe.set("codec",Y),oe.set("candidatePairs",Z),oe.set("timestamp",+de);var re=null,ge=null;if(r.timestamp=de,j.timestamp=de,h.timestamp=de,h.timestamp=de,v.timestamp=de,D.isSubscriber)(re=oe.get("inbound-video"))&&(n._setStat(r,"id","inbound_video_ssrc_recv"),n._setStat(r,"mediaType",re.mediaType),n._setStat(r,"packetsLost",re.packetsLost),n._setStat(r,"googDecodeMs",null),n._setStat(r,"googMaxDecodeMs",null),n._setStat(r,"googRenderDelayMs",null),n._setStat(r,"googMinPlayoutDelayMs",null),n._setStat(r,"googNacksSent",re.nackCount),n._setStat(r,"googPlisSent",re.pliCount),n._setStat(r,"googFirsSent",re.firCount),n._setStat(r,"bytesReceived",re.bytesReceived),n._setStat(r,"packetsReceived",re.packetsReceived)),(re=oe.get("inbound-audio"))&&(n._setStat(j,"id","inbound_audio_ssrc_recv"),n._setStat(j,"mediaType",re.mediaType),n._setStat(j,"bytesReceived",re.bytesReceived),n._setStat(j,"packetsLost",re.packetsLost),n._setStat(j,"packetsReceived",re.packetsReceived),n._setStat(j,"googAccelerateRate",re.removedSamplesForAcceleration),n._setStat(j,"googCurrentDelayMs",re.jitterBufferDelay),n._setStat(j,"googDecodingCNG",null),n._setStat(j,"googDecodingCTN",null),n._setStat(j,"googDecodingCTSG",null),n._setStat(j,"googDecodingNormal",null),n._setStat(j,"googDecodingPLC",null),n._setStat(j,"googDecodingPLCCNG",null),n._setStat(j,"googJitterReceived",re.jitter),n._setStat(j,"googPreferredJitterBufferMs",null),n._setStat(j,"googSecondaryDecodedRate",null)),(re=oe.get("remote-video-track"))&&(n._setStat(r,"googTargetDelayMs",re.jitterBufferDelay),n._setStat(r,"googFrameWidthReceived",re.frameWidth),n._setStat(r,"googFrameHeightReceived",re.frameHeight),n._setStat(r,"googJitterBufferMs",re.jitterBufferDelay/re.jitterBufferEmittedCount*1e3),n._setStat(r,"googCurrentDelayMs",re.jitterBufferDelay),n._setStat(r,"googFramesDecoded",re.framesDecoded),n._setStat(r,"googFramesReceived",re.framesReceived)),(re=oe.get("remote-audio-track"))&&(n._setStat(j,"audioOutputLevel",32767*re.audioLevel),n._setStat(j,"googJitterBufferMs",re.jitterBufferDelay/re.jitterBufferEmittedCount*1e3),n._setStat(j,"googExpandRate",re.concealedSamples),n._setStat(j,"googPreemptiveExpandRate",re.insertedSamplesForDeceleration),n._setStat(j,"googSpeechExpandRate",re.silentConcealedSamples));else{var o=n.lastStats.get("timestamp"),pe=n.lastStats.get("outbound-video");if((re=oe.get("outbound-audio"))&&(n._setStat(h,"id","outbound_audio_ssrc_send"),n._setStat(h,"mediaType",re.mediaType),n._setStat(h,"aecDivergentFilterFraction",null),n._setStat(h,"bytesSent",re.bytesSent),n._setStat(h,"packetsSent",re.packetsSent),ge=re.transportId),re=oe.get("outbound-video")){if(n._setStat(t,"id","outbound_video_ssrc_send"),n._setStat(t,"mediaType",re.mediaType),n._setStat(t,"bytesSent",re.bytesSent),n._setStat(t,"packetsSent",re.packetsSent),n._setStat(t,"googAdaptationChanges",re.qualityLimitationDurations),n._setStat(t,"googAvgEncodeMs",null),n._setStat(t,"googEncodeUsagePercent",null),ge=re.transportId,re.totalEncodedBytesTarget&&pe&&pe.totalEncodedBytesTarget){var te=(re.totalEncodedBytesTarget-pe.totalEncodedBytesTarget)/(+new Date-o);n._setStat(v,"googTargetEncBitrate",Math.floor(8*te*1e3))}if(re.retransmittedBytesSent&&pe&&pe.retransmittedBytesSent){var N=(re.retransmittedBytesSent-pe.retransmittedBytesSent)/(+new Date-o);n._setStat(v,"googRetransmitBitrate",Math.floor(8*N*1e3))}if(re.bytesSent&&pe&&pe.bytesSent){var fe=(re.bytesSent-pe.bytesSent)/(+new Date-o);n._setStat(v,"googTransmitBitrate",Math.floor(8*fe*1e3)),n._setStat(v,"googActualEncBitrate",Math.floor(8*fe*1e3))}if(re.totalPacketSendDelay&&pe&&pe.totalPacketSendDelay){var Ee=(re.totalPacketSendDelay-pe.totalPacketSendDelay)/(+new Date-o);n._setStat(v,"googBucketDelay",Math.floor(1e3*Ee))}}if((re=oe.get("remote-inbound-video"))&&(n._setStat(t,"packetsLost",re.packetsLost),n._setStat(t,"googRtt",re.roundTripTime)),(re=oe.get("local-video-track"))&&(n._setStat(t,"googFrameHeightSent",re.frameHeight),n._setStat(t,"googFrameWidthSent",re.frameWidth),re.framesPerSecond!==void 0&&n._setStat(t,"googFrameRateSent",re.framesPerSecond)),(re=oe.get("local-audio-track"))&&(n._setStat(h,"googEchoCancellationReturnLoss",re.echoReturnLoss),n._setStat(h,"googEchoCancellationReturnLossEnhancement",re.echoReturnLossEnhancement)),(re=oe.get("media-source-video"))&&(n._setStat(t,"googFrameHeightInput",re.height),n._setStat(t,"googFrameWidthInput",re.width),n._setStat(t,"googFrameRateInput",re.framesPerSecond)),(re=oe.get("media-source-audio"))&&n._setStat(h,"audioInputLevel",32767*re.totalAudioEnergy),(re=oe.get("inbound-video"))&&(n._setStat(t,"googFirsReceived",re.firCount),n._setStat(t,"googNacksReceived",re.nackCount),n._setStat(t,"googPlisReceived",re.pliCount)),ge)oe.get("candidatePairs").map(function(ye){ge==ye.transportId&&n._setStat(v,"googAvailableSendBandwidth",ye.availableOutgoingBitrate)});else{var he=oe.get("candidatePairs")[0];he&&n._setStat(v,"googAvailableSendBandwidth",he.availableOutgoingBitrate)}}n.lastStats=oe;var _e=[E()({},t),E()({},h),E()({},r),E()({},j),E()({},v)];_e.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),w(_e)})},n._processGetStatsBeforeChrome76=function(w){n.peerConnection.getStats(function(D){var x=[],ee=[],Y=null;Object.keys(D).forEach(function(Z){var oe=D[Z];oe&&(ee.push(oe),Y=oe.timestamp,oe.type==="VideoBwe"?v=oe:oe.id.indexOf("_send")>-1&&oe.mediaType==="video"?t=oe:oe.id.indexOf("_send")>-1&&oe.mediaType==="audio"?h=oe:oe.id.indexOf("_recv")>-1&&oe.mediaType==="video"?r=oe:oe.id.indexOf("_recv")>-1&&oe.mediaType==="audio"&&(j=oe))}),(x=[E()({},t),E()({},h),E()({},r),E()({},j),E()({},v)]).push({id:"time",startTime:n.connectedTime,timestamp:Y||new Date}),w(x,ee)})},n._getStats=function(w){Object(l.getParameter)("CHROME_NEW_STATS")&&m.isChromeKernel()&&+m.getBrowserVersion()>=76?n._processGetStatsAfterChrome76(w):n._processGetStatsBeforeChrome76(w)},n.addTrack=function(w,D){if(Object(l.getParameter)("PLAN")==="unified-plan"){var x=w.kind==="audio"?n._audioSender:n._videoSender;if(x){var ee=n.peerConnection.getTransceivers().find(function(Y){return Y.sender===x});x.replaceTrack(w).then(function(){ee.direction="sendrecv",n.renegotiate()})}else x=n.peerConnection.addTrack(w,D),w.kind==="audio"?n._audioSender=x:n._videoSender=x}else n.peerConnection.addTrack(w,D)},n.removeTrack=function(w,D){if(Object(l.getParameter)("PLAN")==="unified-plan"){var x=n.peerConnection.getTransceivers().find(function(ee){return ee.sender.track===w});x&&(x.direction="inactive",n.peerConnection.removeTrack(x.sender))}else n.peerConnection.removeTrack(n.peerConnection.getSenders().find(function(ee){return ee.track==w}))},n.addStream=function(w){Object(l.getParameter)("PLAN")==="unified-plan"?w.getTracks().forEach(function(D){var x=n.peerConnection.addTrack(D,w);D.kind==="audio"?n._audioSender=x:n._videoSender=x}):(n.peerConnection.addStream(w),n.markActionNeeded())},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(w){window.setTimeout(w,1)},n.onstablestate=function(){var w;if(n.actionNeeded){if(n.state==="new"||n.state==="established")n.peerConnection.createOffer(n.mediaConstraints).then(function(D){return D?D.sdp!==n.prevOffer?(_.isSubscriber&&(D.sdp=D.sdp.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")),n.peerConnection.setLocalDescription(D),n.state="preparing-offer",void n.markActionNeeded()):void i.default.debug("["+n.clientId+"]Not sending a new offer"):(i.default.debug("["+n.clientId+"]sessionDescription is null"),void n.onsignalingmessage(null))}).catch(function(D){i.default.debug("["+n.clientId+"]peer connection create offer failed ",D)});else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(_.isCloudProxy3&&_.onNoIceCandidate&&_.onNoIceCandidate(),i.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),Object(l.getParameter)("SHIM_CANDIDATE")?(i.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):i.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(D){if(n.peerConnection.setLocalDescription(D),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var x=new Date;i.default.debug("["+n.clientId+"]"+x.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(D){i.default.debug("["+n.clientId+"]peer connection create answer failed ",D)},n.mediaConstraints);else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;w=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",w),n.state="established"}else i.default.debug("[".concat(n.clientId,"] Dazed and confused in state ").concat(n.state,", stopping here'"));n.actionNeeded=!1}},n.sendMessage=function(w,D){var x={};x.messageType=w,x.sdp=D,w==="OFFER"?(x.offererSessionId=n.sessionId,x.answererSessionId=n.otherSessionId,x.seq=n.sequenceNumber+=1,x.tiebreaker=Math.floor(429496723*Math.random()+1)):(x.offererSessionId=n.incomingMessage.offererSessionId,x.answererSessionId=n.sessionId,x.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(x))},n._getSender=function(w){if(n.peerConnection&&n.peerConnection.getSenders){var D=n.peerConnection.getSenders().find(function(x){return x.track.kind==w});if(D)return D}return null},n.hasSender=function(w){return!!n._getSender(w)},n.replaceTrack=function(w,D,x){var ee=n._getSender(w.kind);if(!ee)return x("NO_SENDER_FOUND");try{ee.replaceTrack(w)}catch(Y){return x&&x(Y)}setTimeout(function(){return D&&D()},50)},n.error=function(w){throw"Error in RoapOnJsep: "+w},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=_.callback,n.peerConnection.ontrack=function(w){n.onaddstream&&(n.onaddstream(w,"ontrack"),n.peerConnection.onaddstream=null)},n.peerConnection.onaddstream=function(w){n.onaddstream&&(n.onaddstream(w,"onaddstream"),n.peerConnection.ontrack=null)},n.peerConnection.onremovestream=function(w){n.onremovestream&&n.onremovestream(w)},n.peerConnection.oniceconnectionstatechange=function(w){i.default.debug(n.peerConnection.iceConnectionState),w.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(w.currentTarget.iceConnectionState)},n.renegotiate=function(){n.prevOffer!==void 0&&n.peerConnection.createOffer().then(function(w){return Object(l.getParameter)("PLAN")!=="unified-plan"&&(w.sdp=w.sdp.replace(/a=recvonly\r\n/g,`a=inactive\r
`)),w.sdp=B(w.sdp),w.sdp=q(w.sdp),n.peerConnection.setLocalDescription(w)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(w){i.default.error("createOffer error: ",w.message||w)})},n.peerConnection.onnegotiationneeded=n.renegotiate,n.onaddstream=null,n.onremovestream=null,n.onnegotiationneeded=null,n.state="new",n.markActionNeeded(),n},f=function(_){var n={},L=a.RTCPeerConnection;n.uid=_.uid,n.isVideoMute=_.isVideoMute,n.isAudioMute=_.isAudioMute,n.isSubscriber=_.isSubscriber,n.clientId=_.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[],bundlePolicy:"max-bundle"},n.con={optional:[{DtlsSrtpKeyAgreement:!0}]},_.iceServers instanceof Array?n.pc_config.iceServers=_.iceServers:(_.stunServerUrl&&(_.stunServerUrl instanceof Array?_.stunServerUrl.map(function(w){typeof w=="string"&&w!==""&&n.pc_config.iceServers.push({url:w})}):typeof _.stunServerUrl=="string"&&_.stunServerUrl!==""&&n.pc_config.iceServers.push({url:_.stunServerUrl})),_.turnServers&&(_.turnServers instanceof Array?_.turnServers.map(function(w){w.udpport&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.udpport+"?transport=udp"}),typeof w.tcpport=="string"&&w.tcpport!==""&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.tcpport+"?transport=tcp"}),w.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):i.default.error("[".concat(n.clientId,"] turnServers is not a array")))),_.audio===void 0&&(_.audio=!0),_.video===void 0&&(_.video=!0),n.mediaConstraints={mandatory:{OfferToReceiveVideo:_.video,OfferToReceiveAudio:_.audio}},n.roapSessionId=103;try{n.pc_config.sdpSemantics=Object(l.getParameter)("PLAN"),n.peerConnection=new L(n.pc_config,n.con)}catch{delete n.pc_config.sdpSemantics,n.peerConnection=new L(n.pc_config,n.con)}n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(l.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(w){var D,x,ee,Y;x=(D=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),ee=D.match(/a=candidate:.+typ\shost.+\r\n/),Y=D.match(/a=candidate:.+typ\srelay.+\r\n/),n.iceCandidateCount===0&&(n.timeout=setTimeout(function(){n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},1e3)),x===null&&ee===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1};var h=function(w){return _.screen&&(w=w.replace(`a=x-google-flag:conference\r
`,"")),w},t=function(w){var D,x;return(D=w.match(/m=video.*\r\n/))&&_.minVideoBW&&_.maxVideoBW&&(x=D[0]+"b=AS:"+_.maxVideoBW+`\r
`,w=w.replace(D[0],x),i.default.debug("["+n.clientId+"]Set Video Bitrate - min:"+_.minVideoBW+" max:"+_.maxVideoBW)),(D=w.match(/m=audio.*\r\n/))&&_.maxAudioBW&&(x=D[0]+"b=AS:"+_.maxAudioBW+`\r
`,w=w.replace(D[0],x)),w};n.processSignalingMessage=function(w){var D,x=JSON.parse(w);n.incomingMessage=x,n.state==="new"?x.messageType==="OFFER"?(D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="offer-sent"?x.messageType==="ANSWER"?((D={sdp:x.sdp,type:"answer"}).sdp=h(D.sdp),D.sdp=t(D.sdp),D.sdp=D.sdp.replace(/a=x-google-flag:conference\r\n/g,""),_.screen&&_.optimizationMode==="detail"&&(i.default.debug("[".concat(n.client,"] remove screen share abs ext")),D.sdp=D.sdp.replace(/a=.*abs-send-time\r\n/g,"").replace(/a=.*goog-remb\r\n/g,"")),n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)),n.state="established"):x.messageType==="pr-answer"?(D={sdp:x.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D))):x.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="established"&&(x.messageType==="OFFER"?(D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new RTCSessionDescription(D)),n.state="offer-received",n.markActionNeeded()):x.messageType==="ANSWER"?((D={sdp:x.sdp,type:"answer"}).sdp=h(D.sdp),D.sdp=t(D.sdp),n.peerConnection.setRemoteDescription(new RTCSessionDescription(D))):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var w=g()(b.a.mark(function D(x){return b.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:n.degradation=x;case 1:case"end":return ee.stop()}},D)}));return function(D){return w.apply(this,arguments)}}(),n._setRtpSenderParameters=function(){var w=g()(b.a.mark(function D(x){var ee,Y,Z;return b.a.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(ee=n.peerConnection.getSenders(),Y=ee.find(function(de){return de&&de.track&&de.track.kind==="video"})){oe.next=4;break}return oe.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=x,oe.prev=6,i.default.debug("[".concat(n.clientId,"] setParameters"),Z),oe.next=10,Y.setParameters(Z);case 10:oe.next=15;break;case 12:oe.prev=12,oe.t0=oe.catch(6),i.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return oe.stop()}},D,null,[[6,12]])}));return function(D){return w.apply(this,arguments)}}();var j={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},r={id:"",type:"",mediaType:"",googCodecName:_.codec?_.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},v={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},M={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},B={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},q=0,Q=0,z=0;return n.isRemoteVideoStats=function(w){return!!(w.frameHeight&&w.frameWidth&&w.remoteSource)},n.getVideoRelatedStats=function(w){n.peerConnection.getStats().then(function(D){D.forEach(function(x){if(n.isSubscriber){var ee={peerId:n.uid,mediaType:"video",isVideoMute:n.isVideoMute};if(x.type==="track"&&(~x.id.indexOf("video")||~x.trackIdentifier.indexOf("v")||n.isRemoteVideoStats(x))){if(!n.lastReport)return void(n.lastReport=x);ee.frameRateReceived=x.framesReceived-n.lastReport.framesReceived+"",ee.frameRateDecoded=x.framesDecoded-n.lastReport.framesDecoded+"",n.lastReport=x}x.type==="inbound-rtp"&&~x.id.indexOf("Video")&&(ee.bytesReceived=x.bytesReceived+"",ee.packetsReceived=x.packetsReceived+"",ee.packetsLost=x.packetsLost+""),w&&w(ee)}else if(x.type==="outbound-rtp"&&~x.id.indexOf("Video")){if(!n.lastReport)return void(n.lastReport=x);w&&w({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:_.maxFrameRate+"",frameRateSent:x.framesEncoded-n.lastReport.framesEncoded+""}),n.lastReport=x}})})},n.getAudioRelatedStats=function(w){n.peerConnection.getStats().then(function(D){D.forEach(function(x){n.isSubscriber&&x.type==="inbound-rtp"&&~x.id.indexOf("Audio")&&w&&w({peerId:n.uid,mediaType:"audio",isAudioMute:n.isAudioMute,frameDropped:x.packetsLost+"",frameReceived:x.packetsReceived+"",googJitterReceived:x.jitter+"",bytesReceived:x.bytesReceived+"",packetsReceived:x.packetsReceived+"",packetsLost:x.packetsLost+""})})})},n.getStatsRate=function(w){n.getStats(function(D){D.forEach(function(x){x.type==="outbound-rtp"&&x.mediaType==="video"&&x.googFramesEncoded&&(x.googFrameRateSent=Math.ceil((x.googFramesEncoded-q)/3).toString(),q=x.googFramesEncoded),x.type==="inbound-rtp"&&x.id.indexOf("55543")!=-1&&(x.googFrameRateReceived&&(x.googFrameRateReceived=Math.ceil((x.googFrameReceived-z)/3).toString(),z=x.googFrameReceived),x.googFrameRateDecoded&&(x.googFrameRateDecoded=Math.ceil((x.googFramesDecoded-Q)/3).toString(),Q=x.googFramesDecoded))}),w(D)})},n.getStats=function(w,D){D=(D=D||500)>500?500:D,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<D?w&&w(n.filterStatsCache,n.originStatsCache):this._getStats(function(x,ee){n.filterStatsCache=x,n.originStatsCache=ee,n.lastTimeGetStats=Date.now(),w&&w(x,ee)})},n._getStats=function(w){var D=[];n.peerConnection.getStats().then(function(x){x.forEach(function(Y){var Z;D.push(Y),Y.type==="outbound-rtp"&&Y.mediaType==="audio"&&(j.id=Y.id,j.type=Y.type,j.mediaType=Y.mediaType,j.bytesSent=Y.bytesSent?Y.bytesSent+"":"0",j.packetsSent=Y.packetsSent?Y.packetsSent+"":"0",_.agoraStream.local&&(j.audioInputLevel=Math.round(32767*_.agoraStream.getAudioLevel()).toString())),Y.type==="outbound-rtp"&&Y.mediaType==="video"&&(r.id=Y.id,r.type=Y.type,r.mediaType=Y.mediaType,r.bytesSent=Y.bytesSent?Y.bytesSent+"":"0",r.packetsSent=Y.packetsSent?Y.packetsSent+"":"0",r.googPlisReceived=Y.pliCount?Y.pliCount+"":"0",r.googNacksReceived=Y.nackCount?Y.nackCount+"":"0",r.googFirsReceived=Y.firCount?Y.firCount+"":"0",r.googFramesEncoded=Y.framesEncoded?Y.framesEncoded+"":"0",(Z=x.get(Y.trackId))&&(r.googFrameHeightSent=Z.frameHeight&&Z.frameHeight.toString(),r.googFrameWidthSent=Z.frameWidth&&Z.frameWidth.toString())),Y.type!=="inbound-rtp"||Y.id.indexOf("44444")==-1&&Y.mediaType!=="audio"||(v.id=Y.id,v.type=Y.type,v.mediaType="audio",v.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",v.bytesReceived=Y.bytesReceived?Y.bytesReceived+"":"0",v.packetsLost=Y.packetsLost?Y.packetsLost+"":"0",v.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",v.googJitterReceived=Y.jitter?Y.jitter+"":"0",(Z=x.get(Y.trackId))&&(v.audioOutputLevel=Z.audioLevel&&Math.round(32767*Z.audioLevel).toString()),_.agoraStream.local||v.audioOutputLevel||(v.audioOutputLevel=Math.round(32767*_.agoraStream.getAudioLevel()).toString())),Y.type!=="inbound-rtp"||Y.id.indexOf("55543")==-1&&Y.mediaType!=="video"||(M.id=Y.id,M.type=Y.type,M.mediaType="video",M.packetsReceived=Y.packetsReceived?Y.packetsReceived+"":"0",M.bytesReceived=Y.bytesReceived?Y.bytesReceived+"":"0",M.packetsLost=Y.packetsLost?Y.packetsLost+"":"0",M.googJitterBufferMs=Y.jitter?Y.jitter+"":"0",M.googNacksSent=Y.nackCount?Y.nackCount+"":"0",M.googPlisSent=Y.pliCount?Y.pliCount+"":"0",M.googFirsSent=Y.firCount?Y.firCount+"":"0",(Z=x.get(Y.trackId))&&(M.googFrameHeightReceived=Z.frameHeight&&Z.frameHeight.toString(),M.googFrameWidthReceived=Z.frameWidth&&Z.frameWidth.toString(),M.googFrameReceived=Z.framesReceived&&Z.framesReceived.toString(),M.googFramesDecoded=Z.framesDecoded&&Z.framesDecoded.toString())),Y.type==="candidate-pair"&&(Y.availableIncomingBitrate==0?B.googAvailableSendBandwidth=Y.availableOutgoingBitrate+"":B.googAvailableReceiveBandwidth=Y.availableIncomingBitrate+"")});var ee=[B,j,r,v,M];ee.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),w(ee,D)}).catch(function(x){i.default.error("["+n.clientId+"] ",x)})},n.addTrack=function(w,D){n.peerConnection.addTrack(w,D)},n.removeTrack=function(w,D){var x=n.peerConnection.getSenders().find(function(ee){return ee.track==w});x.replaceTrack(null),n.peerConnection.removeTrack(x)},n.addStream=function(w){window.navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")===-1?w.getTracks().forEach(function(D){return n.peerConnection.addTrack(D,w)}):n.peerConnection.addStream(w),n.markActionNeeded()},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(w){window.setTimeout(w,1)},n.onstablestate=function(){var w;if(n.actionNeeded){if(n.state==="new"||n.state==="established")_.isSubscriber&&(n.peerConnection.addTransceiver("audio",{direction:"recvonly"}),n.peerConnection.addTransceiver("video",{direction:"recvonly"})),n.peerConnection.createOffer(n.mediaConstraints).then(function(D){if(D.sdp=t(D.sdp),_.isSubscriber||(D.sdp=D.sdp.replace(/a=.*video-orientation\r\n/g,"")),D.sdp!==n.prevOffer)return n.peerConnection.setLocalDescription(D),n.state="preparing-offer",void n.markActionNeeded();i.default.debug("["+n.clientId+"]Not sending a new offer")}).catch(function(D){i.default.debug("["+n.clientId+"]peer connection create offer failed ",D)});else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(i.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),_.isCloudProxy3&&_.onNoIceCandidate&&_.onNoIceCandidate(),Object(l.getParameter)("SHIM_CANDIDATE")?(i.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):i.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(D){if(n.peerConnection.setLocalDescription(D),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var x=new Date;i.default.debug("["+n.clientId+"]"+x.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(D){i.default.debug("["+n.clientId+"]peer connection create answer failed ",D)},n.mediaConstraints);else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;w=n.peerConnection.localDescription.sdp,n.sendMessage("ANSWER",w),n.state="established"}else n.debug("Dazed and confused in state "+n.state+", stopping here");n.actionNeeded=!1}},n.sendMessage=function(w,D){var x={};x.messageType=w,x.sdp=D,w==="OFFER"?(x.offererSessionId=n.sessionId,x.answererSessionId=n.otherSessionId,x.seq=n.sequenceNumber+=1,x.tiebreaker=Math.floor(429496723*Math.random()+1)):(x.offererSessionId=n.incomingMessage.offererSessionId,x.answererSessionId=n.sessionId,x.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(x))},n._getSender=function(w){if(n.peerConnection&&n.peerConnection.getSenders){var D=n.peerConnection.getSenders().find(function(x){return x.track.kind==w});if(D)return D}return null},n.hasSender=function(w){return!!n._getSender(w)},n.replaceTrack=function(w,D,x){var ee=n._getSender(w.kind);if(!ee)return x("NO_SENDER_FOUND");try{ee.replaceTrack(w)}catch(Y){return x&&x(Y)}setTimeout(function(){return D&&D()},50)},n.error=function(w){throw"Error in RoapOnJsep: "+w},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=_.callback,n.peerConnection.ontrack=function(w){n.onaddstream&&n.onaddstream(w,"ontrack")},n.peerConnection.onremovestream=function(w){n.onremovestream&&n.onremovestream(w)},n.peerConnection.oniceconnectionstatechange=function(w){w.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date,n._setRtpSenderParameters(n.degradation)),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(w.currentTarget.iceConnectionState)},n.renegotiate=function(){n.isSubscriber||(i.default.debug("[".concat(n.uid,"]"),"renegotiating"),n.prevOffer!==void 0&&n.peerConnection.createOffer().then(function(w){return w.sdp=w.sdp.replace(/a=recvonly\r\n/g,`a=inactive\r
`),w.sdp=h(w.sdp),w.sdp=t(w.sdp),n.peerConnection.setLocalDescription(w)}).then(function(){n.onnegotiationneeded&&n.onnegotiationneeded(n.peerConnection.localDescription.sdp)}).catch(function(w){i.default.error("createOffer error: ",w)}))},n.isSubscriber||(n.peerConnection.onnegotiationneeded=n.renegotiate),n.onaddstream=null,n.onremovestream=null,n.state="new",n.markActionNeeded(),n};function C(_){if(typeof Symbol>"u"||_[Symbol.iterator]==null){if(Array.isArray(_)||(_=function(v,M){if(v){if(typeof v=="string")return I(v,M);var B=Object.prototype.toString.call(v).slice(8,-1);if(B==="Object"&&v.constructor&&(B=v.constructor.name),B==="Map"||B==="Set")return Array.from(B);if(B==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(B))return I(v,M)}}(_))){var n=0,L=function(){};return{s:L,n:function(){return n>=_.length?{done:!0}:{done:!1,value:_[n++]}},e:function(v){throw v},f:L}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h,t,j=!0,r=!1;return{s:function(){h=_[Symbol.iterator]()},n:function(){var v=h.next();return j=v.done,v},e:function(v){r=!0,t=v},f:function(){try{j||h.return==null||h.return()}finally{if(r)throw t}}}}function I(_,n){(n==null||n>_.length)&&(n=_.length);for(var L=0,h=new Array(n);L<n;L++)h[L]=_[L];return h}var P=function(_){var n={},L=(mozRTCPeerConnection,mozRTCSessionDescription),h=!1;n.uid=_.uid,n.isVideoMute=_.isVideoMute,n.isAudioMute=_.isAudioMute,n.isSubscriber=_.isSubscriber,n.clientId=_.clientId,n.filterStatsCache=[],n.originStatsCache=[],n.lastTimeGetStats=null,n.pc_config={iceServers:[]},_.iceServers instanceof Array?_.iceServers.map(function(w){w.url.indexOf("stun:")===0&&n.pc_config.iceServers.push({url:w.url})}):(_.stunServerUrl&&(_.stunServerUrl instanceof Array?_.stunServerUrl.map(function(w){typeof w=="string"&&w!==""&&n.pc_config.iceServers.push({url:w})}):typeof _.stunServerUrl=="string"&&_.stunServerUrl!==""&&n.pc_config.iceServers.push({url:_.stunServerUrl})),_.turnServers&&(_.turnServers instanceof Array?_.turnServers.map(function(w){w.udpport&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.udpport+"?transport=udp"}),typeof w.tcpport=="string"&&w.tcpport!==""&&n.pc_config.iceServers.push({username:w.username,credential:w.credential,credentialType:"password",urls:(w.useTurns?"turns:":"turn:")+w.url+":"+w.tcpport+"?transport=tcp"}),w.forceturn===!0&&(n.pc_config.iceTransportPolicy="relay")}):i.default.error("[".concat(n.clientId,"] turnServers is not a array")))),_.audio===void 0&&(_.audio=!0),_.video===void 0&&(_.video=!0),n.mediaConstraints={offerToReceiveAudio:_.audio,offerToReceiveVideo:_.video,mozDontOfferDataChannel:!0},n.roapSessionId=103,n.peerConnection=new a.RTCPeerConnection(n.pc_config),n.iceCandidateTimer=setTimeout(function(){n.iceCandidateTimer=null,i.default.debug("[".concat(n.clientId,"]Candidates collected: ").concat(n.iceCandidateCount)),n.moreIceComing&&(n.moreIceComing=!1,n.markActionNeeded())},Object(l.getParameter)("CANDIDATE_TIMEOUT")),n.peerConnection.onicecandidate=function(w){var D,x,ee,Y;x=(D=n.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),ee=D.match(/a=candidate:.+typ\shost.+\r\n/),Y=D.match(/a=candidate:.+typ\srelay.+\r\n/),x===null&&ee===null&&Y===null||n.ice!==void 0||!n.iceCandidateTimer||(clearTimeout(n.iceCandidateTimer),n.iceCandidateTimer=null,n.ice=0,n.moreIceComing=!1,n.markActionNeeded()),n.iceCandidateCount=n.iceCandidateCount+1},n.checkMLineReverseInSDP=function(w){return!(!~w.indexOf("m=audio")||!~w.indexOf("m=video"))&&w.indexOf("m=audio")>w.indexOf("m=video")},n.reverseMLineInSDP=function(w){var D=w.split("m=audio"),x=D[1].split("m=video"),ee="m=video"+x[1],Y="m=audio"+x[0];return w=D[0]+ee+Y},n.processSignalingMessage=function(w){var D,x=JSON.parse(w);n.incomingMessage=x,n.state==="new"?x.messageType==="OFFER"?(x.sdp=Q(x.sdp),D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new L(D),function(){i.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function(ee){i.default.info("["+n.clientId+"]setRemoteDescription failed: "+ee.name)}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="offer-sent"?x.messageType==="ANSWER"?(x.sdp=Q(x.sdp),x.sdp=x.sdp.replace(/ generation 0/g,""),x.sdp=x.sdp.replace(/ udp /g," UDP "),x.sdp.indexOf("a=group:BUNDLE")!==-1?(x.sdp=x.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),x.sdp=x.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),x.sdp=x.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(x.sdp=x.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),x.sdp=x.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),D={sdp:x.sdp,type:"answer"},_.screen&&_.optimizationMode==="detail"&&(i.default.debug("[".concat(n.client,"] remove screen share abs ext")),x.sdp=z(D.sdp)),n.peerConnection.setRemoteDescription(new L(D),function(){i.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function(ee){i.default.info("["+n.clientId+"]setRemoteDescription failed: "+ee)}),n.state="established"):x.messageType==="pr-answer"?(D={sdp:x.sdp,type:"pr-answer"},n.peerConnection.setRemoteDescription(new L(D),function(){i.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function(ee){i.default.info("["+n.clientId+"]setRemoteDescription failed: "+ee.name)})):x.messageType==="offer"?n.error("Not written yet"):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state):n.state==="established"&&(x.messageType==="OFFER"?(D={sdp:x.sdp,type:"offer"},n.peerConnection.setRemoteDescription(new L(D),function(){i.default.debug("["+n.clientId+"]setRemoteDescription succeeded")},function(ee){i.default.info("["+n.clientId+"]setRemoteDescription failed: "+ee.name)}),n.state="offer-received",n.markActionNeeded()):n.error("Illegal message for this state: "+x.messageType+" in state "+n.state))},n.setRtpSenderParameters=function(){var w=g()(b.a.mark(function D(x){var ee,Y,Z;return b.a.wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(ee=n.peerConnection.getSenders(),Y=ee.find(function(de){return de.track.kind==="video"})){oe.next=4;break}return oe.abrupt("return");case 4:return(Z=Y.getParameters()).degradationPreference=x,oe.prev=6,i.default.debug("[".concat(n.clientId,"] setParameters"),Z),oe.next=10,Y.setParameters(Z);case 10:oe.next=15;break;case 12:oe.prev=12,oe.t0=oe.catch(6),i.default.debug("[".concat(n.clientId,"] setParameters failed, ignore"));case 15:case"end":return oe.stop()}},D,null,[[6,12]])}));return function(D){return w.apply(this,arguments)}}();var t={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},j={id:"",type:"",mediaType:"",googCodecName:_.codec?_.codec.toUpperCase():"",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},r={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},v={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},M=0,B=0,q=0;n.getVideoRelatedStats=function(w){n.peerConnection.getStats().then(function(D){var x,ee=C(D.values());try{for(ee.s();!(x=ee.n()).done;){var Y=x.value;if(n.isSubscriber){if((Y.type==="inbound-rtp"||Y.type==="inboundrtp")&&Y.mediaType==="video"){if(!n.lastReport)return void(n.lastReport=Y);w&&w({browser:"firefox",mediaType:"video",peerId:n.uid,isVideoMute:n.isVideoMute,frameRateReceived:Math.round(Y.framerateMean)+"",frameRateDecoded:Y.framesDecoded-n.lastReport.framesDecoded+"",bytesReceived:Y.bytesReceived+"",packetsReceived:Y.packetsReceived+"",packetsLost:Y.packetsLost+""}),n.lastReport=Y}}else if((Y.type==="outbound-rtp"||Y.type==="outboundrtp")&&Y.mediaType==="video"){if(!n.lastReport)return void(n.lastReport=Y);w&&w({mediaType:"video",isVideoMute:n.isVideoMute,frameRateInput:Math.round(Y.framerateMean)+"",frameRateSent:Y.framesEncoded-n.lastReport.framesEncoded+""}),n.lastReport=Y}}}catch(Z){ee.e(Z)}finally{ee.f()}})},n.getAudioRelatedStats=function(w){n.peerConnection.getStats().then(function(D){var x,ee=C(D.values());try{for(ee.s();!(x=ee.n()).done;){var Y=x.value;n.isSubscriber&&(Y.type!=="inbound-rtp"&&Y.type!=="inboundrtp"||Y.mediaType!=="audio"||w&&w({browser:"firefox",mediaType:"audio",peerId:n.uid,isAudioMute:n.isAudioMute,frameDropped:Y.packetsLost+"",frameReceived:Y.packetsReceived+"",googJitterReceived:Y.jitter+"",bytesReceived:Y.bytesReceived+"",packetsReceived:Y.packetsReceived+"",packetsLost:Y.packetsLost+""}))}}catch(Z){ee.e(Z)}finally{ee.f()}})},n.getStatsRate=function(w){n.getStats(function(D){D.forEach(function(x){}),w(D)})},n.getStats=function(w,D){D=(D=D||500)>500?500:D,n.lastTimeGetStats&&Date.now()-n.lastTimeGetStats<D?w&&w(n.filterStatsCache,n.originStatsCache):this._getStats(function(x,ee){n.filterStatsCache=x,n.originStatsCache=ee,n.lastTimeGetStats=Date.now(),w&&w(x,ee)})},n._getStats=function(w){n.peerConnection.getStats().then(function(D){var x,ee=[],Y=C(D.values());try{for(Y.s();!(x=Y.n()).done;){var Z=x.value;ee.push(Z),Z.type!=="outbound-rtp"&&Z.type!=="outboundrtp"||Z.mediaType!=="video"||Z.id.indexOf("rtcp")!==-1||(j.id=Z.id,j.type=Z.type,j.mediaType=Z.mediaType,j.bytesSent=Z.bytesSent?Z.bytesSent+"":"0",j.packetsSent=Z.packetsSent?Z.packetsSent+"":"0",j.googPlisReceived=Z.pliCount?Z.pliCount+"":"0",j.googNacksReceived=Z.nackCount?Z.nackCount+"":"0",j.googFirsReceived=Z.firCount?Z.firCount+"":"0",j.googFrameRateSent=Z.framerateMean?Math.round(Z.framerateMean)+"":"0"),Z.type!=="outbound-rtp"&&Z.type!=="outboundrtp"||Z.mediaType!=="audio"||Z.id.indexOf("rtcp")!==-1||(t.id=Z.id,t.type=Z.type,t.mediaType=Z.mediaType,t.bytesSent=Z.bytesSent?Z.bytesSent+"":"0",t.packetsSent=Z.packetsSent?Z.packetsSent+"":"0",_.agoraStream.local&&(t.audioInputLevel=Math.round(32767*_.agoraStream.getAudioLevel()).toString())),Z.type!=="inbound-rtp"&&Z.type!=="inboundrtp"||Z.mediaType!=="audio"||Z.isRemote||Z.id.indexOf("rtcp")!==-1||(r.id=Z.id,r.type=Z.type,r.mediaType=Z.mediaType,r.bytesReceived=Z.bytesReceived?Z.bytesReceived+"":"0",r.packetsLost=Z.packetsLost?Z.packetsLost+"":"0",r.packetsReceived=Z.packetsReceived?Z.packetsReceived+"":"0",r.googJitterReceived=Z.jitter?Z.jitter+"":"0",_.agoraStream.local||(r.audioOutputLevel=Math.round(32767*_.agoraStream.getAudioLevel()).toString())),Z.type!=="inbound-rtp"&&Z.type!=="inboundrtp"||Z.mediaType!=="video"||Z.isRemote||Z.id.indexOf("rtcp")!==-1||(v.id=Z.id,v.type=Z.type,v.mediaType=Z.mediaType,v.bytesReceived=Z.bytesReceived?Z.bytesReceived+"":"0",v.googFrameRateReceived=Z.framerateMean?Math.round(Z.framerateMean)+"":"0",v.googFramesDecoded=Z.framesDecoded?Z.framesDecoded+"":"0",Date.now()-q>=1e3?(v.googFrameRateDecoded=(Z.framesDecoded-M)/((Date.now()-q)/1e3),v.googFrameRateDecoded=Math.round(Math.max(0,v.googFrameRateDecoded)),q=Date.now(),B=v.googFrameRateDecoded,M=Z.framesDecoded,v.googFrameRateDecoded=v.googFrameRateDecoded.toString()):v.googFrameRateDecoded=B.toString(),v.packetsLost=Z.packetsLost?Z.packetsLost+"":"0",v.packetsReceived=Z.packetsReceived?Z.packetsReceived+"":"0",v.googJitterBufferMs=Z.jitter?Z.jitter+"":"0",v.googNacksSent=Z.nackCount?Z.nackCount+"":"0",v.googPlisSent=Z.pliCount?Z.pliCount+"":"0",v.googFirsSent=Z.firCount?Z.firCount+"":"0"),Z.id.indexOf("outbound_rtcp_video")!==-1&&(j.packetsLost=Z.packetsLost?Z.packetsLost+"":"0")}}catch(de){Y.e(de)}finally{Y.f()}var oe=[j,t,r,v];oe.push({id:"time",startTime:n.connectedTime,timestamp:new Date}),w(oe,ee)},function(D){i.default.error("["+n.clientId+"]"+D)})},n.addStream=function(w){h=!0,n.peerConnection.addStream(w),n.markActionNeeded()},n.removeStream=function(){n.markActionNeeded()},n.close=function(){n.state="closed",n.peerConnection.close()},n.markActionNeeded=function(){n.actionNeeded=!0,n.doLater(function(){n.onstablestate()})},n.doLater=function(w){window.setTimeout(w,1)},n.onstablestate=function(){if(n.actionNeeded){if(n.state==="new"||n.state==="established")h&&(n.mediaConstraints=void 0),n.peerConnection.createOffer(function(D){if(D.sdp=Q(D.sdp),D.sdp=D.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),D.sdp!==n.prevOffer)return n.peerConnection.setLocalDescription(D),n.state="preparing-offer",void n.markActionNeeded();i.default.debug("["+n.clientId+"]Not sending a new offer")},function(D){i.default.debug("["+n.clientId+"]Ups! create offer failed ",D)},n.mediaConstraints);else if(n.state==="preparing-offer"){if(n.moreIceComing)return;n.prevOffer=n.peerConnection.localDescription.sdp,n.offerCandidates=n.prevOffer.match(/a=candidate.+\r\n/g)||[],n.offerCandidates.length||(_.isCloudProxy3&&_.onNoIceCandidate&&_.onNoIceCandidate(),i.default.warning("[".concat(n.clientId,"]No Ice Candidate generated")),Object(l.getParameter)("SHIM_CANDIDATE")?(i.default.debug("Shimming fake candidate"),n.prevOffer+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`):i.default.error("[".concat(n.clientId,"]None Ice Candidate not allowed"))),n.prevOffer=n.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`),n.sendMessage("OFFER",n.prevOffer),n.state="offer-sent"}else if(n.state==="offer-received")n.peerConnection.createAnswer(function(D){if(n.peerConnection.setLocalDescription(D),n.state="offer-received-preparing-answer",n.iceStarted)n.markActionNeeded();else{var x=new Date;i.default.debug("["+n.clientId+"]"+x.getTime()+": Starting ICE in responder"),n.iceStarted=!0}},function(){i.default.debug("["+n.clientId+"]Ups! Something went wrong")});else if(n.state==="offer-received-preparing-answer"){if(n.moreIceComing)return;var w=n.peerConnection.localDescription.sdp;n.sendMessage("ANSWER",w),n.state="established"}else n.debug("Dazed and confused in state "+n.state+", stopping here");n.actionNeeded=!1}},n.sendMessage=function(w,D){var x={};x.messageType=w,x.sdp=D,w==="OFFER"?(x.offererSessionId=n.sessionId,x.answererSessionId=n.otherSessionId,x.seq=n.sequenceNumber+=1,x.tiebreaker=Math.floor(429496723*Math.random()+1)):(x.offererSessionId=n.incomingMessage.offererSessionId,x.answererSessionId=n.sessionId,x.seq=n.incomingMessage.seq),n.onsignalingmessage(JSON.stringify(x))},n._getSender=function(w){if(n.peerConnection&&n.peerConnection.getSenders){var D=n.peerConnection.getSenders().find(function(x){return x.track.kind==w});if(D)return D}return null},n.hasSender=function(w){return!!n._getSender(w)},n.replaceTrack=function(w,D,x){var ee=n._getSender(w.kind);if(!ee)return x("NO_SENDER_FOUND");try{ee.replaceTrack(w)}catch(Y){return x&&x(Y)}setTimeout(function(){return D&&D()},50)},n.error=function(w){throw"Error in RoapOnJsep: "+w},n.sessionId=n.roapSessionId+=1,n.sequenceNumber=0,n.actionNeeded=!1,n.iceStarted=!1,n.moreIceComing=!0,n.iceCandidateCount=0,n.onsignalingmessage=_.callback,n.peerConnection.ontrack=function(w){n.onaddstream&&n.onaddstream(w,"ontrack")},n.peerConnection.onremovestream=function(w){n.onremovestream&&n.onremovestream(w)},n.peerConnection.oniceconnectionstatechange=function(w){w.currentTarget.iceConnectionState==="connected"&&(n.connectedTime=new Date),n.oniceconnectionstatechange&&n.oniceconnectionstatechange(w.currentTarget.iceConnectionState)};var Q=function(w){var D;if(_.video&&_.maxVideoBW&&((D=w.match(/m=video.*\r\n/))==null&&(D=w.match(/m=video.*\n/)),D&&D.length>0)){var x=D[0]+"b=TIAS:"+1e3*_.maxVideoBW+`\r
`;w=w.replace(D[0],x)}return _.audio&&_.maxAudioBW&&((D=w.match(/m=audio.*\r\n/))==null&&(D=w.match(/m=audio.*\n/)),D&&D.length>0)&&(x=D[0]+"b=TIAS:"+1e3*_.maxAudioBW+`\r
`,w=w.replace(D[0],x)),w},z=function(w){return(w=w.replace(/a=.*abs-send-time\r\n/g,"")).replace(/a=.*goog-remb\r\n/g,"")};return n.onaddstream=null,n.onremovestream=null,n.state="new",n.markActionNeeded(),n},T=y(50),F=y.n(T),J=y(26),G=(y(5),103),H=function(_){var n={};if(n.clientId=_.clientId,_.session_id=G+=1,typeof window>"u"||!window.navigator)throw i.default.error("["+n.streamId+"]["+n.clientId+"]Publish/subscribe video/audio streams not supported yet"),new Error("NON_BROWSER_ENV_DETECTED");return window.navigator.userAgent.match("Firefox")!==null?(n.browser="mozilla",n=P(_)):m.getBrowserOS()==="iOS"||m.isSafari()?(i.default.debug("["+n.streamId+"]["+n.clientId+"]Safari"),(n=f(_)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?n=new F.a(_):(n=S(_)).browser="chrome-stable",n},V=function(_,n,L){var h={};h.config=_,h.streamId=_.streamId,delete _.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var t=0,j=1,r=!1,v=null,M=function(z){if(t++,v)if(v===z)i.default.debug("Using Video Source/ Audio Source");else{var w=v.getVideoTracks()[0],D=v.getAudioTracks()[0],x=z.getVideoTracks()[0],ee=z.getAudioTracks()[0];x&&(w&&v.removeTrack(w),v.addTrack(x)),ee&&(D&&v.removeTrack(D),v.addTrack(ee))}else v=z;t!==j||r||(r=!0,setTimeout(function(){n(v)},0))},B=function(z){i.default.error("Failed to GetUserMedia",z.name,z.code,z.message,z),t++,r||(r=!0,setTimeout(function(){L&&L(z)},0))},q=function(){var z={video:_.video,audio:_.audio};if(i.default.debug("GetUserMedia",JSON.stringify(z)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(z).then(M).catch(B);else if(typeof navigator<"u"&&navigator.getMedia)navigator.getMedia(_,M,B);else{var w={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};i.default.error("["+h.streamId+"]"+w.message),L&&L(w)}};if((_.videoSource||_.audioSource)&&(v=new MediaStream,_.videoSource&&v.addTrack(_.videoSource),_.audioSource&&v.addTrack(_.audioSource)),_.video||_.audio||_.screen||_.screenAudio){if(!_.screen&&_.screenAudio)return L&&L({code:"Set screen to true before sharing the audio"});if(_.screen){if(J.a.isElectron())return _.screen.sourceId?J.a.getScreenStream(_.screen.sourceId,_.screen,function(z,w){z?B(z):(_.audio&&(j++,q()),M(w))}):J.a.shareScreen(_.screen,function(z,w){z?B(z):(_.audio&&(j++,q()),M(w))});if(m.isFireFox()){if(i.default.debug("["+h.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(_.screen.mediaSource))return L&&L({code:"Invalid mediaSource, mediaSource should be one of [screen, window, application]"});navigator.getMedia({video:_.screen},function(z){_.audio&&(j++,q()),M(z)},B)}else if(m.isChromeKernel()&&_.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void L({code:"This browser does not support screen sharing"});i.default.debug("["+h.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(_.screen.extensionId,{getStream:!0},function(z){z===void 0?(i.default.error("["+h.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),B({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(_.screen.mandatory.chromeMediaSourceId=z.streamId,navigator.getMedia({video:_.screen},function(w){_.audio&&(j++,q()),M(w)},B))})}catch{return i.default.debug("["+h.streamId+"]AgoraRTC screensharing plugin is not accessible"),void L({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var Q={};return typeof _.screen.width=="number"&&typeof _.screen.height=="number"?Q.video={width:{ideal:_.screen.width},height:{ideal:_.screen.height}}:Q.video={width:_.screen.width,height:_.screen.height},_.screen.frameRate&&_.screen.frameRate.min?Q.video.frameRate={ideal:_.screen.frameRate.max,max:_.screen.frameRate.max}:Q.video.frameRate=_.screen.frameRate,_.screenAudio&&(Q.audio=_.screenAudio),i.default.debug("use getDisplayMedia, constraints:",Q),window.navigator.mediaDevices.getDisplayMedia(Q).then(function(z){!_.screenAudio&&_.audio&&(j++,q()),M(z)}).catch(B)}i.default.error("["+h.streamId+"]This browser does not support screenSharing"),L({code:"This browser does not support screen sharing"})}}else q()}else M(v)}},function(c,O,y){var m=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(O,"__esModule",{value:!0});var d=m(y(0)),E=function(){function p(b,s,g){s===void 0&&(s=""),this.name="AgoraRTCException",this.code=b,this.message="AgoraRTCError "+this.code+": "+s,this.data=g}return p.prototype.toString=function(){return this.data?this.message+" data: "+JSON.stringify(this.data):this.message},p.prototype.throw=function(){throw d.default.error(this.toString()),this},p}();O.AgoraRTCError=E,function(p){p.UNEXPECTED_ERROR="UNEXPECTED_ERROR",p.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",p.TIMEOUT="TIMEOUT",p.INVALID_PARAMS="INVALID_PARAMS",p.NOT_SUPPORT="NOT_SUPPORT",p.INVALID_OPERATION="INVALID_OPERATION",p.OPERATION_ABORT="OPERATION_ABORT",p.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",p.NETWORK_ERROR="NETWORK_ERROR",p.NETWORK_TIMEOUT="NETWORK_TIMEOUT",p.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",p.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",p.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",p.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",p.ELECTRON_IS_NULL="ELECTRON_IS_NULL",p.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",p.STREAM_ALREADY_INITIALIZED="STREAM_ALREADY_INITIALIZED",p.STREAM_IS_CLOSED="STREAM_IS_CLOSED",p.ABORT_OTHER_INIT="ABORT_OTHER_INIT",p.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",p.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",p.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",p.PERMISSION_DENIED="PERMISSION_DENIED",p.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",p.CAN_NOT_AUTOPLAY="CAN_NOT_AUTOPLAY",p.HIGH_STREAM_NO_VIDEO_TRACK="HIGH_STREAM_NO_VIDEO_TRACK",p.SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM="SCREEN_SHARE_CAN_NOT_CREATE_LOW_STREAM",p.TRACK_IS_DISABLED="TRACK_IS_DISABLED",p.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",p.TOKEN_GENERATOR_FUNCTION_ERROR="TOKEN_GENERATOR_FUNCTION_ERROR",p.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",p.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",p.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",p.UID_CONFLICT="UID_CONFLICT",p.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",p.INVALID_TRACK="INVALID_TRACK",p.SENDER_NOT_FOUND="SENDER_NOT_FOUND",p.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",p.SET_ANSWER_FAILED="SET_ANSWER_FAILED",p.ICE_FAILED="ICE_FAILED",p.PC_CLOSED="PC_CLOSED",p.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",p.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",p.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",p.INVALID_REMOTE_USER="INVALID_REMOTE_USER",p.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",p.SUBSCRIPTION_IS_IN_PROGRESS="SUBSCRIPTION_IS_IN_PROGRESS",p.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",p.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",p.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",p.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",p.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",p.EFFECT_ID_CONFLICTED="EFFECT_ID_CONFLICTED",p.EFFECT_SOUND_ID_NOT_FOUND="EFFECT_SOUND_ID_NOT_FOUND",p.WS_ABORT="WS_ABORT",p.WS_DISCONNECT="WS_DISCONNECT",p.WS_ERR="WS_ERR",p.CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER="CAN_NOT_CONNECT_TO_LIVE_STREAMING_WORKER",p.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",p.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",p.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",p.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",p.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT="LIVE_STREAMING_TRANSCODING_NOT_SUPPORT",p.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",p.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",p.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",p.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",p.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",p.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",p.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",p.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",p.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",p.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",p.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",p.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",p.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(O.AgoraRTCErrorCode||(O.AgoraRTCErrorCode={}))},function(c,O,y){y.d(O,"a",function(){return s});var m=y(0),d=window.AudioContext||window.webkitAudioContext,E=y(2),p=E.getParameter,b=E.setParameter,s=function(){return p("AUDIO_CONTEXT")||b("AUDIO_CONTEXT",function(){if(d){var g=new d;return window.ctx=g,new Promise(function(i){document.body?i():window.addEventListener("load",i)}).then(function(){var i=function a(){g.state=="suspended"?(m.default.debug("AudioContext is suspended, auto resume"),g.resume().then(function(){m.default.debug("AudioContext resume success"),document.body.removeEventListener("touchend",a,!0),document.body.removeEventListener("mousedown",a,!0)})):(m.default.debug("AudioContext is running"),document.body.removeEventListener("touchend",a,!0),document.body.removeEventListener("mousedown",a,!0))};document.body.addEventListener("touchend",i,!0),document.body.addEventListener("mousedown",i,!0)}),g}throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}()),p("AUDIO_CONTEXT")};s()},function(c,O,y){var m=y(1),d=null,E=function(){try{d=window.require("electron")}catch{}return d},p=function(s){var g=m.report.reportApiInvoke(null,{callback:s,name:"getScreenSources",options:arguments,tag:"tracer"}),i=E();if(!i)return g&&g("electron is null");try{var a=i.desktopCapturer.getSources({types:["window","screen"]})}catch(l){console.log(l)}a instanceof Promise?a.then(function(l){return g&&g(null,l)}).catch(function(l){return g&&g(l)}):a=i.desktopCapturer.getSources({types:["window","screen"]},function(l,A){g&&g(null,A)})},b=function(s,g,i){var a=g.width;g={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:g.height,maxWidth:a,maxFrameRate:g.frameRate&&g.frameRate.max,minFrameRate:g.frameRate&&g.frameRate.min}}},navigator.webkitGetUserMedia(g,function(l){i&&i(null,l)},function(l){i&&i(l)})};O.a={isElectron:function(){return!!E()},getElectronInstance:E,getScreenSources:p,getScreenStream:b,shareScreen:function(s,g){p(function(i,a){if(i)return g&&g(i);(function(l,A){var k=document.createElement("div");k.innerText="share screen",k.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");var C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var I=document.createElement("div");I.setAttribute("style","text-align: right; padding: 16px 0;");var P=document.createElement("button");P.innerHTML="cancel",P.setAttribute("style","width: 85px;"),P.onclick=function(){document.body.removeChild(T),A&&A("NotAllowedError")},I.appendChild(P),S.appendChild(f),S.appendChild(C),S.appendChild(I);var T=document.createElement("div");T.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(k),T.appendChild(S),document.body.appendChild(T),l.map(function(F){if(F.id){var J=document.createElement("div");J.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");var G=F.thumbnail;G.getSize().width>1920&&(G=G.resize({width:1920})),J.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+G.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+F.name.replace(/[\u00A0-\u9999<>\&]/g,function(H){return"&#"+H.charCodeAt(0)+";"})+"</span>",J.onclick=function(){document.body.removeChild(T),A&&A(null,F.id)},C.appendChild(J)}})})(a,function(l,A){if(l)return g&&g(l);b(A,s,g)})})}}},function(c,O,y){Object.defineProperty(O,"__esModule",{value:!0});var m=y(3);(function(d){d.TRANSCODE="mix_streaming",d.RAW="raw_streaming",d.INJECT="inject_streaming"})(O.LiveStreamingServiceMode||(O.LiveStreamingServiceMode={})),O.DEFAULT_LIVE_STREAMING_TRANSCODING_USER={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},O.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},O.isLiveStreamingTranscodingConfig=function(d){return m.isEmpty(d.width)||m.checkValidNumber(d.width,"config.width",0),m.isEmpty(d.height)||m.checkValidNumber(d.height,"config.height",0),m.isEmpty(d.videoBitrate)||m.checkValidNumber(d.videoBitrate,"config.videoBitrate",1,1e6),m.isEmpty(d.videoFramerate)||m.checkValidNumber(d.videoFramerate,"config.videoFramerate"),m.isEmpty(d.lowLatency)||m.checkValidBoolean(d.lowLatency,"config.lowLatency"),m.isEmpty(d.audioSampleRate)||m.checkValidEnum(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),m.isEmpty(d.audioBitrate)||m.checkValidNumber(d.audioBitrate,"config.audioBitrate",1,128),m.isEmpty(d.audioChannels)||m.checkValidEnum(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),m.isEmpty(d.videoGop)||m.checkValidNumber(d.videoGop,"config.videoGop"),m.isEmpty(d.videoCodecProfile)||m.checkValidEnum(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),m.isEmpty(d.userCount)||m.checkValidNumber(d.userCount,"config.userCount",0,17),m.isEmpty(d.backgroundColor)||m.checkValidNumber(d.backgroundColor,"config.backgroundColor",0,16777215),d.transcodingUsers&&!m.isEmpty(d.transcodingUsers)&&(m.checkValidArray(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach(function(E,p){m.checkValidUID(E.uid),m.isEmpty(E.x)||m.checkValidNumber(E.x,"transcodingUser["+p+"].x",0,1e4),m.isEmpty(E.y)||m.checkValidNumber(E.y,"transcodingUser["+p+"].y",0,1e4),m.isEmpty(E.width)||m.checkValidNumber(E.width,"transcodingUser["+p+"].width",0,1e4),m.isEmpty(E.height)||m.checkValidNumber(E.height,"transcodingUser["+p+"].height",0,1e4),m.isEmpty(E.zOrder)||m.checkValidNumber(E.zOrder-1,"transcodingUser["+p+"].zOrder",0,100),m.isEmpty(E.alpha)||m.checkValidFloatNumber(E.alpha,"transcodingUser["+p+"].alpha",0,1)})),d.images&&!m.isEmpty(d.images)&&(m.checkValidArray(d.images,"config.images"),d.images.forEach(function(E,p){m.checkValidString(E.url,"images["+p+"].url",1,1e3,!1),m.isEmpty(E.x)||m.checkValidNumber(E.x,"images["+p+"].x",0,1e4),m.isEmpty(E.y)||m.checkValidNumber(E.y,"images["+p+"].y",0,1e4),m.isEmpty(E.width)||m.checkValidNumber(E.width,"images["+p+"].width",0,1e4),m.isEmpty(E.height)||m.checkValidNumber(E.height,"images["+p+"].height",0,1e4),m.isEmpty(E.zOrder)||m.checkValidNumber(E.zOrder,"images["+p+"].zOrder",0,255),m.isEmpty(E.alpha)||m.checkValidFloatNumber(E.alpha,"images["+p+"].alpha",0,1)})),!0},O.DEFAULT_TRANSCODING_CONFIG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFramerate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},O.isInjectStreamConfig=function(d){return m.isEmpty(d.audioVolume)||m.checkValidNumber(d.audioVolume,"config.audioVolume",0,1e3),m.isEmpty(d.audioBitrate)||m.checkValidNumber(d.audioBitrate,"config.audioBitrate",1,1e4),m.isEmpty(d.audioChannels)||m.checkValidEnum(d.audioChannels,"config.audioChannels",[1,2]),m.isEmpty(d.audioSampleRate)||m.checkValidEnum(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),m.isEmpty(d.width)||m.checkValidNumber(d.width,"config.width",0,1e4),m.isEmpty(d.height)||m.checkValidNumber(d.height,"config.height",0,1e4),m.isEmpty(d.videoBitrate)||m.checkValidNumber(d.videoBitrate,"config.videoBitrate",1,1e4),m.isEmpty(d.videoFramerate)||m.checkValidNumber(d.videoFramerate,"config.videoFramerate",1,1e4),m.isEmpty(d.videoGop)||m.checkValidNumber(d.videoGop,"config.videoGop",1,1e4),!0},O.DEFAULT_INJECT_CONFIG={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},function(d){d.WARNING="@live_uap-warning",d.ERROR="@line_uap-error",d.PUBLISH_STREAM_STATUS="@live_uap-publish-status",d.INJECT_STREAM_STATUS="@live_uap-inject-status",d.WORKER_STATUS="@live_uap-worker-status",d.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(O.LiveStreamingUapSignalEvents||(O.LiveStreamingUapSignalEvents={})),function(d){d.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(O.LiveStreamingInternalEvents||(O.LiveStreamingInternalEvents={})),function(d){d[d.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",d[d.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",d[d.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",d[d.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",d[d.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",d[d.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",d[d.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",d[d.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",d[d.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",d[d.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",d[d.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",d[d.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",d[d.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",d[d.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",d[d.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",d[d.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",d[d.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",d[d.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE=505]="LIVE_STREAM_RESPONSE_INGNORE_MESSAGE",d[d.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",d[d.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",d[d.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",d[d.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(O.LIVE_STREAM_ERROR_CODE||(O.LIVE_STREAM_ERROR_CODE={})),function(d){d.CONNECTED="websocket:connected",d.RECONNECTING="websocket:reconnecting",d.WILL_RECONNECT="websocket:will_reconnect",d.CLOSED="websocket:closed",d.FAILED="websocket:failed",d.ON_MESSAGE="websocket:on_message",d.REQUEST_NEW_URLS="websocket:request_new_urls"}(O.WebSocketManagerEvents||(O.WebSocketManagerEvents={}))},function(c,O,y){var m=y(57),d=y(58);c.exports=function(E,p,b){var s=p&&b||0;typeof E=="string"&&(p=E==="binary"?new Array(16):null,E=null);var g=(E=E||{}).random||(E.rng||m)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,p)for(var i=0;i<16;++i)p[s+i]=g[i];return p||d(g)}},function(c,O,y){var m;c.exports=(m=y(73),function(d){var E=m,p=E.lib,b=p.WordArray,s=p.Hasher,g=E.algo,i=[],a=[];(function(){function k(I){for(var P=d.sqrt(I),T=2;T<=P;T++)if(!(I%T))return!1;return!0}function S(I){return 4294967296*(I-(0|I))|0}for(var f=2,C=0;C<64;)k(f)&&(C<8&&(i[C]=S(d.pow(f,.5))),a[C]=S(d.pow(f,1/3)),C++),f++})();var l=[],A=g.SHA256=s.extend({_doReset:function(){this._hash=new b.init(i.slice(0))},_doProcessBlock:function(k,S){for(var f=this._hash.words,C=f[0],I=f[1],P=f[2],T=f[3],F=f[4],J=f[5],G=f[6],H=f[7],V=0;V<64;V++){if(V<16)l[V]=0|k[S+V];else{var _=l[V-15],n=(_<<25|_>>>7)^(_<<14|_>>>18)^_>>>3,L=l[V-2],h=(L<<15|L>>>17)^(L<<13|L>>>19)^L>>>10;l[V]=n+l[V-7]+h+l[V-16]}var t=C&I^C&P^I&P,j=(C<<30|C>>>2)^(C<<19|C>>>13)^(C<<10|C>>>22),r=H+((F<<26|F>>>6)^(F<<21|F>>>11)^(F<<7|F>>>25))+(F&J^~F&G)+a[V]+l[V];H=G,G=J,J=F,F=T+r|0,T=P,P=I,I=C,C=r+(j+t)|0}f[0]=f[0]+C|0,f[1]=f[1]+I|0,f[2]=f[2]+P|0,f[3]=f[3]+T|0,f[4]=f[4]+F|0,f[5]=f[5]+J|0,f[6]=f[6]+G|0,f[7]=f[7]+H|0},_doFinalize:function(){var k=this._data,S=k.words,f=8*this._nDataBytes,C=8*k.sigBytes;return S[C>>>5]|=128<<24-C%32,S[14+(C+64>>>9<<4)]=d.floor(f/4294967296),S[15+(C+64>>>9<<4)]=f,k.sigBytes=4*S.length,this._process(),this._hash},clone:function(){var k=s.clone.call(this);return k._hash=this._hash.clone(),k}});E.SHA256=s._createHelper(A),E.HmacSHA256=s._createHmacHelper(A)}(Math),m.SHA256)},function(c,O,y){Object.defineProperty(O,"__esModule",{value:!0}),O.randomString=function(m){m===void 0&&(m=8);for(var d="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",E=d.length,p="",b=0;b<m;b++)p+=d.charAt(Math.floor(Math.random()*E));return p}},function(c,O,y){var m=this&&this.__assign||function(){return(m=Object.assign||function(I){for(var P,T=1,F=arguments.length;T<F;T++)for(var J in P=arguments[T])Object.prototype.hasOwnProperty.call(P,J)&&(I[J]=P[J]);return I}).apply(this,arguments)},d=this&&this.__awaiter||function(I,P,T,F){return new(T||(T=Promise))(function(J,G){function H(n){try{_(F.next(n))}catch(L){G(L)}}function V(n){try{_(F.throw(n))}catch(L){G(L)}}function _(n){var L;n.done?J(n.value):(L=n.value,L instanceof T?L:new T(function(h){h(L)})).then(H,V)}_((F=F.apply(I,P||[])).next())})},E=this&&this.__generator||function(I,P){var T,F,J,G,H={label:0,sent:function(){if(1&J[0])throw J[1];return J[1]},trys:[],ops:[]};return G={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function V(_){return function(n){return function(L){if(T)throw new TypeError("Generator is already executing.");for(;H;)try{if(T=1,F&&(J=2&L[0]?F.return:L[0]?F.throw||((J=F.return)&&J.call(F),0):F.next)&&!(J=J.call(F,L[1])).done)return J;switch(F=0,J&&(L=[2&L[0],J.value]),L[0]){case 0:case 1:J=L;break;case 4:return H.label++,{value:L[1],done:!1};case 5:H.label++,F=L[1],L=[0];continue;case 7:L=H.ops.pop(),H.trys.pop();continue;default:if(J=H.trys,!((J=J.length>0&&J[J.length-1])||L[0]!==6&&L[0]!==2)){H=0;continue}if(L[0]===3&&(!J||L[1]>J[0]&&L[1]<J[3])){H.label=L[1];break}if(L[0]===6&&H.label<J[1]){H.label=J[1],J=L;break}if(J&&H.label<J[2]){H.label=J[2],H.ops.push(L);break}J[2]&&H.ops.pop(),H.trys.pop();continue}L=P.call(I,H)}catch(h){L=[6,h],F=0}finally{T=J=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([_,n])}}},p=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(O,"__esModule",{value:!0});var b=y(2),s=p(y(37)),g=y(24),i=p(y(0)),a=y(1);function l(I){return new Promise(function(P){window.setTimeout(P,I)})}function A(I,P){return new Promise(function(T,F){P.timeout=P.timeout||b.getParameter("HTTP_CONNECT_TIMEOUT"),P.responseType=P.responseType||"json",P.data&&(P.data=JSON.stringify(P.data)),P.headers=P.headers||{},P.headers["Content-Type"]="application/json",P.method="POST",P.url=I,s.default.request(P).then(function(J){T(J.data)}).catch(function(J){s.default.isCancel(J)?F(new g.AgoraRTCError(g.AgoraRTCErrorCode.OPERATION_ABORT,"cancel token canceled")):J.code==="ECONNABORTED"?F(new g.AgoraRTCError(g.AgoraRTCErrorCode.NETWORK_TIMEOUT,J.message)):J.response?F(new g.AgoraRTCError(g.AgoraRTCErrorCode.NETWORK_RESPONSE_ERROR,J.response.status)):F(new g.AgoraRTCError(g.AgoraRTCErrorCode.NETWORK_ERROR,J.message))})})}function k(I,P,T,F){var J=this,G=Object.assign({},O.DEFAULT_RETRY_CONFIG,F),H=G.timeout,V=function(){return d(J,void 0,void 0,function(){return E(this,function(L){switch(L.label){case 0:return[4,l(H)];case 1:return L.sent(),H*=G.timeoutFactor,H=Math.min(G.maxRetryTimeout,H),[2]}})})},_=!1,n=new Promise(function(L,h){return d(J,void 0,void 0,function(){var t,j,r;return E(this,function(v){switch(v.label){case 0:P=P||function(){return!1},T=T||function(){return!0},t=0,v.label=1;case 1:if(!(t<G.maxRetryCount))return[3,12];if(_)return[2,h(new g.AgoraRTCError(g.AgoraRTCErrorCode.OPERATION_ABORT))];v.label=2;case 2:return v.trys.push([2,7,,11]),[4,I()];case 3:return j=v.sent(),P(j,t)?t+1===G.maxRetryCount?[2,L(j)]:[4,V()]:[3,5];case 4:return v.sent(),[3,6];case 5:return[2,L(j)];case 6:return[3,11];case 7:return r=v.sent(),T(r,t)?t+1===G.maxRetryCount?[2,h(r)]:[4,V()]:[3,9];case 8:return v.sent(),[3,10];case 9:return[2,h(r)];case 10:return[3,11];case 11:return t+=1,[3,1];case 12:return[2]}})})});return n.cancel=function(){return _=!0},n}function S(I,P){return{addressList:I.servers.map(function(T,F){return"wss://"+T.address.replace(/\./g,"-")+".edge.agora.io:"+T.wss+"?serviceName="+encodeURIComponent(P)}),workerToken:I.workerToken,vid:I.vid}}O.wait=l,O.post=A,O.DEFAULT_RETRY_CONFIG={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4},O.getRetryWaitTime=function(I,P){var T=P.timeout*Math.pow(P.timeoutFactor,I);return Math.min(P.maxRetryTimeout,T)},O.retryable=k,O.liveStreamingServerResponseToResult=S;var f=1;function C(I,P,T,F,J){var G=this;J===void 0&&(J=O.DEFAULT_RETRY_CONFIG),f+=1;var H,V,_={sid:T.sid,command:"convergeAllocateEdge",uid:"666",appId:T.appId,ts:Math.floor(Date.now()/1e3),seq:f,requestId:f,version:b.VERSION,cname:T.cname},n={service_name:P,json_body:JSON.stringify(_)},L=I[0];return k(function(){return d(G,void 0,void 0,function(){var h,t,j,r,v;return E(this,function(M){switch(M.label){case 0:return H=Date.now(),[4,A(L,{data:n,cancelToken:F,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}})];case 1:if(h=M.sent(),V=Date.now()-H,h.code!==0)throw j=new g.AgoraRTCError(g.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming ap error, code"+h.code,{retry:!0}),i.default.error(j.toString()),j;if((t=JSON.parse(h.json_body)).code!==200)throw j=new g.AgoraRTCError(g.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center error, code: "+t.code+", reason: "+t.reason),i.default.error(j.toString()),j;if(!t.servers||t.servers.length===0)throw j=new g.AgoraRTCError(g.AgoraRTCErrorCode.UNEXPECTED_RESPONSE,"live streaming app center empty server"),i.default.error(j.toString()),j;if(r=S(t,P),b.getParameter("LIVE_STREAMING_ADDRESS"))try{v=JSON.parse(b.getParameter("LIVE_STREAMING_ADDRESS")),r.addressList=v}catch{r.addressList=[b.getParameter("LIVE_STREAMING_ADDRESS")]}return[2,m(m({},r),{responseTime:V})]}})})},function(h,t){return a.report.requestApWorkerEvent(T.sid,{success:!0,sc:200,serviceName:P,responseDetail:JSON.stringify(h.addressList),firstSuccess:t===0,responseTime:V,serverIp:I[t%I.length]}),!1},function(h,t){return a.report.requestApWorkerEvent(T.sid,{success:!1,sc:h.data&&h.data.code||200,serviceName:P,responseTime:V,serverIp:I[t%I.length]}),!!(h.code!==g.AgoraRTCErrorCode.OPERATION_ABORT&&h.code!==g.AgoraRTCErrorCode.UNEXPECTED_RESPONSE||h.data&&h.data.retry)&&(L=I[(t+1)%I.length],!0)},J)}O.requestLiveStreamingWorkerManager=C,O.getLiveStreamingWorkerMangerResult=function(I,P,T){return d(this,void 0,void 0,function(){var F,J;return E(this,function(G){switch(G.label){case 0:F=b.getParameter("UAP_AP").map(function(H){return P.proxyServer?"https://"+P.proxyServer+"/ap/?url="+H+"/api/v1?action=uap":"https://"+H+"/api/v1?action=uap"}),G.label=1;case 1:return G.trys.push([1,3,,4]),[4,C(F,I,P,T)];case 2:return[2,G.sent()];case 3:throw J=G.sent(),a.report.requestApWorkerEvent(P.sid,{success:!1,sc:J.data&&J.data.code||200,serviceName:I,responseTime:J.data&&J.data.responseTime}),J;case 4:return[2]}})})}},function(c,O,y){var m=y(70),d=y(71),E=y(34),p=y(72);c.exports=function(b){return m(b)||d(b)||E(b)||p()}},function(c,O){var y;y=function(){return this}();try{y=y||new Function("return this")()}catch{typeof window=="object"&&(y=window)}c.exports=y},function(c,O,y){var m=y(35);c.exports=function(d,E){if(d){if(typeof d=="string")return m(d,E);var p=Object.prototype.toString.call(d).slice(8,-1);return p==="Object"&&d.constructor&&(p=d.constructor.name),p==="Map"||p==="Set"?Array.from(p):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?m(d,E):void 0}}},function(c,O){c.exports=function(y,m){(m==null||m>y.length)&&(m=y.length);for(var d=0,E=new Array(m);d<m;d++)E[d]=y[d];return E}},function(c,O,y){var m=this&&this.__spreadArrays||function(){for(var b=0,s=0,g=arguments.length;s<g;s++)b+=arguments[s].length;var i=Array(b),a=0;for(s=0;s<g;s++)for(var l=arguments[s],A=0,k=l.length;A<k;A++,a++)i[a]=l[A];return i};Object.defineProperty(O,"__esModule",{value:!0});var d=y(24),E=function(){function b(){this._events={},this.addListener=this.on}return b.prototype.getListeners=function(s){return this._events[s]?this._events[s].map(function(g){return g.listener}):[]},b.prototype.on=function(s,g){this._events[s]||(this._events[s]=[]);var i=this._events[s];this._indexOfListener(i,g)===-1&&i.push({listener:g,once:!1})},b.prototype.once=function(s,g){this._events[s]||(this._events[s]=[]);var i=this._events[s];this._indexOfListener(i,g)===-1&&i.push({listener:g,once:!0})},b.prototype.off=function(s,g){if(this._events[s]){var i=this._events[s],a=this._indexOfListener(i,g);a!==-1&&i.splice(a,1),this._events[s].length===0&&delete this._events[s]}},b.prototype.removeAllListeners=function(s){s?delete this._events[s]:this._events={}},b.prototype.emit=function(s){for(var g=[],i=1;i<arguments.length;i++)g[i-1]=arguments[i];this._events[s]||(this._events[s]=[]);for(var a=this._events[s].map(function(k){return k}),l=0;l<a.length;l+=1){var A=a[l];A.once&&this.off(s,A.listener),A.listener.apply(this,g||[])}},b.prototype._indexOfListener=function(s,g){for(var i=s.length;i--;)if(s[i].listener===g)return i;return-1},b}();function p(b,s){for(var g=[],i=2;i<arguments.length;i++)g[i-2]=arguments[i];var a=null,l=null;if(b.emit.apply(b,m([s],g,[function(A){a=A},function(A){l=A}])),l!==null)throw l;if(a===null)throw new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"handler is not sync");return a}O.EventEmitter=E,O.emitAsPromise=function(b,s){for(var g=[],i=2;i<arguments.length;i++)g[i-2]=arguments[i];return b.getListeners(s).length===0?Promise.reject(new d.AgoraRTCError(d.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not emit promise")):new Promise(function(a,l){b.emit.apply(b,m([s],g,[a,l]))})},O.emitAsInvokerNoResponse=function(b,s){for(var g=[],i=2;i<arguments.length;i++)g[i-2]=arguments[i];return b.getListeners(s).length===0?null:p.apply(void 0,m([b,s],g))},O.emitAsInvoker=p},function(c,O,y){c.exports=y(78)},function(c,O,y){c.exports=function(m,d){return function(){for(var E=new Array(arguments.length),p=0;p<E.length;p++)E[p]=arguments[p];return m.apply(d,E)}}},function(c,O,y){var m=y(18);function d(E){return encodeURIComponent(E).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}c.exports=function(E,p,b){if(!p)return E;var s;if(b)s=b(p);else if(m.isURLSearchParams(p))s=p.toString();else{var g=[];m.forEach(p,function(a,l){a!=null&&(m.isArray(a)?l+="[]":a=[a],m.forEach(a,function(A){m.isDate(A)?A=A.toISOString():m.isObject(A)&&(A=JSON.stringify(A)),g.push(d(l)+"="+d(A))}))}),s=g.join("&")}if(s){var i=E.indexOf("#");i!==-1&&(E=E.slice(0,i)),E+=(E.indexOf("?")===-1?"?":"&")+s}return E}},function(c,O,y){c.exports=function(m){return!(!m||!m.__CANCEL__)}},function(c,O,y){(function(m){var d=y(18),E=y(84),p={"Content-Type":"application/x-www-form-urlencoded"};function b(i,a){!d.isUndefined(i)&&d.isUndefined(i["Content-Type"])&&(i["Content-Type"]=a)}var s,g={adapter:((typeof XMLHttpRequest<"u"||m!==void 0&&Object.prototype.toString.call(m)==="[object process]")&&(s=y(42)),s),transformRequest:[function(i,a){return E(a,"Accept"),E(a,"Content-Type"),d.isFormData(i)||d.isArrayBuffer(i)||d.isBuffer(i)||d.isStream(i)||d.isFile(i)||d.isBlob(i)?i:d.isArrayBufferView(i)?i.buffer:d.isURLSearchParams(i)?(b(a,"application/x-www-form-urlencoded;charset=utf-8"),i.toString()):d.isObject(i)?(b(a,"application/json;charset=utf-8"),JSON.stringify(i)):i}],transformResponse:[function(i){if(typeof i=="string")try{i=JSON.parse(i)}catch{}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(i){return i>=200&&i<300}};g.headers={common:{Accept:"application/json, text/plain, */*"}},d.forEach(["delete","get","head"],function(i){g.headers[i]={}}),d.forEach(["post","put","patch"],function(i){g.headers[i]=d.merge(p)}),c.exports=g}).call(this,y(83))},function(c,O,y){var m=y(18),d=y(85),E=y(39),p=y(87),b=y(90),s=y(91),g=y(43);c.exports=function(i){return new Promise(function(a,l){var A=i.data,k=i.headers;m.isFormData(A)&&delete k["Content-Type"];var S=new XMLHttpRequest;if(i.auth){var f=i.auth.username||"",C=i.auth.password||"";k.Authorization="Basic "+btoa(f+":"+C)}var I=p(i.baseURL,i.url);if(S.open(i.method.toUpperCase(),E(I,i.params,i.paramsSerializer),!0),S.timeout=i.timeout,S.onreadystatechange=function(){if(S&&S.readyState===4&&(S.status!==0||S.responseURL&&S.responseURL.indexOf("file:")===0)){var F="getAllResponseHeaders"in S?b(S.getAllResponseHeaders()):null,J={data:i.responseType&&i.responseType!=="text"?S.response:S.responseText,status:S.status,statusText:S.statusText,headers:F,config:i,request:S};d(a,l,J),S=null}},S.onabort=function(){S&&(l(g("Request aborted",i,"ECONNABORTED",S)),S=null)},S.onerror=function(){l(g("Network Error",i,null,S)),S=null},S.ontimeout=function(){var F="timeout of "+i.timeout+"ms exceeded";i.timeoutErrorMessage&&(F=i.timeoutErrorMessage),l(g(F,i,"ECONNABORTED",S)),S=null},m.isStandardBrowserEnv()){var P=y(92),T=(i.withCredentials||s(I))&&i.xsrfCookieName?P.read(i.xsrfCookieName):void 0;T&&(k[i.xsrfHeaderName]=T)}if("setRequestHeader"in S&&m.forEach(k,function(F,J){A===void 0&&J.toLowerCase()==="content-type"?delete k[J]:S.setRequestHeader(J,F)}),m.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),i.responseType)try{S.responseType=i.responseType}catch(F){if(i.responseType!=="json")throw F}typeof i.onDownloadProgress=="function"&&S.addEventListener("progress",i.onDownloadProgress),typeof i.onUploadProgress=="function"&&S.upload&&S.upload.addEventListener("progress",i.onUploadProgress),i.cancelToken&&i.cancelToken.promise.then(function(F){S&&(S.abort(),l(F),S=null)}),A===void 0&&(A=null),S.send(A)})}},function(c,O,y){var m=y(86);c.exports=function(d,E,p,b,s){var g=new Error(d);return m(g,E,p,b,s)}},function(c,O,y){var m=y(18);c.exports=function(d,E){E=E||{};var p={},b=["url","method","params","data"],s=["headers","auth","proxy"],g=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];m.forEach(b,function(l){E[l]!==void 0&&(p[l]=E[l])}),m.forEach(s,function(l){m.isObject(E[l])?p[l]=m.deepMerge(d[l],E[l]):E[l]!==void 0?p[l]=E[l]:m.isObject(d[l])?p[l]=m.deepMerge(d[l]):d[l]!==void 0&&(p[l]=d[l])}),m.forEach(g,function(l){E[l]!==void 0?p[l]=E[l]:d[l]!==void 0&&(p[l]=d[l])});var i=b.concat(s).concat(g),a=Object.keys(E).filter(function(l){return i.indexOf(l)===-1});return m.forEach(a,function(l){E[l]!==void 0?p[l]=E[l]:d[l]!==void 0&&(p[l]=d[l])}),p}},function(c,O,y){function m(d){this.message=d}m.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},m.prototype.__CANCEL__=!0,c.exports=m},function(c,O){c.exports=function(y,m,d){return m in y?Object.defineProperty(y,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):y[m]=d,y}},function(c,O,y){var m=this&&this.__awaiter||function(S,f,C,I){return new(C||(C=Promise))(function(P,T){function F(H){try{G(I.next(H))}catch(V){T(V)}}function J(H){try{G(I.throw(H))}catch(V){T(V)}}function G(H){var V;H.done?P(H.value):(V=H.value,V instanceof C?V:new C(function(_){_(V)})).then(F,J)}G((I=I.apply(S,f||[])).next())})},d=this&&this.__generator||function(S,f){var C,I,P,T,F={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return T={next:J(0),throw:J(1),return:J(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function J(G){return function(H){return function(V){if(C)throw new TypeError("Generator is already executing.");for(;F;)try{if(C=1,I&&(P=2&V[0]?I.return:V[0]?I.throw||((P=I.return)&&P.call(I),0):I.next)&&!(P=P.call(I,V[1])).done)return P;switch(I=0,P&&(V=[2&V[0],P.value]),V[0]){case 0:case 1:P=V;break;case 4:return F.label++,{value:V[1],done:!1};case 5:F.label++,I=V[1],V=[0];continue;case 7:V=F.ops.pop(),F.trys.pop();continue;default:if(P=F.trys,!((P=P.length>0&&P[P.length-1])||V[0]!==6&&V[0]!==2)){F=0;continue}if(V[0]===3&&(!P||V[1]>P[0]&&V[1]<P[3])){F.label=V[1];break}if(V[0]===6&&F.label<P[1]){F.label=P[1],P=V;break}if(P&&F.label<P[2]){F.label=P[2],F.ops.push(V);break}P[2]&&F.ops.pop(),F.trys.pop();continue}V=f.call(S,F)}catch(_){V=[6,_],I=0}finally{C=P=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([G,H])}}},E=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}},p=this&&this.__importStar||function(S){if(S&&S.__esModule)return S;var f={};if(S!=null)for(var C in S)Object.hasOwnProperty.call(S,C)&&(f[C]=S[C]);return f.default=S,f};Object.defineProperty(O,"__esModule",{value:!0});var b=E(y(59)),s=p(y(62)),g=p(y(63)),i=E(y(0)),a=y(2),l=b.default.Root.fromJSON(g),A=function(){function S(){this.requestArray=[],this.retryBackoffCount=0,this.state=0}return S.prototype.setProxy=function(f){this.proxyServer=f},S.prototype.sendReportList=function(f,C){var I=this,P=this._dataConvert("ProtoRaws",{vid:C,sendTs:Math.round(Date.now()/1e3),payloads:f.map(function(T){return{id:s[T.type],msg:I._dataConvert(T.type,T.data)}})});this.send(P)},S.prototype._dataConvert=function(f,C){var I;try{I=l.lookupType("protobuf."+f)}catch{i.default.error("[send-proto] invalid proto name "+f)}var P=I.create(C);return I.encode(P).finish()},S.prototype.send=function(f){this.state==0?this._send(f):this.requestArray.push(f)},S.prototype._send=function(f){return m(this,void 0,void 0,function(){return d(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,4]),this.state=1,[4,this.request(f)];case 1:return C.sent(),this.retryBackoffCount=0,this.requestArray.length!==0?this._send(this.requestArray.shift()):this.state=0,[3,4];case 2:return C.sent(),[4,k(this.retryBackoffCount++<2?200:1e4)];case 3:return C.sent(),this._send(f),[3,4];case 4:return[2]}})})},S.prototype.request=function(f){return m(this,void 0,void 0,function(){var C,I;return d(this,function(P){switch(P.label){case 0:C=this._getAddress(),I=this._getBackupAddress(),P.label=1;case 1:return P.trys.push([1,3,,5]),[4,this._request(C,f)];case 2:return P.sent(),[3,5];case 3:return P.sent(),[4,this._request(I,f)];case 4:return P.sent(),[3,5];case 5:return[2]}})})},S.prototype._request=function(f,C){return this._post(f,C)},S.prototype._post=function(f,C){var I=this;return new Promise(function(P,T){var F=new XMLHttpRequest;F.timeout=a.getParameter("HTTP_CONNECT_TIMEOUT"),F.open("POST",f,!0),F.setRequestHeader("Content-type","application/octet-stream"),I.proxyServer||(F.setRequestHeader("Cache-Control","no-cache, no-store"),F.setRequestHeader("Pragma","no-cache"),F.setRequestHeader("Expires","0")),F.onload=function(J){P(F.responseText)},F.onerror=function(J){T(J)},F.ontimeout=function(J){T(J)},F.send(C)})},S.prototype._getAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+a.getParameter("EVENT_REPORT_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+a.getParameter("EVENT_REPORT_DOMAIN")+":6443/events/proto-raws"},S.prototype._getBackupAddress=function(){return this.proxyServer?"https://"+this.proxyServer+"/rs/?h="+a.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+"&p=6443&d=events/proto-raws":"https://"+a.getParameter("EVENT_REPORT_BACKUP_DOMAIN")+":6443/events/proto-raws"},S}();O.default=A;var k=function(S){return new Promise(function(f){window.setTimeout(f,S)})}},function(c,O){c.exports=function(y,m){if(!(y instanceof m))throw new TypeError("Cannot call a class as a function")}},function(c,O){function y(m,d){for(var E=0;E<d.length;E++){var p=d[E];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(m,p.key,p)}}c.exports=function(m,d,E){return d&&y(m.prototype,d),E&&y(m,E),m}},function(c,O,y){var m=this&&this.__awaiter||function(i,a,l,A){return new(l||(l=Promise))(function(k,S){function f(P){try{I(A.next(P))}catch(T){S(T)}}function C(P){try{I(A.throw(P))}catch(T){S(T)}}function I(P){var T;P.done?k(P.value):(T=P.value,T instanceof l?T:new l(function(F){F(T)})).then(f,C)}I((A=A.apply(i,a||[])).next())})},d=this&&this.__generator||function(i,a){var l,A,k,S,f={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return S={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function C(I){return function(P){return function(T){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,A&&(k=2&T[0]?A.return:T[0]?A.throw||((k=A.return)&&k.call(A),0):A.next)&&!(k=k.call(A,T[1])).done)return k;switch(A=0,k&&(T=[2&T[0],k.value]),T[0]){case 0:case 1:k=T;break;case 4:return f.label++,{value:T[1],done:!1};case 5:f.label++,A=T[1],T=[0];continue;case 7:T=f.ops.pop(),f.trys.pop();continue;default:if(k=f.trys,!((k=k.length>0&&k[k.length-1])||T[0]!==6&&T[0]!==2)){f=0;continue}if(T[0]===3&&(!k||T[1]>k[0]&&T[1]<k[3])){f.label=T[1];break}if(T[0]===6&&f.label<k[1]){f.label=k[1],k=T;break}if(k&&f.label<k[2]){f.label=k[2],f.ops.push(T);break}k[2]&&f.ops.pop(),f.trys.pop();continue}T=a.call(i,f)}catch(F){T=[6,F],A=0}finally{l=k=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([I,P])}}},E=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(O,"__esModule",{value:!0});var p,b=E(y(0)),s=y(15);(function(i){i.NEW="new",i.PREPARING_OFFER="preparing-offer",i.OFFER_SENT="offer-sent",i.ESTABLISHED="established",i.CLOSED="closed"})(p||(p={}));var g=function(){function i(a){this.candidate=null,this.state=p.NEW,this.config=a,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(a),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:this.config.codec.toUpperCase(),bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return i.prototype.addStream=function(a){this.peerConnection.addStream(a)},i.prototype.setRtpSenderParameters=function(a){return m(this,void 0,void 0,function(){return d(this,function(l){return[2]})})},i.prototype.setAnswer=function(a){var l=JSON.parse(a);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:l.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},i.prototype.close=function(){this.peerConnection.close()},i.prototype.getStats=function(a,l){if(l===void 0&&(l=500),l=l>500?500:l,Date.now()-this.lastTimeGetStats<l){var A=[];this.config.isSubscriber?(A.push(this.receiveVideoStats),A.push(this.receiveAudioStats)):(A.push(this.sendAudioStats),A.push(this.sendVideoStats)),A.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),a&&a(A)}else this._getStats(a)},i.prototype._getStats=function(a){var l=this,A=[];this.peerConnection.getStats(null).then(function(k){l.lastTimeGetStats=Date.now(),Object.keys(k).map(function(S){var f=k[S];l.config.isSubscriber?f.type&&f.type==="inboundrtp"&&f.mediaType&&f.mediaType==="audio"?(l.receiveAudioStats.id=f.id+"recv",l.receiveAudioStats.type=f.type+"",l.receiveAudioStats.mediaType=f.mediaType+"",l.receiveAudioStats.packetsReceived=f.packetsReceived+"",l.receiveAudioStats.bytesReceived=f.bytesReceived+"",l.receiveAudioStats.packetsLost=f.packetsLost+"",l.receiveAudioStats.googJitterReceived=f.jitter+""):f.type&&f.type==="inboundrtp"&&f.mediaType&&f.mediaType==="video"?(l.receiveVideoStats.id=f.id+"recv",l.receiveVideoStats.type=f.type+"",l.receiveVideoStats.mediaType=f.mediaType+"",l.receiveVideoStats.packetsReceived=f.packetsReceived+"",l.receiveVideoStats.bytesReceived=f.bytesReceived+"",l.receiveVideoStats.packetsLost=f.packetsLost+"",l.receiveVideoStats.googJitterBufferMs=f.jitter+"",l.receiveVideoStats.googPlisSent=f.pliCount+"",l.receiveVideoStats.googFirsSent=f.firCount+"",l.receiveVideoStats.googNacksSent=f.nackCount+""):f.remoteSource&&f.type&&f.type==="track"&&f.trackIdentifier&&f.trackIdentifier.indexOf("v")!==-1?(l.receiveVideoStats.googFrameHeightReceived=f.frameHeight+"",l.receiveVideoStats.googFrameWidthReceived=f.frameWidth+"",l.receiveVideoStats.googFrameRateDecoded=f.framesPerSecond+"",l.receiveVideoStats.googFrameRateOutput=f.framesPerSecond+"",l.receiveVideoStats.googFrameRateReceived=f.framesPerSecond+"",l.receiveVideoStats.googFramesDecoded=f.framesDecoded+"",l.receiveVideoStats.googFrameReceived=f.framesReceived+""):f.remoteSource&&f.type&&f.type==="track"&&f.trackIdentifier&&f.trackIdentifier.indexOf("a")!==-1&&(l.receiveAudioStats.audioOutputLevel=f.audioLevel+""):!f.isRemote&&f.type&&f.type==="outboundrtp"&&f.mediaType&&f.mediaType==="audio"?(l.sendAudioStats.id=f.id+"send",l.sendAudioStats.type=f.type+"",l.sendAudioStats.mediaType=f.mediaType+"",l.sendAudioStats.packetsSent=f.packetsSent+"",l.sendAudioStats.bytesSent=f.bytesSent+""):!f.isRemote&&f.type&&f.type==="outboundrtp"&&f.mediaType&&f.mediaType==="video"?(l.sendVideoStats.id=f.id+"send",l.sendVideoStats.type=f.type+"",l.sendVideoStats.mediaType=f.mediaType+"",l.sendVideoStats.packetsSent=f.packetsSent+"",l.sendVideoStats.bytesSent=f.bytesSent+"",l.sendVideoStats.googRtt=f.roundTripTime+"",l.sendVideoStats.googPlisReceived=f.pliCount+"",l.sendVideoStats.googFirsReceived=f.firCount+"",l.sendVideoStats.googNacksReceived=f.nackCount+""):!f.remoteSource&&f.type&&f.type==="track"&&f.framesSent&&f.framesSent!==0&&(l.sendVideoStats.googFrameHeightSent=f.frameHeight+"",l.sendVideoStats.googFrameHeightInput=f.frameHeight+"",l.sendVideoStats.googFrameWidthSent=f.frameWidth+"",l.sendVideoStats.googFrameWidthInput=f.frameWidth+"",l.sendVideoStats.googFramesEncoded=f.framesSent+"",l.sendVideoStats.googFrameRateSent=f.framesPerSecond+"")}),l.config.isSubscriber?(A.push(l.receiveVideoStats),A.push(l.receiveAudioStats)):(A.push(l.sendAudioStats),A.push(l.sendVideoStats)),A.push({id:"time",startTime:l.connectedTime,timestamp:Date.now()}),a&&a(A)})},i.prototype.getStatsRate=function(a){this.getStats(a)},i.prototype.initPeecConnection=function(a){var l=a.stunServerUrl,A=a.turnServer,k=a.iceServers;return this.pcConfig={iceServers:[]},k instanceof Array?this.pcConfig.iceServers=a.iceServers:l&&(l instanceof Array?l.map(function(S){typeof S=="string"&&S!==""&&this.pcConfig.iceServers.push({urls:S})}):typeof l=="string"&&l!==""&&this.pcConfig.iceServers.push({urls:l})),A&&(A instanceof Array?A.map(function(S){typeof S.url=="string"&&S.url!==""&&this.pcConfig.iceServers.push({username:S.username,credential:S.credential,url:S.url})}):A.mode!=="auto"&&A.mode!=="manual"||(A.udpport&&this.pcConfig.iceServers.push({username:A.username,credential:A.credential,credentialType:"password",urls:"turn:"+A.url+":"+A.udpport+"?transport=udp"}),typeof A.tcpport=="string"&&A.tcpport!==""&&this.pcConfig.iceServers.push({username:A.username,credential:A.credential,credentialType:"password",urls:"turn:"+A.url+":"+A.tcpport+"?transport=tcp"}),A.forceturn===!0&&(this.pcConfig.iceTransportPolicy="relay"))),new s.RTCPeerConnection(this.pcConfig)},i.prototype._ontrack=function(a){this.onaddstream&&this.onaddstream(a,"ontrack")},i.prototype._onaddstream=function(a){this.onaddstream&&this.onaddstream(a,"onaddstream")},i.prototype._oniceconnectionstatechange=function(a){a.currentTarget.iceConnectionState==="connected"&&(this.state=p.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(a.currentTarget.iceConnectionState)},i.prototype._onicecandidate=function(a){!this.candidate&&a&&(this.candidate=a.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},i.prototype.setLocalSDP=function(a){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:a.sdp,type:"offer"})),this.state=p.PREPARING_OFFER,a},i.prototype.editLocalSDP=function(a){return a.sdp=this.setBandWidth(a.sdp),a.sdp=this.reviseOpus(a.sdp),a.sdp=this.addCandidate(a.sdp),a},i.prototype.setSendRecv=function(a){return a=(a=(a=a.replace(/a=recvonly\r\n/g,`a=sendrecv\r
`)).replace(/a=sendonly\r\n/g,`a=sendrecv\r
`)).replace(/a=inactive\r\n/g,`a=sendrecv\r
`)},i.prototype.setBandWidth=function(a){var l,A,k=this.config,S=k.codec,f=k.minVideoBW,C=k.maxVideoBW,I=k.maxAudioBW,P=k.clientId;if((l=a.match(/m=video.*\r\n/))&&f&&C){A=l[0]+"b=AS:"+C+`\r
`;var T=0,F=0;S==="h264"?(T=a.search(/a=rtpmap:(\d+) H264\/90000\r\n/),F=a.search(/H264\/90000\r\n/)):S==="vp8"?(T=a.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),F=a.search(/VP8\/90000\r\n/)):S==="vp9"&&(T=a.search(/a=rtpmap:(\d+) VP9\/90000\r\n/),F=a.search(/VP9\/90000\r\n/)),T!==-1&&F!==-1&&F-T>10&&(A=A+"a=fmtp:"+a.slice(T+9,F-1)+" x-google-min-bitrate="+f+`\r
`),a=a.replace(l[0],A),b.default.debug("["+P+"]Set Video Bitrate - min:"+f+" max:"+C)}return(l=a.match(/m=audio.*\r\n/))&&I&&(A=l[0]+"b=AS:"+I+`\r
`,a=a.replace(l[0],A)),a},i.prototype.reviseOpus=function(a){return a=(a=a.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},i.prototype.addCandidate=function(a){return a+=`a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r
`},i.prototype.sendOffer=function(a){this.config.callback(JSON.stringify({sdp:a.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=p.OFFER_SENT},i}();O.default=g},function(c,O,y){var m=y(65),d=y(66),E=y(34),p=y(67);c.exports=function(b,s){return m(b)||d(b,s)||E(b,s)||p()}},function(c,O,y){var m,d,E;d=this,E=function(){var p,b=this;function s(A){b.console&&(b.console.error?b.console.error(A):b.console.log&&b.console.log(A))}function g(A,k,S,f){var C=f||s,I=A.createShader(S);return A.shaderSource(I,k),A.compileShader(I),A.getShaderParameter(I,A.COMPILE_STATUS)?I:(C("*** Error compiling shader '"+I+"':"+A.getShaderInfoLog(I)),A.deleteShader(I),null)}function i(A,k,S,f,C){var I=C||s,P=A.createProgram();return k.forEach(function(T){A.attachShader(P,T)}),S&&S.forEach(function(T,F){A.bindAttribLocation(P,f?f[F]:F,T)}),A.linkProgram(P),A.getProgramParameter(P,A.LINK_STATUS)?P:(I("Error in program linking:"+A.getProgramInfoLog(P)),A.deleteProgram(P),null)}(p=p||b)===p.top&&(console.log("%c%s","color:blue;font-weight:bold;","for more about webgl-utils.js see:"),console.log("%c%s","color:blue;font-weight:bold;","http://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html"));var a,l=["VERTEX_SHADER","FRAGMENT_SHADER"];return!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(a=HTMLCanvasElement.prototype.getContext,function(){var A=arguments,k=A[0];return k==="webgl"&&((A=[].slice.call(arguments))[0]="experimental-webgl"),a.apply(this,A)})),{createProgram:i,createProgramFromSources:function(A,k,S,f,C){for(var I=[],P=0;P<k.length;++P)I.push(g(A,k[P],A[l[P]],C));return i(A,I,S,f,C)}}},(m=function(){return E.call(d)}.apply(O,[]))===void 0||(c.exports=m)},function(c,O,y){var m=this&&this.__awaiter||function(i,a,l,A){return new(l||(l=Promise))(function(k,S){function f(P){try{I(A.next(P))}catch(T){S(T)}}function C(P){try{I(A.throw(P))}catch(T){S(T)}}function I(P){var T;P.done?k(P.value):(T=P.value,T instanceof l?T:new l(function(F){F(T)})).then(f,C)}I((A=A.apply(i,a||[])).next())})},d=this&&this.__generator||function(i,a){var l,A,k,S,f={label:0,sent:function(){if(1&k[0])throw k[1];return k[1]},trys:[],ops:[]};return S={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function C(I){return function(P){return function(T){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,A&&(k=2&T[0]?A.return:T[0]?A.throw||((k=A.return)&&k.call(A),0):A.next)&&!(k=k.call(A,T[1])).done)return k;switch(A=0,k&&(T=[2&T[0],k.value]),T[0]){case 0:case 1:k=T;break;case 4:return f.label++,{value:T[1],done:!1};case 5:f.label++,A=T[1],T=[0];continue;case 7:T=f.ops.pop(),f.trys.pop();continue;default:if(k=f.trys,!((k=k.length>0&&k[k.length-1])||T[0]!==6&&T[0]!==2)){f=0;continue}if(T[0]===3&&(!k||T[1]>k[0]&&T[1]<k[3])){f.label=T[1];break}if(T[0]===6&&f.label<k[1]){f.label=k[1],k=T;break}if(k&&f.label<k[2]){f.label=k[2],f.ops.push(T);break}k[2]&&f.ops.pop(),f.trys.pop();continue}T=a.call(i,f)}catch(F){T=[6,F],A=0}finally{l=k=0}if(5&T[0])throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}([I,P])}}},E=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(O,"__esModule",{value:!0});var p=y(68),b=y(4),s=E(y(0));O.getSupportedCodec=function(i){return m(void 0,void 0,void 0,function(){var a,l,A,k,S;return d(this,function(f){switch(f.label){case 0:return a={video:[],audio:[]},typeof window<"u"?[3,1]:(s.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{l=p.createRTCPeerConnection({iceServers:[]})}catch(C){return s.default.error("Failed to init RTCPeerConnection",C),[2,Promise.reject(C)]}return l?[3,2]:(s.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(a)]);case 2:return i&&i.stream?[3,7]:(A={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},k=void 0,(b.isSafari()||b.isFireFox()||b.isWeChatBrowser())&&l.addTransceiver?(l.addTransceiver("audio"),l.addTransceiver("video"),[4,l.createOffer()]):[3,4]);case 3:return k=f.sent(),[3,6];case 4:return[4,new Promise(function(C,I){var P=setTimeout(function(){I("CREATEOFFER_TIMEOUT")},3e3);l.createOffer(function(T){clearTimeout(P),C(T)},function(T){clearTimeout(P),I(T)},A)})];case 5:k=f.sent(),f.label=6;case 6:return l.close(),S=k.sdp,[2,g(S)];case 7:return i.stream.getTracks&&l.addTrack?i.stream.getTracks().forEach(function(C){l.addTrack(C,i.stream)}):l.addStream(i.stream),k=void 0,b.isSafari()||b.isFireFox()?[4,l.createOffer()]:[3,9];case 8:return k=f.sent(),[3,11];case 9:return[4,new Promise(function(C,I){l.createOffer(C,I)})];case 10:k=f.sent(),f.label=11;case 11:return l.close(),S=k.sdp,[2,g(S)]}})})};var g=function(i){var a={video:[],audio:[]};return i.match(/ VP8/i)&&a.video.push("VP8"),i.match(/ VP9/i)&&a.video.push("VP9"),i.match(/ H264/i)&&a.video.push("H264"),i.match(/ opus/i)&&a.audio.push("OPUS"),Promise.resolve(a)}},function(c,O,y){var m=this&&this.__awaiter||function(b,s,g,i){return new(g||(g=Promise))(function(a,l){function A(f){try{S(i.next(f))}catch(C){l(C)}}function k(f){try{S(i.throw(f))}catch(C){l(C)}}function S(f){var C;f.done?a(f.value):(C=f.value,C instanceof g?C:new g(function(I){I(C)})).then(A,k)}S((i=i.apply(b,s||[])).next())})},d=this&&this.__generator||function(b,s){var g,i,a,l,A={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return l={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function k(S){return function(f){return function(C){if(g)throw new TypeError("Generator is already executing.");for(;A;)try{if(g=1,i&&(a=2&C[0]?i.return:C[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,C[1])).done)return a;switch(i=0,a&&(C=[2&C[0],a.value]),C[0]){case 0:case 1:a=C;break;case 4:return A.label++,{value:C[1],done:!1};case 5:A.label++,i=C[1],C=[0];continue;case 7:C=A.ops.pop(),A.trys.pop();continue;default:if(a=A.trys,!((a=a.length>0&&a[a.length-1])||C[0]!==6&&C[0]!==2)){A=0;continue}if(C[0]===3&&(!a||C[1]>a[0]&&C[1]<a[3])){A.label=C[1];break}if(C[0]===6&&A.label<a[1]){A.label=a[1],a=C;break}if(a&&A.label<a[2]){A.label=a[2],A.ops.push(C);break}a[2]&&A.ops.pop(),A.trys.pop();continue}C=s.call(b,A)}catch(I){C=[6,I],i=0}finally{g=a=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([S,f])}}};Object.defineProperty(O,"__esModule",{value:!0});var E=y(10);function p(b){for(var s="",g=0;g<b.length;g+=1)s+=String.fromCharCode(b[g]);return window.btoa(s)}O.encryptRSA=function(b){return m(void 0,void 0,void 0,function(){var s,g,i,a;return d(this,function(l){switch(l.label){case 0:return s=E.base64ToUint8Array(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),[4,window.crypto.subtle.importKey("spki",s,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"])];case 1:return g=l.sent(),A=b,i=new TextEncoder().encode(A),[4,window.crypto.subtle.encrypt({name:"RSA-OAEP"},g,i)];case 2:return a=l.sent(),[2,p(new Uint8Array(a))]}var A})})}},function(c,O,y){var m=this&&this.__awaiter||function(a,l,A,k){return new(A||(A=Promise))(function(S,f){function C(T){try{P(k.next(T))}catch(F){f(F)}}function I(T){try{P(k.throw(T))}catch(F){f(F)}}function P(T){var F;T.done?S(T.value):(F=T.value,F instanceof A?F:new A(function(J){J(F)})).then(C,I)}P((k=k.apply(a,l||[])).next())})},d=this&&this.__generator||function(a,l){var A,k,S,f,C={label:0,sent:function(){if(1&S[0])throw S[1];return S[1]},trys:[],ops:[]};return f={next:I(0),throw:I(1),return:I(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function I(P){return function(T){return function(F){if(A)throw new TypeError("Generator is already executing.");for(;C;)try{if(A=1,k&&(S=2&F[0]?k.return:F[0]?k.throw||((S=k.return)&&S.call(k),0):k.next)&&!(S=S.call(k,F[1])).done)return S;switch(k=0,S&&(F=[2&F[0],S.value]),F[0]){case 0:case 1:S=F;break;case 4:return C.label++,{value:F[1],done:!1};case 5:C.label++,k=F[1],F=[0];continue;case 7:F=C.ops.pop(),C.trys.pop();continue;default:if(S=C.trys,!((S=S.length>0&&S[S.length-1])||F[0]!==6&&F[0]!==2)){C=0;continue}if(F[0]===3&&(!S||F[1]>S[0]&&F[1]<S[3])){C.label=F[1];break}if(F[0]===6&&C.label<S[1]){C.label=S[1],S=F;break}if(S&&C.label<S[2]){C.label=S[2],C.ops.push(F);break}S[2]&&C.ops.pop(),C.trys.pop();continue}F=l.call(a,C)}catch(J){F=[6,J],k=0}finally{A=S=0}if(5&F[0])throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}([P,T])}}},E=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(O,"__esModule",{value:!0});var p=E(y(0)),b=y(75),s=y(24),g=y(1),i=y(27);O.addLiveStreamingCapability=function(a,l){var A=this,k=function(S){var f=S.type;if(!a.joinInfo)return new s.AgoraRTCError(s.AgoraRTCErrorCode.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();switch(f){case i.LiveStreamingServiceMode.INJECT:return a._injectStreamingClient||(a._injectStreamingClient=new b.AgoraRTCLiveStreamingClient(a.joinInfo),a._injectStreamingClient.onInjectStatusChange=function(C,I,P){a.gatewayClient.dispatchEvent({type:"streamInjectedStatus",url:P,status:C})}),a._injectStreamingClient;case i.LiveStreamingServiceMode.RAW:return a._liveRawStreamingClient||(a._liveRawStreamingClient=new b.AgoraRTCLiveStreamingClient(a.joinInfo),a._liveRawStreamingClient.setGatewayConnectionState(a.getConnectionState()),a.on("connection-state-change",function(C){a._liveRawStreamingClient.setGatewayConnectionState(C.curState),C.prevState==="CONNECTING"&&C.curState==="CONNECTED"&&a._liveRawStreamingClient&&a._liveRawStreamingClient.resetAllTask()}),a._liveRawStreamingClient.onLiveStreamError=function(C,I){p.default.error("LIVE_STREAMING_ERROR",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:C,reason:I.code})},a._liveRawStreamingClient.onLiveStreamWarning=function(C,I){p.default.warning("LIVE_STREAMING_WARNING",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:C,reason:I.code})}),a._liveRawStreamingClient;case i.LiveStreamingServiceMode.TRANSCODE:return a._liveTranscodeStreamingClient||(a._liveTranscodeStreamingClient=new b.AgoraRTCLiveStreamingClient(a.joinInfo),a._liveTranscodeStreamingClient.setGatewayConnectionState(a.getConnectionState()),a.on("connection-state-change",function(C){a._liveTranscodeStreamingClient.setGatewayConnectionState(C.curState),C.prevState==="CONNECTING"&&C.curState==="CONNECTED"&&a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.resetAllTask()}),a._liveTranscodeStreamingClient.onLiveStreamError=function(C,I){p.default.error("LIVE_STREAMING_ERROR",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:C,reason:I.code})},a._liveTranscodeStreamingClient.onLiveStreamWarning=function(C,I){p.default.warning("LIVE_STREAMING_WARNING",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingWarning",url:C,reason:I})}),a._liveTranscodeStreamingClient}};a.gatewayClient.addEventListener("join",function(S){a._injectStreamingClient&&a._injectStreamingClient.resetAllTask()}),a.gatewayClient.addEventListener("stream-unpublished",function(S){S.options&&S.options.streamType===0&&(a._liveRawStreamingClient&&a._liveRawStreamingClient.resetAllTask(),a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.resetAllTask())}),a.gatewayClient.addEventListener("stream-published",function(S){}),a.startLiveStreaming=function(S,f){p.default.debug("startLiveStreaming");var C=g.report.reportApiInvoke(l.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});if(a.gatewayClient&&a.gatewayClient.role==="audience"){var I={code:403,reason:"AUDIENCE_STREAMING_FORBIDDEN"};throw C(I),I}var P=a._startLiveStreaming(S,f);return P.then(function(T){C(null,T)}).catch(function(T){p.default.error("LIVE_STREAMING_ERROR",T.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:S,reason:T.code}),C(T)}),P},a._startLiveStreaming=function(S,f){return m(A,void 0,void 0,function(){var C;return d(this,function(I){switch(I.label){case 0:return f||(l.codec==="vp8"&&p.default.warning("VP8 is not supported by raw_streaming. Subscriber side will suffer"),l.codec==="vp9"&&p.default.warning("VP9 is not supported by raw_streaming. Subscriber side will suffer"),l.mode==="rtc"&&p.default.warning("RTC mode is not supported by raw_streaming. Subscriber side will suffer")),(a._liveRawStreamingClient&&a._liveRawStreamingClient.haveUrl(S)||a._liveTranscodeStreamingClient&&a._liveTranscodeStreamingClient.haveUrl(S))&&new s.AgoraRTCError(s.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw(),C=f?i.LiveStreamingServiceMode.TRANSCODE:i.LiveStreamingServiceMode.RAW,[4,k({type:C}).startLiveStreamingTask(S,C)];case 1:return I.sent(),a.gatewayClient.dispatchEvent({type:"liveStreamingStarted",url:S}),[2]}})})},a.setLiveTranscoding=function(S){p.default.debug("setLiveTranscoding: "+JSON.stringify(S));var f=g.report.reportApiInvoke(l.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"}),C=k({type:i.LiveStreamingServiceMode.TRANSCODE});return C.setTranscodingConfig(S).then(function(){a.gatewayClient.dispatchEvent({type:"liveTranscodingUpdated"}),f(null)}).catch(function(I){p.default.error("SET_LIVE_TRANSCODING_ERROR",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",reason:I.code}),f(I)})},a.stopLiveStreaming=function(S){var f=g.report.reportApiInvoke(l.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"}),C=a._stopLiveStreaming(S);return C.then(function(I){f(null,I)}).catch(function(I){p.default.error("STOP_LIVE_STREAMING_ERROR",I.toString()),a.gatewayClient.dispatchEvent({type:"liveStreamingFailed",url:S,reason:I.code}),f(I)}),C},a._stopLiveStreaming=function(S){return m(this,void 0,void 0,function(){var f;return d(this,function(C){switch(C.label){case 0:return p.default.debug("stopLiveStreaming: "+JSON.stringify(S)),f=[a._liveRawStreamingClient,a._liveTranscodeStreamingClient],[4,Promise.all(f.map(function(I){return I&&I.haveUrl(S)&&I.stopLiveStreamingTask(S)}))];case 1:return C.sent(),p.default.debug("stopLiveStreaming sucess: "+JSON.stringify(S)),a.gatewayClient.dispatchEvent({type:"liveStreamingStopped",url:S}),[2]}})})},a.addInjectStreamUrl=function(S,f){var C=g.report.reportApiInvoke(l.sessionId,{name:"Client.addInjectStreamUrl",options:[S,f],tag:"tracer"});if(a.gatewayClient.role==="audience"){var I={code:403,reason:"AUDIENCE_INJECTING_FORBIDDEN"};throw C(I),I}var P=a._addInjectStreamUrl(S,f);return P.then(function(T){C(null,T)}).catch(function(T){p.default.error("ADD_INJECT_STREAM_ERROR",T.toString()),C(T)}),P},a._addInjectStreamUrl=function(S,f){return m(A,void 0,void 0,function(){var C;return d(this,function(I){switch(I.label){case 0:return(C=k({type:i.LiveStreamingServiceMode.INJECT})).setInjectStreamConfig(f,0),[4,C.startLiveStreamingTask(S,i.LiveStreamingServiceMode.INJECT)];case 1:return I.sent(),[2]}})})},a.removeInjectStreamUrl=function(S){return m(this,void 0,void 0,function(){var f,C;return d(this,function(I){return f=g.report.reportApiInvoke(l.sessionId,{name:"Client.removeInjectStreamUrl",options:[S],tag:"tracer"}),(C=a._removeInjectStreamUrl(S)).then(function(P){f(null,P)}).catch(function(P){p.default.error("REMOVE_INJECT_STREAM_ERROR",P.toString()),f(P)}),[2,C]})})},a._removeInjectStreamUrl=function(S){return m(A,void 0,void 0,function(){return d(this,function(f){switch(f.label){case 0:return[4,k({type:i.LiveStreamingServiceMode.INJECT}).stopLiveStreamingTask(S)];case 1:return f.sent(),[2]}})})},a._terminateLiveStreaming=function(){return m(A,void 0,void 0,function(){return d(this,function(S){return[a._injectStreamingClient,a._liveRawStreamingClient,a._liveTranscodeStreamingClient].forEach(function(f){f&&f.terminate()}),[2]})})}}},function(c,O,y){var m=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(O,"__esModule",{value:!0});var d=m(y(5)),E=m(y(0)),p=y(10);O.default=function(b,s){s===void 0&&(s={width:160,height:120,framerate:15});var g=s.width,i=s.height,a=s.framerate,l=b.stream;if(!l)throw d.default.INVALID_LOCAL_STREAM;if(!l.getVideoTracks()[0])throw d.default.HIGH_STREAM_NOT_VIDEO_TRACE;var A=l.getVideoTracks()[0];E.default.debug("Start getLowStream");var k=document.createElement("video"),S=document.createElement("canvas");k.setAttribute("style","display:none"),k.setAttribute("muted",""),k.muted=!0,k.setAttribute("autoplay",""),k.autoplay=!0,k.setAttribute("playsinline",""),S.setAttribute("style","display:none"),S.setAttribute("width",g.toString()),S.setAttribute("height",i.toString());var f=S.getContext("2d");if(!f)throw new Error("not get canvas context");k.srcObject=l,document.body.append(k),document.body.append(S),k.play(),E.default.debug("Start render lowStream");var C=p.audioTimerLoop(function(){return function(){if(k.paused&&k.play(),k.videoHeight>2&&k.videoWidth>2){var T=k.videoWidth,F=k.videoHeight/T,J=S.width*F;Math.abs(J-S.height)>=2&&(E.default.debug("adjust low stream resolution",S.width+"x"+S.height+" -> "+S.width+"x"+J),S.height=J)}f.drawImage(k,0,0,S.width,S.height);var G=b.stream;if(G){var H=G.getVideoTracks()[0];A!==H&&(E.default.debug("adjust low stream track"),k.srcObject=G,A=H)}}()},a),I=S.captureStream(a),P=I.getVideoTracks()[0];return P.requestFrame&&P.requestFrame(),I.clean=function(){E.default.debug("Start clean lowStream"),C(),(k||k.parentNode||k.parentNode.removeChild)&&k.parentNode.removeChild(k),(S||S.parentNode||S.parentNode.removeChild)&&S.parentNode.removeChild(S),E.default.debug("Clean lowStream")},I}},function(c,O){var y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(y){var m=new Uint8Array(16);c.exports=function(){return y(m),m}}else{var d=new Array(16);c.exports=function(){for(var E,p=0;p<16;p++)!(3&p)&&(E=4294967296*Math.random()),d[p]=E>>>((3&p)<<3)&255;return d}}},function(c,O){for(var y=[],m=0;m<256;++m)y[m]=(m+256).toString(16).substr(1);c.exports=function(d,E){var p=E||0,b=y;return[b[d[p++]],b[d[p++]],b[d[p++]],b[d[p++]],"-",b[d[p++]],b[d[p++]],"-",b[d[p++]],b[d[p++]],"-",b[d[p++]],b[d[p++]],"-",b[d[p++]],b[d[p++]],b[d[p++]],b[d[p++]],b[d[p++]],b[d[p++]]].join("")}},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*!
 * protobuf.js v6.10.0 (c) 2016, daniel wirtz
 * compiled wed, 15 jul 2020 23:34:13 utc
 * licensed under the bsd-3-clause license
 * see: https://github.com/dcodeio/protobuf.js for details
 */(function(undefined$1){(function(c,O,y){var m=function d(E){var p=O[E];return p||c[E][0].call(p=O[E]={exports:{}},d,p,p.exports),p.exports}(y[0]);m.util.global.protobuf=m,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(61)],(__WEBPACK_AMD_DEFINE_RESULT__=function(d){return d&&d.isLong&&(m.util.Long=d,m.configure()),m}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))===undefined$1||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),module&&module.exports&&(module.exports=m)})({1:[function(c,O,y){O.exports=function(m,d){for(var E=new Array(arguments.length-1),p=0,b=2,s=!0;b<arguments.length;)E[p++]=arguments[b++];return new Promise(function(g,i){E[p]=function(a){if(s)if(s=!1,a)i(a);else{for(var l=new Array(arguments.length-1),A=0;A<l.length;)l[A++]=arguments[A];g.apply(null,l)}};try{m.apply(d||null,E)}catch(a){s&&(s=!1,i(a))}})}},{}],2:[function(c,O,y){var m=y;m.length=function(b){var s=b.length;if(!s)return 0;for(var g=0;--s%4>1&&b.charAt(s)==="=";)++g;return Math.ceil(3*b.length)/4-g};for(var d=new Array(64),E=new Array(123),p=0;p<64;)E[d[p]=p<26?p+65:p<52?p+71:p<62?p-4:p-59|43]=p++;m.encode=function(b,s,g){for(var i,a=null,l=[],A=0,k=0;s<g;){var S=b[s++];switch(k){case 0:l[A++]=d[S>>2],i=(3&S)<<4,k=1;break;case 1:l[A++]=d[i|S>>4],i=(15&S)<<2,k=2;break;case 2:l[A++]=d[i|S>>6],l[A++]=d[63&S],k=0}A>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,l)),A=0)}return k&&(l[A++]=d[i],l[A++]=61,k===1&&(l[A++]=61)),a?(A&&a.push(String.fromCharCode.apply(String,l.slice(0,A))),a.join("")):String.fromCharCode.apply(String,l.slice(0,A))},m.decode=function(b,s,g){for(var i,a=g,l=0,A=0;A<b.length;){var k=b.charCodeAt(A++);if(k===61&&l>1)break;if((k=E[k])===undefined$1)throw Error("invalid encoding");switch(l){case 0:i=k,l=1;break;case 1:s[g++]=i<<2|(48&k)>>4,i=k,l=2;break;case 2:s[g++]=(15&i)<<4|(60&k)>>2,i=k,l=3;break;case 3:s[g++]=(3&i)<<6|k,l=0}}if(l===1)throw Error("invalid encoding");return g-a},m.test=function(b){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(b)}},{}],3:[function(c,O,y){function m(d,E){typeof d=="string"&&(E=d,d=undefined$1);var p=[];function b(g){if(typeof g!="string"){var i=s();if(m.verbose&&console.log("codegen: "+i),i="return "+i,g){for(var a=Object.keys(g),l=new Array(a.length+1),A=new Array(a.length),k=0;k<a.length;)l[k]=a[k],A[k]=g[a[k++]];return l[k]=i,Function.apply(null,l).apply(null,A)}return Function(i)()}for(var S=new Array(arguments.length-1),f=0;f<S.length;)S[f]=arguments[++f];if(f=0,g=g.replace(/%([%dfijs])/g,function(C,I){var P=S[f++];switch(I){case"d":case"f":return String(Number(P));case"i":return String(Math.floor(P));case"j":return JSON.stringify(P);case"s":return String(P)}return"%"}),f!==S.length)throw Error("parameter count mismatch");return p.push(g),b}function s(g){return"function "+(g||E||"")+"("+(d&&d.join(",")||"")+`){
  `+p.join(`
  `)+`
}`}return b.toString=s,b}O.exports=m,m.verbose=!1},{}],4:[function(c,O,y){function m(){this._listeners={}}O.exports=m,m.prototype.on=function(d,E,p){return(this._listeners[d]||(this._listeners[d]=[])).push({fn:E,ctx:p||this}),this},m.prototype.off=function(d,E){if(d===undefined$1)this._listeners={};else if(E===undefined$1)this._listeners[d]=[];else for(var p=this._listeners[d],b=0;b<p.length;)p[b].fn===E?p.splice(b,1):++b;return this},m.prototype.emit=function(d){var E=this._listeners[d];if(E){for(var p=[],b=1;b<arguments.length;)p.push(arguments[b++]);for(b=0;b<E.length;)E[b].fn.apply(E[b++].ctx,p)}return this}},{}],5:[function(c,O,y){O.exports=E;var m=c(1),d=c(7)("fs");function E(p,b,s){return typeof b=="function"?(s=b,b={}):b||(b={}),s?!b.xhr&&d&&d.readFile?d.readFile(p,function(g,i){return g&&typeof XMLHttpRequest<"u"?E.xhr(p,b,s):g?s(g):s(null,b.binary?i:i.toString("utf8"))}):E.xhr(p,b,s):m(E,this,p,b)}E.xhr=function(p,b,s){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState!==4)return undefined$1;if(g.status!==0&&g.status!==200)return s(Error("status "+g.status));if(b.binary){var i=g.response;if(!i){i=[];for(var a=0;a<g.responseText.length;++a)i.push(255&g.responseText.charCodeAt(a))}return s(null,typeof Uint8Array<"u"?new Uint8Array(i):i)}return s(null,g.responseText)},b.binary&&("overrideMimeType"in g&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.responseType="arraybuffer"),g.open("GET",p),g.send()}},{1:1,7:7}],6:[function(c,O,y){function m(s){return typeof Float32Array<"u"?function(){var g=new Float32Array([-0]),i=new Uint8Array(g.buffer),a=i[3]===128;function l(f,C,I){g[0]=f,C[I]=i[0],C[I+1]=i[1],C[I+2]=i[2],C[I+3]=i[3]}function A(f,C,I){g[0]=f,C[I]=i[3],C[I+1]=i[2],C[I+2]=i[1],C[I+3]=i[0]}function k(f,C){return i[0]=f[C],i[1]=f[C+1],i[2]=f[C+2],i[3]=f[C+3],g[0]}function S(f,C){return i[3]=f[C],i[2]=f[C+1],i[1]=f[C+2],i[0]=f[C+3],g[0]}s.writeFloatLE=a?l:A,s.writeFloatBE=a?A:l,s.readFloatLE=a?k:S,s.readFloatBE=a?S:k}():function(){function g(a,l,A,k){var S=l<0?1:0;if(S&&(l=-l),l===0)a(1/l>0?0:2147483648,A,k);else if(isNaN(l))a(2143289344,A,k);else if(l>34028234663852886e22)a((S<<31|2139095040)>>>0,A,k);else if(l<11754943508222875e-54)a((S<<31|Math.round(l/1401298464324817e-60))>>>0,A,k);else{var f=Math.floor(Math.log(l)/Math.LN2);a((S<<31|f+127<<23|8388607&Math.round(l*Math.pow(2,-f)*8388608))>>>0,A,k)}}function i(a,l,A){var k=a(l,A),S=2*(k>>31)+1,f=k>>>23&255,C=8388607&k;return f===255?C?NaN:S*(1/0):f===0?1401298464324817e-60*S*C:S*Math.pow(2,f-150)*(C+8388608)}s.writeFloatLE=g.bind(null,d),s.writeFloatBE=g.bind(null,E),s.readFloatLE=i.bind(null,p),s.readFloatBE=i.bind(null,b)}(),typeof Float64Array<"u"?function(){var g=new Float64Array([-0]),i=new Uint8Array(g.buffer),a=i[7]===128;function l(f,C,I){g[0]=f,C[I]=i[0],C[I+1]=i[1],C[I+2]=i[2],C[I+3]=i[3],C[I+4]=i[4],C[I+5]=i[5],C[I+6]=i[6],C[I+7]=i[7]}function A(f,C,I){g[0]=f,C[I]=i[7],C[I+1]=i[6],C[I+2]=i[5],C[I+3]=i[4],C[I+4]=i[3],C[I+5]=i[2],C[I+6]=i[1],C[I+7]=i[0]}function k(f,C){return i[0]=f[C],i[1]=f[C+1],i[2]=f[C+2],i[3]=f[C+3],i[4]=f[C+4],i[5]=f[C+5],i[6]=f[C+6],i[7]=f[C+7],g[0]}function S(f,C){return i[7]=f[C],i[6]=f[C+1],i[5]=f[C+2],i[4]=f[C+3],i[3]=f[C+4],i[2]=f[C+5],i[1]=f[C+6],i[0]=f[C+7],g[0]}s.writeDoubleLE=a?l:A,s.writeDoubleBE=a?A:l,s.readDoubleLE=a?k:S,s.readDoubleBE=a?S:k}():function(){function g(a,l,A,k,S,f){var C=k<0?1:0;if(C&&(k=-k),k===0)a(0,S,f+l),a(1/k>0?0:2147483648,S,f+A);else if(isNaN(k))a(0,S,f+l),a(2146959360,S,f+A);else if(k>17976931348623157e292)a(0,S,f+l),a((C<<31|2146435072)>>>0,S,f+A);else{var I;if(k<22250738585072014e-324)a((I=k/5e-324)>>>0,S,f+l),a((C<<31|I/4294967296)>>>0,S,f+A);else{var P=Math.floor(Math.log(k)/Math.LN2);P===1024&&(P=1023),a(4503599627370496*(I=k*Math.pow(2,-P))>>>0,S,f+l),a((C<<31|P+1023<<20|1048576*I&1048575)>>>0,S,f+A)}}}function i(a,l,A,k,S){var f=a(k,S+l),C=a(k,S+A),I=2*(C>>31)+1,P=C>>>20&2047,T=4294967296*(1048575&C)+f;return P===2047?T?NaN:I*(1/0):P===0?5e-324*I*T:I*Math.pow(2,P-1075)*(T+4503599627370496)}s.writeDoubleLE=g.bind(null,d,0,4),s.writeDoubleBE=g.bind(null,E,4,0),s.readDoubleLE=i.bind(null,p,0,4),s.readDoubleBE=i.bind(null,b,4,0)}(),s}function d(s,g,i){g[i]=255&s,g[i+1]=s>>>8&255,g[i+2]=s>>>16&255,g[i+3]=s>>>24}function E(s,g,i){g[i]=s>>>24,g[i+1]=s>>>16&255,g[i+2]=s>>>8&255,g[i+3]=255&s}function p(s,g){return(s[g]|s[g+1]<<8|s[g+2]<<16|s[g+3]<<24)>>>0}function b(s,g){return(s[g]<<24|s[g+1]<<16|s[g+2]<<8|s[g+3])>>>0}O.exports=m(m)},{}],7:[function(require,module,exports){function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(c){}return null}module.exports=inquire},{}],8:[function(c,O,y){var m=y,d=m.isAbsolute=function(p){return/^(?:\/|\w+:)/.test(p)},E=m.normalize=function(p){var b=(p=p.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),s=d(p),g="";s&&(g=b.shift()+"/");for(var i=0;i<b.length;)b[i]===".."?i>0&&b[i-1]!==".."?b.splice(--i,2):s?b.splice(i,1):++i:b[i]==="."?b.splice(i,1):++i;return g+b.join("/")};m.resolve=function(p,b,s){return s||(b=E(b)),d(b)?b:(s||(p=E(p)),(p=p.replace(/(?:\/|^)[^/]+$/,"")).length?E(p+"/"+b):b)}},{}],9:[function(c,O,y){O.exports=function(m,d,E){var p=E||8192,b=p>>>1,s=null,g=p;return function(i){if(i<1||i>b)return m(i);g+i>p&&(s=m(p),g=0);var a=d.call(s,g,g+=i);return 7&g&&(g=1+(7|g)),a}}},{}],10:[function(c,O,y){var m=y;m.length=function(d){for(var E=0,p=0,b=0;b<d.length;++b)(p=d.charCodeAt(b))<128?E+=1:p<2048?E+=2:(64512&p)==55296&&(64512&d.charCodeAt(b+1))==56320?(++b,E+=4):E+=3;return E},m.read=function(d,E,p){if(p-E<1)return"";for(var b,s=null,g=[],i=0;E<p;)(b=d[E++])<128?g[i++]=b:b>191&&b<224?g[i++]=(31&b)<<6|63&d[E++]:b>239&&b<365?(b=((7&b)<<18|(63&d[E++])<<12|(63&d[E++])<<6|63&d[E++])-65536,g[i++]=55296+(b>>10),g[i++]=56320+(1023&b)):g[i++]=(15&b)<<12|(63&d[E++])<<6|63&d[E++],i>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,g)),i=0);return s?(i&&s.push(String.fromCharCode.apply(String,g.slice(0,i))),s.join("")):String.fromCharCode.apply(String,g.slice(0,i))},m.write=function(d,E,p){for(var b,s,g=p,i=0;i<d.length;++i)(b=d.charCodeAt(i))<128?E[p++]=b:b<2048?(E[p++]=b>>6|192,E[p++]=63&b|128):(64512&b)==55296&&(64512&(s=d.charCodeAt(i+1)))==56320?(b=65536+((1023&b)<<10)+(1023&s),++i,E[p++]=b>>18|240,E[p++]=b>>12&63|128,E[p++]=b>>6&63|128,E[p++]=63&b|128):(E[p++]=b>>12|224,E[p++]=b>>6&63|128,E[p++]=63&b|128);return p-g}},{}],11:[function(c,O,y){var m=y,d=c(14),E=c(33);function p(s,g,i,a){if(g.resolvedType)if(g.resolvedType instanceof d){s("switch(d%s){",a);for(var l=g.resolvedType.values,A=Object.keys(l),k=0;k<A.length;++k)g.repeated&&l[A[k]]===g.typeDefault&&s("default:"),s("case%j:",A[k])("case %i:",l[A[k]])("m%s=%j",a,l[A[k]])("break");s("}")}else s('if(typeof d%s!=="object")',a)("throw TypeError(%j)",g.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",a,i,a);else{var S=!1;switch(g.type){case"double":case"float":s("m%s=Number(d%s)",a,a);break;case"uint32":case"fixed32":s("m%s=d%s>>>0",a,a);break;case"int32":case"sint32":case"sfixed32":s("m%s=d%s|0",a,a);break;case"uint64":S=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":s("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",a,a,S)('else if(typeof d%s==="string")',a)("m%s=parseInt(d%s,10)",a,a)('else if(typeof d%s==="number")',a)("m%s=d%s",a,a)('else if(typeof d%s==="object")',a)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",a,a,a,S?"true":"");break;case"bytes":s('if(typeof d%s==="string")',a)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",a,a,a)("else if(d%s.length)",a)("m%s=d%s",a,a);break;case"string":s("m%s=String(d%s)",a,a);break;case"bool":s("m%s=Boolean(d%s)",a,a)}}return s}function b(s,g,i,a){if(g.resolvedType)g.resolvedType instanceof d?s("d%s=o.enums===String?types[%i].values[m%s]:m%s",a,i,a,a):s("d%s=types[%i].toObject(m%s,o)",a,i,a);else{var l=!1;switch(g.type){case"double":case"float":s("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",a,a,a,a);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":s('if(typeof m%s==="number")',a)("d%s=o.longs===String?String(m%s):m%s",a,a,a)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",a,a,a,a,l?"true":"",a);break;case"bytes":s("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",a,a,a,a,a);break;default:s("d%s=m%s",a,a)}}return s}m.fromObject=function(s){var g=s.fieldsArray,i=E.codegen(["d"],s.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!g.length)return i("return new this.ctor");i("var m=new this.ctor");for(var a=0;a<g.length;++a){var l=g[a].resolve(),A=E.safeProp(l.name);l.map?(i("if(d%s){",A)('if(typeof d%s!=="object")',A)("throw TypeError(%j)",l.fullName+": object expected")("m%s={}",A)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",A),p(i,l,a,A+"[ks[i]]")("}")("}")):l.repeated?(i("if(d%s){",A)("if(!Array.isArray(d%s))",A)("throw TypeError(%j)",l.fullName+": array expected")("m%s=[]",A)("for(var i=0;i<d%s.length;++i){",A),p(i,l,a,A+"[i]")("}")("}")):(l.resolvedType instanceof d||i("if(d%s!=null){",A),p(i,l,a,A),l.resolvedType instanceof d||i("}"))}return i("return m")},m.toObject=function(s){var g=s.fieldsArray.slice().sort(E.compareFieldsById);if(!g.length)return E.codegen()("return {}");for(var i=E.codegen(["m","o"],s.name+"$toObject")("if(!o)")("o={}")("var d={}"),a=[],l=[],A=[],k=0;k<g.length;++k)g[k].partOf||(g[k].resolve().repeated?a:g[k].map?l:A).push(g[k]);if(a.length){for(i("if(o.arrays||o.defaults){"),k=0;k<a.length;++k)i("d%s=[]",E.safeProp(a[k].name));i("}")}if(l.length){for(i("if(o.objects||o.defaults){"),k=0;k<l.length;++k)i("d%s={}",E.safeProp(l[k].name));i("}")}if(A.length){for(i("if(o.defaults){"),k=0;k<A.length;++k){var S=A[k],f=E.safeProp(S.name);if(S.resolvedType instanceof d)i("d%s=o.enums===String?%j:%j",f,S.resolvedType.valuesById[S.typeDefault],S.typeDefault);else if(S.long)i("if(util.Long){")("var n=new util.Long(%i,%i,%j)",S.typeDefault.low,S.typeDefault.high,S.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",f)("}else")("d%s=o.longs===String?%j:%i",f,S.typeDefault.toString(),S.typeDefault.toNumber());else if(S.bytes){var C="["+Array.prototype.slice.call(S.typeDefault).join(",")+"]";i("if(o.bytes===String)d%s=%j",f,String.fromCharCode.apply(String,S.typeDefault))("else{")("d%s=%s",f,C)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",f,f)("}")}else i("d%s=%j",f,S.typeDefault)}i("}")}var I=!1;for(k=0;k<g.length;++k){S=g[k];var P=s._fieldsArray.indexOf(S);f=E.safeProp(S.name),S.map?(I||(I=!0,i("var ks2")),i("if(m%s&&(ks2=Object.keys(m%s)).length){",f,f)("d%s={}",f)("for(var j=0;j<ks2.length;++j){"),b(i,S,P,f+"[ks2[j]]")("}")):S.repeated?(i("if(m%s&&m%s.length){",f,f)("d%s=[]",f)("for(var j=0;j<m%s.length;++j){",f),b(i,S,P,f+"[j]")("}")):(i("if(m%s!=null&&m.hasOwnProperty(%j)){",f,S.name),b(i,S,P,f),S.partOf&&i("if(o.oneofs)")("d%s=%j",E.safeProp(S.partOf.name),S.name)),i("}")}return i("return d")}},{14:14,33:33}],12:[function(c,O,y){O.exports=function(b){var s=E.codegen(["r","l"],b.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(b.fieldsArray.filter(function(k){return k.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");b.group&&s("if((t&7)===4)")("break"),s("switch(t>>>3){");for(var g=0;g<b.fieldsArray.length;++g){var i=b._fieldsArray[g].resolve(),a=i.resolvedType instanceof m?"int32":i.type,l="m"+E.safeProp(i.name);s("case %i:",i.id),i.map?(s("if(%s===util.emptyObject)",l)("%s={}",l)("var c2 = r.uint32()+r.pos"),d.defaults[i.keyType]!==undefined$1?s("k=%j",d.defaults[i.keyType]):s("k=null"),d.defaults[a]!==undefined$1?s("value=%j",d.defaults[a]):s("value=null"),s("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",i.keyType)("case 2:"),d.basic[a]===undefined$1?s("value=types[%i].decode(r,r.uint32())",g):s("value=r.%s()",a),s("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),d.long[i.keyType]!==undefined$1?s('%s[typeof k==="object"?util.longToHash(k):k]=value',l):s("%s[k]=value",l)):i.repeated?(s("if(!(%s&&%s.length))",l,l)("%s=[]",l),d.packed[a]!==undefined$1&&s("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",l,a)("}else"),d.basic[a]===undefined$1?s(i.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",l,g):s("%s.push(r.%s())",l,a)):d.basic[a]===undefined$1?s(i.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",l,g):s("%s=r.%s()",l,a),s("break")}for(s("default:")("r.skipType(t&7)")("break")("}")("}"),g=0;g<b._fieldsArray.length;++g){var A=b._fieldsArray[g];A.required&&s("if(!m.hasOwnProperty(%j))",A.name)("throw util.ProtocolError(%j,{instance:m})",p(A))}return s("return m")};var m=c(14),d=c(32),E=c(33);function p(b){return"missing required '"+b.name+"'"}},{14:14,32:32,33:33}],13:[function(c,O,y){O.exports=function(b){for(var s,g=E.codegen(["m","w"],b.name+"$encode")("if(!w)")("w=Writer.create()"),i=b.fieldsArray.slice().sort(E.compareFieldsById),a=0;a<i.length;++a){var l=i[a].resolve(),A=b._fieldsArray.indexOf(l),k=l.resolvedType instanceof m?"int32":l.type,S=d.basic[k];s="m"+E.safeProp(l.name),l.map?(g("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",s,l.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",s)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(l.id<<3|2)>>>0,8|d.mapKey[l.keyType],l.keyType),S===undefined$1?g("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",A,s):g(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|S,k,s),g("}")("}")):l.repeated?(g("if(%s!=null&&%s.length){",s,s),l.packed&&d.packed[k]!==undefined$1?g("w.uint32(%i).fork()",(l.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",s)("w.%s(%s[i])",k,s)("w.ldelim()"):(g("for(var i=0;i<%s.length;++i)",s),S===undefined$1?p(g,l,A,s+"[i]"):g("w.uint32(%i).%s(%s[i])",(l.id<<3|S)>>>0,k,s)),g("}")):(l.optional&&g("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",s,l.name),S===undefined$1?p(g,l,A,s):g("w.uint32(%i).%s(%s)",(l.id<<3|S)>>>0,k,s))}return g("return w")};var m=c(14),d=c(32),E=c(33);function p(b,s,g,i){return s.resolvedType.group?b("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",g,i,(s.id<<3|3)>>>0,(s.id<<3|4)>>>0):b("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",g,i,(s.id<<3|2)>>>0)}},{14:14,32:32,33:33}],14:[function(c,O,y){O.exports=p;var m=c(22);((p.prototype=Object.create(m.prototype)).constructor=p).className="Enum";var d=c(21),E=c(33);function p(b,s,g,i,a){if(m.call(this,b,g),s&&typeof s!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=a||{},this.reserved=undefined$1,s)for(var l=Object.keys(s),A=0;A<l.length;++A)typeof s[l[A]]=="number"&&(this.valuesById[this.values[l[A]]=s[l[A]]]=l[A])}p.fromJSON=function(b,s){var g=new p(b,s.values,s.options,s.comment,s.comments);return g.reserved=s.reserved,g},p.prototype.toJSON=function(b){var s=!!b&&Boolean(b.keepComments);return E.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined$1,"comment",s?this.comment:undefined$1,"comments",s?this.comments:undefined$1])},p.prototype.add=function(b,s,g){if(!E.isString(b))throw TypeError("name must be a string");if(!E.isInteger(s))throw TypeError("id must be an integer");if(this.values[b]!==undefined$1)throw Error("duplicate name '"+b+"' in "+this);if(this.isReservedId(s))throw Error("id "+s+" is reserved in "+this);if(this.isReservedName(b))throw Error("name '"+b+"' is reserved in "+this);if(this.valuesById[s]!==undefined$1){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+s+" in "+this);this.values[b]=s}else this.valuesById[this.values[b]=s]=b;return this.comments[b]=g||null,this},p.prototype.remove=function(b){if(!E.isString(b))throw TypeError("name must be a string");var s=this.values[b];if(s==null)throw Error("name '"+b+"' does not exist in "+this);return delete this.valuesById[s],delete this.values[b],delete this.comments[b],this},p.prototype.isReservedId=function(b){return d.isReservedId(this.reserved,b)},p.prototype.isReservedName=function(b){return d.isReservedName(this.reserved,b)}},{21:21,22:22,33:33}],15:[function(c,O,y){O.exports=g;var m=c(22);((g.prototype=Object.create(m.prototype)).constructor=g).className="Field";var d,E=c(14),p=c(32),b=c(33),s=/^required|optional|repeated$/;function g(i,a,l,A,k,S,f){if(b.isObject(A)?(f=k,S=A,A=k=undefined$1):b.isObject(k)&&(f=S,S=k,k=undefined$1),m.call(this,i,S),!b.isInteger(a)||a<0)throw TypeError("id must be a non-negative integer");if(!b.isString(l))throw TypeError("type must be a string");if(A!==undefined$1&&!s.test(A=A.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(k!==undefined$1&&!b.isString(k))throw TypeError("extend must be a string");this.rule=A&&A!=="optional"?A:undefined$1,this.type=l,this.id=a,this.extend=k||undefined$1,this.required=A==="required",this.optional=!this.required,this.repeated=A==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!b.Long&&p.long[l]!==undefined$1,this.bytes=l==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=f}g.fromJSON=function(i,a){return new g(i,a.id,a.type,a.rule,a.extend,a.options,a.comment)},Object.defineProperty(g.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}}),g.prototype.setOption=function(i,a,l){return i==="packed"&&(this._packed=null),m.prototype.setOption.call(this,i,a,l)},g.prototype.toJSON=function(i){var a=!!i&&Boolean(i.keepComments);return b.toObject(["rule",this.rule!=="optional"&&this.rule||undefined$1,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",a?this.comment:undefined$1])},g.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=p.defaults[this.type])===undefined$1&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof d?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof E&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==!0&&(this.options.packed===undefined$1||!this.resolvedType||this.resolvedType instanceof E)||delete this.options.packed,Object.keys(this.options).length||(this.options=undefined$1)),this.long)this.typeDefault=b.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var i;b.base64.test(this.typeDefault)?b.base64.decode(this.typeDefault,i=b.newBuffer(b.base64.length(this.typeDefault)),0):b.utf8.write(this.typeDefault,i=b.newBuffer(b.utf8.length(this.typeDefault)),0),this.typeDefault=i}return this.map?this.defaultValue=b.emptyObject:this.repeated?this.defaultValue=b.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof d&&(this.parent.ctor.prototype[this.name]=this.defaultValue),m.prototype.resolve.call(this)},g.d=function(i,a,l,A){return typeof a=="function"?a=b.decorateType(a).name:a&&typeof a=="object"&&(a=b.decorateEnum(a).name),function(k,S){b.decorateType(k.constructor).add(new g(S,i,a,l,{default:A}))}},g._configure=function(i){d=i}},{14:14,22:22,32:32,33:33}],16:[function(c,O,y){var m=O.exports=c(17);m.build="light",m.load=function(d,E,p){return typeof E=="function"?(p=E,E=new m.Root):E||(E=new m.Root),E.load(d,p)},m.loadSync=function(d,E){return E||(E=new m.Root),E.loadSync(d)},m.encoder=c(13),m.decoder=c(12),m.verifier=c(36),m.converter=c(11),m.ReflectionObject=c(22),m.Namespace=c(21),m.Root=c(26),m.Enum=c(14),m.Type=c(31),m.Field=c(15),m.OneOf=c(23),m.MapField=c(18),m.Service=c(30),m.Method=c(20),m.Message=c(19),m.wrappers=c(37),m.types=c(32),m.util=c(33),m.ReflectionObject._configure(m.Root),m.Namespace._configure(m.Type,m.Service,m.Enum),m.Root._configure(m.Type),m.Field._configure(m.Type)},{11:11,12:12,13:13,14:14,15:15,17:17,18:18,19:19,20:20,21:21,22:22,23:23,26:26,30:30,31:31,32:32,33:33,36:36,37:37}],17:[function(c,O,y){var m=y;function d(){m.util._configure(),m.Writer._configure(m.BufferWriter),m.Reader._configure(m.BufferReader)}m.build="minimal",m.Writer=c(38),m.BufferWriter=c(39),m.Reader=c(24),m.BufferReader=c(25),m.util=c(35),m.rpc=c(28),m.roots=c(27),m.configure=d,d()},{24:24,25:25,27:27,28:28,35:35,38:38,39:39}],18:[function(c,O,y){O.exports=p;var m=c(15);((p.prototype=Object.create(m.prototype)).constructor=p).className="MapField";var d=c(32),E=c(33);function p(b,s,g,i,a,l){if(m.call(this,b,s,i,undefined$1,undefined$1,a,l),!E.isString(g))throw TypeError("keyType must be a string");this.keyType=g,this.resolvedKeyType=null,this.map=!0}p.fromJSON=function(b,s){return new p(b,s.id,s.keyType,s.type,s.options,s.comment)},p.prototype.toJSON=function(b){var s=!!b&&Boolean(b.keepComments);return E.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",s?this.comment:undefined$1])},p.prototype.resolve=function(){if(this.resolved)return this;if(d.mapKey[this.keyType]===undefined$1)throw Error("invalid key type: "+this.keyType);return m.prototype.resolve.call(this)},p.d=function(b,s,g){return typeof g=="function"?g=E.decorateType(g).name:g&&typeof g=="object"&&(g=E.decorateEnum(g).name),function(i,a){E.decorateType(i.constructor).add(new p(a,b,s,g))}}},{15:15,32:32,33:33}],19:[function(c,O,y){O.exports=d;var m=c(35);function d(E){if(E)for(var p=Object.keys(E),b=0;b<p.length;++b)this[p[b]]=E[p[b]]}d.create=function(E){return this.$type.create(E)},d.encode=function(E,p){return this.$type.encode(E,p)},d.encodeDelimited=function(E,p){return this.$type.encodeDelimited(E,p)},d.decode=function(E){return this.$type.decode(E)},d.decodeDelimited=function(E){return this.$type.decodeDelimited(E)},d.verify=function(E){return this.$type.verify(E)},d.fromObject=function(E){return this.$type.fromObject(E)},d.toObject=function(E,p){return this.$type.toObject(E,p)},d.prototype.toJSON=function(){return this.$type.toObject(this,m.toJSONOptions)}},{35:35}],20:[function(c,O,y){O.exports=E;var m=c(22);((E.prototype=Object.create(m.prototype)).constructor=E).className="Method";var d=c(33);function E(p,b,s,g,i,a,l,A){if(d.isObject(i)?(l=i,i=a=undefined$1):d.isObject(a)&&(l=a,a=undefined$1),b!==undefined$1&&!d.isString(b))throw TypeError("type must be a string");if(!d.isString(s))throw TypeError("requestType must be a string");if(!d.isString(g))throw TypeError("responseType must be a string");m.call(this,p,l),this.type=b||"rpc",this.requestType=s,this.requestStream=!!i||undefined$1,this.responseType=g,this.responseStream=!!a||undefined$1,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=A}E.fromJSON=function(p,b){return new E(p,b.type,b.requestType,b.responseType,b.requestStream,b.responseStream,b.options,b.comment)},E.prototype.toJSON=function(p){var b=!!p&&Boolean(p.keepComments);return d.toObject(["type",this.type!=="rpc"&&this.type||undefined$1,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",b?this.comment:undefined$1])},E.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),m.prototype.resolve.call(this))}},{22:22,33:33}],21:[function(c,O,y){O.exports=i;var m=c(22);((i.prototype=Object.create(m.prototype)).constructor=i).className="Namespace";var d,E,p,b=c(15),s=c(33);function g(l,A){if(!l||!l.length)return undefined$1;for(var k={},S=0;S<l.length;++S)k[l[S].name]=l[S].toJSON(A);return k}function i(l,A){m.call(this,l,A),this.nested=undefined$1,this._nestedArray=null}function a(l){return l._nestedArray=null,l}i.fromJSON=function(l,A){return new i(l,A.options).addJSON(A.nested)},i.arrayToJSON=g,i.isReservedId=function(l,A){if(l){for(var k=0;k<l.length;++k)if(typeof l[k]!="string"&&l[k][0]<=A&&l[k][1]>A)return!0}return!1},i.isReservedName=function(l,A){if(l){for(var k=0;k<l.length;++k)if(l[k]===A)return!0}return!1},Object.defineProperty(i.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=s.toArray(this.nested))}}),i.prototype.toJSON=function(l){return s.toObject(["options",this.options,"nested",g(this.nestedArray,l)])},i.prototype.addJSON=function(l){if(l)for(var A,k=Object.keys(l),S=0;S<k.length;++S)A=l[k[S]],this.add((A.fields!==undefined$1?d.fromJSON:A.values!==undefined$1?p.fromJSON:A.methods!==undefined$1?E.fromJSON:A.id!==undefined$1?b.fromJSON:i.fromJSON)(k[S],A));return this},i.prototype.get=function(l){return this.nested&&this.nested[l]||null},i.prototype.getEnum=function(l){if(this.nested&&this.nested[l]instanceof p)return this.nested[l].values;throw Error("no such enum: "+l)},i.prototype.add=function(l){if(!(l instanceof b&&l.extend!==undefined$1||l instanceof d||l instanceof p||l instanceof E||l instanceof i))throw TypeError("object must be a valid nested object");if(this.nested){var A=this.get(l.name);if(A){if(!(A instanceof i&&l instanceof i)||A instanceof d||A instanceof E)throw Error("duplicate name '"+l.name+"' in "+this);for(var k=A.nestedArray,S=0;S<k.length;++S)l.add(k[S]);this.remove(A),this.nested||(this.nested={}),l.setOptions(A.options,!0)}}else this.nested={};return this.nested[l.name]=l,l.onAdd(this),a(this)},i.prototype.remove=function(l){if(!(l instanceof m))throw TypeError("object must be a ReflectionObject");if(l.parent!==this)throw Error(l+" is not a member of "+this);return delete this.nested[l.name],Object.keys(this.nested).length||(this.nested=undefined$1),l.onRemove(this),a(this)},i.prototype.define=function(l,A){if(s.isString(l))l=l.split(".");else if(!Array.isArray(l))throw TypeError("illegal path");if(l&&l.length&&l[0]==="")throw Error("path must be relative");for(var k=this;l.length>0;){var S=l.shift();if(k.nested&&k.nested[S]){if(!((k=k.nested[S])instanceof i))throw Error("path conflicts with non-namespace objects")}else k.add(k=new i(S))}return A&&k.addJSON(A),k},i.prototype.resolveAll=function(){for(var l=this.nestedArray,A=0;A<l.length;)l[A]instanceof i?l[A++].resolveAll():l[A++].resolve();return this.resolve()},i.prototype.lookup=function(l,A,k){if(typeof A=="boolean"?(k=A,A=undefined$1):A&&!Array.isArray(A)&&(A=[A]),s.isString(l)&&l.length){if(l===".")return this.root;l=l.split(".")}else if(!l.length)return this;if(l[0]==="")return this.root.lookup(l.slice(1),A);var S=this.get(l[0]);if(S){if(l.length===1){if(!A||A.indexOf(S.constructor)>-1)return S}else if(S instanceof i&&(S=S.lookup(l.slice(1),A,!0)))return S}else for(var f=0;f<this.nestedArray.length;++f)if(this._nestedArray[f]instanceof i&&(S=this._nestedArray[f].lookup(l,A,!0)))return S;return this.parent===null||k?null:this.parent.lookup(l,A)},i.prototype.lookupType=function(l){var A=this.lookup(l,[d]);if(!A)throw Error("no such type: "+l);return A},i.prototype.lookupEnum=function(l){var A=this.lookup(l,[p]);if(!A)throw Error("no such Enum '"+l+"' in "+this);return A},i.prototype.lookupTypeOrEnum=function(l){var A=this.lookup(l,[d,p]);if(!A)throw Error("no such Type or Enum '"+l+"' in "+this);return A},i.prototype.lookupService=function(l){var A=this.lookup(l,[E]);if(!A)throw Error("no such Service '"+l+"' in "+this);return A},i._configure=function(l,A,k){d=l,E=A,p=k}},{15:15,22:22,33:33}],22:[function(c,O,y){O.exports=E,E.className="ReflectionObject";var m,d=c(33);function E(p,b){if(!d.isString(p))throw TypeError("name must be a string");if(b&&!d.isObject(b))throw TypeError("options must be an object");this.options=b,this.parsedOptions=null,this.name=p,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(E.prototype,{root:{get:function(){for(var p=this;p.parent!==null;)p=p.parent;return p}},fullName:{get:function(){for(var p=[this.name],b=this.parent;b;)p.unshift(b.name),b=b.parent;return p.join(".")}}}),E.prototype.toJSON=function(){throw Error()},E.prototype.onAdd=function(p){this.parent&&this.parent!==p&&this.parent.remove(this),this.parent=p,this.resolved=!1;var b=p.root;b instanceof m&&b._handleAdd(this)},E.prototype.onRemove=function(p){var b=p.root;b instanceof m&&b._handleRemove(this),this.parent=null,this.resolved=!1},E.prototype.resolve=function(){return this.resolved||this.root instanceof m&&(this.resolved=!0),this},E.prototype.getOption=function(p){return this.options?this.options[p]:undefined$1},E.prototype.setOption=function(p,b,s){return s&&this.options&&this.options[p]!==undefined$1||((this.options||(this.options={}))[p]=b),this},E.prototype.setParsedOption=function(p,b,s){this.parsedOptions||(this.parsedOptions=[]);var g=this.parsedOptions;if(s){var i=g.find(function(A){return Object.prototype.hasOwnProperty.call(A,p)});if(i){var a=i[p];d.setProperty(a,s,b)}else(i={})[p]=d.setProperty({},s,b),g.push(i)}else{var l={};l[p]=b,g.push(l)}return this},E.prototype.setOptions=function(p,b){if(p)for(var s=Object.keys(p),g=0;g<s.length;++g)this.setOption(s[g],p[s[g]],b);return this},E.prototype.toString=function(){var p=this.constructor.className,b=this.fullName;return b.length?p+" "+b:p},E._configure=function(p){m=p}},{33:33}],23:[function(c,O,y){O.exports=p;var m=c(22);((p.prototype=Object.create(m.prototype)).constructor=p).className="OneOf";var d=c(15),E=c(33);function p(s,g,i,a){if(Array.isArray(g)||(i=g,g=undefined$1),m.call(this,s,i),g!==undefined$1&&!Array.isArray(g))throw TypeError("fieldNames must be an Array");this.oneof=g||[],this.fieldsArray=[],this.comment=a}function b(s){if(s.parent)for(var g=0;g<s.fieldsArray.length;++g)s.fieldsArray[g].parent||s.parent.add(s.fieldsArray[g])}p.fromJSON=function(s,g){return new p(s,g.oneof,g.options,g.comment)},p.prototype.toJSON=function(s){var g=!!s&&Boolean(s.keepComments);return E.toObject(["options",this.options,"oneof",this.oneof,"comment",g?this.comment:undefined$1])},p.prototype.add=function(s){if(!(s instanceof d))throw TypeError("field must be a Field");return s.parent&&s.parent!==this.parent&&s.parent.remove(s),this.oneof.push(s.name),this.fieldsArray.push(s),s.partOf=this,b(this),this},p.prototype.remove=function(s){if(!(s instanceof d))throw TypeError("field must be a Field");var g=this.fieldsArray.indexOf(s);if(g<0)throw Error(s+" is not a member of "+this);return this.fieldsArray.splice(g,1),(g=this.oneof.indexOf(s.name))>-1&&this.oneof.splice(g,1),s.partOf=null,this},p.prototype.onAdd=function(s){m.prototype.onAdd.call(this,s);for(var g=0;g<this.oneof.length;++g){var i=s.get(this.oneof[g]);i&&!i.partOf&&(i.partOf=this,this.fieldsArray.push(i))}b(this)},p.prototype.onRemove=function(s){for(var g,i=0;i<this.fieldsArray.length;++i)(g=this.fieldsArray[i]).parent&&g.parent.remove(g);m.prototype.onRemove.call(this,s)},p.d=function(){for(var s=new Array(arguments.length),g=0;g<arguments.length;)s[g]=arguments[g++];return function(i,a){E.decorateType(i.constructor).add(new p(a,s)),Object.defineProperty(i,a,{get:E.oneOfGetter(s),set:E.oneOfSetter(s)})}}},{15:15,22:22,33:33}],24:[function(c,O,y){O.exports=s;var m,d=c(35),E=d.LongBits,p=d.utf8;function b(S,f){return RangeError("index out of range: "+S.pos+" + "+(f||1)+" > "+S.len)}function s(S){this.buf=S,this.pos=0,this.len=S.length}var g,i=typeof Uint8Array<"u"?function(S){if(S instanceof Uint8Array||Array.isArray(S))return new s(S);throw Error("illegal buffer")}:function(S){if(Array.isArray(S))return new s(S);throw Error("illegal buffer")},a=function(){return d.Buffer?function(S){return(s.create=function(f){return d.Buffer.isBuffer(f)?new m(f):i(f)})(S)}:i};function l(){var S=new E(0,0),f=0;if(!(this.len-this.pos>4)){for(;f<3;++f){if(this.pos>=this.len)throw b(this);if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*f)>>>0,this.buf[this.pos++]<128)return S}return S.lo=(S.lo|(127&this.buf[this.pos++])<<7*f)>>>0,S}for(;f<4;++f)if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*f)>>>0,this.buf[this.pos++]<128)return S;if(S.lo=(S.lo|(127&this.buf[this.pos])<<28)>>>0,S.hi=(S.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return S;if(f=0,this.len-this.pos>4){for(;f<5;++f)if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*f+3)>>>0,this.buf[this.pos++]<128)return S}else for(;f<5;++f){if(this.pos>=this.len)throw b(this);if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*f+3)>>>0,this.buf[this.pos++]<128)return S}throw Error("invalid varint encoding")}function A(S,f){return(S[f-4]|S[f-3]<<8|S[f-2]<<16|S[f-1]<<24)>>>0}function k(){if(this.pos+8>this.len)throw b(this,8);return new E(A(this.buf,this.pos+=4),A(this.buf,this.pos+=4))}s.create=a(),s.prototype._slice=d.Array.prototype.subarray||d.Array.prototype.slice,s.prototype.uint32=(g=4294967295,function(){if(g=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(g=(g|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(g=(g|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(g=(g|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(g=(g|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return g;if((this.pos+=5)>this.len)throw this.pos=this.len,b(this,10);return g}),s.prototype.int32=function(){return 0|this.uint32()},s.prototype.sint32=function(){var S=this.uint32();return S>>>1^-(1&S)|0},s.prototype.bool=function(){return this.uint32()!==0},s.prototype.fixed32=function(){if(this.pos+4>this.len)throw b(this,4);return A(this.buf,this.pos+=4)},s.prototype.sfixed32=function(){if(this.pos+4>this.len)throw b(this,4);return 0|A(this.buf,this.pos+=4)},s.prototype.float=function(){if(this.pos+4>this.len)throw b(this,4);var S=d.float.readFloatLE(this.buf,this.pos);return this.pos+=4,S},s.prototype.double=function(){if(this.pos+8>this.len)throw b(this,4);var S=d.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,S},s.prototype.bytes=function(){var S=this.uint32(),f=this.pos,C=this.pos+S;if(C>this.len)throw b(this,S);return this.pos+=S,Array.isArray(this.buf)?this.buf.slice(f,C):f===C?new this.buf.constructor(0):this._slice.call(this.buf,f,C)},s.prototype.string=function(){var S=this.bytes();return p.read(S,0,S.length)},s.prototype.skip=function(S){if(typeof S=="number"){if(this.pos+S>this.len)throw b(this,S);this.pos+=S}else do if(this.pos>=this.len)throw b(this);while(128&this.buf[this.pos++]);return this},s.prototype.skipType=function(S){switch(S){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(S=7&this.uint32())!=4;)this.skipType(S);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+S+" at offset "+this.pos)}return this},s._configure=function(S){m=S,s.create=a(),m._configure();var f=d.Long?"toLong":"toNumber";d.merge(s.prototype,{int64:function(){return l.call(this)[f](!1)},uint64:function(){return l.call(this)[f](!0)},sint64:function(){return l.call(this).zzDecode()[f](!1)},fixed64:function(){return k.call(this)[f](!0)},sfixed64:function(){return k.call(this)[f](!1)}})}},{35:35}],25:[function(c,O,y){O.exports=E;var m=c(24);(E.prototype=Object.create(m.prototype)).constructor=E;var d=c(35);function E(p){m.call(this,p)}E._configure=function(){d.Buffer&&(E.prototype._slice=d.Buffer.prototype.slice)},E.prototype.string=function(){var p=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+p,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+p,this.len))},E._configure()},{24:24,35:35}],26:[function(c,O,y){O.exports=a;var m=c(21);((a.prototype=Object.create(m.prototype)).constructor=a).className="Root";var d,E,p,b=c(15),s=c(14),g=c(23),i=c(33);function a(S){m.call(this,"",S),this.deferred=[],this.files=[]}function l(){}a.fromJSON=function(S,f){return f||(f=new a),S.options&&f.setOptions(S.options),f.addJSON(S.nested)},a.prototype.resolvePath=i.path.resolve,a.prototype.fetch=i.fetch,a.prototype.load=function S(f,C,I){typeof C=="function"&&(I=C,C=undefined$1);var P=this;if(!I)return i.asPromise(S,P,f,C);var T=I===l;function F(L,h){if(I){var t=I;if(I=null,T)throw L;t(L,h)}}function J(L){var h=L.lastIndexOf("google/protobuf/");if(h>-1){var t=L.substring(h);if(t in p)return t}return null}function G(L,h){try{if(i.isString(h)&&h.charAt(0)==="{"&&(h=JSON.parse(h)),i.isString(h)){E.filename=L;var t,j=E(h,P,C),r=0;if(j.imports)for(;r<j.imports.length;++r)(t=J(j.imports[r])||P.resolvePath(L,j.imports[r]))&&H(t);if(j.weakImports)for(r=0;r<j.weakImports.length;++r)(t=J(j.weakImports[r])||P.resolvePath(L,j.weakImports[r]))&&H(t,!0)}else P.setOptions(h.options).addJSON(h.nested)}catch(v){F(v)}T||V||F(null,P)}function H(L,h){if(!(P.files.indexOf(L)>-1))if(P.files.push(L),L in p)T?G(L,p[L]):(++V,setTimeout(function(){--V,G(L,p[L])}));else if(T){var t;try{t=i.fs.readFileSync(L).toString("utf8")}catch(j){return void(h||F(j))}G(L,t)}else++V,P.fetch(L,function(j,r){--V,I&&(j?h?V||F(null,P):F(j):G(L,r))})}var V=0;i.isString(f)&&(f=[f]);for(var _,n=0;n<f.length;++n)(_=P.resolvePath("",f[n]))&&H(_);return T?P:(V||F(null,P),undefined$1)},a.prototype.loadSync=function(S,f){if(!i.isNode)throw Error("not supported");return this.load(S,f,l)},a.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(S){return"'extend "+S.extend+"' in "+S.parent.fullName}).join(", "));return m.prototype.resolveAll.call(this)};var A=/^[A-Z]/;function k(S,f){var C=f.parent.lookup(f.extend);if(C){var I=new b(f.fullName,f.id,f.type,f.rule,undefined$1,f.options);return I.declaringField=f,f.extensionField=I,C.add(I),!0}return!1}a.prototype._handleAdd=function(S){if(S instanceof b)S.extend===undefined$1||S.extensionField||k(0,S)||this.deferred.push(S);else if(S instanceof s)A.test(S.name)&&(S.parent[S.name]=S.values);else if(!(S instanceof g)){if(S instanceof d)for(var f=0;f<this.deferred.length;)k(0,this.deferred[f])?this.deferred.splice(f,1):++f;for(var C=0;C<S.nestedArray.length;++C)this._handleAdd(S._nestedArray[C]);A.test(S.name)&&(S.parent[S.name]=S)}},a.prototype._handleRemove=function(S){if(S instanceof b){if(S.extend!==undefined$1)if(S.extensionField)S.extensionField.parent.remove(S.extensionField),S.extensionField=null;else{var f=this.deferred.indexOf(S);f>-1&&this.deferred.splice(f,1)}}else if(S instanceof s)A.test(S.name)&&delete S.parent[S.name];else if(S instanceof m){for(var C=0;C<S.nestedArray.length;++C)this._handleRemove(S._nestedArray[C]);A.test(S.name)&&delete S.parent[S.name]}},a._configure=function(S,f,C){d=S,E=f,p=C}},{14:14,15:15,21:21,23:23,33:33}],27:[function(c,O,y){O.exports={}},{}],28:[function(c,O,y){y.Service=c(29)},{29:29}],29:[function(c,O,y){O.exports=d;var m=c(35);function d(E,p,b){if(typeof E!="function")throw TypeError("rpcImpl must be a function");m.EventEmitter.call(this),this.rpcImpl=E,this.requestDelimited=Boolean(p),this.responseDelimited=Boolean(b)}(d.prototype=Object.create(m.EventEmitter.prototype)).constructor=d,d.prototype.rpcCall=function E(p,b,s,g,i){if(!g)throw TypeError("request must be specified");var a=this;if(!i)return m.asPromise(E,a,p,b,s,g);if(!a.rpcImpl)return setTimeout(function(){i(Error("already ended"))},0),undefined$1;try{return a.rpcImpl(p,b[a.requestDelimited?"encodeDelimited":"encode"](g).finish(),function(l,A){if(l)return a.emit("error",l,p),i(l);if(A===null)return a.end(!0),undefined$1;if(!(A instanceof s))try{A=s[a.responseDelimited?"decodeDelimited":"decode"](A)}catch(k){return a.emit("error",k,p),i(k)}return a.emit("data",A,p),i(null,A)})}catch(l){return a.emit("error",l,p),setTimeout(function(){i(l)},0),undefined$1}},d.prototype.end=function(E){return this.rpcImpl&&(E||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{35:35}],30:[function(c,O,y){O.exports=b;var m=c(21);((b.prototype=Object.create(m.prototype)).constructor=b).className="Service";var d=c(20),E=c(33),p=c(28);function b(g,i){m.call(this,g,i),this.methods={},this._methodsArray=null}function s(g){return g._methodsArray=null,g}b.fromJSON=function(g,i){var a=new b(g,i.options);if(i.methods)for(var l=Object.keys(i.methods),A=0;A<l.length;++A)a.add(d.fromJSON(l[A],i.methods[l[A]]));return i.nested&&a.addJSON(i.nested),a.comment=i.comment,a},b.prototype.toJSON=function(g){var i=m.prototype.toJSON.call(this,g),a=!!g&&Boolean(g.keepComments);return E.toObject(["options",i&&i.options||undefined$1,"methods",m.arrayToJSON(this.methodsArray,g)||{},"nested",i&&i.nested||undefined$1,"comment",a?this.comment:undefined$1])},Object.defineProperty(b.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=E.toArray(this.methods))}}),b.prototype.get=function(g){return this.methods[g]||m.prototype.get.call(this,g)},b.prototype.resolveAll=function(){for(var g=this.methodsArray,i=0;i<g.length;++i)g[i].resolve();return m.prototype.resolve.call(this)},b.prototype.add=function(g){if(this.get(g.name))throw Error("duplicate name '"+g.name+"' in "+this);return g instanceof d?(this.methods[g.name]=g,g.parent=this,s(this)):m.prototype.add.call(this,g)},b.prototype.remove=function(g){if(g instanceof d){if(this.methods[g.name]!==g)throw Error(g+" is not a member of "+this);return delete this.methods[g.name],g.parent=null,s(this)}return m.prototype.remove.call(this,g)},b.prototype.create=function(g,i,a){for(var l,A=new p.Service(g,i,a),k=0;k<this.methodsArray.length;++k){var S=E.lcFirst((l=this._methodsArray[k]).resolve().name).replace(/[^$\w_]/g,"");A[S]=E.codegen(["r","c"],E.isReserved(S)?S+"_":S)("return this.rpcCall(m,q,s,r,c)")({m:l,q:l.resolvedRequestType.ctor,s:l.resolvedResponseType.ctor})}return A}},{20:20,21:21,28:28,33:33}],31:[function(c,O,y){O.exports=I;var m=c(21);((I.prototype=Object.create(m.prototype)).constructor=I).className="Type";var d=c(14),E=c(23),p=c(15),b=c(18),s=c(30),g=c(19),i=c(24),a=c(38),l=c(33),A=c(13),k=c(12),S=c(36),f=c(11),C=c(37);function I(T,F){m.call(this,T,F),this.fields={},this.oneofs=undefined$1,this.extensions=undefined$1,this.reserved=undefined$1,this.group=undefined$1,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function P(T){return T._fieldsById=T._fieldsArray=T._oneofsArray=null,delete T.encode,delete T.decode,delete T.verify,T}Object.defineProperties(I.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var T=Object.keys(this.fields),F=0;F<T.length;++F){var J=this.fields[T[F]],G=J.id;if(this._fieldsById[G])throw Error("duplicate id "+G+" in "+this);this._fieldsById[G]=J}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=l.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=l.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=I.generateConstructor(this)())},set:function(T){var F=T.prototype;F instanceof g||((T.prototype=new g).constructor=T,l.merge(T.prototype,F)),T.$type=T.prototype.$type=this,l.merge(T,g,!0),this._ctor=T;for(var J=0;J<this.fieldsArray.length;++J)this._fieldsArray[J].resolve();var G={};for(J=0;J<this.oneofsArray.length;++J)G[this._oneofsArray[J].resolve().name]={get:l.oneOfGetter(this._oneofsArray[J].oneof),set:l.oneOfSetter(this._oneofsArray[J].oneof)};J&&Object.defineProperties(T.prototype,G)}}}),I.generateConstructor=function(T){for(var F,J=l.codegen(["p"],T.name),G=0;G<T.fieldsArray.length;++G)(F=T._fieldsArray[G]).map?J("this%s={}",l.safeProp(F.name)):F.repeated&&J("this%s=[]",l.safeProp(F.name));return J("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},I.fromJSON=function(T,F){var J=new I(T,F.options);J.extensions=F.extensions,J.reserved=F.reserved;for(var G=Object.keys(F.fields),H=0;H<G.length;++H)J.add((F.fields[G[H]].keyType!==void 0?b.fromJSON:p.fromJSON)(G[H],F.fields[G[H]]));if(F.oneofs)for(G=Object.keys(F.oneofs),H=0;H<G.length;++H)J.add(E.fromJSON(G[H],F.oneofs[G[H]]));if(F.nested)for(G=Object.keys(F.nested),H=0;H<G.length;++H){var V=F.nested[G[H]];J.add((V.id!==undefined$1?p.fromJSON:V.fields!==undefined$1?I.fromJSON:V.values!==undefined$1?d.fromJSON:V.methods!==undefined$1?s.fromJSON:m.fromJSON)(G[H],V))}return F.extensions&&F.extensions.length&&(J.extensions=F.extensions),F.reserved&&F.reserved.length&&(J.reserved=F.reserved),F.group&&(J.group=!0),F.comment&&(J.comment=F.comment),J},I.prototype.toJSON=function(T){var F=m.prototype.toJSON.call(this,T),J=!!T&&Boolean(T.keepComments);return l.toObject(["options",F&&F.options||undefined$1,"oneofs",m.arrayToJSON(this.oneofsArray,T),"fields",m.arrayToJSON(this.fieldsArray.filter(function(G){return!G.declaringField}),T)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:undefined$1,"reserved",this.reserved&&this.reserved.length?this.reserved:undefined$1,"group",this.group||undefined$1,"nested",F&&F.nested||undefined$1,"comment",J?this.comment:undefined$1])},I.prototype.resolveAll=function(){for(var T=this.fieldsArray,F=0;F<T.length;)T[F++].resolve();var J=this.oneofsArray;for(F=0;F<J.length;)J[F++].resolve();return m.prototype.resolveAll.call(this)},I.prototype.get=function(T){return this.fields[T]||this.oneofs&&this.oneofs[T]||this.nested&&this.nested[T]||null},I.prototype.add=function(T){if(this.get(T.name))throw Error("duplicate name '"+T.name+"' in "+this);if(T instanceof p&&T.extend===undefined$1){if(this._fieldsById?this._fieldsById[T.id]:this.fieldsById[T.id])throw Error("duplicate id "+T.id+" in "+this);if(this.isReservedId(T.id))throw Error("id "+T.id+" is reserved in "+this);if(this.isReservedName(T.name))throw Error("name '"+T.name+"' is reserved in "+this);return T.parent&&T.parent.remove(T),this.fields[T.name]=T,T.message=this,T.onAdd(this),P(this)}return T instanceof E?(this.oneofs||(this.oneofs={}),this.oneofs[T.name]=T,T.onAdd(this),P(this)):m.prototype.add.call(this,T)},I.prototype.remove=function(T){if(T instanceof p&&T.extend===undefined$1){if(!this.fields||this.fields[T.name]!==T)throw Error(T+" is not a member of "+this);return delete this.fields[T.name],T.parent=null,T.onRemove(this),P(this)}if(T instanceof E){if(!this.oneofs||this.oneofs[T.name]!==T)throw Error(T+" is not a member of "+this);return delete this.oneofs[T.name],T.parent=null,T.onRemove(this),P(this)}return m.prototype.remove.call(this,T)},I.prototype.isReservedId=function(T){return m.isReservedId(this.reserved,T)},I.prototype.isReservedName=function(T){return m.isReservedName(this.reserved,T)},I.prototype.create=function(T){return new this.ctor(T)},I.prototype.setup=function(){for(var T=this.fullName,F=[],J=0;J<this.fieldsArray.length;++J)F.push(this._fieldsArray[J].resolve().resolvedType);this.encode=A(this)({Writer:a,types:F,util:l}),this.decode=k(this)({Reader:i,types:F,util:l}),this.verify=S(this)({types:F,util:l}),this.fromObject=f.fromObject(this)({types:F,util:l}),this.toObject=f.toObject(this)({types:F,util:l});var G=C[T];if(G){var H=Object.create(this);H.fromObject=this.fromObject,this.fromObject=G.fromObject.bind(H),H.toObject=this.toObject,this.toObject=G.toObject.bind(H)}return this},I.prototype.encode=function(T,F){return this.setup().encode(T,F)},I.prototype.encodeDelimited=function(T,F){return this.encode(T,F&&F.len?F.fork():F).ldelim()},I.prototype.decode=function(T,F){return this.setup().decode(T,F)},I.prototype.decodeDelimited=function(T){return T instanceof i||(T=i.create(T)),this.decode(T,T.uint32())},I.prototype.verify=function(T){return this.setup().verify(T)},I.prototype.fromObject=function(T){return this.setup().fromObject(T)},I.prototype.toObject=function(T,F){return this.setup().toObject(T,F)},I.d=function(T){return function(F){l.decorateType(F,T)}}},{11:11,12:12,13:13,14:14,15:15,18:18,19:19,21:21,23:23,24:24,30:30,33:33,36:36,37:37,38:38}],32:[function(c,O,y){var m=y,d=c(33),E=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function p(b,s){var g=0,i={};for(s|=0;g<b.length;)i[E[g+s]]=b[g++];return i}m.basic=p([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),m.defaults=p([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",d.emptyArray,null]),m.long=p([0,0,0,1,1],7),m.mapKey=p([0,0,0,5,5,0,0,0,1,1,0,2],2),m.packed=p([1,5,0,0,0,5,5,0,0,0,1,1,0])},{33:33}],33:[function(c,O,y){var m,d,E=O.exports=c(35),p=c(27);E.codegen=c(3),E.fetch=c(5),E.path=c(8),E.fs=E.inquire("fs"),E.toArray=function(a){if(a){for(var l=Object.keys(a),A=new Array(l.length),k=0;k<l.length;)A[k]=a[l[k++]];return A}return[]},E.toObject=function(a){for(var l={},A=0;A<a.length;){var k=a[A++],S=a[A++];S!==undefined$1&&(l[k]=S)}return l};var b=/\\/g,s=/"/g;E.isReserved=function(a){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(a)},E.safeProp=function(a){return!/^[$\w_]+$/.test(a)||E.isReserved(a)?'["'+a.replace(b,"\\\\").replace(s,'\\"')+'"]':"."+a},E.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.substring(1)};var g=/_([a-z])/g;E.camelCase=function(a){return a.substring(0,1)+a.substring(1).replace(g,function(l,A){return A.toUpperCase()})},E.compareFieldsById=function(a,l){return a.id-l.id},E.decorateType=function(a,l){if(a.$type)return l&&a.$type.name!==l&&(E.decorateRoot.remove(a.$type),a.$type.name=l,E.decorateRoot.add(a.$type)),a.$type;m||(m=c(31));var A=new m(l||a.name);return E.decorateRoot.add(A),A.ctor=a,Object.defineProperty(a,"$type",{value:A,enumerable:!1}),Object.defineProperty(a.prototype,"$type",{value:A,enumerable:!1}),A};var i=0;E.decorateEnum=function(a){if(a.$type)return a.$type;d||(d=c(14));var l=new d("Enum"+i++,a);return E.decorateRoot.add(l),Object.defineProperty(a,"$type",{value:l,enumerable:!1}),l},E.setProperty=function(a,l,A){if(typeof a!="object")throw TypeError("dst must be an object");if(!l)throw TypeError("path must be specified");return function k(S,f,C){var I=f.shift();if(f.length>0)S[I]=k(S[I]||{},f,C);else{var P=S[I];P&&(C=[].concat(P).concat(C)),S[I]=C}return S}(a,l=l.split("."),A)},Object.defineProperty(E,"decorateRoot",{get:function(){return p.decorated||(p.decorated=new(c(26)))}})},{14:14,26:26,27:27,3:3,31:31,35:35,5:5,8:8}],34:[function(c,O,y){O.exports=d;var m=c(35);function d(s,g){this.lo=s>>>0,this.hi=g>>>0}var E=d.zero=new d(0,0);E.toNumber=function(){return 0},E.zzEncode=E.zzDecode=function(){return this},E.length=function(){return 1};var p=d.zeroHash="\0\0\0\0\0\0\0\0";d.fromNumber=function(s){if(s===0)return E;var g=s<0;g&&(s=-s);var i=s>>>0,a=(s-i)/4294967296>>>0;return g&&(a=~a>>>0,i=~i>>>0,++i>4294967295&&(i=0,++a>4294967295&&(a=0))),new d(i,a)},d.from=function(s){if(typeof s=="number")return d.fromNumber(s);if(m.isString(s)){if(!m.Long)return d.fromNumber(parseInt(s,10));s=m.Long.fromString(s)}return s.low||s.high?new d(s.low>>>0,s.high>>>0):E},d.prototype.toNumber=function(s){if(!s&&this.hi>>>31){var g=1+~this.lo>>>0,i=~this.hi>>>0;return g||(i=i+1>>>0),-(g+4294967296*i)}return this.lo+4294967296*this.hi},d.prototype.toLong=function(s){return m.Long?new m.Long(0|this.lo,0|this.hi,Boolean(s)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(s)}};var b=String.prototype.charCodeAt;d.fromHash=function(s){return s===p?E:new d((b.call(s,0)|b.call(s,1)<<8|b.call(s,2)<<16|b.call(s,3)<<24)>>>0,(b.call(s,4)|b.call(s,5)<<8|b.call(s,6)<<16|b.call(s,7)<<24)>>>0)},d.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},d.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},d.prototype.zzDecode=function(){var s=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},d.prototype.length=function(){var s=this.lo,g=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?g===0?s<16384?s<128?1:2:s<2097152?3:4:g<16384?g<128?5:6:g<2097152?7:8:i<128?9:10}},{35:35}],35:[function(c,O,y){var m=y;function d(p,b,s){for(var g=Object.keys(b),i=0;i<g.length;++i)p[g[i]]!==undefined$1&&s||(p[g[i]]=b[g[i]]);return p}function E(p){function b(s,g){if(!(this instanceof b))return new b(s,g);Object.defineProperty(this,"message",{get:function(){return s}}),Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:new Error().stack||""}),g&&d(this,g)}return(b.prototype=Object.create(Error.prototype)).constructor=b,Object.defineProperty(b.prototype,"name",{get:function(){return p}}),b.prototype.toString=function(){return this.name+": "+this.message},b}m.asPromise=c(1),m.base64=c(2),m.EventEmitter=c(4),m.float=c(6),m.inquire=c(7),m.utf8=c(10),m.pool=c(9),m.LongBits=c(34),m.isNode=Boolean(global!==void 0&&global&&global.process&&global.process.versions&&global.process.versions.node),m.global=m.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||this,m.emptyArray=Object.freeze?Object.freeze([]):[],m.emptyObject=Object.freeze?Object.freeze({}):{},m.isInteger=Number.isInteger||function(p){return typeof p=="number"&&isFinite(p)&&Math.floor(p)===p},m.isString=function(p){return typeof p=="string"||p instanceof String},m.isObject=function(p){return p&&typeof p=="object"},m.isset=m.isSet=function(p,b){var s=p[b];return!(s==null||!p.hasOwnProperty(b))&&(typeof s!="object"||(Array.isArray(s)?s.length:Object.keys(s).length)>0)},m.Buffer=function(){try{var p=m.inquire("buffer").Buffer;return p.prototype.utf8Write?p:null}catch{return null}}(),m._Buffer_from=null,m._Buffer_allocUnsafe=null,m.newBuffer=function(p){return typeof p=="number"?m.Buffer?m._Buffer_allocUnsafe(p):new m.Array(p):m.Buffer?m._Buffer_from(p):typeof Uint8Array>"u"?p:new Uint8Array(p)},m.Array=typeof Uint8Array<"u"?Uint8Array:Array,m.Long=m.global.dcodeIO&&m.global.dcodeIO.Long||m.global.Long||m.inquire("long"),m.key2Re=/^true|false|0|1$/,m.key32Re=/^-?(?:0|[1-9][0-9]*)$/,m.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,m.longToHash=function(p){return p?m.LongBits.from(p).toHash():m.LongBits.zeroHash},m.longFromHash=function(p,b){var s=m.LongBits.fromHash(p);return m.Long?m.Long.fromBits(s.lo,s.hi,b):s.toNumber(Boolean(b))},m.merge=d,m.lcFirst=function(p){return p.charAt(0).toLowerCase()+p.substring(1)},m.newError=E,m.ProtocolError=E("ProtocolError"),m.oneOfGetter=function(p){for(var b={},s=0;s<p.length;++s)b[p[s]]=1;return function(){for(var g=Object.keys(this),i=g.length-1;i>-1;--i)if(b[g[i]]===1&&this[g[i]]!==undefined$1&&this[g[i]]!==null)return g[i]}},m.oneOfSetter=function(p){return function(b){for(var s=0;s<p.length;++s)p[s]!==b&&delete this[p[s]]}},m.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},m._configure=function(){var p=m.Buffer;p?(m._Buffer_from=p.from!==Uint8Array.from&&p.from||function(b,s){return new p(b,s)},m._Buffer_allocUnsafe=p.allocUnsafe||function(b){return new p(b)}):m._Buffer_from=m._Buffer_allocUnsafe=null}},{1:1,10:10,2:2,34:34,4:4,6:6,7:7,9:9}],36:[function(c,O,y){O.exports=function(s){var g=d.codegen(["m"],s.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),i=s.oneofsArray,a={};i.length&&g("var p={}");for(var l=0;l<s.fieldsArray.length;++l){var A=s._fieldsArray[l].resolve(),k="m"+d.safeProp(A.name);if(A.optional&&g("if(%s!=null&&m.hasOwnProperty(%j)){",k,A.name),A.map)g("if(!util.isObject(%s))",k)("return%j",E(A,"object"))("var k=Object.keys(%s)",k)("for(var i=0;i<k.length;++i){"),b(g,A,"k[i]"),p(g,A,l,k+"[k[i]]")("}");else if(A.repeated)g("if(!Array.isArray(%s))",k)("return%j",E(A,"array"))("for(var i=0;i<%s.length;++i){",k),p(g,A,l,k+"[i]")("}");else{if(A.partOf){var S=d.safeProp(A.partOf.name);a[A.partOf.name]===1&&g("if(p%s===1)",S)("return%j",A.partOf.name+": multiple values"),a[A.partOf.name]=1,g("p%s=1",S)}p(g,A,l,k)}A.optional&&g("}")}return g("return null")};var m=c(14),d=c(33);function E(s,g){return s.name+": "+g+(s.repeated&&g!=="array"?"[]":s.map&&g!=="object"?"{k:"+s.keyType+"}":"")+" expected"}function p(s,g,i,a){if(g.resolvedType)if(g.resolvedType instanceof m){s("switch(%s){",a)("default:")("return%j",E(g,"enum value"));for(var l=Object.keys(g.resolvedType.values),A=0;A<l.length;++A)s("case %i:",g.resolvedType.values[l[A]]);s("break")("}")}else s("{")("var e=types[%i].verify(%s);",i,a)("if(e)")("return%j+e",g.name+".")("}");else switch(g.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":s("if(!util.isInteger(%s))",a)("return%j",E(g,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":s("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",a,a,a,a)("return%j",E(g,"integer|Long"));break;case"float":case"double":s('if(typeof %s!=="number")',a)("return%j",E(g,"number"));break;case"bool":s('if(typeof %s!=="boolean")',a)("return%j",E(g,"boolean"));break;case"string":s("if(!util.isString(%s))",a)("return%j",E(g,"string"));break;case"bytes":s('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',a,a,a)("return%j",E(g,"buffer"))}return s}function b(s,g,i){switch(g.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":s("if(!util.key32Re.test(%s))",i)("return%j",E(g,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":s("if(!util.key64Re.test(%s))",i)("return%j",E(g,"integer|Long key"));break;case"bool":s("if(!util.key2Re.test(%s))",i)("return%j",E(g,"boolean key"))}return s}},{14:14,33:33}],37:[function(c,O,y){var m=y,d=c(19);m[".google.protobuf.Any"]={fromObject:function(E){if(E&&E["@type"]){var p=E["@type"].substring(E["@type"].lastIndexOf("/")+1),b=this.lookup(p);if(b){var s=E["@type"].charAt(0)==="."?E["@type"].substr(1):E["@type"];return s.indexOf("/")===-1&&(s="/"+s),this.create({type_url:s,value:b.encode(b.fromObject(E)).finish()})}}return this.fromObject(E)},toObject:function(E,p){var b="",s="";if(p&&p.json&&E.type_url&&E.value){s=E.type_url.substring(E.type_url.lastIndexOf("/")+1),b=E.type_url.substring(0,E.type_url.lastIndexOf("/")+1);var g=this.lookup(s);g&&(E=g.decode(E.value))}if(!(E instanceof this.ctor)&&E instanceof d){var i=E.$type.toObject(E,p);return b===""&&(b="type.googleapis.com/"),s=b+(E.$type.fullName[0]==="."?E.$type.fullName.substr(1):E.$type.fullName),i["@type"]=s,i}return this.toObject(E,p)}}},{19:19}],38:[function(c,O,y){O.exports=a;var m,d=c(35),E=d.LongBits,p=d.base64,b=d.utf8;function s(I,P,T){this.fn=I,this.len=P,this.next=undefined$1,this.val=T}function g(){}function i(I){this.head=I.head,this.tail=I.tail,this.len=I.len,this.next=I.states}function a(){this.len=0,this.head=new s(g,0,0),this.tail=this.head,this.states=null}var l=function(){return d.Buffer?function(){return(a.create=function(){return new m})()}:function(){return new a}};function A(I,P,T){P[T]=255&I}function k(I,P){this.len=I,this.next=undefined$1,this.val=P}function S(I,P,T){for(;I.hi;)P[T++]=127&I.lo|128,I.lo=(I.lo>>>7|I.hi<<25)>>>0,I.hi>>>=7;for(;I.lo>127;)P[T++]=127&I.lo|128,I.lo=I.lo>>>7;P[T++]=I.lo}function f(I,P,T){P[T]=255&I,P[T+1]=I>>>8&255,P[T+2]=I>>>16&255,P[T+3]=I>>>24}a.create=l(),a.alloc=function(I){return new d.Array(I)},d.Array!==Array&&(a.alloc=d.pool(a.alloc,d.Array.prototype.subarray)),a.prototype._push=function(I,P,T){return this.tail=this.tail.next=new s(I,P,T),this.len+=P,this},k.prototype=Object.create(s.prototype),k.prototype.fn=function(I,P,T){for(;I>127;)P[T++]=127&I|128,I>>>=7;P[T]=I},a.prototype.uint32=function(I){return this.len+=(this.tail=this.tail.next=new k((I>>>=0)<128?1:I<16384?2:I<2097152?3:I<268435456?4:5,I)).len,this},a.prototype.int32=function(I){return I<0?this._push(S,10,E.fromNumber(I)):this.uint32(I)},a.prototype.sint32=function(I){return this.uint32((I<<1^I>>31)>>>0)},a.prototype.uint64=function(I){var P=E.from(I);return this._push(S,P.length(),P)},a.prototype.int64=a.prototype.uint64,a.prototype.sint64=function(I){var P=E.from(I).zzEncode();return this._push(S,P.length(),P)},a.prototype.bool=function(I){return this._push(A,1,I?1:0)},a.prototype.fixed32=function(I){return this._push(f,4,I>>>0)},a.prototype.sfixed32=a.prototype.fixed32,a.prototype.fixed64=function(I){var P=E.from(I);return this._push(f,4,P.lo)._push(f,4,P.hi)},a.prototype.sfixed64=a.prototype.fixed64,a.prototype.float=function(I){return this._push(d.float.writeFloatLE,4,I)},a.prototype.double=function(I){return this._push(d.float.writeDoubleLE,8,I)};var C=d.Array.prototype.set?function(I,P,T){P.set(I,T)}:function(I,P,T){for(var F=0;F<I.length;++F)P[T+F]=I[F]};a.prototype.bytes=function(I){var P=I.length>>>0;if(!P)return this._push(A,1,0);if(d.isString(I)){var T=a.alloc(P=p.length(I));p.decode(I,T,0),I=T}return this.uint32(P)._push(C,P,I)},a.prototype.string=function(I){var P=b.length(I);return P?this.uint32(P)._push(b.write,P,I):this._push(A,1,0)},a.prototype.fork=function(){return this.states=new i(this),this.head=this.tail=new s(g,0,0),this.len=0,this},a.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new s(g,0,0),this.len=0),this},a.prototype.ldelim=function(){var I=this.head,P=this.tail,T=this.len;return this.reset().uint32(T),T&&(this.tail.next=I.next,this.tail=P,this.len+=T),this},a.prototype.finish=function(){for(var I=this.head.next,P=this.constructor.alloc(this.len),T=0;I;)I.fn(I.val,P,T),T+=I.len,I=I.next;return P},a._configure=function(I){m=I,a.create=l(),m._configure()}},{35:35}],39:[function(c,O,y){O.exports=E;var m=c(38);(E.prototype=Object.create(m.prototype)).constructor=E;var d=c(35);function E(){m.call(this)}function p(b,s,g){b.length<40?d.utf8.write(b,s,g):s.utf8Write?s.utf8Write(b,g):s.write(b,g)}E._configure=function(){E.alloc=d._Buffer_allocUnsafe,E.writeBytesBuffer=d.Buffer&&d.Buffer.prototype instanceof Uint8Array&&d.Buffer.prototype.set.name==="set"?function(b,s,g){s.set(b,g)}:function(b,s,g){if(b.copy)b.copy(s,g,0,b.length);else for(var i=0;i<b.length;)s[g++]=b[i++]}},E.prototype.bytes=function(b){d.isString(b)&&(b=d._Buffer_from(b,"base64"));var s=b.length>>>0;return this.uint32(s),s&&this._push(E.writeBytesBuffer,s,b),this},E.prototype.string=function(b){var s=d.Buffer.byteLength(b);return this.uint32(s),s&&this._push(p,s,b),this},E._configure()},{35:35,38:38}]},{},[16])})()}).call(this,__webpack_require__(33),__webpack_require__(60)(module))},function(c,O){c.exports=function(y){return y.webpackPolyfill||(y.deprecate=function(){},y.paths=[],y.children||(y.children=[]),Object.defineProperty(y,"loaded",{enumerable:!0,get:function(){return y.l}}),Object.defineProperty(y,"id",{enumerable:!0,get:function(){return y.i}}),y.webpackPolyfill=1),y}},function(c,O){c.exports=m;var y=null;try{y=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function m(_,n,L){this.low=0|_,this.high=0|n,this.unsigned=!!L}function d(_){return(_&&_.__isLong__)===!0}m.prototype.__isLong__,Object.defineProperty(m.prototype,"__isLong__",{value:!0}),m.isLong=d;var E={},p={};function b(_,n){var L,h,t;return n?(t=0<=(_>>>=0)&&_<256)&&(h=p[_])?h:(L=g(_,(0|_)<0?-1:0,!0),t&&(p[_]=L),L):(t=-128<=(_|=0)&&_<128)&&(h=E[_])?h:(L=g(_,_<0?-1:0,!1),t&&(E[_]=L),L)}function s(_,n){if(isNaN(_))return n?I:C;if(n){if(_<0)return I;if(_>=k)return G}else{if(_<=-S)return H;if(_+1>=S)return J}return _<0?s(-_,n).neg():g(_%A|0,_/A|0,n)}function g(_,n,L){return new m(_,n,L)}m.fromInt=b,m.fromNumber=s,m.fromBits=g;var i=Math.pow;function a(_,n,L){if(_.length===0)throw Error("empty string");if(_==="NaN"||_==="Infinity"||_==="+Infinity"||_==="-Infinity")return C;if(typeof n=="number"?(L=n,n=!1):n=!!n,(L=L||10)<2||36<L)throw RangeError("radix");var h;if((h=_.indexOf("-"))>0)throw Error("interior hyphen");if(h===0)return a(_.substring(1),n,L).neg();for(var t=s(i(L,8)),j=C,r=0;r<_.length;r+=8){var v=Math.min(8,_.length-r),M=parseInt(_.substring(r,r+v),L);if(v<8){var B=s(i(L,v));j=j.mul(B).add(s(M))}else j=(j=j.mul(t)).add(s(M))}return j.unsigned=n,j}function l(_,n){return typeof _=="number"?s(_,n):typeof _=="string"?a(_,n):g(_.low,_.high,typeof n=="boolean"?n:_.unsigned)}m.fromString=a,m.fromValue=l;var A=4294967296,k=A*A,S=k/2,f=b(1<<24),C=b(0);m.ZERO=C;var I=b(0,!0);m.UZERO=I;var P=b(1);m.ONE=P;var T=b(1,!0);m.UONE=T;var F=b(-1);m.NEG_ONE=F;var J=g(-1,2147483647,!1);m.MAX_VALUE=J;var G=g(-1,-1,!0);m.MAX_UNSIGNED_VALUE=G;var H=g(0,-2147483648,!1);m.MIN_VALUE=H;var V=m.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*A+(this.low>>>0):this.high*A+(this.low>>>0)},V.toString=function(_){if((_=_||10)<2||36<_)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(H)){var n=s(_),L=this.div(n),h=L.mul(n).sub(this);return L.toString(_)+h.toInt().toString(_)}return"-"+this.neg().toString(_)}for(var t=s(i(_,6),this.unsigned),j=this,r="";;){var v=j.div(t),M=(j.sub(v.mul(t)).toInt()>>>0).toString(_);if((j=v).isZero())return M+r;for(;M.length<6;)M="0"+M;r=""+M+r}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(H)?64:this.neg().getNumBitsAbs();for(var _=this.high!=0?this.high:this.low,n=31;n>0&&!(_&1<<n);n--);return this.high!=0?n+33:n+1},V.isZero=function(){return this.high===0&&this.low===0},V.eqz=V.isZero,V.isNegative=function(){return!this.unsigned&&this.high<0},V.isPositive=function(){return this.unsigned||this.high>=0},V.isOdd=function(){return(1&this.low)==1},V.isEven=function(){return(1&this.low)==0},V.equals=function(_){return d(_)||(_=l(_)),(this.unsigned===_.unsigned||this.high>>>31!=1||_.high>>>31!=1)&&this.high===_.high&&this.low===_.low},V.eq=V.equals,V.notEquals=function(_){return!this.eq(_)},V.neq=V.notEquals,V.ne=V.notEquals,V.lessThan=function(_){return this.comp(_)<0},V.lt=V.lessThan,V.lessThanOrEqual=function(_){return this.comp(_)<=0},V.lte=V.lessThanOrEqual,V.le=V.lessThanOrEqual,V.greaterThan=function(_){return this.comp(_)>0},V.gt=V.greaterThan,V.greaterThanOrEqual=function(_){return this.comp(_)>=0},V.gte=V.greaterThanOrEqual,V.ge=V.greaterThanOrEqual,V.compare=function(_){if(d(_)||(_=l(_)),this.eq(_))return 0;var n=this.isNegative(),L=_.isNegative();return n&&!L?-1:!n&&L?1:this.unsigned?_.high>>>0>this.high>>>0||_.high===this.high&&_.low>>>0>this.low>>>0?-1:1:this.sub(_).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(H)?H:this.not().add(P)},V.neg=V.negate,V.add=function(_){d(_)||(_=l(_));var n=this.high>>>16,L=65535&this.high,h=this.low>>>16,t=65535&this.low,j=_.high>>>16,r=65535&_.high,v=_.low>>>16,M=0,B=0,q=0,Q=0;return q+=(Q+=t+(65535&_.low))>>>16,B+=(q+=h+v)>>>16,M+=(B+=L+r)>>>16,M+=n+j,g((q&=65535)<<16|(Q&=65535),(M&=65535)<<16|(B&=65535),this.unsigned)},V.subtract=function(_){return d(_)||(_=l(_)),this.add(_.neg())},V.sub=V.subtract,V.multiply=function(_){if(this.isZero())return C;if(d(_)||(_=l(_)),y)return g(y.mul(this.low,this.high,_.low,_.high),y.get_high(),this.unsigned);if(_.isZero())return C;if(this.eq(H))return _.isOdd()?H:C;if(_.eq(H))return this.isOdd()?H:C;if(this.isNegative())return _.isNegative()?this.neg().mul(_.neg()):this.neg().mul(_).neg();if(_.isNegative())return this.mul(_.neg()).neg();if(this.lt(f)&&_.lt(f))return s(this.toNumber()*_.toNumber(),this.unsigned);var n=this.high>>>16,L=65535&this.high,h=this.low>>>16,t=65535&this.low,j=_.high>>>16,r=65535&_.high,v=_.low>>>16,M=65535&_.low,B=0,q=0,Q=0,z=0;return Q+=(z+=t*M)>>>16,q+=(Q+=h*M)>>>16,Q&=65535,q+=(Q+=t*v)>>>16,B+=(q+=L*M)>>>16,q&=65535,B+=(q+=h*v)>>>16,q&=65535,B+=(q+=t*r)>>>16,B+=n*M+L*v+h*r+t*j,g((Q&=65535)<<16|(z&=65535),(B&=65535)<<16|(q&=65535),this.unsigned)},V.mul=V.multiply,V.divide=function(_){if(d(_)||(_=l(_)),_.isZero())throw Error("division by zero");var n,L,h;if(y)return this.unsigned||this.high!==-2147483648||_.low!==-1||_.high!==-1?g((this.unsigned?y.div_u:y.div_s)(this.low,this.high,_.low,_.high),y.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?I:C;if(this.unsigned){if(_.unsigned||(_=_.toUnsigned()),_.gt(this))return I;if(_.gt(this.shru(1)))return T;h=I}else{if(this.eq(H))return _.eq(P)||_.eq(F)?H:_.eq(H)?P:(n=this.shr(1).div(_).shl(1)).eq(C)?_.isNegative()?P:F:(L=this.sub(_.mul(n)),h=n.add(L.div(_)));if(_.eq(H))return this.unsigned?I:C;if(this.isNegative())return _.isNegative()?this.neg().div(_.neg()):this.neg().div(_).neg();if(_.isNegative())return this.div(_.neg()).neg();h=C}for(L=this;L.gte(_);){n=Math.max(1,Math.floor(L.toNumber()/_.toNumber()));for(var t=Math.ceil(Math.log(n)/Math.LN2),j=t<=48?1:i(2,t-48),r=s(n),v=r.mul(_);v.isNegative()||v.gt(L);)v=(r=s(n-=j,this.unsigned)).mul(_);r.isZero()&&(r=P),h=h.add(r),L=L.sub(v)}return h},V.div=V.divide,V.modulo=function(_){return d(_)||(_=l(_)),y?g((this.unsigned?y.rem_u:y.rem_s)(this.low,this.high,_.low,_.high),y.get_high(),this.unsigned):this.sub(this.div(_).mul(_))},V.mod=V.modulo,V.rem=V.modulo,V.not=function(){return g(~this.low,~this.high,this.unsigned)},V.and=function(_){return d(_)||(_=l(_)),g(this.low&_.low,this.high&_.high,this.unsigned)},V.or=function(_){return d(_)||(_=l(_)),g(this.low|_.low,this.high|_.high,this.unsigned)},V.xor=function(_){return d(_)||(_=l(_)),g(this.low^_.low,this.high^_.high,this.unsigned)},V.shiftLeft=function(_){return d(_)&&(_=_.toInt()),(_&=63)==0?this:_<32?g(this.low<<_,this.high<<_|this.low>>>32-_,this.unsigned):g(0,this.low<<_-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(_){return d(_)&&(_=_.toInt()),(_&=63)==0?this:_<32?g(this.low>>>_|this.high<<32-_,this.high>>_,this.unsigned):g(this.high>>_-32,this.high>=0?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(_){if(d(_)&&(_=_.toInt()),(_&=63)===0)return this;var n=this.high;return _<32?g(this.low>>>_|n<<32-_,n>>>_,this.unsigned):g(_===32?n:n>>>_-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.shr_u=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?g(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:g(this.low,this.high,!0)},V.toBytes=function(_){return _?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var _=this.high,n=this.low;return[255&n,n>>>8&255,n>>>16&255,n>>>24,255&_,_>>>8&255,_>>>16&255,_>>>24]},V.toBytesBE=function(){var _=this.high,n=this.low;return[_>>>24,_>>>16&255,_>>>8&255,255&_,n>>>24,n>>>16&255,n>>>8&255,255&n]},m.fromBytes=function(_,n,L){return L?m.fromBytesLE(_,n):m.fromBytesBE(_,n)},m.fromBytesLE=function(_,n){return new m(_[0]|_[1]<<8|_[2]<<16|_[3]<<24,_[4]|_[5]<<8|_[6]<<16|_[7]<<24,n)},m.fromBytesBE=function(_,n){return new m(_[4]<<24|_[5]<<16|_[6]<<8|_[7],_[0]<<24|_[1]<<16|_[2]<<8|_[3],n)}},function(c){c.exports=JSON.parse('{"PeerPublishStatus":408,"JoinChannelTimeout":407,"OnUpdateStream":356,"OnRemoveStream":355,"OnAddVideoStream":353,"OnAddAudioStream":352,"FirstAudioDecode":351,"FirstVideoDecode":350,"FirstAudioReceived":349,"FirstVideoReceived":348,"ReqUserAccount":196,"ApiInvoke":41,"RequestProxyWorkerManager":36,"RequestProxyAppCenter":35,"VideoSendingStopped":34,"AudioSendingStopped":33,"StreamSwitch":32,"FirstFrame":31,"Publish":30,"Subscribe":29,"JoinGateway":28,"JoinChooseServer":27,"Session":26,"APWorkerEvent":160,"WorkerEvent":156,"JoinWebProxyAP":700,"WebSocketQuit":671}')},function(c){c.exports=JSON.parse('{"nested":{"protobuf":{"nested":{"Session":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"version":{"type":"string","id":11},"browser":{"type":"string","id":12},"appid":{"type":"string","id":13},"mode":{"type":"string","id":14},"extend":{"type":"string","id":15},"process":{"type":"string","id":16},"build":{"type":"string","id":17},"ipv6":{"type":"string","id":18},"sourceHost":{"type":"string","id":19},"sourcePath":{"type":"string","id":20},"collectorHost":{"type":"string","id":21},"collectorName":{"type":"string","id":22}}},"JoinChooseServer":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"chooseServerAddr":{"type":"string","id":11},"chooseServerAddrList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"chooseServerIp":{"type":"string","id":15}}},"JoinGateway":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"gatewayAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"firstSuccess":{"type":"bool","id":14}}},"Subscribe":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"video":{"type":"bool","id":16},"audio":{"type":"bool","id":17},"subscribeRequestid":{"type":"int32","id":18},"p2pid":{"type":"int32","id":19}}},"Publish":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"localSdp":{"type":"string","id":11},"remoteSdp":{"type":"string","id":12},"extend":{"type":"string","id":13},"errorCode":{"type":"string","id":14},"eventElapse":{"type":"int64","id":15},"videoName":{"type":"string","id":16},"audioName":{"type":"string","id":17},"screenName":{"type":"string","id":18},"video":{"type":"bool","id":19},"audio":{"type":"bool","id":20},"publishRequestid":{"type":"int32","id":21},"p2pid":{"type":"int32","id":22},"screenshare":{"type":"bool","id":23}}},"FirstFrame":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"extend":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"width":{"type":"int64","id":13},"height":{"type":"int64","id":14}}},"StreamSwitch":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"isDual":{"type":"bool","id":11}}},"AudioSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"VideoSendingStopped":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"reason":{"type":"string","id":10},"eventType":{"type":"string","id":11}}},"RequestProxyAppCenter":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"APAddr":{"type":"string","id":11},"workerManagerList":{"type":"string","id":12},"errorCode":{"type":"string","id":13},"eventElapse":{"type":"int64","id":14},"extend":{"type":"string","id":15},"response":{"type":"string","id":16}}},"RequestProxyWorkerManager":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"eventType":{"type":"string","id":10},"workerManagerAddr":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"eventElapse":{"type":"int64","id":13},"extend":{"type":"string","id":14},"response":{"type":"string","id":15}}},"ApiInvoke":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"apiName":{"type":"string","id":9},"errorCode":{"type":"string","id":10},"options":{"type":"string","id":11},"execElapse":{"type":"int64","id":12},"execStates":{"type":"string","id":13},"execResult":{"type":"string","id":14},"invokeId":{"type":"int64","id":15}}},"ReqUserAccount":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"serverAddress":{"type":"string","id":10},"stringUid":{"type":"string","id":11},"errorCode":{"type":"string","id":12},"extend":{"type":"string","id":13}}},"FirstVideoReceived":{"fields":{"lts":{"type":"int64","id":1},"peer":{"type":"int64","id":2},"elapse":{"type":"int64","id":3},"sid":{"type":"string","id":4},"cname":{"type":"string","id":5},"cid":{"type":"int64","id":6},"uid":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstAudioReceived":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"FirstVideoDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"videowidth":{"type":"int32","id":9},"videoheight":{"type":"int32","id":10},"subscribeRequestid":{"type":"int32","id":11},"p2pid":{"type":"int32","id":12},"subscribeElapse":{"type":"int64","id":13}}},"FirstAudioDecode":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"elapse":{"type":"int64","id":8},"subscribeRequestid":{"type":"int32","id":9},"p2pid":{"type":"int32","id":10},"subscribeElapse":{"type":"int64","id":11}}},"OnAddAudioStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnAddVideoStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnRemoveStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7}}},"OnUpdateStream":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":6},"peer":{"type":"int64","id":7},"audio":{"type":"bool","id":8},"video":{"type":"bool","id":9}}},"JoinChannelTimeout":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"timeout":{"type":"int32","id":7}}},"PeerPublishStatus":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"peer":{"type":"int64","id":6},"elapse":{"type":"int64","id":7},"peerPublishDuration":{"type":"int64","id":8},"joinChannelSuccessElapse":{"type":"int64","id":9},"subscribeElapse":{"type":"int64","id":10},"audiotag":{"type":"int32","id":11},"videotag":{"type":"int32","id":12},"screensharetag":{"type":"int32","id":13},"firsttimetag":{"type":"int32","id":14}}},"WebSocketQuit":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"uid":{"type":"int64","id":5},"elapse":{"type":"int64","id":6},"succ":{"type":"int32","id":7},"errorCode":{"type":"string","id":8},"ip":{"type":"string","id":9}}},"Message":{"fields":{"id":{"type":"int64","id":1},"msg":{"type":"bytes","id":2}}},"ProtoRaws":{"fields":{"sendTs":{"type":"int64","id":1},"payloads":{"rule":"repeated","type":"Message","id":2},"vid":{"type":"int32","id":3}}},"APWorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"ec":{"type":"int32","id":10},"sc":{"type":"int32","id":11},"serverIp":{"type":"string","id":12},"firstSuccess":{"type":"bool","id":13},"responseTime":{"type":"int32","id":14},"serviceName":{"type":"string","id":15},"responseDetail":{"type":"string","id":16}}},"WorkerEvent":{"fields":{"sid":{"type":"string","id":1},"cname":{"type":"string","id":2},"cid":{"type":"int64","id":3},"lts":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"success":{"type":"bool","id":7},"elapse":{"type":"int64","id":8},"peer":{"type":"int64","id":9},"command":{"type":"string","id":10},"actionType":{"type":"string","id":11},"url":{"type":"string","id":12},"payload":{"type":"string","id":13},"serverCode":{"type":"int32","id":14},"code":{"type":"int32","id":15},"traceId":{"type":"string","id":16},"workerType":{"type":"int32","id":17},"responseTime":{"type":"int32","id":18},"requestId":{"type":"int64","id":19},"packIndex":{"type":"int32","id":20},"requestByUser":{"type":"bool","id":21},"tid":{"type":"string","id":22}}},"JoinWebProxyAP":{"fields":{"lts":{"type":"int64","id":1},"sid":{"type":"string","id":2},"cname":{"type":"string","id":3},"cid":{"type":"int64","id":4},"ip":{"type":"string","id":5},"uid":{"type":"int64","id":6},"sucess":{"type":"int32","id":7},"elapse":{"type":"int64","id":8},"eventType":{"type":"string","id":9},"apServerAddr":{"type":"string","id":10},"turnServerAddrList":{"type":"string","id":11},"errorCode":{"type":"string","id":12}}}}}}}')},function(c,O,y){var m=function(d){var E=Object.prototype,p=E.hasOwnProperty,b=typeof Symbol=="function"?Symbol:{},s=b.iterator||"@@iterator",g=b.asyncIterator||"@@asyncIterator",i=b.toStringTag||"@@toStringTag";function a(h,t,j,r){var v=t&&t.prototype instanceof k?t:k,M=Object.create(v.prototype),B=new _(r||[]);return M._invoke=function(q,Q,z){var w="suspendedStart";return function(D,x){if(w==="executing")throw new Error("Generator is already running");if(w==="completed"){if(D==="throw")throw x;return L()}for(z.method=D,z.arg=x;;){var ee=z.delegate;if(ee){var Y=G(ee,z);if(Y){if(Y===A)continue;return Y}}if(z.method==="next")z.sent=z._sent=z.arg;else if(z.method==="throw"){if(w==="suspendedStart")throw w="completed",z.arg;z.dispatchException(z.arg)}else z.method==="return"&&z.abrupt("return",z.arg);w="executing";var Z=l(q,Q,z);if(Z.type==="normal"){if(w=z.done?"completed":"suspendedYield",Z.arg===A)continue;return{value:Z.arg,done:z.done}}Z.type==="throw"&&(w="completed",z.method="throw",z.arg=Z.arg)}}}(h,j,B),M}function l(h,t,j){try{return{type:"normal",arg:h.call(t,j)}}catch(r){return{type:"throw",arg:r}}}d.wrap=a;var A={};function k(){}function S(){}function f(){}var C={};C[s]=function(){return this};var I=Object.getPrototypeOf,P=I&&I(I(n([])));P&&P!==E&&p.call(P,s)&&(C=P);var T=f.prototype=k.prototype=Object.create(C);function F(h){["next","throw","return"].forEach(function(t){h[t]=function(j){return this._invoke(t,j)}})}function J(h,t){var j;this._invoke=function(r,v){function M(){return new t(function(B,q){(function Q(z,w,D,x){var ee=l(h[z],h,w);if(ee.type!=="throw"){var Y=ee.arg,Z=Y.value;return Z&&typeof Z=="object"&&p.call(Z,"__await")?t.resolve(Z.__await).then(function(oe){Q("next",oe,D,x)},function(oe){Q("throw",oe,D,x)}):t.resolve(Z).then(function(oe){Y.value=oe,D(Y)},function(oe){return Q("throw",oe,D,x)})}x(ee.arg)})(r,v,B,q)})}return j=j?j.then(M,M):M()}}function G(h,t){var j=h.iterator[t.method];if(j===void 0){if(t.delegate=null,t.method==="throw"){if(h.iterator.return&&(t.method="return",t.arg=void 0,G(h,t),t.method==="throw"))return A;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var r=l(j,h.iterator,t.arg);if(r.type==="throw")return t.method="throw",t.arg=r.arg,t.delegate=null,A;var v=r.arg;return v?v.done?(t[h.resultName]=v.value,t.next=h.nextLoc,t.method!=="return"&&(t.method="next",t.arg=void 0),t.delegate=null,A):v:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,A)}function H(h){var t={tryLoc:h[0]};1 in h&&(t.catchLoc=h[1]),2 in h&&(t.finallyLoc=h[2],t.afterLoc=h[3]),this.tryEntries.push(t)}function V(h){var t=h.completion||{};t.type="normal",delete t.arg,h.completion=t}function _(h){this.tryEntries=[{tryLoc:"root"}],h.forEach(H,this),this.reset(!0)}function n(h){if(h){var t=h[s];if(t)return t.call(h);if(typeof h.next=="function")return h;if(!isNaN(h.length)){var j=-1,r=function v(){for(;++j<h.length;)if(p.call(h,j))return v.value=h[j],v.done=!1,v;return v.value=void 0,v.done=!0,v};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return S.prototype=T.constructor=f,f.constructor=S,f[i]=S.displayName="GeneratorFunction",d.isGeneratorFunction=function(h){var t=typeof h=="function"&&h.constructor;return!!t&&(t===S||(t.displayName||t.name)==="GeneratorFunction")},d.mark=function(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,f):(h.__proto__=f,i in h||(h[i]="GeneratorFunction")),h.prototype=Object.create(T),h},d.awrap=function(h){return{__await:h}},F(J.prototype),J.prototype[g]=function(){return this},d.AsyncIterator=J,d.async=function(h,t,j,r,v){v===void 0&&(v=Promise);var M=new J(a(h,t,j,r),v);return d.isGeneratorFunction(t)?M:M.next().then(function(B){return B.done?B.value:M.next()})},F(T),T[i]="Generator",T[s]=function(){return this},T.toString=function(){return"[object Generator]"},d.keys=function(h){var t=[];for(var j in h)t.push(j);return t.reverse(),function r(){for(;t.length;){var v=t.pop();if(v in h)return r.value=v,r.done=!1,r}return r.done=!0,r}},d.values=n,_.prototype={constructor:_,reset:function(h){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(V),!h)for(var t in this)t.charAt(0)==="t"&&p.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var h=this.tryEntries[0].completion;if(h.type==="throw")throw h.arg;return this.rval},dispatchException:function(h){if(this.done)throw h;var t=this;function j(Q,z){return M.type="throw",M.arg=h,t.next=Q,z&&(t.method="next",t.arg=void 0),!!z}for(var r=this.tryEntries.length-1;r>=0;--r){var v=this.tryEntries[r],M=v.completion;if(v.tryLoc==="root")return j("end");if(v.tryLoc<=this.prev){var B=p.call(v,"catchLoc"),q=p.call(v,"finallyLoc");if(B&&q){if(this.prev<v.catchLoc)return j(v.catchLoc,!0);if(this.prev<v.finallyLoc)return j(v.finallyLoc)}else if(B){if(this.prev<v.catchLoc)return j(v.catchLoc,!0)}else{if(!q)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return j(v.finallyLoc)}}}},abrupt:function(h,t){for(var j=this.tryEntries.length-1;j>=0;--j){var r=this.tryEntries[j];if(r.tryLoc<=this.prev&&p.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var v=r;break}}v&&(h==="break"||h==="continue")&&v.tryLoc<=t&&t<=v.finallyLoc&&(v=null);var M=v?v.completion:{};return M.type=h,M.arg=t,v?(this.method="next",this.next=v.finallyLoc,A):this.complete(M)},complete:function(h,t){if(h.type==="throw")throw h.arg;return h.type==="break"||h.type==="continue"?this.next=h.arg:h.type==="return"?(this.rval=this.arg=h.arg,this.method="return",this.next="end"):h.type==="normal"&&t&&(this.next=t),A},finish:function(h){for(var t=this.tryEntries.length-1;t>=0;--t){var j=this.tryEntries[t];if(j.finallyLoc===h)return this.complete(j.completion,j.afterLoc),V(j),A}},catch:function(h){for(var t=this.tryEntries.length-1;t>=0;--t){var j=this.tryEntries[t];if(j.tryLoc===h){var r=j.completion;if(r.type==="throw"){var v=r.arg;V(j)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(h,t,j){return this.delegate={iterator:n(h),resultName:t,nextLoc:j},this.method==="next"&&(this.arg=void 0),A}},d}(c.exports);try{regeneratorRuntime=m}catch{Function("r","regeneratorRuntime = r")(m)}},function(c,O){c.exports=function(y){if(Array.isArray(y))return y}},function(c,O){c.exports=function(y,m){if(typeof Symbol<"u"&&Symbol.iterator in Object(y)){var d=[],E=!0,p=!1,b=void 0;try{for(var s,g=y[Symbol.iterator]();!(E=(s=g.next()).done)&&(d.push(s.value),!m||d.length!==m);E=!0);}catch(i){p=!0,b=i}finally{try{E||g.return==null||g.return()}finally{if(p)throw b}}return d}}},function(c,O){c.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(c,O,y){Object.defineProperty(O,"__esModule",{value:!0});var m=typeof window=="object"&&window.RTCPeerConnection,d=typeof window=="object"&&window.webkitRTCPeerConnection,E=typeof window=="object"&&window.mozRTCPeerConnection;O.createRTCPeerConnection=function(p){var b=m||d||E;return b?new b(p):null}},function(c,O,y){var m;/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(d){function E(){}var p=E.prototype,b=d.EventEmitter;function s(i,a){for(var l=i.length;l--;)if(i[l].listener===a)return l;return-1}function g(i){return function(){return this[i].apply(this,arguments)}}p.getListeners=function(i){var a,l,A=this._getEvents();if(i instanceof RegExp)for(l in a={},A)A.hasOwnProperty(l)&&i.test(l)&&(a[l]=A[l]);else a=A[i]||(A[i]=[]);return a},p.flattenListeners=function(i){var a,l=[];for(a=0;a<i.length;a+=1)l.push(i[a].listener);return l},p.getListenersAsObject=function(i){var a,l=this.getListeners(i);return l instanceof Array&&((a={})[i]=l),a||l},p.addListener=function(i,a){if(!function S(f){return typeof f=="function"||f instanceof RegExp||!(!f||typeof f!="object")&&S(f.listener)}(a))throw new TypeError("listener must be a function");var l,A=this.getListenersAsObject(i),k=typeof a=="object";for(l in A)A.hasOwnProperty(l)&&s(A[l],a)===-1&&A[l].push(k?a:{listener:a,once:!1});return this},p.on=g("addListener"),p.addOnceListener=function(i,a){return this.addListener(i,{listener:a,once:!0})},p.once=g("addOnceListener"),p.defineEvent=function(i){return this.getListeners(i),this},p.defineEvents=function(i){for(var a=0;a<i.length;a+=1)this.defineEvent(i[a]);return this},p.removeListener=function(i,a){var l,A,k=this.getListenersAsObject(i);for(A in k)k.hasOwnProperty(A)&&(l=s(k[A],a))!==-1&&k[A].splice(l,1);return this},p.off=g("removeListener"),p.addListeners=function(i,a){return this.manipulateListeners(!1,i,a)},p.removeListeners=function(i,a){return this.manipulateListeners(!0,i,a)},p.manipulateListeners=function(i,a,l){var A,k,S=i?this.removeListener:this.addListener,f=i?this.removeListeners:this.addListeners;if(typeof a!="object"||a instanceof RegExp)for(A=l.length;A--;)S.call(this,a,l[A]);else for(A in a)a.hasOwnProperty(A)&&(k=a[A])&&(typeof k=="function"?S.call(this,A,k):f.call(this,A,k));return this},p.removeEvent=function(i){var a,l=typeof i,A=this._getEvents();if(l==="string")delete A[i];else if(i instanceof RegExp)for(a in A)A.hasOwnProperty(a)&&i.test(a)&&delete A[a];else delete this._events;return this},p.removeAllListeners=g("removeEvent"),p.emitEvent=function(i,a){var l,A,k,S,f=this.getListenersAsObject(i);for(S in f)if(f.hasOwnProperty(S))for(l=f[S].slice(0),k=0;k<l.length;k++)(A=l[k]).once===!0&&this.removeListener(i,A.listener),A.listener.apply(this,a||[])===this._getOnceReturnValue()&&this.removeListener(i,A.listener);return this},p.trigger=g("emitEvent"),p.emit=function(i){var a=Array.prototype.slice.call(arguments,1);return this.emitEvent(i,a)},p.setOnceReturnValue=function(i){return this._onceReturnValue=i,this},p._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},p._getEvents=function(){return this._events||(this._events={})},E.noConflict=function(){return d.EventEmitter=b,E},(m=function(){return E}.call(d,y,d,c))===void 0||(c.exports=m)})(typeof window<"u"?window:this||{})},function(c,O,y){var m=y(35);c.exports=function(d){if(Array.isArray(d))return m(d)}},function(c,O){c.exports=function(y){if(typeof Symbol<"u"&&Symbol.iterator in Object(y))return Array.from(y)}},function(c,O){c.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(c,O,y){(function(m){var d;c.exports=(d=d||function(E,p){var b;if(typeof window<"u"&&window.crypto&&(b=window.crypto),typeof self<"u"&&self.crypto&&(b=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(b=globalThis.crypto),!b&&typeof window<"u"&&window.msCrypto&&(b=window.msCrypto),!b&&m!==void 0&&m.crypto&&(b=m.crypto),!b)try{b=y(74)}catch{}var s=function(){if(b){if(typeof b.getRandomValues=="function")try{return b.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof b.randomBytes=="function")try{return b.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},g=Object.create||function(){function T(){}return function(F){var J;return T.prototype=F,J=new T,T.prototype=null,J}}(),i={},a=i.lib={},l=a.Base={extend:function(T){var F=g(this);return T&&F.mixIn(T),F.hasOwnProperty("init")&&this.init!==F.init||(F.init=function(){F.$super.init.apply(this,arguments)}),F.init.prototype=F,F.$super=this,F},create:function(){var T=this.extend();return T.init.apply(T,arguments),T},init:function(){},mixIn:function(T){for(var F in T)T.hasOwnProperty(F)&&(this[F]=T[F]);T.hasOwnProperty("toString")&&(this.toString=T.toString)},clone:function(){return this.init.prototype.extend(this)}},A=a.WordArray=l.extend({init:function(T,F){T=this.words=T||[],this.sigBytes=F??4*T.length},toString:function(T){return(T||S).stringify(this)},concat:function(T){var F=this.words,J=T.words,G=this.sigBytes,H=T.sigBytes;if(this.clamp(),G%4)for(var V=0;V<H;V++){var _=J[V>>>2]>>>24-V%4*8&255;F[G+V>>>2]|=_<<24-(G+V)%4*8}else for(var n=0;n<H;n+=4)F[G+n>>>2]=J[n>>>2];return this.sigBytes+=H,this},clamp:function(){var T=this.words,F=this.sigBytes;T[F>>>2]&=4294967295<<32-F%4*8,T.length=E.ceil(F/4)},clone:function(){var T=l.clone.call(this);return T.words=this.words.slice(0),T},random:function(T){for(var F=[],J=0;J<T;J+=4)F.push(s());return new A.init(F,T)}}),k=i.enc={},S=k.Hex={stringify:function(T){for(var F=T.words,J=T.sigBytes,G=[],H=0;H<J;H++){var V=F[H>>>2]>>>24-H%4*8&255;G.push((V>>>4).toString(16)),G.push((15&V).toString(16))}return G.join("")},parse:function(T){for(var F=T.length,J=[],G=0;G<F;G+=2)J[G>>>3]|=parseInt(T.substr(G,2),16)<<24-G%8*4;return new A.init(J,F/2)}},f=k.Latin1={stringify:function(T){for(var F=T.words,J=T.sigBytes,G=[],H=0;H<J;H++){var V=F[H>>>2]>>>24-H%4*8&255;G.push(String.fromCharCode(V))}return G.join("")},parse:function(T){for(var F=T.length,J=[],G=0;G<F;G++)J[G>>>2]|=(255&T.charCodeAt(G))<<24-G%4*8;return new A.init(J,F)}},C=k.Utf8={stringify:function(T){try{return decodeURIComponent(escape(f.stringify(T)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(T){return f.parse(unescape(encodeURIComponent(T)))}},I=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new A.init,this._nDataBytes=0},_append:function(T){typeof T=="string"&&(T=C.parse(T)),this._data.concat(T),this._nDataBytes+=T.sigBytes},_process:function(T){var F,J=this._data,G=J.words,H=J.sigBytes,V=this.blockSize,_=H/(4*V),n=(_=T?E.ceil(_):E.max((0|_)-this._minBufferSize,0))*V,L=E.min(4*n,H);if(n){for(var h=0;h<n;h+=V)this._doProcessBlock(G,h);F=G.splice(0,n),J.sigBytes-=L}return new A.init(F,L)},clone:function(){var T=l.clone.call(this);return T._data=this._data.clone(),T},_minBufferSize:0}),P=(a.Hasher=I.extend({cfg:l.extend(),init:function(T){this.cfg=this.cfg.extend(T),this.reset()},reset:function(){I.reset.call(this),this._doReset()},update:function(T){return this._append(T),this._process(),this},finalize:function(T){return T&&this._append(T),this._doFinalize()},blockSize:16,_createHelper:function(T){return function(F,J){return new T.init(J).finalize(F)}},_createHmacHelper:function(T){return function(F,J){return new P.HMAC.init(T,J).finalize(F)}}}),i.algo={});return i}(Math),d)}).call(this,y(33))},function(c,O){},function(c,O,y){var m=this&&this.__assign||function(){return(m=Object.assign||function(f){for(var C,I=1,P=arguments.length;I<P;I++)for(var T in C=arguments[I])Object.prototype.hasOwnProperty.call(C,T)&&(f[T]=C[T]);return f}).apply(this,arguments)},d=this&&this.__awaiter||function(f,C,I,P){return new(I||(I=Promise))(function(T,F){function J(V){try{H(P.next(V))}catch(_){F(_)}}function G(V){try{H(P.throw(V))}catch(_){F(_)}}function H(V){var _;V.done?T(V.value):(_=V.value,_ instanceof I?_:new I(function(n){n(_)})).then(J,G)}H((P=P.apply(f,C||[])).next())})},E=this&&this.__generator||function(f,C){var I,P,T,F,J={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return F={next:G(0),throw:G(1),return:G(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function G(H){return function(V){return function(_){if(I)throw new TypeError("Generator is already executing.");for(;J;)try{if(I=1,P&&(T=2&_[0]?P.return:_[0]?P.throw||((T=P.return)&&T.call(P),0):P.next)&&!(T=T.call(P,_[1])).done)return T;switch(P=0,T&&(_=[2&_[0],T.value]),_[0]){case 0:case 1:T=_;break;case 4:return J.label++,{value:_[1],done:!1};case 5:J.label++,P=_[1],_=[0];continue;case 7:_=J.ops.pop(),J.trys.pop();continue;default:if(T=J.trys,!((T=T.length>0&&T[T.length-1])||_[0]!==6&&_[0]!==2)){J=0;continue}if(_[0]===3&&(!T||_[1]>T[0]&&_[1]<T[3])){J.label=_[1];break}if(_[0]===6&&J.label<T[1]){J.label=T[1],T=_;break}if(T&&J.label<T[2]){J.label=T[2],J.ops.push(_);break}T[2]&&J.ops.pop(),J.trys.pop();continue}_=C.call(f,J)}catch(n){_=[6,n],P=0}finally{I=T=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}([H,V])}}},p=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(O,"__esModule",{value:!0});var b=y(76),s=y(27),g=y(95),i=y(20),a=y(24),l=y(31),A=p(y(0)),k=p(y(37)),S=function(){function f(C){this.retryTimeout=1e4,this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.taskMutex=new g.PromiseMutex("LS"),this.cancelToken=k.default.CancelToken.source(),this.injectConfig=m({},s.DEFAULT_INJECT_CONFIG),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Map,this.spec=C}return Object.defineProperty(f.prototype,"isNeedReset",{get:function(){for(var C=this,I=0,P=Array.from(this.streamingTasks.values());I<P.length;I++){var T=P[I];if(T.mode===s.LiveStreamingServiceMode.INJECT||T.mode===s.LiveStreamingServiceMode.TRANSCODE&&(this.transcodingConfig&&(this.transcodingConfig.userConfigs||this.transcodingConfig.transcodingUsers)||[]).find(function(F){return F.uid===C.spec.uid}))return!0}return!1},enumerable:!0,configurable:!0}),f.prototype.setTranscodingConfig=function(C){return d(this,void 0,void 0,function(){var I,P,T,F,J,G=this;return E(this,function(H){switch(H.label){case 0:(I=m(m({},s.DEFAULT_TRANSCODING_CONFIG),C)).transcodingUsers||(I.transcodingUsers=I.userConfigs),I.videoCodecProfile!==66&&I.videoCodecProfile!==77&&I.videoCodecProfile!==100&&(A.default.debug("["+this.spec.clientId+"] set transcoding config, fix video codec profile: "+I.videoCodecProfile+" -> 100"),I.videoCodecProfile=100),I.transcodingUsers&&(I.transcodingUsers=I.transcodingUsers.map(function(V){return m(m(m({},s.DEFAULT_LIVE_STREAMING_TRANSCODING_USER),V),{zOrder:V.zOrder?V.zOrder+1:1})})),I.images&&(I.images=I.images.map(function(V){return m(m({},s.DEFAULT_LIVE_STREAMING_TRANSCODING_WATERMARK),V)}));try{s.isLiveStreamingTranscodingConfig(I)}catch(V){throw V}return I.transcodingUsers&&(I.userConfigs=I.transcodingUsers.map(function(V){return m({},V)}),I.userCount=I.transcodingUsers.length,delete I.transcodingUsers),P=(I.userConfigs||[]).map(function(V){return typeof V.uid=="number"?Promise.resolve(V.uid):i.getUserAccount(G.spec,null,V.uid)}),[4,this.taskMutex.lock()];case 1:return T=H.sent(),[4,Promise.all(P)];case 2:if(H.sent().forEach(function(V,_){I.userConfigs&&I.userConfigs[_]&&(I.userConfigs[_].uid=V&&V.uid||V)}),this.transcodingConfig=I,!this.connection)return T(),[2];H.label=3;case 3:return H.trys.push([3,5,,6]),[4,this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(this.streamingTasks.values()).map(function(V){return V.taskId}).join("#")})];case 4:return F=H.sent(),T(),A.default.debug("["+this.spec.clientId+"] update live transcoding config success, code: "+F.code+", config:",JSON.stringify(this.transcodingConfig)),[3,6];case 5:if(J=H.sent(),T(),!J.data||!J.data.retry)throw J;return J.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(function(V){A.default.warning("["+G.spec.clientId+"] live streaming receive error",J.toString(),"try to republish",V.url),G.startLiveStreamingTask(V.url,V.mode,J).then(function(){A.default.debug("["+G.spec.clientId+"] live streaming republish "+V.url+" success")}).catch(function(_){A.default.error("["+G.spec.clientId+"] live streaming republish failed",V.url,_.toString()),G.onLiveStreamError&&G.onLiveStreamError(V.url,_)})}),[3,6];case 6:return[2]}})})},f.prototype.setInjectStreamConfig=function(C,I){this.injectConfig=Object.assign({},this.injectConfig,C),this.injectLoopTimes=I},f.prototype.startLiveStreamingTask=function(C,I,P){return d(this,void 0,void 0,function(){var T,F,J,G,H,V,_,n,L=this;return E(this,function(h){switch(h.label){case 0:return Array.from(this.streamingTasks.values()).find(function(t){return t.mode===s.LiveStreamingServiceMode.INJECT})&&I===s.LiveStreamingServiceMode.INJECT?[2,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw()]:(T={command:"PublishStream",ts:Date.now(),url:C,uid:this.spec.uid.toString(),autoDestroyTime:30},A.default.debug("["+this.spec.clientId+"] start live streaming "+C+", mode: "+I),[4,this.taskMutex.lock()]);case 1:if(F=h.sent(),!this.transcodingConfig&&I===s.LiveStreamingServiceMode.TRANSCODE)throw F(),new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(!this.connection&&P)return F(),[2];if(this.streamingTasks.get(C)&&!P)return F(),[2,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_TASK_CONFLICT).throw()];if(!this.transcodingConfig&&I===s.LiveStreamingServiceMode.TRANSCODE)throw F(),new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");h.label=2;case 2:return h.trys.push([2,5,,6]),this.connection?[3,4]:(J=this,[4,this.connect(I)]);case 3:J.connection=h.sent(),h.label=4;case 4:return[3,6];case 5:throw G=h.sent(),F(),G;case 6:switch(I){case s.LiveStreamingServiceMode.TRANSCODE:T.transcodingConfig=m({},this.transcodingConfig);break;case s.LiveStreamingServiceMode.RAW:break;case s.LiveStreamingServiceMode.INJECT:T={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:C,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(T.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0,H=this.lastTaskId++,h.label=7;case 7:return h.trys.push([7,9,,14]),V=new Promise(function(t,j){l.wait(L.retryTimeout).then(function(){if(P)return j(P);var r=L.statusError.get(C);return r?(L.statusError.delete(C),j(r)):void 0})}),[4,Promise.race([this.connection.request("request",{clientRequest:T},!0,{url:C,command:"PublishStream",workerType:I===s.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!P,tid:H.toString()}),V])];case 8:return _=h.sent(),this.isStartingStreamingTask=!1,A.default.debug("["+this.spec.clientId+"] live streaming started, code: "+_.code),this.streamingTasks.set(C,{clientRequest:T,mode:I,url:C,taskId:H}),F(),[3,14];case 9:if(n=h.sent(),F(),this.isStartingStreamingTask=!1,!n.data||!n.data.retry||P)throw n;return n.data.changeAddress?[3,11]:[4,this.startLiveStreamingTask(C,I,n)];case 10:return[2,h.sent()];case 11:return this.connection.tryNextAddress(),[4,this.startLiveStreamingTask(C,I,n)];case 12:return[2,h.sent()];case 13:return[3,14];case 14:return[2]}})})},f.prototype.stopLiveStreamingTask=function(C){var I=this;return new Promise(function(P,T){var F=I.streamingTasks.get(C);if(!F||!I.connection)return new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();var J=F.mode;F.abortTask=function(){A.default.debug("["+I.spec.clientId+"] stop live streaming success(worker exception)"),I.streamingTasks.delete(C),P()},A.default.debug("stop live streaming task request: "+JSON.stringify(C)),I.connection.request("request",{clientRequest:{command:J===s.LiveStreamingServiceMode.INJECT?"UninjectStream":"UnpublishStream",url:F.url}},!1,{url:C,command:"UnPublishStream",workerType:J===s.LiveStreamingServiceMode.TRANSCODE?1:2,requestByUser:!0,tid:(I.lastTaskId++).toString()}).then(function(G){A.default.debug("["+I.spec.clientId+"] stop live streaming success, code: "+G.code),I.streamingTasks.delete(C),I.streamingTasks.size===0&&J!==s.LiveStreamingServiceMode.INJECT&&(I.connection.close(),I.connection=void 0),P()}).catch(T)})},f.prototype.controlInjectStream=function(C,I,P,T){return d(this,void 0,void 0,function(){var F;return E(this,function(J){switch(J.label){case 0:if(!(F=this.streamingTasks.get(C))||!this.connection||F.mode!==s.LiveStreamingServiceMode.INJECT)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.INVALID_OPERATION,"can not find inject stream task to control");return[4,this.connection.request("request",{clientRequest:{command:"ControlStream",url:C,control:I,audioVolume:P,position:T}})];case 1:return[2,J.sent().serverResponse]}})})},f.prototype.resetAllTask=function(){var C=this,I=Array.from(this.streamingTasks.values());this.terminate();for(var P=function(G){T.startLiveStreamingTask(G.url,G.mode).catch(function(H){C.onLiveStreamError&&C.onLiveStreamError(G.url,H)})},T=this,F=0,J=I;F<J.length;F++)P(J[F])},f.prototype.setGatewayConnectionState=function(C){this.connection&&(this.connection.gatewayConnectionState=C)},f.prototype.terminate=function(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=k.default.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0},f.prototype.connect=function(C){return d(this,void 0,void 0,function(){var I,P=this;return E(this,function(T){switch(T.label){case 0:if(this.connection)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"live streaming connection has already connected");return[4,l.getLiveStreamingWorkerMangerResult(C,this.spec,this.cancelToken.token)];case 1:return I=T.sent(),this.uapResponse=I,this.connection=new b.AgoraLiveStreamingUapSignal(I.workerToken,this.spec,C),this.connection.on(s.LiveStreamingUapSignalEvents.WARNING,function(F,J){return P.onLiveStreamWarning&&P.onLiveStreamWarning(J,F)}),this.connection.on(s.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,function(F){return P.handlePublishStreamServer(F)}),this.connection.on(s.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,function(F){return P.handleInjectStreamServerStatus(F)}),this.connection.on(s.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS,function(F,J){if(!P.connection)return J(new a.AgoraRTCError(a.AgoraRTCErrorCode.UNEXPECTED_ERROR,"can not get new live streaming address list"));l.getLiveStreamingWorkerMangerResult(C,P.spec,P.cancelToken.token).then(function(G){P.uapResponse=G,F(G.addressList)}).catch(J)}),[4,this.connection.init(I.addressList)];case 2:return T.sent(),[2,this.connection]}})})},f.prototype.handlePublishStreamServer=function(C){var I=this,P=C.serverStatus&&C.serverStatus.url;if(!P)throw new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"empty url",{code:C.code});var T=this.streamingTasks.get(P);switch(C.code){case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case s.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:var F=new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:C.code});if(T)return A.default.error(F.toString()),this.onLiveStreamError&&this.onLiveStreamError(P,F);if(!this.isStartingStreamingTask)return;this.statusError.set(P,F);case s.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case s.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(!this.connection||this.streamingTasks.size===0)return;this.connection.tryNextAddress();for(var J=Array.from(this.streamingTasks.values()),G=function(n){if(n.abortTask)return n.abortTask(),"continue";A.default.warning("["+H.spec.clientId+"] publish stream status code",C.code,"try to republish",n.url),H.startLiveStreamingTask(n.url,n.mode,new a.AgoraRTCError(a.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:C.code})).then(function(){A.default.debug("["+I.spec.clientId+"] republish live stream success",n.url)}).catch(function(L){A.default.error(L.toString()),I.onLiveStreamError&&I.onLiveStreamError(n.url,L)})},H=this,V=0,_=J;V<_.length;V++)G(_[V]);return}},f.prototype.handleInjectStreamServerStatus=function(C){var I=Number(C.uid),P=C.serverStatus&&C.serverStatus.url;switch(C.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,I,P));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,I,P),void this.streamingTasks.delete(P);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,I,P),void this.streamingTasks.delete(P);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,I,P),void this.streamingTasks.delete(P);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,I,P),void this.streamingTasks.delete(P);default:return void A.default.debug("inject stream server status",C)}},f.prototype.haveUrl=function(C){return this.streamingTasks.has(C)||void 0},f}();O.AgoraRTCLiveStreamingClient=S},function(c,O,y){var m,d=this&&this.__extends||(m=function(I,P){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,F){T.__proto__=F}||function(T,F){for(var J in F)F.hasOwnProperty(J)&&(T[J]=F[J])})(I,P)},function(I,P){function T(){this.constructor=I}m(I,P),I.prototype=P===null?Object.create(P):(T.prototype=P.prototype,new T)}),E=this&&this.__assign||function(){return(E=Object.assign||function(I){for(var P,T=1,F=arguments.length;T<F;T++)for(var J in P=arguments[T])Object.prototype.hasOwnProperty.call(P,J)&&(I[J]=P[J]);return I}).apply(this,arguments)},p=this&&this.__awaiter||function(I,P,T,F){return new(T||(T=Promise))(function(J,G){function H(n){try{_(F.next(n))}catch(L){G(L)}}function V(n){try{_(F.throw(n))}catch(L){G(L)}}function _(n){var L;n.done?J(n.value):(L=n.value,L instanceof T?L:new T(function(h){h(L)})).then(H,V)}_((F=F.apply(I,P||[])).next())})},b=this&&this.__generator||function(I,P){var T,F,J,G,H={label:0,sent:function(){if(1&J[0])throw J[1];return J[1]},trys:[],ops:[]};return G={next:V(0),throw:V(1),return:V(2)},typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function V(_){return function(n){return function(L){if(T)throw new TypeError("Generator is already executing.");for(;H;)try{if(T=1,F&&(J=2&L[0]?F.return:L[0]?F.throw||((J=F.return)&&J.call(F),0):F.next)&&!(J=J.call(F,L[1])).done)return J;switch(F=0,J&&(L=[2&L[0],J.value]),L[0]){case 0:case 1:J=L;break;case 4:return H.label++,{value:L[1],done:!1};case 5:H.label++,F=L[1],L=[0];continue;case 7:L=H.ops.pop(),H.trys.pop();continue;default:if(J=H.trys,!((J=J.length>0&&J[J.length-1])||L[0]!==6&&L[0]!==2)){H=0;continue}if(L[0]===3&&(!J||L[1]>J[0]&&L[1]<J[3])){H.label=L[1];break}if(L[0]===6&&H.label<J[1]){H.label=J[1],J=L;break}if(J&&H.label<J[2]){H.label=J[2],H.ops.push(L);break}J[2]&&H.ops.pop(),H.trys.pop();continue}L=P.call(I,H)}catch(h){L=[6,h],F=0}finally{T=J=0}if(5&L[0])throw L[1];return{value:L[0]?L[1]:void 0,done:!0}}([_,n])}}},s=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(O,"__esModule",{value:!0});var g=y(27),i=y(77),a=y(36),l=y(24),A=y(2),k=s(y(0)),S=y(1),f=y(31),C=function(I){function P(T,F,J){var G=I.call(this)||this;return G._gatewayConnectionState="CONNECTED",G.reconnectMode="retry",G.reqId=0,G.commandReqId=0,G.waitingResponseList=[],G.handleWebSocketOpen=function(){G.reconnectMode="retry",G.startPingPong()},G.handleWebSocketMessage=function(H){if(H.data){var V=JSON.parse(H.data);if(V.requestId)G.emit("@"+V.requestId,V);else if(G.serviceMode===g.LiveStreamingServiceMode.INJECT)G.emit(g.LiveStreamingUapSignalEvents.INJECT_STREAM_STATUS,V);else{S.report.requestWorkerEvent(G.spec.sid,{actionType:"status",serverCode:V.code,workerType:G.serviceMode===g.LiveStreamingServiceMode.TRANSCODE?1:2});var _=V.serverStatus&&V.serverStatus.url;_&&G.waitingResponseList.includes(_)&&V.code===200&&G.emit(_),G.emit(g.LiveStreamingUapSignalEvents.PUBLISH_STREAM_STATUS,V)}}},G.spec=F,G.token=T,G.serviceMode=J,G.websocket=new i.AgoraWebSocketManager("live-streaming"),G.websocket.on(g.WebSocketManagerEvents.CONNECTED,G.handleWebSocketOpen),G.websocket.on(g.WebSocketManagerEvents.ON_MESSAGE,G.handleWebSocketMessage),G.websocket.on(g.WebSocketManagerEvents.REQUEST_NEW_URLS,function(H,V){a.emitAsPromise(G,g.LiveStreamingUapSignalEvents.REQUEST_NEW_ADDRESS).then(H).catch(V)}),G.websocket.on(g.WebSocketManagerEvents.RECONNECTING,function(){G.websocket.reconnectMode=G.reconnectMode}),G}return d(P,I),Object.defineProperty(P.prototype,"gatewayConnectionState",{get:function(){return this._gatewayConnectionState},set:function(T){this._gatewayConnectionState=T,T==="CONNECTED"&&this.emit("gateway-connected",T)},enumerable:!0,configurable:!0}),P.prototype.init=function(T){return this.websocket.init(T)},P.prototype.request=function(T,F,J,G){return p(this,void 0,void 0,function(){var H,V,_,n,L,h,t,j,r,v,M=this;return b(this,function(B){switch(B.label){case 0:if(this.reqId+=1,H=this.reqId,T==="request"&&(this.commandReqId+=1),V=this.commandReqId,!H||!this.websocket)throw new l.AgoraRTCError(l.AgoraRTCErrorCode.UNEXPECTED_ERROR);if(_=A.VERSION,this.websocket.state==="closed")throw new l.AgoraRTCError(l.AgoraRTCErrorCode.WS_DISCONNECT);return n=function(){return new Promise(function(q,Q){var z=function(){M.gatewayConnectionState==="CONNECTED"&&M.websocket.state==="connected"&&(M.off("gateway-connected",z),M.websocket.off(g.WebSocketManagerEvents.CONNECTED,z),q(void 0))};M.on("gateway-connected",z),M.websocket.once(g.WebSocketManagerEvents.CLOSED,function(){return Q(new l.AgoraRTCError(l.AgoraRTCErrorCode.WS_ABORT))}),M.websocket.on(g.WebSocketManagerEvents.CONNECTED,z)})},this.websocket.state==="connected"&&this.gatewayConnectionState==="CONNECTED"?[3,2]:[4,n()];case 1:B.sent(),B.label=2;case 2:L=Promise.race([new Promise(function(q,Q){var z=function(){Q(new l.AgoraRTCError(l.AgoraRTCErrorCode.WS_ABORT))};M.websocket.once(g.WebSocketManagerEvents.RECONNECTING,z),M.websocket.once(g.WebSocketManagerEvents.CLOSED,z),M.once("@"+H,function(w){q(w)})}),f.wait(A.getParameter("LIVE_STREAMING_TIMEOUT")).then(function(){return!1})]),(h=E({command:T,sdkVersion:_,seq:H,requestId:H,allocate:J,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},F)).clientRequest&&(h.clientRequest.workerToken=this.token),G&&S.report.requestWorkerEvent(this.spec.sid,E(E({},G),{requestId:V,actionType:"request",payload:JSON.stringify(F.clientRequest),serverCode:0,code:0})),t=Date.now(),this.websocket.sendMessage(h),j=null,B.label=3;case 3:return B.trys.push([3,5,,8]),[4,L];case 4:return j=B.sent(),[3,8];case 5:if(r=B.sent(),this.websocket.state==="closed")throw r;return[4,n()];case 6:return B.sent(),[4,this.request(T,F,J,G)];case 7:return[2,B.sent()];case 8:if(j===!1)throw v=new l.AgoraRTCError(l.AgoraRTCErrorCode.NETWORK_TIMEOUT,(F&&F.clientRequest&&F.clientRequest.command)+" timeout",{changeAddress:!0,retry:!0}),this.emit(g.LiveStreamingUapSignalEvents.WARNING,v,G&&G.url||"unknown url"),G&&S.report.requestWorkerEvent(this.spec.sid,E(E({},G),{requestId:V,actionType:"response",payload:"TIMEOUT",serverCode:0,success:0,responseTime:Date.now()-t})),v;return G&&S.report.requestWorkerEvent(this.spec.sid,E(E({},G),{requestId:V,actionType:"response",payload:JSON.stringify(j.serverResponse),serverCode:j.code,success:j.code===200,responseTime:Date.now()-t})),j.code===200?[3,10]:[4,this.handleResponseError(j)];case 9:B.sent(),B.label=10;case 10:return[2,j]}})})},P.prototype.tryNextAddress=function(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")},P.prototype.close=function(){var T=A.VERSION==="__VERSION__"?"0.0.1":A.VERSION;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:T,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)},P.prototype.handleResponseError=function(T){return p(this,void 0,void 0,function(){var F,J,G,H,V=this;return b(this,function(_){switch(k.default.debug("[live-streaming] receive response error "+T.code),T.code){case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return k.default.warning("live stream response already exists stream"),F=T.serverResponse.url,this.emit(g.LiveStreamingUapSignalEvents.WARNING,"live stream response already exists stream, code 454",F),this.waitingResponseList.includes(F)||this.waitingResponseList.push(F),[2,new Promise(function(n,L){V.once(F,function(){V.waitingResponseList.splice(V.waitingResponseList.indexOf(F),1),n()}),setTimeout(function(){V.waitingResponseList.splice(V.waitingResponseList.indexOf(F),1),L(new l.AgoraRTCError(l.AgoraRTCErrorCode.TIMEOUT,"live stream timeout waiting 454",{code:T.code}))},1e4)})];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_BAD_STREAM:case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return[2,new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:T.code}).throw()];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INGNORE_MESSAGE:throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INVALID_ARGUMENT,"",{retry:!0,changeAddress:!0});case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(T.serverResponse.command==="UnpublishStream"||T.serverResponse.command==="UninjectStream")return[2];throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return[2,new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:T.code}).throw()];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return J=new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE),[2,this.emit(g.LiveStreamingUapSignalEvents.WARNING,J,T.serverResponse.url)];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return J=new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_WARN_FREQUENT_REQUEST),[2,this.emit(g.LiveStreamingUapSignalEvents.WARNING,J,T.serverResponse.url)];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return[2,new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_TRANSCODING_NOT_SUPPORT,"",{code:T.code}).throw()];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return J=new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),[2,this.emit(g.LiveStreamingUapSignalEvents.WARNING,J,T.serverResponse.url)];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return[2,new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:T.code}).throw()];case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_LOST:case g.LIVE_STREAM_ERROR_CODE.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(T.serverResponse.command==="UnpublishStream"||T.serverResponse.command==="UninjectStream")return[2];throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case g.LIVE_STREAM_ERROR_CODE.ERROR_FAIL_SEND_MESSAGE:if(T.serverResponse.command==="UnpublishStream"||T.serverResponse.command==="UninjectStream")return[2];if(T.serverResponse.command==="UpdateTranscoding"||T.serverResponse.command==="ControlStream")return[2,new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:T.code}).throw()];throw new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case g.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case g.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case g.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case g.LIVE_STREAM_ERROR_CODE.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return G=T.serverResponse.url,this.waitingResponseList.includes(G)||this.waitingResponseList.push(G),H=new l.AgoraRTCError(l.AgoraRTCErrorCode.LIVE_STREAMING_CDN_ERROR,"",{code:T.code}),this.emit(g.LiveStreamingUapSignalEvents.WARNING,H,G),[2,new Promise(function(n,L){V.once(G,function(){V.waitingResponseList.splice(V.waitingResponseList.indexOf(G),1),n()}),setTimeout(function(){V.waitingResponseList.splice(V.waitingResponseList.indexOf(G),1),L(H)},1e4)})]}return[2]})})},P.prototype.startPingPong=function(){var T=this;this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(function(){T.websocket.state==="connected"&&T.request("ping",{}).catch(function(){})},6e3)},P}(a.EventEmitter);O.AgoraLiveStreamingUapSignal=C},function(c,O,y){var m,d=this&&this.__extends||(m=function(k,S){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,C){f.__proto__=C}||function(f,C){for(var I in C)C.hasOwnProperty(I)&&(f[I]=C[I])})(k,S)},function(k,S){function f(){this.constructor=k}m(k,S),k.prototype=S===null?Object.create(S):(f.prototype=S.prototype,new f)}),E=this&&this.__awaiter||function(k,S,f,C){return new(f||(f=Promise))(function(I,P){function T(G){try{J(C.next(G))}catch(H){P(H)}}function F(G){try{J(C.throw(G))}catch(H){P(H)}}function J(G){var H;G.done?I(G.value):(H=G.value,H instanceof f?H:new f(function(V){V(H)})).then(T,F)}J((C=C.apply(k,S||[])).next())})},p=this&&this.__generator||function(k,S){var f,C,I,P,T={label:0,sent:function(){if(1&I[0])throw I[1];return I[1]},trys:[],ops:[]};return P={next:F(0),throw:F(1),return:F(2)},typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function F(J){return function(G){return function(H){if(f)throw new TypeError("Generator is already executing.");for(;T;)try{if(f=1,C&&(I=2&H[0]?C.return:H[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,H[1])).done)return I;switch(C=0,I&&(H=[2&H[0],I.value]),H[0]){case 0:case 1:I=H;break;case 4:return T.label++,{value:H[1],done:!1};case 5:T.label++,C=H[1],H=[0];continue;case 7:H=T.ops.pop(),T.trys.pop();continue;default:if(I=T.trys,!((I=I.length>0&&I[I.length-1])||H[0]!==6&&H[0]!==2)){T=0;continue}if(H[0]===3&&(!I||H[1]>I[0]&&H[1]<I[3])){T.label=H[1];break}if(H[0]===6&&T.label<I[1]){T.label=I[1],I=H;break}if(I&&T.label<I[2]){T.label=I[2],T.ops.push(H);break}I[2]&&T.ops.pop(),T.trys.pop();continue}H=S.call(k,T)}catch(V){H=[6,V],C=0}finally{f=I=0}if(5&H[0])throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}([J,G])}}},b=this&&this.__importDefault||function(k){return k&&k.__esModule?k:{default:k}};Object.defineProperty(O,"__esModule",{value:!0});var s=y(24),g=y(36),i=y(31),a=y(27),l=b(y(0)),A=function(k){function S(f){var C=k.call(this)||this;return C.connectionID=0,C.currentURLIndex=0,C.reconnectMode="tryNext",C._state="closed",C.retryConfig=i.DEFAULT_RETRY_CONFIG,C.reconnectCount=0,C.name=f,C}return d(S,k),Object.defineProperty(S.prototype,"url",{get:function(){return this.websocket?this.websocket.url:null},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"state",{get:function(){return this._state},set:function(f){f!==this._state&&(this._state=f,this._state==="reconnecting"?this.emit(a.WebSocketManagerEvents.RECONNECTING,this.reconnectMode):this._state==="connected"?this.emit(a.WebSocketManagerEvents.CONNECTED):this._state==="closed"?this.emit(a.WebSocketManagerEvents.CLOSED):this._state==="failed"&&this.emit(a.WebSocketManagerEvents.FAILED))},enumerable:!0,configurable:!0}),S.prototype.init=function(f){var C=this;return new Promise(function(I,P){C.urls=f;var T=C.urls[C.currentURLIndex];C.state="connecting",C.createWebSocketConnection(T).then(I).catch(P),C.once(a.WebSocketManagerEvents.CLOSED,function(){return P(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT))}),C.once(a.WebSocketManagerEvents.CONNECTED,function(){return I()})})},S.prototype.close=function(f,C){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;var I=this.websocket;C?setTimeout(function(){return I.close()},500):I.close(),this.websocket=void 0}this.state=f?"failed":"closed"},S.prototype.reconnect=function(f){if(this.websocket){f!==void 0&&(this.reconnectMode=f);var C=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),C&&C.bind(this.websocket)({code:9999})}else l.default.warning("["+this.name+"] can not reconnect, no websocket")},S.prototype.sendMessage=function(f){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ABORT,"websocket is not ready");var C=JSON.stringify(f);try{this.websocket.send(C)}catch(I){throw new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ERR,"send websocket message error"+I.toString())}},S.prototype.createWebSocketConnection=function(f){return E(this,void 0,void 0,function(){var C,I=this;return p(this,function(P){return this.connectionID+=1,C=this.connectionID,[2,new Promise(function(T,F){I.websocket&&(I.websocket.onclose=null,I.websocket.close()),l.default.debug("["+I.name+"] start connect, url: "+f);try{I.websocket=new WebSocket(f),I.websocket.binaryType="arraybuffer"}catch(G){var J=new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_ERR,"init websocket failed! Error: "+G.toString());return l.default.error("["+I.name+"]"+J),void F(J)}i.wait(5e3).then(function(){C===I.connectionID&&I.websocket&&I.websocket.readyState!==WebSocket.OPEN&&I.websocket&&I.websocket.close()}),I.websocket.onopen=function(){l.default.debug("["+I.name+"] websockect opened:",f),I.reconnectMode="retry",I.state="connected",I.reconnectCount=0,T()},I.websocket.onclose=function(G){return E(I,void 0,void 0,function(){var H,V;return p(this,function(_){switch(_.label){case 0:return l.default.debug("["+this.name+"] websocket close "+(this.websocket&&this.websocket.url)+", code: "+G.code+", reason: "+G.reason+", current mode: "+this.reconnectMode),this.reconnectCount<this.retryConfig.maxRetryCount?(this.state==="connected"&&(this.state="reconnecting"),H=g.emitAsInvokerNoResponse(this,a.WebSocketManagerEvents.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,[4,this.reconnectWithAction(H)]):[3,2];case 1:return V=_.sent(),this.state==="closed"?(l.default.debug("["+this.connectionID+"] ws is closed, no need to reconnect"),[2]):V?(T(),[3,3]):(F(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT,"websocket reconnect failed: "+G.code)),this.close(!0),[2]);case 2:F(new s.AgoraRTCError(s.AgoraRTCErrorCode.WS_DISCONNECT,"websocket close: "+G.code)),this.close(),_.label=3;case 3:return[2]}})})},I.websocket.onmessage=function(G){I.emit(a.WebSocketManagerEvents.ON_MESSAGE,G)}})]})})},S.prototype.reconnectWithAction=function(f,C){return E(this,void 0,void 0,function(){var I,P,T,F;return p(this,function(J){switch(J.label){case 0:return!C&&this.reconnectCount>=this.retryConfig.maxRetryCount?[2,!1]:this.urls?this.state==="closed"?[2,!1]:(I=i.getRetryWaitTime(this.reconnectCount,this.retryConfig),l.default.debug("["+this.name+"] wait "+I+"ms to reconnect websocket, mode: "+f),[4,i.wait(I)]):[2,!1];case 1:if(J.sent(),this.state==="closed")return[2,!1];this.reconnectCount+=1,J.label=2;case 2:return J.trys.push([2,12,,14]),f!=="retry"?[3,4]:(T=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(T)]);case 3:return J.sent(),[3,11];case 4:return f!=="tryNext"?[3,8]:(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length?[4,this.reconnectWithAction("recover")]:[3,6]);case 5:return[2,J.sent()];case 6:return l.default.debug("["+this.name+"] websocket url length: "+this.urls.length+" current index: "+this.currentURLIndex),T=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(T)];case 7:return J.sent(),[3,11];case 8:return f!=="recover"?[3,11]:(l.default.debug("["+this.name+"] request new urls"),P=this,[4,g.emitAsPromise(this,a.WebSocketManagerEvents.REQUEST_NEW_URLS)]);case 9:return P.urls=J.sent(),this.currentURLIndex=0,T=this.urls[this.currentURLIndex],[4,this.createWebSocketConnection(T)];case 10:J.sent(),J.label=11;case 11:return[2,!0];case 12:return F=J.sent(),l.default.error("["+this.name+"] reconnect failed",F.toString()),[4,this.reconnectWithAction(f)];case 13:return[2,J.sent()];case 14:return[2]}})})},S}(g.EventEmitter);O.AgoraWebSocketManager=A},function(c,O,y){var m=y(18),d=y(38),E=y(79),p=y(44);function b(g){var i=new E(g),a=d(E.prototype.request,i);return m.extend(a,E.prototype,i),m.extend(a,i),a}var s=b(y(41));s.Axios=E,s.create=function(g){return b(p(s.defaults,g))},s.Cancel=y(45),s.CancelToken=y(93),s.isCancel=y(40),s.all=function(g){return Promise.all(g)},s.spread=y(94),c.exports=s,c.exports.default=s},function(c,O,y){var m=y(18),d=y(39),E=y(80),p=y(81),b=y(44);function s(g){this.defaults=g,this.interceptors={request:new E,response:new E}}s.prototype.request=function(g){typeof g=="string"?(g=arguments[1]||{}).url=arguments[0]:g=g||{},(g=b(this.defaults,g)).method?g.method=g.method.toLowerCase():this.defaults.method?g.method=this.defaults.method.toLowerCase():g.method="get";var i=[p,void 0],a=Promise.resolve(g);for(this.interceptors.request.forEach(function(l){i.unshift(l.fulfilled,l.rejected)}),this.interceptors.response.forEach(function(l){i.push(l.fulfilled,l.rejected)});i.length;)a=a.then(i.shift(),i.shift());return a},s.prototype.getUri=function(g){return g=b(this.defaults,g),d(g.url,g.params,g.paramsSerializer).replace(/^\?/,"")},m.forEach(["delete","get","head","options"],function(g){s.prototype[g]=function(i,a){return this.request(m.merge(a||{},{method:g,url:i}))}}),m.forEach(["post","put","patch"],function(g){s.prototype[g]=function(i,a,l){return this.request(m.merge(l||{},{method:g,url:i,data:a}))}}),c.exports=s},function(c,O,y){var m=y(18);function d(){this.handlers=[]}d.prototype.use=function(E,p){return this.handlers.push({fulfilled:E,rejected:p}),this.handlers.length-1},d.prototype.eject=function(E){this.handlers[E]&&(this.handlers[E]=null)},d.prototype.forEach=function(E){m.forEach(this.handlers,function(p){p!==null&&E(p)})},c.exports=d},function(c,O,y){var m=y(18),d=y(82),E=y(40),p=y(41);function b(s){s.cancelToken&&s.cancelToken.throwIfRequested()}c.exports=function(s){return b(s),s.headers=s.headers||{},s.data=d(s.data,s.headers,s.transformRequest),s.headers=m.merge(s.headers.common||{},s.headers[s.method]||{},s.headers),m.forEach(["delete","get","head","post","put","patch","common"],function(g){delete s.headers[g]}),(s.adapter||p.adapter)(s).then(function(g){return b(s),g.data=d(g.data,g.headers,s.transformResponse),g},function(g){return E(g)||(b(s),g&&g.response&&(g.response.data=d(g.response.data,g.response.headers,s.transformResponse))),Promise.reject(g)})}},function(c,O,y){var m=y(18);c.exports=function(d,E,p){return m.forEach(p,function(b){d=b(d,E)}),d}},function(c,O){var y,m,d=c.exports={};function E(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}function b(f){if(y===setTimeout)return setTimeout(f,0);if((y===E||!y)&&setTimeout)return y=setTimeout,setTimeout(f,0);try{return y(f,0)}catch{try{return y.call(null,f,0)}catch{return y.call(this,f,0)}}}(function(){try{y=typeof setTimeout=="function"?setTimeout:E}catch{y=E}try{m=typeof clearTimeout=="function"?clearTimeout:p}catch{m=p}})();var s,g=[],i=!1,a=-1;function l(){i&&s&&(i=!1,s.length?g=s.concat(g):a=-1,g.length&&A())}function A(){if(!i){var f=b(l);i=!0;for(var C=g.length;C;){for(s=g,g=[];++a<C;)s&&s[a].run();a=-1,C=g.length}s=null,i=!1,function(I){if(m===clearTimeout)return clearTimeout(I);if((m===p||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(I);try{m(I)}catch{try{return m.call(null,I)}catch{return m.call(this,I)}}}(f)}}function k(f,C){this.fun=f,this.array=C}function S(){}d.nextTick=function(f){var C=new Array(arguments.length-1);if(arguments.length>1)for(var I=1;I<arguments.length;I++)C[I-1]=arguments[I];g.push(new k(f,C)),g.length!==1||i||b(A)},k.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=S,d.addListener=S,d.once=S,d.off=S,d.removeListener=S,d.removeAllListeners=S,d.emit=S,d.prependListener=S,d.prependOnceListener=S,d.listeners=function(f){return[]},d.binding=function(f){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(f){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(c,O,y){var m=y(18);c.exports=function(d,E){m.forEach(d,function(p,b){b!==E&&b.toUpperCase()===E.toUpperCase()&&(d[E]=p,delete d[b])})}},function(c,O,y){var m=y(43);c.exports=function(d,E,p){var b=p.config.validateStatus;!b||b(p.status)?d(p):E(m("Request failed with status code "+p.status,p.config,null,p.request,p))}},function(c,O,y){c.exports=function(m,d,E,p,b){return m.config=d,E&&(m.code=E),m.request=p,m.response=b,m.isAxiosError=!0,m.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},m}},function(c,O,y){var m=y(88),d=y(89);c.exports=function(E,p){return E&&!m(p)?d(E,p):p}},function(c,O,y){c.exports=function(m){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(m)}},function(c,O,y){c.exports=function(m,d){return d?m.replace(/\/+$/,"")+"/"+d.replace(/^\/+/,""):m}},function(c,O,y){var m=y(18),d=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];c.exports=function(E){var p,b,s,g={};return E&&m.forEach(E.split(`
`),function(i){if(s=i.indexOf(":"),p=m.trim(i.substr(0,s)).toLowerCase(),b=m.trim(i.substr(s+1)),p){if(g[p]&&d.indexOf(p)>=0)return;g[p]=p==="set-cookie"?(g[p]?g[p]:[]).concat([b]):g[p]?g[p]+", "+b:b}}),g}},function(c,O,y){var m=y(18);c.exports=m.isStandardBrowserEnv()?function(){var d,E=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");function b(s){var g=s;return E&&(p.setAttribute("href",g),g=p.href),p.setAttribute("href",g),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return d=b(window.location.href),function(s){var g=m.isString(s)?b(s):s;return g.protocol===d.protocol&&g.host===d.host}}():function(){return!0}},function(c,O,y){var m=y(18);c.exports=m.isStandardBrowserEnv()?{write:function(d,E,p,b,s,g){var i=[];i.push(d+"="+encodeURIComponent(E)),m.isNumber(p)&&i.push("expires="+new Date(p).toGMTString()),m.isString(b)&&i.push("path="+b),m.isString(s)&&i.push("domain="+s),g===!0&&i.push("secure"),document.cookie=i.join("; ")},read:function(d){var E=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return E?decodeURIComponent(E[3]):null},remove:function(d){this.write(d,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(c,O,y){var m=y(45);function d(E){if(typeof E!="function")throw new TypeError("executor must be a function.");var p;this.promise=new Promise(function(s){p=s});var b=this;E(function(s){b.reason||(b.reason=new m(s),p(b.reason))})}d.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},d.source=function(){var E;return{token:new d(function(p){E=p}),cancel:E}},c.exports=d},function(c,O,y){c.exports=function(m){return function(d){return m.apply(null,d)}}},function(c,O,y){var m=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(O,"__esModule",{value:!0});var d=m(y(0)),E=1,p=function(){function b(s){this.lockingPromise=Promise.resolve(),this.locks=0,this.name="",this.lockId=E++,s&&(this.name=s),d.default.debug("[lock-"+this.name+"-"+this.lockId+"] is created.")}return Object.defineProperty(b.prototype,"isLocked",{get:function(){return this.locks>0},enumerable:!0,configurable:!0}),b.prototype.lock=function(){var s,g=this;this.locks+=1,d.default.debug("[lock-"+this.name+"-"+this.lockId+"] is locked, current queue "+this.locks+".");var i=new Promise(function(l){s=function(){g.locks-=1,d.default.debug("[lock-"+g.name+"-"+g.lockId+"] is not locked, current queue "+g.locks+"."),l()}}),a=this.lockingPromise.then(function(){return s});return this.lockingPromise=this.lockingPromise.then(function(){return i}),a},b}();O.PromiseMutex=p},function(c,O,y){y.r(O);var m=y(2),d=y(0),E=y(1),p=y(8),b=y(4),s=function(){};s.prototype.set=function(te,N){["BatteryLevel"].indexOf(te)>-1&&(this[te]=N)};var g=function(){var te=E.report.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),N=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,fe=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,Ee=window.WebSocket,he=!!N&&!!fe&&!!Ee,_e=!1;b.isChrome()&&b.getBrowserVersion()>=58&&b.getBrowserOS()!=="iOS"&&(_e=!0),b.isFireFox()&&b.getBrowserVersion()>=56&&(_e=!0),b.isOpera()&&b.getBrowserVersion()>=45&&(_e=!0),b.isSafari()&&b.getBrowserVersion()>=11&&(_e=!0),b.isEdge()&&(_e=!0),(b.isWeChatBrowser()||b.isQQBrowser())&&b.getBrowserOS()!=="iOS"&&(_e=!0),b.isSupportedPC()||b.isSupportedMobile()||(_e=!1);var ye=he&&_e;return te(null,ye),ye},i=new function(){var te=Object(p.b)();return te.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},te.state=te.states.UNINIT,te.batteryManager=null,te._init=function(N,fe){te.state=te.states.INITING,navigator.getBattery?navigator.getBattery().then(function(Ee){te.batteryManager=Ee,N&&setTimeout(function(){N()},0)}).catch(function(Ee){d.default.debug("navigator.getBattery is disabled",Ee),N&&N()}):(te.state=te.states.INITED,N&&N())},te._getBatteryStats=function(){var N={};return te.batteryManager&&te.batteryManager.level?N.BatteryLevel=Math.floor(100*te.batteryManager.level):N.BatteryLevel="UNSUPPORTED",N},te.getStats=function(N,fe){var Ee=new s,he=te._getBatteryStats();he&&he.BatteryLevel&&Ee.set("BatteryLevel",he.BatteryLevel),N&&N(Ee)},te._init(),te},a=y(22),l=y(19),A=y(26),k=y(53),S=y(9),f=["live","rtc","web","interop","h264_interop","web-only"],C=["vp8","vp9","h264"],I=["aes-128-gcm","aes-256-gcm","aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-256-gcm2","aes-128-gcm2"],P=y(11),T=y.n(P),F=y(7),J=y.n(F),G=y(13),H=y(5),V=y(10),_=y(20),n=y(6),L=y(14),h={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},t={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},j=function(te){var N={remoteStreamStorage:{},localStreamStorage:{}};return N.gatewayClient=te,N.checkAudioOutputLevel=function(fe){return!(fe&&parseInt(fe.audioRecvBytesDelta)>0&&parseInt(fe.audioDecodingNormalDelta)>0&&parseInt(fe.audioOutputLevel)===0)},N.checkAudioIntputLevel=function(fe){return!fe||parseInt(fe.audioInputLevel)!==0},N.checkFramerateInput=function(fe,Ee){if(!fe||!Ee.attributes)return!0;var he=parseInt(Ee.attributes.maxFrameRate),_e=parseInt(fe.googFrameRateInput);return!he||!_e||!(he>10&&_e<5||he<10&&he>=5&&_e<=1)},N.checkFramerateSent=function(fe){return!(fe&&parseInt(fe.googFrameRateInput)>5&&parseInt(fe.googFrameRateSent)<=1)},N.checkSendVideoBitrate=function(fe){return!fe||parseInt(fe.videoSendBytesDelta)!==0},N.checkSendAudioBitrate=function(fe){return!fe||parseInt(fe.audioSendBytesDelta)!==0},N.checkVideoDecode=function(fe){return!fe||parseInt(fe.videoRecvBytesDelta)===0||parseInt(fe.googFrameRateDecoded)!==0},N.checkAudioDecode=function(fe){return!fe||parseInt(fe.audioRecvBytesDelta)===0||parseInt(fe.audioDecodingNormalDelta)!==0},N.record=function(fe,Ee,he,_e,ye){he[fe]||(he[fe]={isPrevNormal:!0,record:[]});var u=he[fe],U=N["check"+fe](Ee,ye);if(u.record.push(U),u.record.length>=5){u.isCurNormal=u.record.indexOf(!0)!==-1;var $=t[fe];u.isPrevNormal&&!u.isCurNormal&&N.gatewayClient.dispatchEvent({type:"exception",code:$,msg:h[$],uid:_e}),!u.isPrevNormal&&u.isCurNormal&&N.gatewayClient.dispatchEvent({type:"exception",code:$+2e3,msg:h[$+2e3],uid:_e}),u.isPrevNormal=u.isCurNormal,u.record=[]}},N.setLocalStats=function(fe){var Ee={};Object.keys(fe).map(function(he){var _e=fe[he],ye=N.gatewayClient.localStreams[parseInt(he)],u=N.localStreamStorage[he]||{};ye&&ye.hasVideo()&&(N.record("SendVideoBitrate",_e.videoStats,u,he),N.record("FramerateInput",_e.videoStats,u,he,ye),N.record("FramerateSent",_e.videoStats,u,he)),ye&&ye.hasAudio()&&(N.record("AudioIntputLevel",_e.audioStats,u,he),N.record("SendAudioBitrate",_e.audioStats,u,he)),Ee[he]=u}),N.localStreamStorage=Ee},N.setRemoteStats=function(fe){var Ee={};Object.keys(fe).map(function(he){var _e=fe[he],ye=te.remoteStreams[he],u=N.remoteStreamStorage[he]||{};ye&&ye.hasVideo()&&ye.isPlaying()&&N.record("VideoDecode",_e.videoStats,u,he),ye&&ye.hasAudio()&&ye.isPlaying()&&(N.record("AudioOutputLevel",_e.audioStats,u,he),N.record("AudioDecode",_e.audioStats,u,he)),Ee[he]=u}),N.remoteStreamStorage=Ee},N};function r(te){if(typeof Symbol>"u"||te[Symbol.iterator]==null){if(Array.isArray(te)||(te=function(u,U){if(u){if(typeof u=="string")return v(u,U);var $=Object.prototype.toString.call(u).slice(8,-1);if($==="Object"&&u.constructor&&($=u.constructor.name),$==="Map"||$==="Set")return Array.from($);if($==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($))return v(u,U)}}(te))){var N=0,fe=function(){};return{s:fe,n:function(){return N>=te.length?{done:!0}:{done:!1,value:te[N++]}},e:function(u){throw u},f:fe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ee,he,_e=!0,ye=!1;return{s:function(){Ee=te[Symbol.iterator]()},n:function(){var u=Ee.next();return _e=u.done,u},e:function(u){ye=!0,he=u},f:function(){try{_e||Ee.return==null||Ee.return()}finally{if(ye)throw he}}}}function v(te,N){(N==null||N>te.length)&&(N=te.length);for(var fe=0,Ee=new Array(N);fe<N;fe++)Ee[fe]=te[fe];return Ee}var M,B=y(3),q=new function(){var te=Object(p.b)();return te.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},te.state=te.states.UNINIT,te.type=null,te.lastConnectedAt=null,te.lastDisconnectedAt=null,te.lastTypeChangedAt=null,te.networkChangeTimer=null,te._init=function(N,fe){if(te.state=te.states.INITING,navigator.connection&&navigator.connection.addEventListener){var Ee=te._getNetworkInfo();te.type=Ee&&Ee.type,te.state=te.states.INITED,N&&N()}else te.state=te.states.UNINIT,fe&&fe("DO_NOT_SUPPORT")},te._getNetworkInfo=function(){return navigator.connection},te._reloadNetworkInfo=function(){var N=te._getNetworkInfo(),fe=N&&N.type||"UNSUPPORTED",Ee=Date.now();if(fe!==te.type){te.lastTypeChangedAt=Ee,fe=="none"?te.lastDisconnectedAt=Ee:te.type=="none"&&(te.lastConnectedAt=Ee),te.type=fe;var he={type:"networkTypeChanged",networkType:fe};te.dispatchEvent(he)}},te.getStats=function(N,fe){var Ee={},he=te._getNetworkInfo();he&&(Ee.NetworkType=he.type||"UNSUPPORTED"),setTimeout(function(){N(Ee)},0)},te._init(function(){navigator.connection.addEventListener("change",function(){te._reloadNetworkInfo()}),te.networkChangeTimer=setInterval(function(){te._reloadNetworkInfo()},5e3)},function(N){}),te},Q=y(55),z=y(16),w=y(56),D=y.n(w),x=y(21),ee=function(){return(M||M||(M=(window.location.protocol.split(":")[0]||"").toUpperCase()))==="HTTPS"},Y=function(){return window.isSecureContext!==void 0},Z="host",oe=function(te){var N={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServers:[],useProxyServer:!1,useLocalAccessPoint:!1};if(N.mode=te.mode,N.codec=te.codec,N.clientId=Object(V.generateSessionId)().slice(0,5),N.uintUid=null,N.customReportCount=0,te=J()({},te),N.aespassword=null,N.aesmode="none",N.hasPublished=!1,N.getSessionId=function(){return te.sessionId},N.startChannelMediaRelay=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(W){if(W)return U&&U(W);U&&U()},name:"Client.startChannelMediaRelay",options:arguments,tag:"tracer"});if(!(u instanceof S.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var X=u.getSrcChannelMediaInfo(),ie=u.getDestChannelMediaInfos();if(Object(B.isEmpty)(X))throw"srcChannelMediaInfo should not be empty";if(Object(B.isEmpty)(ie)||ie.length===0)throw"destChannelMediaInfos should not be empty";if(!Object(V.is32Uint)(X.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(B.isValidChannelName)(X.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(X.token&&!Object(B.isValidToken)(X.token))throw"Invalid token in srcChannelMediaInfo";if(ie.forEach(function(W){if(!Object(V.is32Uint)(W.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(B.isValidChannelName)(W.channelName))throw"Invalid channelName in destChannelMediaInfo";if(W.token&&!Object(B.isValidToken)(W.token))throw"Invalid token in destChannelMediaInfo"}),N.gatewayClient.state!==G.a.CONNECTED)throw"startChannelMediaRelay should be used after join";N.gatewayClient.startChannelMediaRelay(u).then(function(){$&&$()}).catch(function(W){$&&$(W)})},N.updateChannelMediaRelay=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(W){if(W)return U&&U(W);U&&U()},name:"Client.updateChannelMediaRelay",options:arguments,tag:"tracer"});if(!(u instanceof S.ChannelMediaRelayConfiguration))throw"Configration should be instance of [ChannelMediaRelayConfiguration]";var X=u.getSrcChannelMediaInfo(),ie=u.getDestChannelMediaInfos();if(Object(B.isEmpty)(X))throw"srcChannelMediaInfo should not be empty";if(Object(B.isEmpty)(ie)||ie.length===0)throw"destChannelMediaInfos should not be empty";if(!Object(V.is32Uint)(X.uid))throw"Invalid uid in srcChannelMediaInfo";if(!Object(B.isValidChannelName)(X.channelName))throw"Invalid channelName in srcChannelMediaInfo";if(X.token&&!Object(B.isValidToken)(X.token))throw"Invalid token in srcChannelMediaInfo";if(ie.forEach(function(W){if(!Object(V.is32Uint)(W.uid))throw"Invalid uid in destChannelMediaInfo";if(!Object(B.isValidChannelName)(W.channelName))throw"Invalid channelName in destChannelMediaInfo";if(W.token&&!Object(B.isValidToken)(W.token))throw"Invalid token in destChannelMediaInfo"}),N.gatewayClient.state!==G.a.CONNECTED)throw"updateChannelMediaRelay should be used after join";N.gatewayClient.updateChannelMediaRelay(u).then(function(){$&&$()}).catch(function(W){$&&$(W)})},N.stopChannelMediaRelay=function(u){var U=E.report.reportApiInvoke(te.sessionId,{callback:function($){if($)return u&&u($);u&&u()},name:"Client.stopChannelMediaRelay",options:arguments,tag:"tracer"});N.gatewayClient.stopChannelMediaRelay().then(function(){U&&U()}).catch(function($){U&&U($)})},N.getConnectionState=function(){var u=E.report.reportApiInvoke(te.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),U=G.a.connetionStateMap[N.gatewayClient.state];return u(),U},N.setClientRole=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:U,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Object(B.checkValidEnum)(u,"setClientRole",[Z,"audience"]),N.mode==="rtc"){var X="RTC mode can not use setClientRole";return d.default.warning("[".concat(N.clientId,"] ").concat(X)),$&&$(X)}N.gatewayClient&&N.gatewayClient.state===G.a.CONNECTED?(u==="audience"&&(this.highStreamState===0?this._unpublish(this.highStream,function(){$&&$(null,{role:u})},function(ie){$&&$(ie)}):N.gatewayClient.setClientRole("audience",$)),u===Z&&N.gatewayClient.setClientRole(Z,$)):(N.gatewayClient.role=u,$&&$(null,{role:u}))},N.getGatewayInfo=function(u){if(N.gatewayClient.state!==G.a.CONNECTED){var U="Client is not in connected state";return d.default.error("[".concat(N.clientId,"] ").concat(U)),void u(U)}N.gatewayClient.getGatewayInfo(function($){u(null,$)},u)},N.renewToken=function(u,U,$){var X=E.report.reportApiInvoke(te.sessionId,{callback:function(ie,W){if(ie)return d.default.error("Failed to renew token ".concat(ie),W),$&&$(ie);U&&U(W)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Object(B.isValidToken)(u))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return N.gatewayClient?N.key?(N.key=u,void N.gatewayClient.renewToken(u,function(ie){return X(null,ie)},X)):(d.default.error("[".concat(N.clientId,"] renewToken should not be called before user join")),X(H.default.INVALID_OPERATION)):(d.default.error("[".concat(N.clientId,"] renewToken Failed. GatewayClient not Exist")),X(H.default.INVALID_OPERATION))},N.setLowStreamParameter=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});Object(B.checkValidObject)(u,"param");var $=u.width,X=u.height,ie=u.framerate,W=u.bitrate;Object(B.isEmpty)($)||Object(B.checkValidNumber)($,"width"),Object(B.isEmpty)(X)||Object(B.checkValidNumber)(X,"height"),Object(B.isEmpty)(ie)||Object(B.checkValidNumber)(ie,"framerate"),Object(B.isEmpty)(W)||Object(B.checkValidNumber)(W,"bitrate",1,1e7),(!$&&X||$&&!X)&&d.default.warning("[".concat(N.clientId,"] The width and height parameters take effect only when both are set")),N.lowStreamParameter=u,U()},N.init=function(u,U,$){var X=E.report.reportApiInvoke(te.sessionId,{callback:function(ie,W){if(ie)return $&&$(ie);U&&U(W)},name:"Client.init",options:arguments,tag:"tracer"});Object(B.checkValidString)(u),Object(b.isChromeKernel)()&&Object(b.getChromeKernelVersion)()<=48?$?X(H.default.BAD_ENVIRONMENT):Object(V.popBanTip)():(te.appId=u,te.sessionId=Object(V.generateSessionId)(),X())},N.setTurnServer=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(N.gatewayClient&&N.gatewayClient.state!==G.a.DISCONNECTED)throw new Error("Set turn server before join channel");if(N.useProxyServer)throw new Error("You have already set the proxy");if(N.useLocalAccessPoint)throw new Error("You have already set the local proxy");u instanceof Array||(u=[u]);var $=[];u.map(function(X,ie){Object(B.checkValidObject)(X,"turnServer");var W=X.turnServerURL,K=X.username,ne=X.password,se=X.udpport,ue=X.forceturn,ae=X.tcpport;if(Object(B.checkValidString)(W,"turnServerURL"),Object(B.checkValidString)(K,"username"),Object(B.checkValidString)(ne,"password"),Object(B.checkValidString)(se,"udpport"),parseInt(se)===0)throw new Error("udpport should not be ".concat(se));Object(B.isEmpty)(ue)||Object(B.checkValidBoolean)(ue,"forceturn");var me={mode:"manual"};if(me.url=W,me.udpport=se,me.username=K,me.credential=ne,me.forceturn=ue||!1,!Object(B.isEmpty)(ae)){if(Object(B.checkValidString)(ae,"tcpport"),parseInt(ae)===0)throw new Error("tcpport should not be ".concat(ae));me.tcpport=ae,d.default.info("[".concat(N.clientId,"] Set turnserver[").concat(ie,"] tcpurl. ").concat(me.url,":").concat(me.tcpport))}d.default.info("[".concat(N.clientId,"] Set turnserver[").concat(ie,"] udpurl. ").concat(me.url,":").concat(me.udpport,",username: ").concat(me.username)),$.push(me)}),N.turnServers=$,U()},N.setProxyServer=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(N.gatewayClient&&N.gatewayClient.state!==G.a.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!u)throw new Error("Do not set the proxyServer parameter as empty");if(N.useProxyServer)throw new Error("You have already set the proxy");if(N.useLocalAccessPoint)throw new Error("You have already set the local proxy");Object(B.checkValidString)(u,"proxyServer"),N.proxyServer=u,E.report.setProxyServer(u),d.default.setProxyServer(u),U()},N.startProxyServer=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(N.gatewayClient&&N.gatewayClient.state!==G.a.DISCONNECTED)throw new Error("Start proxy server before join channel");if(N.proxyServer)throw new Error("You have already set the proxy");if(N.useLocalAccessPoint)throw new Error("You have already set the local proxy");N.useProxyServer=!0,N.proxyServerType=u||1,U()},N.stopProxyServer=function(){var u=E.report.reportApiInvoke(te.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(N.gatewayClient&&N.gatewayClient.state!==G.a.DISCONNECTED)throw new Error("Stop proxy server after leave channel");E.report.setProxyServer(),d.default.setProxyServer(),N.turnServers=[],N.proxyServer=null,N.useProxyServer=!1,N.proxyServerType=null,u()},N.setEncryptionSecret=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Object(B.checkValidString)(u,"password");var $=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})");$.test(u)||d.default.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer,
      `),N.aespassword=u,U()},N.setEncryptionMode=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Object(B.checkValidString)(u,"encryptionMode"),I.indexOf(u)===-1)throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb" | "sm4-128-ecb" | "aes-128-gcm" | "aes-256-gcm" | "aes-128-gcm2" | "aes-256-gcm2"');var X=["aes-128-gcm2","aes-256-gcm2"];if(X.indexOf(u)!==-1){if(!U||!(U instanceof Uint8Array&&U.length===32))throw Error("salt must be an Uint8Array and exactly equal to 32 bytes")}else if(U)throw new Error("Only ".concat("aes-128-gcm2"," and ").concat("aes-256-gcm2"," support use salt"));U&&(N.aesSalt=Object(V.uint8ArrayToBase64)(U)),N.aesmode=u,$()},N.configPublisher=function(u){var U=E.report.reportApiInvoke(te.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});Object(B.checkValidObject)(u,"config");var $=u.width,X=u.height,ie=u.framerate,W=u.bitrate,K=u.publisherUrl;Object(B.checkValidNumber)($,"width"),Object(B.checkValidNumber)(X,"height"),Object(B.checkValidNumber)(ie,"framerate"),Object(B.checkValidNumber)(W,"bitrate",1,1e7),K&&Object(B.checkValidString)(K,"publisherUrl"),N.gatewayClient.configPublisher(u),U()},N.enableDualStream=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(X,ie){if(X)return U&&U(X);u&&u(ie)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return Object(b.getBrowserOS)()==="iOS"?(E.report.streamSwitch(te.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),$(H.default.IOS_NOT_SUPPORT)):Object(b.isWeChatBrowser)()?(E.report.streamSwitch(te.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!1}),$(H.default.WECHAT_NOT_SUPPORT)):(E.report.streamSwitch(te.sessionId,{lts:new Date().getTime(),isdual:!0,succ:!0}),N.isDualStream=!0,N.highStream&&(N.highStream.isDualStream=!0),void(N.highStreamState===0?N._publishLowStream(function(X){return $(null,X)},function(X){d.default.warning("[".concat(N.clientId,"]"),X),$(H.default.ENABLE_DUALSTREAM_FAILED)}):N.highStreamState===1?$(H.default.STILL_ON_PUBLISHING):$(null)))},N.disableDualStream=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(X,ie){if(X)return U&&U(X);u&&u(ie)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});E.report.streamSwitch(te.sessionId,{lts:new Date().getTime(),isdual:!1,succ:!0}),N.isDualStream=!1,N.highStream&&(N.highStream.isDualStream=!1),N.highStreamState===0?N._unpublishLowStream(function(){N.highStream.lowStream=null,$()},function(X){d.default.warning("[".concat(N.clientId,"]"),X),$(H.default.DISABLE_DUALSTREAM_FAILED)}):N.highStreamState===1?$(H.default.STILL_ON_PUBLISHING):$()},N._getLowStream=function(u,U){N.lowStream?u(N.lowStream):N._createLowStream(function($){N.lowStream=$,u(N.lowStream)},U)},N._createLowStream=function(u,U){if(N.highStream&&N.highStream.stream){var $=J()({},N.highStream.params);if($.streamID+=1,$.audio=!1,$.video)if(N.highStream.stream.getVideoTracks()[0]){var X=new a.a($);X.isLowStream=!0,X.streamId=N.highStream.getId()+1;var ie={};N.lowStreamParameter&&(ie=J()({},N.lowStreamParameter)),ie.width&&ie.height||(ie.width=160,ie.height=120),ie.framerate=ie.framerate||15,ie.bitrate=ie.bitrate||50,X.setVideoProfileCustomPlus(ie);try{var W=D()(N.highStream,{width:X.videoConstraint.width.ideal,height:X.videoConstraint.height.ideal,framerate:X.videoConstraint.frameRate});return X.stream=W,N.highStream.lowStream=X,N.highStream.userMuteVideo&&X.muteVideo(),u&&u(X)}catch(K){return U&&U(K)}}else U&&U(H.default.HIGH_STREAM_NOT_VIDEO_TRACE);else U&&U(H.default.HIGH_STREAM_NOT_VIDEO_TRACE)}else U&&U(H.default.HIGH_STREAM_NOT_VIDEO_TRACE)},N._publishLowStream=function(u,U){return N.lowStreamState!==2?U&&U(H.default.LOW_STREAM_ALREADY_PUBLISHED):N.highStream&&N.highStream.hasScreen()?U&&U(H.default.SHARING_SCREEN_NOT_SUPPORT):void N._getLowStream(function($){N.lowStreamState=1,N.gatewayClient.publish($,{streamType:1},function(){N.lowStreamState=0,u&&u()},function(X){N.lowStreamState===1&&(N.lowStreamState=2),d.default.debug("[".concat(N.clientId,"] publish low stream failed")),U&&U(X)})},U)},N._unpublishLowStream=function(u,U){if(N.lowStreamState!==0)return U&&U(H.default.LOW_STREAM_NOT_YET_PUBLISHED);N.lowStream&&(N.gatewayClient.unpublish(N.lowStream,{streamType:1},function(){},function($){d.default.debug("[".concat(N.clientId,"] unpublish low stream failed")),U&&U($)}),N.lowStream.close(),N.lowStream=null,N.lowStreamState=2,u&&u())},N.join=function(u,U,$,X,ie,W){X&&typeof X=="function"&&(W=ie,ie=X,X=null);var K=g(),ne=Object(b.getBrowserInfo)();d.default.debug(ne,",Support: "+K);var se=ee(),ue="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser",ae=Y()?window.isSecureContext:"Browser Not Support",me=function(){d.default.warning(ue)};Y()?window.isSecureContext||me():se||me();var ve=E.report.reportApiInvoke(te.sessionId,{callback:function(be,Ae){if(be)return W&&W(be);ie&&ie(Ae)},name:"Client.join",options:arguments,getStates:function(){return{isHttps:se,isSecureContext:ae}},tag:"tracer"});if(u&&!Object(B.isValidToken)(u))return d.default.warning("[".concat(N.clientId,"] Param channelKey should be string")),ve(H.default.INVALID_PARAMETER);if(!Object(B.isValidChannelName)(U))return d.default.error("Invalid Channel Name ".concat(U)),d.default.warning("[".concat(N.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),ve(H.default.INVALID_PARAMETER);if(typeof U=="string"&&U==="")return d.default.warning("[".concat(N.clientId,"] Param channel should not be empty")),ve(H.default.INVALID_PARAMETER);if(X&&!Object(B.isValidString)(X))return d.default.warning("[".concat(N.clientId,"] optionalInfo should be string")),ve(H.default.INVALID_PARAMETER);if($&&!Object(V.is32Uint)($)&&!Object(B.isValidString)($,1,255))return d.default.error("Invalid UID ".concat($," ").concat(T()($))),d.default.warning("[".concat(N.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is 32Uint")),ve(H.default.INVALID_PARAMETER);if(typeof $=="string"&&$.length==0)return d.default.warning("[".concat(N.clientId,"] String uid should not be empty")),ve(H.default.INVALID_PARAMETER);if(typeof $=="string"&&$.length>256)return d.default.warning("[".concat(N.clientId,"] Length of string uid should be less than 255")),ve(H.default.INVALID_PARAMETER);d.default.stopWaitJoin(),N.highStream=null,N.lowStream=null,N.lowStreamParameter=null,N.isDualStream=!1,N.highStreamState=2,N.lowStreamState=2;var Re=Date.now(),Ie=setTimeout(function(){if(N.gatewayClient.hasJoined!=1){d.default.debug("[".concat(N.clientId,"] The time to join the channel is greater than 5 seconds "));var be=Date.now();E.report.joinChannelTimeOut({lts:be,sid:te.sessionId,cname:U,cid:Se&&Se.cid,uid:Se.uid||(typeof $=="string"?void 0:$),elapse:be-Re,timeout:5})}},5e3),Se={clientId:N.clientId,appId:te.appId,sid:te.sessionId,cname:U,uid:$,turnServers:N.turnServers.concat(),proxyServer:N.proxyServer,token:u||te.appId,useProxyServer:N.useProxyServer,useLocalAccessPoint:N.useLocalAccessPoint,proxyServerType:N.proxyServerType,optionalInfo:X};if(typeof $=="string"&&(Se.stringUid=$,N.uintUid?(Se.uid=N.uintUid,delete N.uintUid):Se.uid=0),N.aespassword&&N.aesmode!=="none"&&J()(Se,{aespassword:N.aespassword,aesmode:N.aesmode}),N.aesSalt&&(Se.aes_salt=N.aesSalt),E.report.sessionInit(te.sessionId,{lts:new Date().getTime(),cname:U,appid:te.appId,mode:te.mode,succ:!0}),N.onSuccess=function(be){clearTimeout(Ie),N.rtcStatsCollector.startNetworkQualityTimer(),N.onSuccess=null,ve(null,be)},N.onFailure=function(be){return ve(be)},N.channel=U,N.gatewayClient.state!==G.a.DISCONNECTED)return d.default.error("[".concat(N.clientId,"] Client already in connecting/connected state")),ve(H.default.INVALID_OPERATION),void E.report.joinGateway(te.sessionId,{lts:Date.now(),succ:!1,ec:H.default.INVALID_OPERATION,addr:null});N.gatewayClient.state=G.a.CONNECTING;var Te=function(be,Ae){d.default.info("[".concat(N.clientId,"] Joining channel: ").concat(U)),N.gatewayClient.dispatchEvent({type:"config-distribute",config:Ae,joinInfo:Se}),N.key=u||te.appId,Se.cid=be.cid,Se.uid||(Se.uid=be.uid),Se.vid=be.vid,Se.clientId=N.clientId,Se.apResponse=be.res,be.uni_lbs_ip&&be.uni_lbs_ip[1]&&(Se.uni_lbs_ip=be.uni_lbs_ip[1]),Se.gatewayAddr=be.gateway_addr,N.joinInfo=Se,N.gatewayClient.join(Se,N.key,function(Oe){d.default.info("[".concat(N.clientId,"] Join channel ").concat(U," success, join with uid: ").concat(Oe,".")),N.onSuccess=null,N.rtcStatsCollector.startNetworkQualityTimer(),ve(null,Oe)},function(Oe){return ve(Oe)})};Se.stringUid&&!Se.uid?(N.userAccountReq&&!N.userAccountReq.isFinished()&&N.userAccountReq.cancel(),N.userAccountReq=Object(_.getUserAccount)(Se,N.gatewayClient),N.userAccountReq.then(function(be){d.default.debug("getUserAccount Success ".concat(be.url," ").concat(Se.stringUid," => ").concat(be.uid)),Se.uid=be.uid,Object(_.getGatewayList)(Se,Te,function(Ae){return ve(Ae)})}).catch(function(be){d.default.error("getUserAccount rejected",be),ve(be)})):Object(_.getGatewayList)(Se,Te,function(be){return ve(be)})},N.renewChannelKey=function(u,U,$){var X=E.report.reportApiInvoke(te.sessionId,{callback:function(ie,W){if(ie)return $&&$(ie);U&&U(W)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Object(B.checkValidString)(u,"key",1,2047),N.key===void 0?(d.default.error("[".concat(N.clientId,"] renewChannelKey should not be called before user join")),X(H.default.INVALID_OPERATION)):(N.key=u,N.gatewayClient.joinInfo.token=u,N.gatewayClient.key=u,N.gatewayClient.recover(),X())},N.leave=function(u,U){N.gatewayClient.isFirstSuccess=!0,N.gatewayClient.hasInvokeLeave=!0;var $=!1,X=E.report.reportApiInvoke(te.sessionId,{callback:function(ie,W){if(ie)return U&&U(ie);N.gatewayClient.reconnectingCS=!1,N.gatewayClient.state=G.a.DISCONNECTED,clearTimeout(Object(_._getReconnectCSTimer)(N.clientId)),N._renewSession(),N.rtcStatsCollector.clearNetworkQualityTimer(),u&&u(W)},name:"Client.leave",options:arguments,tag:"tracer"});d.default.info("[".concat(N.clientId,"] Leaving channel")),N.userAccountReq&&!N.userAccountReq.isFinished()&&(N.userAccountReq.cancel(),N.gatewayClient.state===G.a.CONNECTING&&(N.gatewayClient.state=G.a.DISCONNECTED)),N._terminateLiveStreaming(),N.gatewayClient.leave(function(ie){$=!0,X(null,ie)},X),setTimeout(function(){$||(N.gatewayClient.socket&&(N.gatewayClient.socket.close(),N.gatewayClient.socket=null),N.gatewayClient.state=G.a.DISCONNECTED,X(null,"LEAVE_MSG_TIMEOUT"))},Object(m.getParameter)("LEAVE_MSG_TIMEOUT"))},N._renewSession=function(){var u=Object(V.generateSessionId)();if(d.default.debug("renewSession ".concat(te.sessionId," => ").concat(u)),te.sessionId=u,N.gatewayClient.peerPublishDurationMap.clear(),N.joinInfo&&(N.joinInfo.sid=u),N.gatewayClient&&(N.gatewayClient.joinInfo&&(N.gatewayClient.joinInfo.sid=u),N.gatewayClient.localStreams))for(var U in N.gatewayClient.localStreams){var $=N.gatewayClient.localStreams[U];$&&($.sid=u)}},N._publish=function(u,U,$,X){if(N.highStreamState!==2)return d.default.warning("[".concat(N.clientId,"] Can't publish stream when stream already publish ").concat(u.getId())),$&&$(H.default.STREAM_ALREADY_PUBLISHED);if(N.turnServers.length===0&&Object(m.getParameter)("FORCE_TURN")&&!Object(m.getParameter)("TURN_ENABLE_TCP")&&!Object(m.getParameter)("TURN_ENABLE_UDP"))throw new Error("force TURN With No TURN Configuration");d.default.info("[".concat(N.clientId,"] Publishing stream, uid ").concat(u.getId())),N.highStream=u,N.highStreamState=1,N.highStream.streamId=N.joinInfo.stringUid||N.joinInfo.uid,N.hasPublished=!1;var ie=function(W,K,ne){N.gatewayClient.publish(W,{streamType:0},function(){W.sid=te.sessionId,N.highStreamState=0,d.default.info("[".concat(N.clientId,"] Publish success, uid: ").concat(W.getId())),N.highStream&&(N.highStream.isDualStream=N.isDualStream),N.isDualStream?N._publishLowStream(function(){K&&K()},function(se){d.default.warning("[".concat(N.clientId,"] "),se),z.a.replaceWithCanvasTrack(W).then(function(){K&&K()})}):z.a.replaceWithCanvasTrack(W).then(function(){K&&K()})},ne)};N.gatewayClient.role!=="audience"||N.mode!=="live"||X?ie(u,U,$):N.gatewayClient.setClientRole(Z,function(W){if(W)return $&&$(W);ie(u,U,$)})},N._unpublish=function(u,U,$,X){if(N.highStreamState!==0)return d.default.warning("[".concat(N.clientId,"] Can't unpublish stream when stream not publish")),$&&$(H.default.STREAM_NOT_YET_PUBLISHED);d.default.info("[".concat(N.clientId,"] Unpublish stream, uid ").concat(u.getId()));var ie=function(W,K,ne){N.isDualStream&&N.lowStream&&N._unpublishLowStream(null,ne),N.gatewayClient.unpublish(W,{streamType:0},function(){N.highStreamState=2,d.default.info("[".concat(N.clientId,"] Unpublish stream success, uid: ").concat(W.getId())),N.gatewayClient.dispatchEvent({type:"stream-unpublished",stream:W}),K&&K()},function(se){d.default.info("[".concat(N.clientId,"] Unpublish stream fail, uid: ").concat(W.getId())),ne&&ne(se)})};N.gatewayClient.role!==Z||N.mode!=="live"||X?ie(u,U,$):N.gatewayClient.setClientRole("audience",function(W){if(W)return $&&$(W);ie(u,U,$)})},N.publish=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(X,ie){if(X)return N.highStreamState===1&&X!=="REQUEST_ABORT"&&(N.highStreamState=2),U&&U(X)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!U}});N.highStreamState===2?u._hasVideoTracks()||u._hasAudioTracks()?(N.gatewayClient.publishRequestId=Object(V.generateId)(),N._publish(u,function(X){return $(null,X)},function(X){return $(X)})):$(H.default.NO_TRACK_IN_STREAM):$(H.default.STREAM_ALREADY_PUBLISHED)},N.unpublish=function(u,U,$){var X=E.report.reportApiInvoke(te.sessionId,{callback:function(ie,W){if(ie)return U&&U(ie);$&&$(W)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!U}});N.highStreamState===0?(N.gatewayClient.publishRequestId=null,N._unpublish(u,function(ie){return X(null,ie)},function(ie){return X(ie)})):X(H.default.STREAM_NOT_YET_PUBLISHED)},N.subscribe=function(u,U,$){var X=E.report.reportApiInvoke(te.sessionId,{callback:function(K,ne){if(K)return $&&$(K)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:U,onFailure:!!$}});typeof U=="function"&&($=U,U=null),Object(B.checkValidObject)(u,"stream"),Object(B.isEmpty)(U)||(Object(B.checkValidObject)(U,"options"),Object(B.isEmpty)(U.video)||Object(B.checkValidBoolean)(U.video,"options.video"),Object(B.isEmpty)(U.audio)||Object(B.checkValidBoolean)(U.audio,"options.audio"));var ie={video:!0,audio:!0};if(!Object(B.isEmpty)(U)){if(Object(b.isSafari)()&&(!U.video||!U.audio)){var W="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return d.default.error("[".concat(N.clientId,"] "),W),void X(W)}if(!Object(B.isEmpty)(U.video)&&!Object(B.isValidBoolean)(U.video)||!Object(B.isEmpty)(U.audio)&&!Object(B.isValidBoolean)(U.audio)||U.audio===!1&&U.video===!1)return W="INVALID_PARAMETER ".concat(JSON.stringify(U)),d.default.error("[".concat(N.clientId,"] "),W),void X(W)}u.subscribeOptions?(J()(u.subscribeOptions,ie,U),N.gatewayClient.subscribeChange(u,function(K){return X(null,K)},X)):(N.gatewayClient.subscribeRequestId.set(u.getId(),Object(V.generateId)()),u.subscribeOptions=J()({},ie,U),N.gatewayClient.subscribe(u,function(K){return X(null,K)},X))},N.unsubscribe=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{callback:function(X,ie){if(X)return U&&U(X)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!U}});d.default.info("[".concat(N.clientId,"] Unsubscribe stream, uid: ").concat(u.getId())),N.gatewayClient.subscribeRequestId.delete(u.getId()),N.gatewayClient.unsubscribe(u,function(X){return $(null,X)},$)},N.setRemoteVideoStreamType=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:U}});Object(B.checkValidEnum)(U,"streamType",[0,1]),N.gatewayClient.setRemoteVideoStreamType(u,U),$()},N.setStreamFallbackOption=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:U}});Object(B.checkValidEnum)(U,"fallbackType",[0,1,2]),N.gatewayClient.setStreamFallbackOption(u,U),$()},N.enableAudioVolumeIndicator=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});u=u||2e3,U=U||3,Object(B.checkValidNumber)(U,"smooth",1,100),Object(B.checkValidNumber)(u,"interval",50,1e5),N.audioVolumeIndication=N.audioVolumeIndication||{enabled:!0},N.audioVolumeIndication.interval=u,N.audioVolumeIndication.smooth=U,N.audioVolumeIndication={interval:u,smooth:U},d.default.info("[".concat(N.clientId,"] enableAudioVolumeIndicator interval ").concat(u," smooth ").concat(U)),N.gatewayClient.enableAudioVolumeIndicator(u,U),$()},N.getNetworkStats=function(u,U){return d.default.deprecate("[".concat(N.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),q.getStats(u,U)},N.getSystemStats=function(u,U){return i.getStats(u,U)},N.getRecordingDevices=function(u,U){return l.a.getRecordingDevices(u,U)},N.getPlayoutDevices=function(u,U){return l.a.getPlayoutDevices(u,U)},N.getCameras=function(u,U){return l.a.getCameras(u,U)},N.getRemoteAudioStats=function(u,U){return N.rtcStatsCollector.getRemoteAudioStats(u,U)},N.getLocalAudioStats=function(u,U){return N.rtcStatsCollector.getLocalAudioStats(u,U)},N.getRemoteVideoStats=function(u,U){return N.rtcStatsCollector.getRemoteVideoStats(u,U)},N.getLocalVideoStats=function(u,U){return N.rtcStatsCollector.getLocalVideoStats(u,U)},N._getRemoteVideoQualityStats=function(u,U){return N.rtcStatsCollector.getRemoteVideoQualityStats(u,U)},N._getRemoteAudioQualityStats=function(u,U){return N.rtcStatsCollector.getRemoteAudioQualityStats(u,U)},N.getTransportStats=function(u,U){return N.rtcStatsCollector.getTransportStats(function($){return q.getStats(function(X){var ie=J()({},$,X);u&&u(ie)},U)},U)},N.getSessionStats=function(u,U){return N.rtcStatsCollector.getSessionStats(u,U)},N.onNetworkQuality=function(){return N.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},N.sendMetadata=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.sendMetadata",tag:"tracer",callback:function(X){if(X)return U&&U(X);U&&U()}});N.gatewayClient.sendMetadata(u,$)},N.sendCustomReportMessage=function(u,U,$,X,ie,W){Object(m.getParameter)("CR")?N.customReportCount>Object(m.getParameter)("CRL")?W&&W("REPORT_LIMITED"):(N.gatewayClient.hasJoined||(d.default.WARNING("Should invoke Client.sendCustomReportMessage after join"),W&&W("REPORT_BEFORE_JOINED")),N.customReportTimer||(N.customReportTimer=setInterval(function(){N.customReportCount=0},Object(m.getParameter)("CRI"))),Object(B.checkValidString)(u,"reportId",0,100,!1),Object(B.checkValidString)(U,"category",0,100,!1),Object(B.checkValidString)($,"event",0,100,!1),Object(B.checkValidString)(X,"label",0,100,!1),Object(B.checkValidNumber)(ie,"value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),N.customReportCount++,E.report.sendCustomReportMessage(te.sessionId,{reportId:u,category:U,event:$,label:X,value:ie,lts:Date.now()},function(K){K?W&&W("REPORT_FAILED"):W&&W()})):W&&W("REPORT_FORBIDDEN")},N.setLocalAccessPoints=function(u,U){var $=E.report.reportApiInvoke(te.sessionId,{name:"Client.setLocalAccessPoints",tag:"tracer"});if(Object(B.checkValidArray)(u,"serverList"),Object(B.checkValidString)(U,"domain"),N.useProxyServer)throw new Error("You have already set the proxy");var X=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;u=u.map(function(ie){return X.test(ie)?"".concat(ie.replace(/\./g,"-"),".").concat(U):ie}),N.useLocalAccessPoint=!0,Object(m.setParameter)("WEBCS_DOMAIN",u),Object(m.setParameter)("WEBCS_DOMAIN_BACKUP_LIST",u),Object(m.setParameter)("GATEWAY_DOMAINS",[U]),Object(m.setParameter)("EVENT_REPORT_DOMAIN",u[Math.floor(Math.random()*u.length)]),Object(m.setParameter)("EVENT_REPORT_BACKUP_DOMAIN",u[Math.floor(Math.random()*u.length)]),Object(m.setParameter)("LOG_UPLOAD_SERVER","".concat(u[Math.floor(Math.random()*u.length)],":6444")),$()},te.clientId=N.clientId,N.gatewayClient=Object(G.a)(te),N.listenerLoggerTimer=null,N.listenerLoggerCache=[],N.on=function(u,U){N.gatewayClient.on(u,U),N.listenerLoggerCache.push("".concat(u).concat(U.name?":"+U.name:"")),N.listenerLoggerTimer?clearTimeout(N.listenerLoggerTimer):d.default.info("[".concat(N.clientId,"] Adding event handler on ").concat(u)),N.listenerLoggerTimer=setTimeout(function(){N.listenerLoggerCache.length&&(N.listenerLoggerTimer=null,d.default.info("[".concat(N.clientId,"] Added event handler on ").concat(N.listenerLoggerCache.join(", "))),N.listenerLoggerCache=[])},0)},N.off=function(u,U){d.default.info("remove event handler from [".concat(u,"]")),N.gatewayClient.removeEventListener(u,U)},N.rtcStatsCollector=function(u){var U=Object(p.b)();return U.gatewayClient=u,U.exceptionMonitor=new j(u),U.localStats={},U.remoteStats={},U.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},U.getRemoteAudioStats=function($){var X=U.gatewayClient.traffic_stats,ie={};for(var W in U.remoteStats){var K={},ne=U.remoteStats[W];if(Object(n.b)(K,"End2EndDelay",ne.peer_delay&&ne.peer_delay.audio_delay),Object(n.b)(K,"TransportDelay",ne.peer_delay&&ne.peer_delay.e2e_delay),Object(n.b)(K,"PacketLossRate",ne.peer_delay&&ne.peer_delay.e2e_audio_lost_ratio_400ms),Object(n.b)(K,"RecvLevel",ne.audioStats&&ne.audioStats.audioOutputLevel),Object(n.b)(K,"RecvBitrate",ne.audioRecvBitrate),Object(n.b)(K,"CodecType",ne.audioStats&&ne.audioStats.googCodecName),Object(n.b)(K,"MuteState",ne.audioDisabled),Object(n.b)(K,"TotalFreezeTime",ne.audioStats&&ne.audioStats.audioTotalFreezeTime),Object(n.b)(K,"TotalPlayDuration",ne.audioStats&&ne.audioStats.audioTotalPlayDuration),X&&X.peer_delay){var se=X.peer_delay.find(function(ae){return ae.peer_uid==W});if(se){var ue=se.peer_publish_audio_duration+(Date.now()-X.timestamp);Object(n.b)(K,"AudioPublishDuration",ue)}else Object(n.b)(K,"AudioPublishDuration",-1)}ie[W]=K}$&&$(ie)},U.getLocalAudioStats=function($){var X={};for(var ie in U.localStats){var W={},K=U.localStats[ie];Object(n.b)(W,"RecordingLevel",K.audioStats&&K.audioStats.audioInputLevel),Object(n.b)(W,"SendLevel",K.audioStats&&K.audioStats.totalAudioEnergy),Object(n.b)(W,"SamplingRate",K.audioStats&&K.audioStats.totalSamplesDuration),Object(n.b)(W,"SendBitrate",K.audioSendBitrate),Object(n.b)(W,"CodecType",K.audioStats&&K.audioStats.googCodecName),Object(n.b)(W,"MuteState",K.audioDisabled),Object(n.b)(W,"audioSendPacketsLost",K.audioStats&&K.audioStats.packetsLost);var ne=U.gatewayClient.localStreams[ie];ne&&ne.isPlaying()&&Object(n.b)(W,"MuteState",ne.userMuteAudio?"1":"0"),X[ie]=W}$&&$(X)},U.getRemoteVideoStats=function($){var X=U.gatewayClient.traffic_stats,ie={};for(var W in U.remoteStats){var K={},ne=U.remoteStats[W];if(Object(n.b)(K,"End2EndDelay",ne.peer_delay&&ne.peer_delay.video_delay),Object(n.b)(K,"TransportDelay",ne.peer_delay&&ne.peer_delay.e2e_delay),Object(n.b)(K,"PacketLossRate",ne.peer_delay&&ne.peer_delay.e2e_video_lost_ratio_400ms),Object(n.b)(K,"RecvBitrate",ne.videoRecvBitrate),Object(n.b)(K,"RecvResolutionWidth",ne.videoStats&&ne.videoStats.googFrameWidthReceived),Object(n.b)(K,"RecvResolutionHeight",ne.videoStats&&ne.videoStats.googFrameHeightReceived),Object(n.b)(K,"RenderResolutionWidth",ne.videoStats&&ne.videoStats.renderRemoteWidth),Object(n.b)(K,"RenderResolutionHeight",ne.videoStats&&ne.videoStats.renderRemoteHeight),Object(n.b)(K,"RenderFrameRate",ne.videoStats&&ne.videoStats.googFrameRateOutput),Object(n.b)(K,"MuteState",ne.videoDisabled),Object(n.b)(K,"TotalFreezeTime",ne.videoStats&&ne.videoStats.videoTotalFreezeTime),Object(n.b)(K,"TotalPlayDuration",ne.videoStats&&ne.videoStats.videoTotalPlayDuration),X&&X.peer_delay){var se=X.peer_delay.find(function(ae){return ae.peer_uid==W});if(se){var ue=se.peer_publish_video_duration+(Date.now()-X.timestamp);Object(n.b)(K,"VideoPublishDuration",ue)}else Object(n.b)(K,"VideoPublishDuration",-1)}ie[W]=K}$&&$(ie)},U.getLocalVideoStats=function($){var X={};for(var ie in U.localStats){var W={},K=U.localStats[ie];Object(n.b)(W,"TargetSendBitrate",K.videoTargetSendBitrate),Object(n.b)(W,"SendFrameRate",K.videoStats&&K.videoStats.googFrameRateSent),Object(n.b)(W,"SendBitrate",K.videoSendBitrate),Object(n.b)(W,"SendResolutionWidth",K.videoStats&&K.videoStats.googFrameWidthSent),Object(n.b)(W,"SendResolutionHeight",K.videoStats&&K.videoStats.googFrameHeightSent),Object(n.b)(W,"CaptureResolutionWidth",K.videoStats&&K.videoStats.googFrameWidthInput),Object(n.b)(W,"CaptureResolutionHeight",K.videoStats&&K.videoStats.googFrameHeightInput),Object(n.b)(W,"EncodeDelay",K.videoStats&&K.videoStats.googAvgEncodeMs),Object(n.b)(W,"MuteState",K.videoDisabled),Object(n.b)(W,"TotalFreezeTime",K.videoStats&&K.videoStats.videoTotalFreezeTime),Object(n.b)(W,"TotalDuration",K.videoStats&&K.videoStats.videoTotalPlayDuration),Object(n.b)(W,"CaptureFrameRate",K.videoStats&&K.videoStats.googFrameRateSent),Object(n.b)(W,"videoSendPacketsLost",K.videoStats&&K.videoStats.packetsLost),K.videoStats&&!K.videoStats.googFrameWidthInput&&Object(n.b)(W,"CaptureResolutionWidth",K.videoStats&&K.videoStats.renderLocalWidth),K.videoStats&&!K.videoStats.googFrameHeightInput&&Object(n.b)(W,"CaptureResolutionHeight",K.videoStats&&K.videoStats.renderLocalHeight),X[ie]=W}$&&$(X)},U.getRemoteVideoQualityStats=function($){var X={};for(var ie in U.remoteStats){var W={},K=U.remoteStats[ie];Object(n.b)(W,"videoReceiveDelay",K.videoStats&&K.videoStats.googCurrentDelayMs),Object(n.b)(W,"VideoFreezeRate",K.videoStats&&K.videoStats.videoFreezeRate),Object(n.b)(W,"FirstFrameTime",K.firstFrameTime),X[ie]=W}$&&$(X)},U.getRemoteAudioQualityStats=function($){var X={};for(var ie in U.remoteStats){var W={},K=U.remoteStats[ie];Object(n.b)(W,"audioReceiveDelay",K.audioStats&&K.audioStats.googCurrentDelayMs),Object(n.b)(W,"AudioFreezeRate",K.videoStats&&K.videoStats.videoFreezeRate),X[ie]=W}$&&$(X)},U.getTransportStats=function($){var X={},ie={},W=U.gatewayClient.traffic_stats,K=W.peer_delay;if(Object(n.b)(X,"OutgoingAvailableBandwidth",U.gatewayClient.OutgoingAvailableBandwidth/1e3),Object(n.b)(X,"RTT",W&&2*W.access_delay),K){var ne,se=r(K);try{for(se.s();!(ne=se.n()).done;){var ue=ne.value;ue.downlink_estimate_bandwidth&&(ie[ue.peer_uid]=ue.downlink_estimate_bandwidth/1e3+"")}}catch(ae){se.e(ae)}finally{se.f()}}X.IncomingAvailableBandwidth=ie,$&&$(X)},U.getSessionStats=function($){var X={},ie=U.gatewayClient.traffic_stats,W=U.gatewayClient.socket,K=0,ne=0;for(var se in U.remoteStats)(ue=U.remoteStats[se])&&ue.videoStats&&ue.videoStats.videoRecvBytesDelta&&(ne+=parseInt(ue.videoStats.videoRecvBytesDelta)),ue&&ue.audioStats&&ue.audioStats.audioRecvBytesDelta&&(ne+=parseInt(ue.audioStats.audioRecvBytesDelta));for(var se in U.localStats){var ue;(ue=U.localStats[se])&&ue.videoStats&&ue.videoStats.videoSendBytesDelta&&(K+=parseInt(ue.videoStats.videoSendBytesDelta)),ue&&ue.audioStats&&ue.audioStats.audioSendBytesDelta&&(K+=parseInt(ue.audioStats.audioSendBytesDelta))}var ae=K+U.session.WSSendBytesDelta+U.session.HTTPSendBytesDelta,me=ne+U.session.WSRecvBytesDelta+U.session.HTTPRecvBytesDelta,ve=U.session.sendBytes+Object(L.getHTTPSendBytes)(),Re=U.session.recvBytes+Object(L.getHTTPRecvBytes)();U.gatewayClient.socket&&U.gatewayClient.socket.state===U.gatewayClient.CONNECTED&&(ve+=W.getSendBytes(),Re+=W.getRecvBytes());var Ie=1;ie.peer_delay&&(Ie=ie.peer_delay.length,Ie+=1),W?Object(n.b)(X,"Duration",W.getDuration()):Object(n.b)(X,"Duration",0),Object(n.b)(X,"UserCount",Ie),Object(n.b)(X,"SendBytes",ve),Object(n.b)(X,"RecvBytes",Re),Object(n.b)(X,"SendBitrate",8*ae/1e3),Object(n.b)(X,"RecvBitrate",8*me/1e3),$&&$(X)},U.isLocalVideoFreeze=function($,X){var ie=0,W=0;if(!$||!X)return!1;if(Object(b.isChrome)()||Object(b.isOpera)())ie=$.googFrameRateInput,W=$.googFrameRateSent;else if(Object(b.isSafari)())ie=parseInt($.framerateMean),W=parseInt($.framesEncoded)-parseInt(X.framesEncoded);else{if(!Object(b.isFireFox)())return!1;ie=parseInt($.framerateMean),W=parseInt($.framesEncoded)-parseInt(X.framesEncoded)}return ie>5&&W<3},U.isRemoteVideoFreeze=function($,X){var ie=0,W=0;if(!$||!X)return!1;if(Object(b.isChrome)()||Object(b.isOpera)())ie=$.googFrameRateReceived,W=$.googFrameRateDecoded;else if(Object(b.isSafari)())ie=$.framerateMean,W=parseInt($.framesDecoded)-parseInt(X.framesDecoded);else{if(!Object(b.isFireFox)())return!1;ie=parseInt($.framesReceived)-parseInt(X.framesReceived),W=parseInt($.framesDecoded)-parseInt(X.framesDecoded)}return ie>5&&ie<10&&W<3||ie>10&&ie<20&&W<4||ie>20&&W<5},U.isAudioFreeze=function($){if(Object(b.isChrome)()&&$){if($.googDecodingPLC&&$.googDecodingPLCCNG&&$.googDecodingCTN)return(parseInt($.googDecodingPLC)+parseInt($.googDecodingPLCCNG))/parseInt($.googDecodingCTN)>.2}else if((Object(b.isSafari)()||Object(b.isFireFox)())&&$.packetsLost&&$.packetsReceived)return parseInt($.packetsLost)/(parseInt($.packetsLost)+parseInt($.packetsReceived))>.2;return!1},U.isAudioDecodeFailed=function($){return!!((Object(b.isChrome)()||Object(b.isOpera)())&&$&&parseInt($.bytesReceived)>0&&parseInt($.googDecodingNormal)===0)},U.startNetworkQualityTimer=function(){U.clearNetworkQualityTimer(),U.networkQualityTimer=setInterval(function(){if(U.gatewayClient.state===G.a.CONNECTED&&navigator.onLine){var $=U.gatewayClient.traffic_stats;U.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:U.networkQualityTrans($.uplink_network_quality),downlinkNetworkQuality:U.networkQualityTrans($.downlink_network_quality)})}else U.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3)},U.clearNetworkQualityTimer=function(){U.networkQualityTimer&&clearInterval(U.networkQualityTimer)},U.networkQualityTrans=function($){return $>=0&&$<.17?1:$>=.17&&$<.36?2:$>=.36&&$<.59?3:$>=.59&&$<=1?4:$>1?5:0},U.getStatsTimer=setInterval(function(){var $=U.gatewayClient.traffic_stats,X=Date.now();U.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(U.localStats).length&&U.exceptionMonitor.setLocalStats(U.localStats),Object.keys(U.remoteStats).length&&U.exceptionMonitor.setRemoteStats(U.remoteStats);var ie={};Object.keys(U.gatewayClient.remoteStreams).forEach(function(ne){var se=U.gatewayClient.remoteStreams[ne],ue=U.remoteStats[ne],ae={id:ne,updatedAt:X};ie[ne]=ae,ae.firstFrameTime=se.firstFrameTime,ue?(ae.audioTotalPlayDuration=ue.audioTotalPlayDuration+1,ae.audioTotalFreezeTime=ue.audioTotalFreezeTime,ae.isAudioFreeze=!1,ae.isAudioDecodeFailed=!1,ae.videoTotalPlayDuration=ue.videoTotalPlayDuration+1,ae.videoTotalFreezeTime=ue.videoTotalFreezeTime,ae.isVideoFreeze=!1):(ae.audioTotalPlayDuration=1,ae.audioTotalFreezeTime=0,ae.videoTotalPlayDuration=1,ae.videoTotalFreezeTime=0);var me=$&&$.peer_delay&&$.peer_delay.find(function(ve){return ve.peer_uid==ne});me&&(ae.peer_delay=me),se&&(se.isPlaying()&&(ae.audioDisabled=se.userMuteAudio||se.peerMuteAudio?"1":"0",ae.videoDisabled=se.userMuteVideo||se.peerMuteVideo?"1":"0"),ue&&ue.peer_delay&&me&&ue.peer_delay.stream_type!==me.stream_type&&U.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:ne,streamType:me.stream_type}),se.pc&&se.pc.state=="established"&&se.pc.getStats(function(ve){if(ae.pcStats=ve,ae.audioStats=ve.find(function(be){return be.mediaType=="audio"&&(be.id.indexOf("_recv")>-1||be.id.toLowerCase().indexOf("inbound")>-1)}),ae.videoStats=ve.find(function(be){return be.mediaType=="video"&&(be.id.indexOf("_recv")>-1||be.id.toLowerCase().indexOf("inbound")>-1)}),ue&&ue.audioStats&&ae.audioStats){var Re=parseInt(ae.audioStats.bytesReceived)-parseInt(ue.audioStats.bytesReceived),Ie=parseInt(ae.audioStats.googDecodingNormal)-parseInt(ue.audioStats.googDecodingNormal);if(ae.audioStats.audioRecvBytesDelta=Re,ae.audioStats.audioDecodingNormalDelta=Ie,U.session.recvBytes+=Re,isFinite(Re)&&ae.audioStats.timestamp){var Se=ae.audioStats.timestamp.getTime()-ue.audioStats.timestamp.getTime();ae.audioRecvBitrate=Math.floor(8*Re/Se)}U.isAudioFreeze(ae.audioStats)&&ae.audioTotalPlayDuration>10&&(ae.audioTotalFreezeTime++,ae.isAudioFreeze=!0),U.isAudioDecodeFailed(ae.audioStats)&&ae.audioTotalPlayDuration>10&&(ae.isAudioDecodeFailed=!0),ae.audioStats.audioTotalFreezeTime=ae.audioTotalFreezeTime,ae.audioStats.audioTotalPlayDuration=ae.audioTotalPlayDuration,ae.audioStats.audioFreezeRate=Math.ceil(100*ae.audioTotalFreezeTime/ae.audioTotalPlayDuration)}if(ue&&ue.videoStats&&ae.videoStats){var Te=parseInt(ae.videoStats.bytesReceived)-parseInt(ue.videoStats.bytesReceived);ae.videoStats.videoRecvBytesDelta=Te,U.session.recvBytes+=Te,isFinite(Te)&&ae.videoStats.timestamp&&(Se=ae.videoStats.timestamp.getTime()-ue.videoStats.timestamp.getTime(),ae.videoRecvBitrate=Math.floor(8*Te/Se)),U.isRemoteVideoFreeze(ae.videoStats,ue.videoStats)&&(ae.videoTotalFreezeTime++,ae.isVideoFreeze=!0),ae.videoStats.videoTotalFreezeTime=ae.videoTotalFreezeTime,ae.videoStats.videoTotalPlayDuration=ae.videoTotalPlayDuration,ae.videoStats.videoFreezeRate=Math.ceil(100*ae.videoTotalFreezeTime/ae.videoTotalPlayDuration),se.player&&se.player.video&&se.player.video.videoWidth&&se.player.video.videoHeight?(ae.videoStats.renderRemoteWidth=se.player.video.videoWidth,ae.videoStats.renderRemoteHeight=se.player.video.videoHeight):(ae.videoStats.renderRemoteWidth=se.videoWidth||ae.videoStats.googFrameWidthReceived,ae.videoStats.renderRemoteHeight=se.videoHeight||ae.videoStats.googFrameHeightReceived)}}))}),U.remoteStats=ie;var W={};if(Object.keys(U.gatewayClient.localStreams).forEach(function(ne){var se=U.gatewayClient.localStreams[ne],ue=U.localStats[ne],ae={id:ne,updatedAt:X};W[ne]=ae,ue?(ae.videoTotalPlayDuration=ue.videoTotalPlayDuration+1,ae.videoTotalFreezeTime=ue.videoTotalFreezeTime,ae.isVideoFreeze=!1):(ae.videoTotalPlayDuration=1,ae.videoTotalFreezeTime=0),se&&(se.isPlaying()&&(ae.audioDisabled=se.userMuteAudio?"1":"0",ae.videoDisabled=se.userMuteVideo?"1":"0"),se.video&&se.attributes.maxVideoBW?ae.videoTargetSendBitrate=se.attributes.maxVideoBW:se.video&&se.screenAttributes&&(ae.videoTargetSendBitrate=se.screenAttributes.maxVideoBW),se.pc&&se.pc.state=="established"&&se.pc.getStats(function(me){if(ae.pcStats=me.reverse(),ae.audioStats=me.find(function(Se){return Se.mediaType=="audio"&&(Se.id.indexOf("_send")>-1||Se.id.toLowerCase().indexOf("outbound")>-1)}),ae.videoStats=me.find(function(Se){return Se.mediaType=="video"&&(Se.id.indexOf("_send")>-1||Se.id.toLowerCase().indexOf("outbound")>-1)}),ae.audioStats&&ue&&ue.audioStats){var ve=parseInt(ae.audioStats.bytesSent)-parseInt(ue.audioStats.bytesSent);if(ae.audioStats.audioSendBytesDelta=ve,U.session.sendBytes+=ve,isFinite(ve)&&ae.audioStats.timestamp){var Re=ae.audioStats.timestamp.getTime()-ue.audioStats.timestamp.getTime();ae.audioSendBitrate=Math.floor(8*ve/Re)}}if(ae.videoStats&&ue&&ue.videoStats){var Ie=parseInt(ae.videoStats.bytesSent)-parseInt(ue.videoStats.bytesSent);ae.videoStats.videoSendBytesDelta=Ie,U.session.sendBytes+=Ie,isFinite(Ie)&&ae.videoStats.timestamp&&(Re=ae.videoStats.timestamp.getTime()-ue.videoStats.timestamp.getTime(),ae.videoSendBitrate=Math.floor(8*Ie/Re)),U.isLocalVideoFreeze(ae.videoStats,ue.videoStats)&&(ae.videoTotalFreezeTime++,ae.isVideoFreeze=!0),ae.videoStats.videoTotalFreezeTime=ae.videoTotalFreezeTime,ae.videoStats.videoTotalPlayDuration=ae.videoTotalPlayDuration,ae.videoStats.videoFreezeRate=Math.ceil(100*ae.videoTotalFreezeTime/ae.videoTotalPlayDuration),ae.videoStats.renderLocalWidth=se.videoWidth||ae.videoStats.googFrameWidthSent,ae.videoStats.renderLocalHeight=se.videoHeight||ae.videoStats.googFrameHeightSent}}))}),U.localStats=W,U.session.HTTPSendBytesDelta=Object(L.getHTTPSendBytes)()-U.session.HTTPSendBytes,U.session.HTTPSendBytes=Object(L.getHTTPSendBytes)(),U.session.HTTPRecvBytesDelta=Object(L.getHTTPRecvBytes)()-U.session.HTTPRecvBytes,U.session.HTTPRecvBytes=Object(L.getHTTPRecvBytes)(),U.gatewayClient.socket&&U.gatewayClient.socket.state===U.gatewayClient.CONNECTED){var K=U.gatewayClient.socket;U.session.WSSendBytesDelta=K.getSendBytes()-U.session.WSSendBytes,U.session.WSSendBytes=K.getSendBytes(),U.session.WSRecvBytesDelta=K.getRecvBytes()-U.session.WSRecvBytes,U.session.WSRecvBytes=K.getRecvBytes()}},1e3),U.gatewayClient.on("join",function(){U.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}}),U}(N.gatewayClient),N.configDistributManager=function(u){var U={};return U.client=u,U.client.gatewayClient&&U.client.gatewayClient.on("config-distribute",function($){var X=$.joinInfo,ie=$.config;if(ie){Object(B.isEmpty)(ie.uploadLog)||(Object(m.setParameter)("UPLOAD_LOG",ie.uploadLog),E.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:ie.uploadLog}})()),Object(B.isEmpty)(ie.dualStream)||(u.isDualStream=ie.dualStream,E.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"dualStream",value:ie.dualStream}})()),Object(B.isEmpty)(ie.streamFallbackOption)||U.client.gatewayClient&&U.client.gatewayClient.on("stream-subscribed",function(W){var K=W.stream;K?(U.client.gatewayClient.setStreamFallbackOption(K,ie.streamFallbackOption),E.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:ie.streamFallbackOption,streamId:K.getId()}})()):E.report.reportApiInvoke(X.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:ie.streamFallbackOption,streamId:K.getId(),err:"invalid stream"}})()});try{d.default.debug("[".concat(u.clientId,"] setParameter in distribution: ").concat(JSON.stringify(ie))),Object.keys(ie).map(function(W){return Object(m.setParameter)(W,ie[W])})}catch{d.default.debug("[".concat(u.clientId,"] setParameter in distribution failed: ").concat(JSON.stringify(ie)))}}}),U}(N),Object(Q.addLiveStreamingCapability)(N,te),te.areaCode){var fe=te,Ee=fe.areaCode,he=fe.excludedArea,_e=Object(x.getAreaCodeByConfig)({areaCode:Ee,excludedArea:he});Object(m.setParameter)("AREA_SETTING",_e);var ye=Object(x.getAreaDomainConfig)(_e);Object.keys(ye).map(function(u){var U=ye[u];u=="LOG_UPLOAD_SERVER"||u=="EVENT_REPORT_DOMAIN"||u=="EVENT_REPORT_BACKUP_DOMAIN"||u=="NGINX"?Object(m.setParameter)(u,U[0]):Object(m.setParameter)(u,U)})}return Object(B.isEmpty)(te.turnServer)||N.setTurnServer(te.turnServer),Object(B.isEmpty)(te.proxyServer)||N.setProxyServer(te.proxyServer),N.mode==="live"&&(N.gatewayClient.role="audience"),N.mode==="rtc"&&(N.gatewayClient.role=Z),N.gatewayClient.on("onMultiIP",function(u){N.gatewayClient.closeGateway(),N.gatewayClient.socket=void 0,N.gatewayClient.hasChangeBGPAddress=!0,N.joinInfo.multiIP=u.option,N.gatewayClient.state=G.a.CONNECTING;var U=function($){d.default.info("[".concat(N.clientId,"] Joining channel: ").concat(N.channel)),N.joinInfo.cid=$.cid,N.joinInfo.uid||(N.joinInfo.uid=$.uid),N.joinInfo.uni_lbs_ip=$.uni_lbs_ip,N.joinInfo.gatewayAddr=$.gateway_addr,N.onSuccess?N.gatewayClient.join(N.joinInfo,N.key,function(X){d.default.info("[".concat(N.clientId,"] Join channel ").concat(N.channel," success"));var ie=N.onSuccess;N.onSuccess=null,N.onFailure=null,ie(X)},N.onFailure):(N.gatewayClient.joinInfo=J()({},N.joinInfo),N.gatewayClient.rejoin())};N.joinInfo.stringUid&&!N.joinInfo.uid?(N.userAccountReq&&!N.userAccountReq.isFinished()&&N.userAccountReq.cancel(),N.userAccountReq=Object(_.getUserAccount)(joinInfo,N.gatewayClient),N.userAccountReq.then(function($){d.default.error("getUserAccount Success ".concat($.url," ").concat(joinInfo.stringUid," => ").concat($.uid)),N.joinInfo.uid=$.uid,Object(_.getGatewayList)(N.joinInfo,U,N.onFailure)}).catch(function($){d.default.error("getUserAccount rejected",$),N.onFailure($)})):Object(_.getGatewayList)(N.joinInfo,U,N.onFailure)}),N.gatewayClient.on("rejoin-start",function(){N._renewSession(),E.report.sessionInit(te.sessionId,{lts:new Date().getTime(),extend:{rejoin:!0},cname:N.channel,appid:te.appId,mode:te.mode,succ:!0})}),N.gatewayClient.on("recover",function(){N._renewSession(),d.default.debug("[".concat(N.clientId,"]"),"recover",te.sessionId),E.report.sessionInit(te.sessionId,{lts:new Date().getTime(),extend:{recover:!0},cname:N.channel,appid:te.appId,mode:te.mode,succ:!0})}),N.gatewayClient.on("rejoin",function(){var u=N.highStreamState;if(d.default.debug("[".concat(N.clientId,"] Client local stream preState: ").concat(u)),N.onSuccess){var U=N.onSuccess;N.onSuccess=null,N.onFailure=null,U(N.joinInfo.uid)}!N.highStream||u!==0&&u!==1||(d.default.info("[".concat(N.clientId,"] publish after rejoin")),N.highStreamState=2,N.lowStreamState=2,N.publish(N.highStream,function($){$&&d.default.info("[".concat(N.clientId,"] "),$)}))}),N.gatewayClient.on("streamPublished",function(u){N.hasPublished||(N.hasPublished=!0,N.gatewayClient.dispatchEvent({type:"stream-published",stream:u.stream,proxy:u.proxy}))}),N.gatewayClient.on("pubP2PLost",function(u){d.default.debug("[".concat(N.clientId,"] Start reconnect local peerConnection: ").concat(N.highStream.getId())),N.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:N.highStream.getId()}),N.highStreamState===1&&(N.highStreamState=0,N.lowStreamState=0),N._unpublish(N.highStream,function(){N._publish(N.highStream,function(){d.default.debug("[".concat(N.clientId,"] Reconnect local peerConnection success: ").concat(N.highStream.getId())),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:N.highStream.getId(),success:!0,reason:""})},function(U){d.default.debug("[".concat(N.clientId,"] Reconnect local peerConnection failed: ").concat(U)),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:N.highStream.getId(),success:!1,reason:U})},!0)},function(U){d.default.debug("[".concat(N.clientId,"] Reconnect local peerConnection failed: ").concat(U)),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:N.highStream.getId(),success:!1,reason:U})},!0)}),N.gatewayClient.on("subP2PLost",function(u){d.default.debug("[".concat(N.clientId,"] Start reconnect remote peerConnection: ").concat(u.stream.getId()," ").concat(u.stream.subscribeOptions)),N.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:u.stream.getId()});var U=u.stream.subscribeOptions;d.default.debug("[".concat(N.clientId,"]"),"Re-subscribe stream",JSON.stringify(U)),N.gatewayClient.unsubscribe(u.stream,function(){u.stream.subscribeOptions=U,N.gatewayClient.subscribe(u.stream,function(){d.default.debug("[".concat(N.clientId,"] Reconnect remote peerConnection success: ").concat(u.stream.getId())),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:u.stream.getId(),success:!0,reason:""})},function($){d.default.debug("[".concat(N.clientId,"] Reconnect remote peerConnection failed: "),$),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:u.stream.getId(),success:!1,reason:$})})},function($){d.default.debug("[".concat(N.clientId,"] Reconnect remote peerConnection failed: "),$),N.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:u.stream.getId(),success:!1,reason:$})})}),q.on("networkTypeChanged",function(u){N.gatewayClient&&N.gatewayClient.dispatchEvent(u);var U=J()({},u,{type:"network-type-changed"});N.gatewayClient.dispatchEvent(U)}),l.a.on("recordingDeviceChanged",function(u){N.gatewayClient&&N.gatewayClient.dispatchEvent(u);var U=J()({},u,{type:"recording-device-changed"});N.gatewayClient.dispatchEvent(U)}),l.a.on("playoutDeviceChanged",function(u){N.gatewayClient&&N.gatewayClient.dispatchEvent(u);var U=J()({},u,{type:"playout-device-changed"});N.gatewayClient.dispatchEvent(U)}),l.a.on("cameraChanged",function(u){N.gatewayClient&&N.gatewayClient.dispatchEvent(u);var U=J()({},u,{type:"camera-changed"});N.gatewayClient.dispatchEvent(U)}),N.gatewayClient.on("streamTypeChange",function(u){var U=J()({},u,{type:"stream-type-changed"});N.gatewayClient.dispatchEvent(U),E.report.reportApiInvoke(te.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(u))}),N},de={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},le=function(te){switch(te){case"h264_interop":return"h264";default:return"vp8"}},ce=function(te){return f.indexOf(te.mode)===-1?H.default.INVALID_CLIENT_MODE:C.indexOf(te.codec)===-1?H.default.INVALID_CLIENT_CODEC:te.mode=="h264_interop"&&te.codec!=="h264"&&H.default.CLIENT_MODE_CODEC_MISMATCH},re=function(te){switch(te.mode){case"interop":case"h264_interop":te.mode="live";break;case"web-only":te.mode="rtc"}},ge=l.a.getDevices,o=A.a.getScreenSources,pe=JSON.parse(JSON.stringify(m.SUPPORT_RESOLUTION_LIST));O.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:de,createClient:function(te){var N=E.report.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(te=J()({},te||{})).codec||(te.codec=le(te.mode));var fe=ce(te);if(fe)throw d.default.error("Invalid parameter setting MODE: ".concat(te.mode," CODEC: ").concat(te.codec," ERROR ").concat(fe)),N(fe),new Error(fe);return d.default.info("Creating client, MODE: ".concat(te.mode," CODEC: ").concat(te.codec)),re(te),N(null,te),oe(te)},createStream:a.b,Logger:d.default,report:E.report,getDevices:ge,getScreenSources:o,getParameter:m.getParameter,setParameter:m.setParameter,checkSystemRequirements:g,getSupportedCodec:k.getSupportedCodec,ChannelMediaRelayConfiguration:S.ChannelMediaRelayConfiguration,VERSION:m.VERSION,BUILD:m.BUILD,PROFILE_TABLE:pe,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2,AREAS:x.AREAS,AREA_VERSION:"global"}}]).default})})(AgoraRTCSDK_min);const AgoraRTC=getDefaultExportFromCjs(AgoraRTCSDK_minExports);var eventsExports={},events={get exports(){return eventsExports},set exports(c){eventsExports=c}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function c(O,y,m){return Function.prototype.apply.call(O,y,m)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(O){return Object.getOwnPropertyNames(O).concat(Object.getOwnPropertySymbols(O))}:ReflectOwnKeys=function(O){return Object.getOwnPropertyNames(O)};function ProcessEmitWarning(c){console&&console.warn&&console.warn(c)}var NumberIsNaN=Number.isNaN||function c(O){return O!==O};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;eventsExports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(c){if(typeof c!="number"||c<0||NumberIsNaN(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");defaultMaxListeners=c}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function c(O){if(typeof O!="number"||O<0||NumberIsNaN(O))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+O+".");return this._maxListeners=O,this};function _getMaxListeners(c){return c._maxListeners===void 0?EventEmitter.defaultMaxListeners:c._maxListeners}EventEmitter.prototype.getMaxListeners=function c(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function c(O){for(var y=[],m=1;m<arguments.length;m++)y.push(arguments[m]);var d=O==="error",E=this._events;if(E!==void 0)d=d&&E.error===void 0;else if(!d)return!1;if(d){var p;if(y.length>0&&(p=y[0]),p instanceof Error)throw p;var b=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw b.context=p,b}var s=E[O];if(s===void 0)return!1;if(typeof s=="function")ReflectApply(s,this,y);else for(var g=s.length,i=arrayClone(s,g),m=0;m<g;++m)ReflectApply(i[m],this,y);return!0};function _addListener(c,O,y,m){var d,E,p;if(checkListener(y),E=c._events,E===void 0?(E=c._events=Object.create(null),c._eventsCount=0):(E.newListener!==void 0&&(c.emit("newListener",O,y.listener?y.listener:y),E=c._events),p=E[O]),p===void 0)p=E[O]=y,++c._eventsCount;else if(typeof p=="function"?p=E[O]=m?[y,p]:[p,y]:m?p.unshift(y):p.push(y),d=_getMaxListeners(c),d>0&&p.length>d&&!p.warned){p.warned=!0;var b=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");b.name="MaxListenersExceededWarning",b.emitter=c,b.type=O,b.count=p.length,ProcessEmitWarning(b)}return c}EventEmitter.prototype.addListener=function c(O,y){return _addListener(this,O,y,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function c(O,y){return _addListener(this,O,y,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(c,O,y){var m={fired:!1,wrapFn:void 0,target:c,type:O,listener:y},d=onceWrapper.bind(m);return d.listener=y,m.wrapFn=d,d}EventEmitter.prototype.once=function c(O,y){return checkListener(y),this.on(O,_onceWrap(this,O,y)),this};EventEmitter.prototype.prependOnceListener=function c(O,y){return checkListener(y),this.prependListener(O,_onceWrap(this,O,y)),this};EventEmitter.prototype.removeListener=function c(O,y){var m,d,E,p,b;if(checkListener(y),d=this._events,d===void 0)return this;if(m=d[O],m===void 0)return this;if(m===y||m.listener===y)--this._eventsCount===0?this._events=Object.create(null):(delete d[O],d.removeListener&&this.emit("removeListener",O,m.listener||y));else if(typeof m!="function"){for(E=-1,p=m.length-1;p>=0;p--)if(m[p]===y||m[p].listener===y){b=m[p].listener,E=p;break}if(E<0)return this;E===0?m.shift():spliceOne(m,E),m.length===1&&(d[O]=m[0]),d.removeListener!==void 0&&this.emit("removeListener",O,b||y)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function c(O){var y,m,d;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[O]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[O]),this;if(arguments.length===0){var E=Object.keys(m),p;for(d=0;d<E.length;++d)p=E[d],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(y=m[O],typeof y=="function")this.removeListener(O,y);else if(y!==void 0)for(d=y.length-1;d>=0;d--)this.removeListener(O,y[d]);return this};function _listeners(c,O,y){var m=c._events;if(m===void 0)return[];var d=m[O];return d===void 0?[]:typeof d=="function"?y?[d.listener||d]:[d]:y?unwrapListeners(d):arrayClone(d,d.length)}EventEmitter.prototype.listeners=function c(O){return _listeners(this,O,!0)};EventEmitter.prototype.rawListeners=function c(O){return _listeners(this,O,!1)};EventEmitter.listenerCount=function(c,O){return typeof c.listenerCount=="function"?c.listenerCount(O):listenerCount.call(c,O)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(c){var O=this._events;if(O!==void 0){var y=O[c];if(typeof y=="function")return 1;if(y!==void 0)return y.length}return 0}EventEmitter.prototype.eventNames=function c(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(c,O){for(var y=new Array(O),m=0;m<O;++m)y[m]=c[m];return y}function spliceOne(c,O){for(;O+1<c.length;O++)c[O]=c[O+1];c.pop()}function unwrapListeners(c){for(var O=new Array(c.length),y=0;y<O.length;++y)O[y]=c[y].listener||c[y];return O}function once(c,O){return new Promise(function(y,m){function d(p){c.removeListener(O,E),m(p)}function E(){typeof c.removeListener=="function"&&c.removeListener("error",d),y([].slice.call(arguments))}eventTargetAgnosticAddListener(c,O,E,{once:!0}),O!=="error"&&addErrorHandlerIfEventEmitter(c,d,{once:!0})})}function addErrorHandlerIfEventEmitter(c,O,y){typeof c.on=="function"&&eventTargetAgnosticAddListener(c,"error",O,y)}function eventTargetAgnosticAddListener(c,O,y,m){if(typeof c.on=="function")m.once?c.once(O,y):c.on(O,y);else if(typeof c.addEventListener=="function")c.addEventListener(O,function d(E){m.once&&c.removeEventListener(O,d),y(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}class RTCClient{constructor(){this.option={appId:"",channel:"",uid:"",token:""},this.client=null,this.localStream=null,this._eventBus=new eventsExports}joinChannel(O){return new Promise((y,m)=>{this.client=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),this.client.init(O.appid,()=>{console.log("init success"),this.clientListener(),this.client.join(O.token?O.token:null,O.channel,null,d=>{console.log("join channel: "+this.option.channel+" success, uid: ",d),this.option={appid:O.appid,token:O.token,channel:O.channel,uid:d},y()},d=>{console.error("client join failed",d)})},d=>{m(d),console.error(d)}),console.log("[agora-vue] appId",O.appid)})}publishStreamVideo(){return new Promise((O,y)=>{this.localStream=AgoraRTC.createStream({streamID:this.option.uid,audio:!0,video:!0,screen:!1}),this.localStream.init(()=>{console.log("init local stream success"),O(this.localStream),this.client.publish(this.localStream,m=>{console.log("publish failed"),console.error(m)})},m=>{y(m),console.error("init local stream failed ",m)})})}publishStreamAudio(){return new Promise((O,y)=>{this.localStream=AgoraRTC.createStream({streamID:this.option.uid,audio:!0,video:!1,screen:!1}),this.localStream.init(()=>{console.log("init local audio stream success"),O(this.localStream),this.client.publish(this.localStream,m=>{console.log("publish failed audio"),console.error(m)})},m=>{y(m),console.error("init local stream failed ",m)})})}clientListener(){const O=this.client;O.on("stream-added",y=>{this._eventBus.emit("stream-added",y)}),O.on("stream-subscribed",y=>{this._eventBus.emit("stream-subscribed",y)}),O.on("stream-removed",y=>{this._eventBus.emit("stream-removed",y)}),O.on("peer-online",y=>{this._eventBus.emit("peer-online",y)}),O.on("peer-leave",y=>{this._eventBus.emit("peer-leave",y)})}on(O,y){this._eventBus.on(O,y)}leaveChannel(){return new Promise((O,y)=>{this.client.unpublish(this.localStream,m=>{console.log(m)}),this.client.leave(()=>{this.localStream.isPlaying()&&this.localStream.stop(),this.localStream.close(),this.client=null,O(),console.log("client leaves channel success"),this.localStream=null},m=>{y(m),console.log("channel leave failed"),console.error(m)})})}}const streamPlayerComponent_vue_vue_type_style_index_0_lang="",_sfc_main$6={name:"stream-player",props:["stream","domId","stream_type","id"],mounted(){this.$nextTick(function(){this.stream&&!this.stream.isPlaying()&&this.stream.play(`${this.domId}`,{fit:"cover"},c=>{c&&c.status!=="aborted"&&console.warn("trigger autoplay policy")})})},beforeDestroy(){this.stream&&(this.stream.isPlaying()&&this.stream.stop(),this.stream.close())}},_hoisted_1$5=["id"],_hoisted_2$5=["id"],_hoisted_3$5=createBaseVNode("img",{class:"img-fluid h-100 w-100",src:"/images/microphone.gif",alt:""},null,-1),_hoisted_4$5=[_hoisted_3$5];function _sfc_render$6(c,O,y,m,d,E){return y.stream_type=="video"?(openBlock(),createElementBlock("div",{key:0,class:"agora-video-player",ref:"player",id:y.domId},null,8,_hoisted_1$5)):(openBlock(),createElementBlock("div",{key:1,class:"agora-video-player",ref:"player",id:y.domId},_hoisted_4$5,8,_hoisted_2$5))}const StreamPlayer=_export_sfc(_sfc_main$6,[["render",_sfc_render$6]]),VideoCallComponent_vue_vue_type_style_index_0_scoped_0d048c6c_lang="",_sfc_main$5=defineComponent({components:{Head,ValidationErrors,Link,StreamPlayer},data(){return{option:{appid:"",token:"",channel:""},disableJoin:!1,localStream:null,remoteStreams:[],leftCommunication:!1,incomingCall:!1,disableIncomingJoin:!1,audioPermissionMessage:null,videoPermissionMessage:null,fetched:!1,showStartedButton:!1,autoJoin:!1}},props:["appointment"],methods:{async joinEvent(){if(this.appointment.appointment_status_code==2){if(await this.checkAudioEnabled(),await this.checkCameraPermission(),this.audioPermissionMessage!=null||this.videoPermissionMessage!=null){document.getElementById("permission_button_model").click();return}}else return;var c=this;this.rtc.joinChannel(this.option).then(()=>{this.rtc.publishStreamVideo().then(O=>{this.localStream=O,(this.$page.props.auth.logged_in_as=="lawyer"||this.$page.props.auth.logged_in_as=="law_firm")&&c.sendPushNotification(),c.makeAgoraCall(),c.showStartedButton=!0}).catch(O=>{console.log("publish local error",O)})}).catch(O=>{c.generateAgoraToken(),console.log("join channel error",O)}),this.disableJoin=!0},async makeAgoraCall(){await axios$1.post(this.route("postApiMakeAgoraCall"),{appointment:this.appointment,channel:this.option.channel,token:this.option.token}).then(c=>{})},leaveEvent(){console.log("leave event call"),this.leftCommunication=!0,this.disableJoin=!1,this.rtc.leaveChannel().then(()=>{}).catch(c=>{console.log("leave error",c)}),this.localStream=null,this.remoteStreams=[],this.incomingCall=!1,this.disableIncomingJoin=!1},generateString(c){const O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let y="";const m=O.length;for(let d=0;d<c;d++)y+=O.charAt(Math.floor(Math.random()*m));return y},async generateAgoraToken(){this.option.channel=this.generateString(10),await axios$1.get(this.route("getAgoraToken",{channel:this.option.channel})).then(c=>{this.option.token=c.data.data,this.fetching=!1})},async sendPushNotification(){var c={appointment:this.appointment??null,channel_name:this.option.channel??null,token:this.option.token??null};await axios$1.get(this.route("getApiSendPushNotification",{title:"Video Call from "+this.$page.props.auth.logged_in_as,body:"Please Join the Call",deep_link:"/appointment_log/detail/"+this.appointment.id+"?auth_tocken="+this.option.token+"&channel_name="+this.option.channel,reciever_id:this.appointment.customer_id,payload:c})).then(O=>{this.fetching=!1})},async checkAudioEnabled(){try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(O=>O.stop()),this.audioPermissionMessage=null}catch(c){console.error("Microphone permission denied",c),this.audioPermissionMessage="Audio/Microphone permission denied by system"}},async checkCameraPermission(){try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(O=>O.stop()),this.videoPermissionMessage=null}catch(c){console.error("Camera permission denied",c),this.videoPermissionMessage="Camera permission denied by system"}},checkPermissions(){this.checkAudioEnabled(),this.checkCameraPermission()},updateAppointmentIsStarted(){this.$page.props.auth.logged_in_as=="lawyer"&&axios$1.post(this.route("appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)}),this.$page.props.auth.logged_in_as=="law_firm"&&axios$1.post(this.route("law_firm.appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)})}},async created(){this.fetched=!0,this.$page.props.settings.agora_app_id&&(this.option.appid=this.$page.props.settings.agora_app_id),Echo.private(`make-agora-call.${this.appointment.id}`).listen(".make-agora-call",m=>{console.log(m),this.$page.props.auth.logged_in_as=="customer"&&this.$page.props.auth.user.customer.id==m.customer_id&&(this.option.channel=m.channel,this.option.token=m.token,this.incomingCall=!0)}),this.rtc=new RTCClient;let c=this.rtc;if(c.on("stream-added",m=>{let{stream:d}=m;console.log("[agora] [stream-added] stream-added",d.getId()),c.client.subscribe(d)}),c.on("stream-subscribed",m=>{let{stream:d}=m;console.log("[agora] [stream-subscribed] stream-added",d.getId()),this.remoteStreams.find(E=>E.getId()===d.getId())||this.remoteStreams.push(d)}),c.on("stream-removed",m=>{let{stream:d}=m;console.log("[agora] [stream-removed] stream-removed",d.getId()),this.remoteStreams=this.remoteStreams.filter(E=>E.getId()!==d.getId())}),c.on("peer-online",m=>{console.log(`Peer ${m.uid} is online`)}),c.on("peer-leave",m=>{console.log(`Peer ${m.uid} already leave`),this.remoteStreams=this.remoteStreams.filter(d=>d.getId()!==m.uid)}),this.$page.props.auth.logged_in_as=="lawyer"||this.$page.props.auth.logged_in_as=="law_firm")await this.generateAgoraToken();else if(window.location.href.indexOf("?")>-1){let d=window.location.href.split("?")[1].split("&");var O=d[0].replace("auth_tocken=",""),y=d[1].replace("channel_name=","");this.option.token=O,this.option.channel=y,this.joinEvent(),this.incomingCall=!1,this.autoJoin=!0}}}),_withScopeId$1=c=>(pushScopeId("data-v-0d048c6c"),c=c(),popScopeId(),c),_hoisted_1$4={key:0,class:"row"},_hoisted_2$4=_withScopeId$1(()=>createBaseVNode("div",{class:"col-md-2"},null,-1)),_hoisted_3$4={class:"col-md-10 d-flex justify-content-end flex-wrap"},_hoisted_4$4=["disabled"],_hoisted_5$4=["disabled"],_hoisted_6$4={key:1,class:"col-12"},_hoisted_7$4={key:0,class:"row"},_hoisted_8$4={class:"col-md-6"},_hoisted_9$4={class:"mb-0"},_hoisted_10$4={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_11$4=["disabled"],_hoisted_12$4=["disabled"],_hoisted_13$4={key:1,class:"row"},_hoisted_14$4={class:"col-md-6"},_hoisted_15$4={class:"mb-0"},_hoisted_16$4={key:2,class:"row"},_hoisted_17$4={class:"col-md-6"},_hoisted_18$4={class:"mb-0"},_hoisted_19$4={key:2,class:"col-12 agora-view mt-4"},_hoisted_20$4={class:"row"},_hoisted_21$4={class:"col-md-6"},_hoisted_22$4={class:"agora-video mt-md-0 mt-3"},_hoisted_23$4={class:"col-md-6"},_hoisted_24$4=_withScopeId$1(()=>createBaseVNode("span",{id:"permission_button_model",class:"d-none","data-bs-toggle":"modal","data-bs-target":"#videoCallModal"},null,-1)),_hoisted_25$4={class:"modal fade",id:"videoCallModal",tabindex:"-1","aria-labelledby":"videoCallModalLabel","aria-hidden":"true"},_hoisted_26$4={class:"modal-dialog"},_hoisted_27$4={class:"modal-content"},_hoisted_28$4={class:"modal-header"},_hoisted_29$4={class:"modal-title",id:"videoCallModalLabel"},_hoisted_30$4=_withScopeId$1(()=>createBaseVNode("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),_hoisted_31$4={class:"modal-body"},_hoisted_32$4={key:0,class:"alert alert-danger",role:"alert"},_hoisted_33$4={key:1,class:"alert alert-danger",role:"alert"},_hoisted_34$4={class:"modal-footer"},_hoisted_35$3={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function _sfc_render$5(c,O,y,m,d,E){const p=resolveComponent("stream-player");return openBlock(),createElementBlock(Fragment,null,[c.$page.props.auth.logged_in_as=="lawyer"||c.$page.props.auth.logged_in_as=="law_firm"?(openBlock(),createElementBlock("div",_hoisted_1$4,[_hoisted_2$4,createBaseVNode("div",_hoisted_3$4,[c.fetched&&(!c.audioPermissionMessage||!c.videoPermissionMessage)&&c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("button",{key:0,type:"button",onClick:O[0]||(O[0]=(...b)=>c.joinEvent&&c.joinEvent(...b)),disabled:c.disableJoin,class:"btn btn-primary px-5"},toDisplayString(c.__("Make Call")),9,_hoisted_4$4)):createCommentVNode("",!0),c.disableJoin?(openBlock(),createElementBlock("button",{key:1,type:"button",onClick:O[1]||(O[1]=(...b)=>c.leaveEvent&&c.leaveEvent(...b)),class:"btn btn-danger ms-lg-3 ms-0 px-5",plain:"",disabled:!c.disableJoin},toDisplayString(c.__("leave call")),9,_hoisted_5$4)):createCommentVNode("",!0),c.showStartedButton&&!c.appointment.is_started?(openBlock(),createElementBlock("button",{key:2,type:"button",onClick:O[2]||(O[2]=(...b)=>c.updateAppointmentIsStarted&&c.updateAppointmentIsStarted(...b)),class:"btn btn-primary ms-lg-3 ms-0 px-5",plain:""},toDisplayString(c.__("start appointment")),1)):createCommentVNode("",!0)])])):createCommentVNode("",!0),c.$page.props.auth.logged_in_as=="customer"?(openBlock(),createElementBlock("div",_hoisted_6$4,[c.incomingCall&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_7$4,[createBaseVNode("div",_hoisted_8$4,[createBaseVNode("p",_hoisted_9$4,toDisplayString(c.__("Waiting for Incoming Call")),1)]),createBaseVNode("div",_hoisted_10$4,[c.incomingCall?(openBlock(),createElementBlock("button",{key:0,type:"button",disabled:c.disableIncomingJoin,onClick:O[3]||(O[3]=async()=>{await this.joinEvent(),this.disableIncomingJoin=!0}),class:"btn btn-primary"},toDisplayString(c.__("Join Call")),9,_hoisted_11$4)):createCommentVNode("",!0),c.disableIncomingJoin?(openBlock(),createElementBlock("button",{key:1,type:"button",onClick:O[4]||(O[4]=(...b)=>c.leaveEvent&&c.leaveEvent(...b)),class:"btn btn-danger",plain:"",disabled:!c.disableIncomingJoin},toDisplayString(c.__("leave call")),9,_hoisted_12$4)):createCommentVNode("",!0)])])):!c.incomingCall&&c.appointment.appointment_status_code==2&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_13$4,[createBaseVNode("div",_hoisted_14$4,[createBaseVNode("p",_hoisted_15$4,toDisplayString(c.__("Waiting for Incoming Call")),1)])])):!c.incomingCall&&c.appointment.appointment_status_code==1&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_16$4,[createBaseVNode("div",_hoisted_17$4,[createBaseVNode("p",_hoisted_18$4,toDisplayString(c.__("Waiting for Appointment Acceptance")),1)])])):createCommentVNode("",!0)])):createCommentVNode("",!0),c.localStream?(openBlock(),createElementBlock("div",_hoisted_19$4,[createBaseVNode("div",_hoisted_20$4,[createBaseVNode("div",_hoisted_21$4,[createBaseVNode("div",_hoisted_22$4,[createVNode(p,{stream:c.localStream,domId:c.localStream.getId(),appointment_id:c.appointment.id,id:c.id,stream_type:"video"},null,8,["stream","domId","appointment_id","id"])])]),createBaseVNode("div",_hoisted_23$4,[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.remoteStreams,(b,s)=>(openBlock(),createElementBlock("div",{class:"agora-video mt-md-0 mt-3",key:s},[createVNode(p,{stream:c.remoteStreams[0],domId:c.remoteStreams[0].getId(),appointment_id:c.appointment.id,id:c.id,stream_type:"video"},null,8,["stream","domId","appointment_id","id"])]))),128))])])])):createCommentVNode("",!0),_hoisted_24$4,createBaseVNode("div",_hoisted_25$4,[createBaseVNode("div",_hoisted_26$4,[createBaseVNode("div",_hoisted_27$4,[createBaseVNode("div",_hoisted_28$4,[createBaseVNode("h5",_hoisted_29$4,toDisplayString(c.__("Permission Warning")),1),_hoisted_30$4]),createBaseVNode("div",_hoisted_31$4,[c.audioPermissionMessage?(openBlock(),createElementBlock("div",_hoisted_32$4,toDisplayString(c.audioPermissionMessage),1)):createCommentVNode("",!0),c.videoPermissionMessage?(openBlock(),createElementBlock("div",_hoisted_33$4,toDisplayString(c.videoPermissionMessage),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_34$4,[createBaseVNode("button",_hoisted_35$3,toDisplayString(c.__("close")),1)])])])])],64)}const VideoCallComponent=_export_sfc(_sfc_main$5,[["render",_sfc_render$5],["__scopeId","data-v-0d048c6c"]]),AudioCallComponent_vue_vue_type_style_index_0_scoped_aceb8e67_lang="",_sfc_main$4=defineComponent({components:{Head,ValidationErrors,Link,StreamPlayer},data(){return{option:{appid:"",token:"",channel:""},disableJoin:!1,localStream:null,remoteStreams:[],leftCommunication:!1,incomingCall:!1,disableIncomingJoin:!1,audioPermissionMessage:null,fetched:!1,showStartedButton:!1,autoJoin:!1}},props:["appointment"],methods:{async joinEvent(){if(this.appointment.appointment_status_code==2){if(await this.checkAudioEnabled(),this.audioPermissionMessage!=null){document.getElementById("permission_button_model").click();return}}else return;var c=this;this.rtc.joinChannel(this.option).then(()=>{this.rtc.publishStreamAudio().then(O=>{this.localStream=O,(this.$page.props.auth.logged_in_as=="lawyer"||this.$page.props.auth.logged_in_as=="law_firm")&&c.sendPushNotification(),c.makeAgoraCall(),c.showStartedButton=!0}).catch(O=>{console.log("publish local error",O)})}).catch(O=>{c.generateAgoraToken(),console.log("join channel error",O)}),this.disableJoin=!0},async makeAgoraCall(){await axios.post(this.route("postApiMakeAgoraCall"),{appointment:this.appointment,channel:this.option.channel,token:this.option.token}).then(c=>{})},leaveEvent(){console.log("leave event call"),this.leftCommunication=!0,this.disableJoin=!1,this.rtc.leaveChannel().then(()=>{}).catch(c=>{console.log("leave error",c)}),this.localStream=null,this.incomingCall=!1,this.remoteStreams=[],this.disableIncomingJoin=!1},generateString(c){const O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let y="";const m=O.length;for(let d=0;d<c;d++)y+=O.charAt(Math.floor(Math.random()*m));return y},async generateAgoraToken(){this.option.channel=this.generateString(10),await axios.get(this.route("getAgoraToken",{channel:this.option.channel})).then(c=>{this.option.token=c.data.data,this.fetching=!1})},async sendPushNotification(){var c={appointment:this.appointment??null,channel_name:this.option.channel??null,token:this.option.token??null};console.log('/appointment_log/detail/"+ this.appointment.id +"?auth_tocken=" + this.option.token + "&channel_name=" + this.option.channel',"/appointment_log/detail/"+this.appointment.id+"?auth_tocken="+this.option.token+"&channel_name="+this.option.channel),await axios.get(this.route("getApiSendPushNotification",{title:"Audio Call from "+this.$page.props.auth.logged_in_as,body:"Please Join the Call",deep_link:"/appointment_log/detail/"+this.appointment.id+"?auth_tocken="+this.option.token+"&channel_name="+this.option.channel,reciever_id:this.appointment.customer_id,payload:c})).then(O=>{this.fetching=!1})},async checkAudioEnabled(){try{const c=await navigator.mediaDevices.getUserMedia({audio:!0});c.getTracks().forEach(O=>O.stop()),this.audioPermissionMessage=null,console.log("Microphone permission granted",c)}catch(c){console.error("Microphone permission denied",c),this.audioPermissionMessage="Audio/Microphone permission denied by system"}},checkPermissions(){this.checkAudioEnabled()},updateAppointmentIsStarted(){this.$page.props.auth.logged_in_as=="lawyer"&&axios.post(this.route("appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)}),this.$page.props.auth.logged_in_as=="law_firm"&&axios.post(this.route("law_firm.appointment_detail.updateStarted",{appointment_id:this.appointment.id})).then(c=>{c.data.success&&(this.$emit("showCompletedButton"),this.showStartedButton=!1)})}},async created(){this.fetched=!0,this.$page.props.settings.agora_app_id&&(this.option.appid=this.$page.props.settings.agora_app_id),Echo.private(`make-agora-call.${this.appointment.id}`).listen(".make-agora-call",m=>{console.log(m),this.$page.props.auth.logged_in_as=="customer"&&this.$page.props.auth.user.customer.id==m.customer_id&&(this.option.channel=m.channel,this.option.token=m.token,this.incomingCall=!0)}),this.rtc=new RTCClient;let c=this.rtc;if(c.on("stream-added",m=>{let{stream:d}=m;console.log("[agora] [stream-added] stream-added",d.getId()),c.client.subscribe(d)}),c.on("stream-subscribed",m=>{let{stream:d}=m;console.log("[agora] [stream-subscribed] stream-added",d.getId()),this.remoteStreams.find(E=>E.getId()===d.getId())||this.remoteStreams.push(d)}),c.on("stream-removed",m=>{let{stream:d}=m;console.log("[agora] [stream-removed] stream-removed",d.getId()),this.remoteStreams=this.remoteStreams.filter(E=>E.getId()!==d.getId())}),c.on("peer-online",m=>{console.log(`Peer ${m.uid} is online`)}),c.on("peer-leave",m=>{console.log(`Peer ${m.uid} already leave`),this.remoteStreams=this.remoteStreams.filter(d=>d.getId()!==m.uid)}),this.$page.props.auth.logged_in_as=="lawyer"||this.$page.props.auth.logged_in_as=="law_firm")await this.generateAgoraToken();else if(window.location.href.indexOf("?")>-1){let d=window.location.href.split("?")[1].split("&");var O=d[0].replace("auth_tocken=",""),y=d[1].replace("channel_name=","");this.option.token=O,this.option.channel=y,this.joinEvent(),this.incomingCall=!1,this.autoJoin=!0}}}),_withScopeId=c=>(pushScopeId("data-v-aceb8e67"),c=c(),popScopeId(),c),_hoisted_1$3={key:0,class:"row"},_hoisted_2$3=_withScopeId(()=>createBaseVNode("div",{class:"col-md-2"},null,-1)),_hoisted_3$3={class:"col-md-10 d-flex justify-content-end flex-wrap"},_hoisted_4$3=["disabled"],_hoisted_5$3=["disabled"],_hoisted_6$3={key:1,class:"col-12"},_hoisted_7$3={key:0,class:"row"},_hoisted_8$3={class:"col-md-6"},_hoisted_9$3={class:"mb-0"},_hoisted_10$3={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_11$3=["disabled"],_hoisted_12$3=["disabled"],_hoisted_13$3={key:1,class:"row"},_hoisted_14$3={class:"col-md-6"},_hoisted_15$3={class:"mb-0"},_hoisted_16$3={key:2,class:"row"},_hoisted_17$3={class:"col-md-6"},_hoisted_18$3={class:"mb-0"},_hoisted_19$3={key:2,class:"col-12 agora-view mt-4"},_hoisted_20$3={class:"row"},_hoisted_21$3={class:"col-md-6"},_hoisted_22$3={class:"agora-video mt-md-0 mt-3"},_hoisted_23$3={class:"col-md-6"},_hoisted_24$3=_withScopeId(()=>createBaseVNode("span",{id:"permission_button_model",class:"d-none","data-bs-toggle":"modal","data-bs-target":"#audioCallModel"},null,-1)),_hoisted_25$3={class:"modal fade",id:"audioCallModel",tabindex:"-1","aria-labelledby":"audioCallModelLabel","aria-hidden":"true"},_hoisted_26$3={class:"modal-dialog"},_hoisted_27$3={class:"modal-content"},_hoisted_28$3={class:"modal-header"},_hoisted_29$3={class:"modal-title",id:"audioCallModelLabel"},_hoisted_30$3=_withScopeId(()=>createBaseVNode("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),_hoisted_31$3={class:"modal-body"},_hoisted_32$3={key:0,class:"alert alert-danger",role:"alert"},_hoisted_33$3={class:"modal-footer"},_hoisted_34$3={type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function _sfc_render$4(c,O,y,m,d,E){const p=resolveComponent("stream-player");return openBlock(),createElementBlock(Fragment,null,[c.$page.props.auth.logged_in_as=="lawyer"||c.$page.props.auth.logged_in_as=="law_firm"?(openBlock(),createElementBlock("div",_hoisted_1$3,[_hoisted_2$3,createBaseVNode("div",_hoisted_3$3,[c.fetched&&!c.audioPermissionMessage&&c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("button",{key:0,type:"button",onClick:O[0]||(O[0]=(...b)=>c.joinEvent&&c.joinEvent(...b)),disabled:c.disableJoin,class:"btn btn-primary px-5"},toDisplayString(c.__("make audio call")),9,_hoisted_4$3)):createCommentVNode("",!0),c.disableJoin?(openBlock(),createElementBlock("button",{key:1,type:"button",onClick:O[1]||(O[1]=(...b)=>c.leaveEvent&&c.leaveEvent(...b)),class:"btn btn-danger ms-lg-3 ms-0 px-5",plain:"",disabled:!c.disableJoin},toDisplayString(c.__("leave call")),9,_hoisted_5$3)):createCommentVNode("",!0),c.showStartedButton&&!c.appointment.is_started?(openBlock(),createElementBlock("button",{key:2,type:"button",onClick:O[2]||(O[2]=(...b)=>c.updateAppointmentIsStarted&&c.updateAppointmentIsStarted(...b)),class:"btn btn-primary ms-lg-3 ms-0 px-5",plain:""},toDisplayString(c.__("start appointment")),1)):createCommentVNode("",!0)])])):createCommentVNode("",!0),c.$page.props.auth.logged_in_as=="customer"?(openBlock(),createElementBlock("div",_hoisted_6$3,[c.incomingCall&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_7$3,[createBaseVNode("div",_hoisted_8$3,[createBaseVNode("p",_hoisted_9$3,toDisplayString(c.__("Waiting for Incoming Call")),1)]),createBaseVNode("div",_hoisted_10$3,[c.incomingCall?(openBlock(),createElementBlock("button",{key:0,type:"button",disabled:c.disableIncomingJoin,onClick:O[3]||(O[3]=async()=>{await this.joinEvent(),this.disableIncomingJoin=!0}),class:"btn btn-primary"},toDisplayString(c.__("Join Call")),9,_hoisted_11$3)):createCommentVNode("",!0),c.disableIncomingJoin?(openBlock(),createElementBlock("button",{key:1,type:"button",onClick:O[4]||(O[4]=(...b)=>c.leaveEvent&&c.leaveEvent(...b)),class:"btn btn-danger",plain:"",disabled:!c.disableIncomingJoin},toDisplayString(c.__("leave call")),9,_hoisted_12$3)):createCommentVNode("",!0)])])):!c.incomingCall&&c.appointment.appointment_status_code==2&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_13$3,[createBaseVNode("div",_hoisted_14$3,[createBaseVNode("p",_hoisted_15$3,toDisplayString(c.__("Waiting for Incoming Call")),1)])])):!c.incomingCall&&c.appointment.appointment_status_code==1&&!c.autoJoin?(openBlock(),createElementBlock("div",_hoisted_16$3,[createBaseVNode("div",_hoisted_17$3,[createBaseVNode("p",_hoisted_18$3,toDisplayString(c.__("Waiting for Appointment Acceptance")),1)])])):createCommentVNode("",!0)])):createCommentVNode("",!0),c.localStream?(openBlock(),createElementBlock("div",_hoisted_19$3,[createBaseVNode("div",_hoisted_20$3,[createBaseVNode("div",_hoisted_21$3,[createBaseVNode("div",_hoisted_22$3,[createVNode(p,{stream:c.localStream,domId:c.localStream.getId(),appointment_id:c.appointment.id,id:c.id,stream_type:"audio"},null,8,["stream","domId","appointment_id","id"])])]),createBaseVNode("div",_hoisted_23$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.remoteStreams,(b,s)=>(openBlock(),createElementBlock("div",{class:"agora-video mt-md-0 mt-3",key:s},[createVNode(p,{stream:c.remoteStreams[0],domId:c.remoteStreams[0].getId(),appointment_id:c.appointment.id,id:c.id,stream_type:"audio"},null,8,["stream","domId","appointment_id","id"])]))),128))])])])):createCommentVNode("",!0),_hoisted_24$3,createBaseVNode("div",_hoisted_25$3,[createBaseVNode("div",_hoisted_26$3,[createBaseVNode("div",_hoisted_27$3,[createBaseVNode("div",_hoisted_28$3,[createBaseVNode("h5",_hoisted_29$3,toDisplayString(c.__("Permission Warning")),1),_hoisted_30$3]),createBaseVNode("div",_hoisted_31$3,[c.audioPermissionMessage?(openBlock(),createElementBlock("div",_hoisted_32$3,toDisplayString(c.audioPermissionMessage),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_33$3,[createBaseVNode("button",_hoisted_34$3,toDisplayString(c.__("close")),1)])])])])],64)}const AudioCallComponent=_export_sfc(_sfc_main$4,[["render",_sfc_render$4],["__scopeId","data-v-aceb8e67"]]),_sfc_main$3=defineComponent({components:{Head,AppLayout,AudioCallComponent,VideoCallComponent,ChatComponent,ValidationErrors,Link,Breadcrums},props:["appointment"],computed:{userRating(){var c=this.appointment.ratings.find(O=>O.fromable_type==this.$page.props.auth.logged_in_as&&O.fromable_id==this.$page.props.auth.user[this.$page.props.auth.logged_in_as].id);return c}},data(){return{appointmentStatusForm:this.$inertia.form({appointment_id:this.appointment.id,status_code:""}),form:this.$inertia.form({comment:"",rating:0,lawyer_id:this.appointment.lawyer_id,booked_appointment_id:this.appointment.id}),showMarkedAsCompletedButton:!1,breadcrums:[{id:1,name:"Home",link:"/"},{id:2,name:"My Appointments",link:"/appointment_log"},{id:3,name:"Appointment Detail",link:""}]}},async created(){this.appointment.is_started&&(this.showMarkedAsCompletedButton=!0)},methods:{close(){document.getElementById("close").click()},resetForm(){this.form=this.$inertia.form({comment:"",rating:0})},setRating(c){this.form.rating=c},updateAppointmentStatus(c){this.appointmentStatusForm.status_code=c,this.appointmentStatusForm.transform(O=>({...O})).post(this.route("appointment_detail.updateStatus"),{onSuccess:()=>{c==5&&document.getElementById("rate_now_button").click()}})},submit(){this.form.post(this.route("add_appointment_rating"),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{const c=document.querySelector(".modal-backdrop");c&&c.classList.remove("modal-backdrop"),this.resetForm()}})}}}),_hoisted_1$2={class:"container-fluid py-5 border-bottom border-dark"},_hoisted_2$2={class:"row"},_hoisted_3$2={class:"col-12"},_hoisted_4$2={class:"fs-2 text-center"},_hoisted_5$2={class:"fw-normal"},_hoisted_6$2={class:"fw-bold"},_hoisted_7$2={class:"section py-5"},_hoisted_8$2={class:"container"},_hoisted_9$2={class:"px-4 mb-0 rounded py-4",style:{"background-color":"#fff3db"}},_hoisted_10$2={key:0,class:"row"},_hoisted_11$2={class:"col-md-6"},_hoisted_12$2={class:"mb-0"},_hoisted_13$2={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_14$2={key:1,class:"row"},_hoisted_15$2={class:"col-md-6"},_hoisted_16$2={class:"mb-0"},_hoisted_17$2={key:2},_hoisted_18$2={key:3},_hoisted_19$2={key:4},_hoisted_20$2={key:5,class:"row justify-content-end"},_hoisted_21$2={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_22$2={key:0,class:"mt-4"},_hoisted_23$2={class:"mb-0 rounded",style:{"background-color":"#fff3db"}},_hoisted_24$2={key:0},_hoisted_25$2={class:"col-md-4 d-flex"},_hoisted_26$2={class:"d-flex align-items-center mb-3"},_hoisted_27$2={class:"mb-0 text-capitalize"},_hoisted_28$2={class:"row"},_hoisted_29$2={class:"col-12"},_hoisted_30$2={class:"pt-4"},_hoisted_31$2={class:"row"},_hoisted_32$2={class:"col-md-4 d-flex"},_hoisted_33$2={class:"d-flex align-items-center mb-3"},_hoisted_34$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-calendar-x fs-1 text-primary"})],-1),_hoisted_35$2={class:"mb-0 text-capitalize"},_hoisted_36$2={class:"col-md-4 d-flex"},_hoisted_37$2={class:"d-flex align-items-center mb-3"},_hoisted_38$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-calendar-x fs-1 text-primary"})],-1),_hoisted_39$2={class:"mb-0 text-capitalize"},_hoisted_40$2={class:"col-md-4 d-flex"},_hoisted_41$2={class:"d-flex align-items-center mb-3"},_hoisted_42$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_43$2={class:"mb-0 text-capitalize"},_hoisted_44$2={class:"col-md-4 d-flex"},_hoisted_45$2={class:"d-flex align-items-center mb-3"},_hoisted_46$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_47$2={class:"mb-0 text-capitalize"},_hoisted_48$2={class:"col-md-4 d-flex"},_hoisted_49$2={class:"d-flex align-items-center mb-3"},_hoisted_50$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-person-circle fs-1 text-primary"})],-1),_hoisted_51$2={class:"mb-0 text-capitalize"},_hoisted_52$2={class:"col-md-4 d-flex"},_hoisted_53$2={class:"d-flex align-items-center mb-3"},_hoisted_54$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clipboard-check fs-1 text-primary"})],-1),_hoisted_55$2={class:"mb-0 text-capitalize"},_hoisted_56$2={class:"col-md-4 d-flex"},_hoisted_57$2={class:"d-flex align-items-center mb-3"},_hoisted_58$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-webcam fs-1 text-primary"})],-1),_hoisted_59$2={class:"mb-0 text-capitalize"},_hoisted_60$2={class:"col-md-4 d-flex"},_hoisted_61$2={class:"d-flex align-items-center mb-3"},_hoisted_62$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-check2-square fs-1 text-primary"})],-1),_hoisted_63$2={class:"mb-0 text-capitalize"},_hoisted_64$2={class:"col-md-4 d-flex"},_hoisted_65$2={class:"d-flex align-items-center mb-3"},_hoisted_66$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-coin fs-1 text-primary"})],-1),_hoisted_67$2={class:"mb-0 text-capitalize"},_hoisted_68$2={class:"col-md-4 d-flex"},_hoisted_69$2={class:"d-flex align-items-center mb-3"},_hoisted_70$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-question-circle fs-1 text-primary"})],-1),_hoisted_71$2={class:"mb-0 text-capitalize"},_hoisted_72$2={class:"col-md-4 d-flex"},_hoisted_73$2={class:"d-flex align-items-center mb-3"},_hoisted_74$2=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-file-earmark-post fs-1 text-primary"})],-1),_hoisted_75$2={class:"mb-0 text-capitalize"},_hoisted_76$2=["src"],_hoisted_77$2={key:1},_hoisted_78$2={key:0},_hoisted_79$2={class:"col-md-4 d-flex"},_hoisted_80$2={class:"d-flex align-items-center mb-3"},_hoisted_81$2={class:"mb-0 text-capitalize"},_hoisted_82$2={class:"modal fade",id:"ratingModel",tabindex:"-1","aria-labelledby":"ratingModelLabel","aria-hidden":"true"},_hoisted_83$2={class:"modal-dialog"},_hoisted_84$2={class:"modal-content"},_hoisted_85$2={class:"modal-header"},_hoisted_86$2={class:"modal-title",id:"ratingModelLabel"},_hoisted_87$2=createBaseVNode("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),_hoisted_88$2={class:"modal-body"},_hoisted_89$1={for:"rating"},_hoisted_90$1={class:"rating text-center fs-3 text-warning"},_hoisted_91$1={class:"form-group"},_hoisted_92$1={for:"comment"},_hoisted_93$1={key:0},_hoisted_94$1={class:"modal-footer"},_hoisted_95$1={type:"button",class:"btn btn-secondary",id:"close","data-bs-dismiss":"modal"};function _sfc_render$3(c,O,y,m,d,E){const p=resolveComponent("breadcrums"),b=resolveComponent("video-call-component"),s=resolveComponent("audio-call-component"),g=resolveComponent("chat-component"),i=resolveComponent("star-rating");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("h2",_hoisted_4$2,[createBaseVNode("span",_hoisted_5$2,toDisplayString(c.__("Hello"))+" "+toDisplayString(c.$page.props.auth.user.name)+" | ",1),createBaseVNode("span",_hoisted_6$2,toDisplayString(c.__("appointment detail")),1)])]),createVNode(p,{breadcrums:c.breadcrums},null,8,["breadcrums"])])]),createBaseVNode("div",_hoisted_7$2,[createBaseVNode("div",_hoisted_8$2,[createBaseVNode("div",_hoisted_9$2,[c.appointment.appointment_status_code==1?(openBlock(),createElementBlock("div",_hoisted_10$2,[createBaseVNode("div",_hoisted_11$2,[createBaseVNode("p",_hoisted_12$2,toDisplayString(c.__("Please accept the appointment from customer")),1)]),createBaseVNode("div",_hoisted_13$2,[createBaseVNode("button",{type:"updatenStatus",onClick:O[0]||(O[0]=a=>c.updateAppointmentStatus(2)),class:"btn btn-primary me-lg-3 me-0 px-5"},toDisplayString(c.__("accept")),1),createBaseVNode("button",{type:"button",onClick:O[1]||(O[1]=a=>c.updateAppointmentStatus(3)),class:"btn btn-danger px-5"},toDisplayString(c.__("reject")),1)])])):createCommentVNode("",!0),c.appointment.appointment_status_code==5?(openBlock(),createElementBlock("div",_hoisted_14$2,[createBaseVNode("div",_hoisted_15$2,[createBaseVNode("p",_hoisted_16$2,toDisplayString(c.__("Appointment has been completed")),1)])])):createCommentVNode("",!0),c.appointment.appointment_type_id==1&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_17$2,[createVNode(b,{onShowCompletedButton:O[2]||(O[2]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==2&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_18$2,[createVNode(s,{onShowCompletedButton:O[3]||(O[3]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==3&&c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("div",_hoisted_19$2,[createVNode(g,{onShowCompletedButton:O[4]||(O[4]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.showMarkedAsCompletedButton?(openBlock(),createElementBlock("div",_hoisted_20$2,[createBaseVNode("div",_hoisted_21$2,[c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("div",_hoisted_22$2,[createBaseVNode("button",{type:"updatenStatus",onClick:O[5]||(O[5]=a=>c.updateAppointmentStatus(5)),class:"btn btn-primary px-5"},toDisplayString(c.__("mark as complete")),1)])):createCommentVNode("",!0)])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_23$2,[c.appointment.appointment_status_code==5&&c.userRating?(openBlock(),createElementBlock("div",_hoisted_24$2,[createBaseVNode("div",_hoisted_25$2,[createBaseVNode("div",_hoisted_26$2,[createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_27$2,toDisplayString(c.__("your feedback")),1),createBaseVNode("b",null,toDisplayString(c.__("rating"))+": ",1),createVNode(i,{rating:c.userRating.rating,"star-size":20,"read-only":!0,increment:.01,"show-rating":!1},null,8,["rating","increment"]),createBaseVNode("b",null,toDisplayString(c.__("comment"))+": ",1),createTextVNode(" "+toDisplayString(c.userRating.comment),1)])])])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_28$2,[createBaseVNode("div",_hoisted_29$2,[createBaseVNode("div",_hoisted_30$2,[createBaseVNode("div",_hoisted_31$2,[createBaseVNode("div",_hoisted_32$2,[createBaseVNode("div",_hoisted_33$2,[_hoisted_34$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_35$2,toDisplayString(c.__("appointment"))+" # ",1),createBaseVNode("span",null,toDisplayString(c.appointment.id),1)])])]),createBaseVNode("div",_hoisted_36$2,[createBaseVNode("div",_hoisted_37$2,[_hoisted_38$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_39$2,toDisplayString(c.__("booking date")),1),createBaseVNode("span",null,toDisplayString(c.appointment.date),1)])])]),createBaseVNode("div",_hoisted_40$2,[createBaseVNode("div",_hoisted_41$2,[_hoisted_42$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_43$2,toDisplayString(c.__("start time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.start_time),1)])])]),createBaseVNode("div",_hoisted_44$2,[createBaseVNode("div",_hoisted_45$2,[_hoisted_46$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_47$2,toDisplayString(c.__("end time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.end_time),1)])])]),createBaseVNode("div",_hoisted_48$2,[createBaseVNode("div",_hoisted_49$2,[_hoisted_50$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_51$2,toDisplayString(c.__("customer")),1),createBaseVNode("span",null,toDisplayString(c.appointment.customer_name),1)])])]),createBaseVNode("div",_hoisted_52$2,[createBaseVNode("div",_hoisted_53$2,[_hoisted_54$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_55$2,toDisplayString(c.__("appointment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_status_name),1)])])]),createBaseVNode("div",_hoisted_56$2,[createBaseVNode("div",_hoisted_57$2,[_hoisted_58$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_59$2,toDisplayString(c.__("appointment type")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_type_name),1)])])]),createBaseVNode("div",_hoisted_60$2,[createBaseVNode("div",_hoisted_61$2,[_hoisted_62$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_63$2,toDisplayString(c.__("payment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.is_paid?c.__("paid"):c.__("un Paid")),1)])])]),createBaseVNode("div",_hoisted_64$2,[createBaseVNode("div",_hoisted_65$2,[_hoisted_66$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_67$2,toDisplayString(c.__("fee")),1),createBaseVNode("span",null,toDisplayString(c.getDisplayAmount(c.appointment.fee)),1)])])]),createBaseVNode("div",_hoisted_68$2,[createBaseVNode("div",_hoisted_69$2,[_hoisted_70$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_71$2,toDisplayString(c.__("question")),1),createBaseVNode("span",null,toDisplayString(c.appointment.question),1)])])]),createBaseVNode("div",_hoisted_72$2,[createBaseVNode("div",_hoisted_73$2,[_hoisted_74$2,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_75$2,toDisplayString(c.__("attachment")),1),c.appointment.attachment_url?(openBlock(),createElementBlock("img",{key:0,src:c.appointment.attachment_url,height:"100",width:"100",alt:""},null,8,_hoisted_76$2)):(openBlock(),createElementBlock("span",_hoisted_77$2,toDisplayString(c.__("n/a")),1))])])]),c.appointment.appointment_status_code==5&&c.userRating?(openBlock(),createElementBlock("div",_hoisted_78$2,[createBaseVNode("div",_hoisted_79$2,[createBaseVNode("div",_hoisted_80$2,[createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_81$2,toDisplayString(c.__("your feedback")),1),createBaseVNode("b",null,toDisplayString(c.__("rating"))+": ",1),createVNode(i,{rating:c.userRating.rating,"star-size":20,"read-only":!0,increment:.01,"show-rating":!1},null,8,["rating","increment"]),createBaseVNode("b",null,toDisplayString(c.__("comment"))+": ",1),createTextVNode(" "+toDisplayString(c.userRating.comment),1)])])])])):createCommentVNode("",!0)])])])]),createBaseVNode("div",_hoisted_82$2,[createBaseVNode("div",_hoisted_83$2,[createBaseVNode("div",_hoisted_84$2,[createBaseVNode("div",_hoisted_85$2,[createBaseVNode("h5",_hoisted_86$2,toDisplayString(c.__("rate now")),1),_hoisted_87$2]),createBaseVNode("div",_hoisted_88$2,[createBaseVNode("label",_hoisted_89$1,toDisplayString(c.__("rating"))+":",1),createBaseVNode("div",_hoisted_90$1,[createVNode(i,{modelValue:c.form.rating,"onUpdate:modelValue":O[6]||(O[6]=a=>c.form.rating=a),"onUpdate:rating":c.setRating,"star-size":25},null,8,["modelValue","onUpdate:rating"])]),createBaseVNode("div",_hoisted_91$1,[createBaseVNode("label",_hoisted_92$1,toDisplayString(c.__("comment"))+":",1),withDirectives(createBaseVNode("textarea",{"onUpdate:modelValue":O[7]||(O[7]=a=>c.form.comment=a),class:"form-control",id:"",cols:"30",rows:"3"},null,512),[[vModelText,c.form.comment]]),c.form.errors.comment?(openBlock(),createElementBlock("span",_hoisted_93$1,toDisplayString(c.form.errors.comment),1)):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_94$1,[createBaseVNode("button",_hoisted_95$1,toDisplayString(c.__("close")),1),createBaseVNode("button",{type:"button",onClick:O[8]||(O[8]=(...a)=>c.submit&&c.submit(...a)),class:"btn btn-primary"},toDisplayString(c.__("submit")),1)])])])])])])])}const LawyerAppointmentDetail=_export_sfc(_sfc_main$3,[["render",_sfc_render$3]]),_sfc_main$2=defineComponent({components:{Head,AppLayout,AudioCallComponent,VideoCallComponent,ChatComponent,ValidationErrors,Link,Breadcrums},props:["appointment"],computed:{userRating(){var c=this.appointment.ratings.find(O=>O.fromable_type==this.$page.props.auth.logged_in_as&&O.fromable_id==this.$page.props.auth.user[this.$page.props.auth.logged_in_as].id);return c}},data(){return{appointmentStatusForm:this.$inertia.form({appointment_id:this.appointment.id,status_code:""}),form:this.$inertia.form({comment:"",rating:0,lawyer_id:this.appointment.lawyer_id,booked_appointment_id:this.appointment.id}),showMarkedAsCompletedButton:!1,breadcrums:[{id:1,name:"Home",link:"/"},{id:2,name:"My Appointments",link:"/appointment_log"},{id:3,name:"Appointment Detail",link:""}]}},async created(){this.appointment.is_started&&(this.showMarkedAsCompletedButton=!0)},methods:{close(){document.getElementById("close").click()},resetForm(){this.form=this.$inertia.form({comment:"",rating:0})},setRating(c){this.form.rating=c},updateAppointmentStatus(c){this.appointmentStatusForm.status_code=c,this.appointmentStatusForm.transform(O=>({...O})).post(this.route("law_firm.appointment_detail.updateStatus"),{onSuccess:()=>{c==5&&document.getElementById("rate_now_button").click()}})},submit(){this.form.post(this.route("add_appointment_rating"),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{const c=document.querySelector(".modal-backdrop");c&&c.classList.remove("modal-backdrop"),this.resetForm()}})}}}),_hoisted_1$1={class:"container-fluid py-5 border-bottom border-dark"},_hoisted_2$1={class:"row"},_hoisted_3$1={class:"col-12"},_hoisted_4$1={class:"fs-2 text-center"},_hoisted_5$1={class:"fw-normal"},_hoisted_6$1={class:"fw-bold"},_hoisted_7$1={class:"section py-5"},_hoisted_8$1={class:"container"},_hoisted_9$1={class:"px-4 mb-0 rounded py-4",style:{"background-color":"#fff3db"}},_hoisted_10$1={key:0,class:"row"},_hoisted_11$1={class:"col-md-6"},_hoisted_12$1={class:"mb-0"},_hoisted_13$1={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_14$1={key:1,class:"row"},_hoisted_15$1={class:"col-md-6"},_hoisted_16$1={class:"mb-0"},_hoisted_17$1={key:2},_hoisted_18$1={key:3},_hoisted_19$1={key:4},_hoisted_20$1={key:5,class:"row justify-content-end"},_hoisted_21$1={class:"col-md-6 d-flex justify-content-end flex-wrap"},_hoisted_22$1={key:0,class:"mt-4"},_hoisted_23$1={class:"mb-0 rounded",style:{"background-color":"#fff3db"}},_hoisted_24$1={key:0},_hoisted_25$1={class:"col-md-4 d-flex"},_hoisted_26$1={class:"d-flex align-items-center mb-3"},_hoisted_27$1={class:"mb-0 text-capitalize"},_hoisted_28$1={class:"row"},_hoisted_29$1={class:"col-12"},_hoisted_30$1={class:"pt-4"},_hoisted_31$1={class:"row"},_hoisted_32$1={class:"col-md-4 d-flex"},_hoisted_33$1={class:"d-flex align-items-center mb-3"},_hoisted_34$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-calendar-x fs-1 text-primary"})],-1),_hoisted_35$1={class:"mb-0 text-capitalize"},_hoisted_36$1={class:"col-md-4 d-flex"},_hoisted_37$1={class:"d-flex align-items-center mb-3"},_hoisted_38$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-calendar-x fs-1 text-primary"})],-1),_hoisted_39$1={class:"mb-0 text-capitalize"},_hoisted_40$1={class:"col-md-4 d-flex"},_hoisted_41$1={class:"d-flex align-items-center mb-3"},_hoisted_42$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_43$1={class:"mb-0 text-capitalize"},_hoisted_44$1={class:"col-md-4 d-flex"},_hoisted_45$1={class:"d-flex align-items-center mb-3"},_hoisted_46$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_47$1={class:"mb-0 text-capitalize"},_hoisted_48$1={class:"col-md-4 d-flex"},_hoisted_49$1={class:"d-flex align-items-center mb-3"},_hoisted_50$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-person-circle fs-1 text-primary"})],-1),_hoisted_51$1={class:"mb-0 text-capitalize"},_hoisted_52$1={class:"col-md-4 d-flex"},_hoisted_53$1={class:"d-flex align-items-center mb-3"},_hoisted_54$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clipboard-check fs-1 text-primary"})],-1),_hoisted_55$1={class:"mb-0 text-capitalize"},_hoisted_56$1={class:"col-md-4 d-flex"},_hoisted_57$1={class:"d-flex align-items-center mb-3"},_hoisted_58$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-webcam fs-1 text-primary"})],-1),_hoisted_59$1={class:"mb-0 text-capitalize"},_hoisted_60$1={class:"col-md-4 d-flex"},_hoisted_61$1={class:"d-flex align-items-center mb-3"},_hoisted_62$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-check2-square fs-1 text-primary"})],-1),_hoisted_63$1={class:"mb-0 text-capitalize"},_hoisted_64$1={class:"col-md-4 d-flex"},_hoisted_65$1={class:"d-flex align-items-center mb-3"},_hoisted_66$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-coin fs-1 text-primary"})],-1),_hoisted_67$1={class:"mb-0 text-capitalize"},_hoisted_68$1={class:"col-md-4 d-flex"},_hoisted_69$1={class:"d-flex align-items-center mb-3"},_hoisted_70$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-question-circle fs-1 text-primary"})],-1),_hoisted_71$1={class:"mb-0 text-capitalize"},_hoisted_72$1={class:"col-md-4 d-flex"},_hoisted_73$1={class:"d-flex align-items-center mb-3"},_hoisted_74$1=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-file-earmark-post fs-1 text-primary"})],-1),_hoisted_75$1={class:"mb-0 text-capitalize"},_hoisted_76$1=["src"],_hoisted_77$1={key:1},_hoisted_78$1={key:0},_hoisted_79$1={class:"col-md-4 d-flex"},_hoisted_80$1={class:"d-flex align-items-center mb-3"},_hoisted_81$1={class:"mb-0 text-capitalize"},_hoisted_82$1={class:"modal fade",id:"ratingModel",tabindex:"-1","aria-labelledby":"ratingModelLabel","aria-hidden":"true"},_hoisted_83$1={class:"modal-dialog"},_hoisted_84$1={class:"modal-content"},_hoisted_85$1={class:"modal-header"},_hoisted_86$1={class:"modal-title",id:"ratingModelLabel"},_hoisted_87$1=createBaseVNode("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),_hoisted_88$1={class:"modal-body"},_hoisted_89={for:"rating"},_hoisted_90={class:"rating text-center fs-3 text-warning"},_hoisted_91={class:"form-group"},_hoisted_92={for:"comment"},_hoisted_93={key:0},_hoisted_94={class:"modal-footer"},_hoisted_95={type:"button",class:"btn btn-secondary",id:"close","data-bs-dismiss":"modal"};function _sfc_render$2(c,O,y,m,d,E){const p=resolveComponent("breadcrums"),b=resolveComponent("video-call-component"),s=resolveComponent("audio-call-component"),g=resolveComponent("chat-component"),i=resolveComponent("star-rating");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("h2",_hoisted_4$1,[createBaseVNode("span",_hoisted_5$1,toDisplayString(c.__("Hello"))+" "+toDisplayString(c.$page.props.auth.user.name)+" | ",1),createBaseVNode("span",_hoisted_6$1,toDisplayString(c.__("appointment detail")),1)])]),createVNode(p,{breadcrums:c.breadcrums},null,8,["breadcrums"])])]),createBaseVNode("div",_hoisted_7$1,[createBaseVNode("div",_hoisted_8$1,[createBaseVNode("div",_hoisted_9$1,[c.appointment.appointment_status_code==1?(openBlock(),createElementBlock("div",_hoisted_10$1,[createBaseVNode("div",_hoisted_11$1,[createBaseVNode("p",_hoisted_12$1,toDisplayString(c.__("Please accept the appointment from customer")),1)]),createBaseVNode("div",_hoisted_13$1,[createBaseVNode("button",{type:"updatenStatus",onClick:O[0]||(O[0]=a=>c.updateAppointmentStatus(2)),class:"btn btn-primary me-lg-3 me-0 px-5"},toDisplayString(c.__("accept")),1),createBaseVNode("button",{type:"button",onClick:O[1]||(O[1]=a=>c.updateAppointmentStatus(3)),class:"btn btn-danger px-5"},toDisplayString(c.__("reject")),1)])])):createCommentVNode("",!0),c.appointment.appointment_status_code==5?(openBlock(),createElementBlock("div",_hoisted_14$1,[createBaseVNode("div",_hoisted_15$1,[createBaseVNode("p",_hoisted_16$1,toDisplayString(c.__("Appointment has been completed")),1)])])):createCommentVNode("",!0),c.appointment.appointment_type_id==1&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_17$1,[createVNode(b,{onShowCompletedButton:O[2]||(O[2]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==2&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_18$1,[createVNode(s,{onShowCompletedButton:O[3]||(O[3]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==3&&c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("div",_hoisted_19$1,[createVNode(g,{onShowCompletedButton:O[4]||(O[4]=()=>this.showMarkedAsCompletedButton=!0),appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.showMarkedAsCompletedButton?(openBlock(),createElementBlock("div",_hoisted_20$1,[createBaseVNode("div",_hoisted_21$1,[c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("div",_hoisted_22$1,[createBaseVNode("button",{type:"updatenStatus",onClick:O[5]||(O[5]=a=>c.updateAppointmentStatus(5)),class:"btn btn-primary px-5"},toDisplayString(c.__("mark as complete")),1)])):createCommentVNode("",!0)])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_23$1,[c.appointment.appointment_status_code==5&&c.userRating?(openBlock(),createElementBlock("div",_hoisted_24$1,[createBaseVNode("div",_hoisted_25$1,[createBaseVNode("div",_hoisted_26$1,[createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_27$1,toDisplayString(c.__("your feedback")),1),createBaseVNode("b",null,toDisplayString(c.__("rating"))+": ",1),createVNode(i,{rating:c.userRating.rating,"star-size":20,"read-only":!0,increment:.01,"show-rating":!1},null,8,["rating","increment"]),createBaseVNode("b",null,toDisplayString(c.__("comment"))+": ",1),createTextVNode(" "+toDisplayString(c.userRating.comment),1)])])])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_28$1,[createBaseVNode("div",_hoisted_29$1,[createBaseVNode("div",_hoisted_30$1,[createBaseVNode("div",_hoisted_31$1,[createBaseVNode("div",_hoisted_32$1,[createBaseVNode("div",_hoisted_33$1,[_hoisted_34$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_35$1,toDisplayString(c.__("appointment"))+" # ",1),createBaseVNode("span",null,toDisplayString(c.appointment.id),1)])])]),createBaseVNode("div",_hoisted_36$1,[createBaseVNode("div",_hoisted_37$1,[_hoisted_38$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_39$1,toDisplayString(c.__("booking date")),1),createBaseVNode("span",null,toDisplayString(c.appointment.date),1)])])]),createBaseVNode("div",_hoisted_40$1,[createBaseVNode("div",_hoisted_41$1,[_hoisted_42$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_43$1,toDisplayString(c.__("start time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.start_time),1)])])]),createBaseVNode("div",_hoisted_44$1,[createBaseVNode("div",_hoisted_45$1,[_hoisted_46$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_47$1,toDisplayString(c.__("end time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.end_time),1)])])]),createBaseVNode("div",_hoisted_48$1,[createBaseVNode("div",_hoisted_49$1,[_hoisted_50$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_51$1,toDisplayString(c.__("customer")),1),createBaseVNode("span",null,toDisplayString(c.appointment.customer_name),1)])])]),createBaseVNode("div",_hoisted_52$1,[createBaseVNode("div",_hoisted_53$1,[_hoisted_54$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_55$1,toDisplayString(c.__("appointment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_status_name),1)])])]),createBaseVNode("div",_hoisted_56$1,[createBaseVNode("div",_hoisted_57$1,[_hoisted_58$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_59$1,toDisplayString(c.__("appointment type")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_type_name),1)])])]),createBaseVNode("div",_hoisted_60$1,[createBaseVNode("div",_hoisted_61$1,[_hoisted_62$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_63$1,toDisplayString(c.__("payment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.is_paid?c.__("paid"):c.__("un Paid")),1)])])]),createBaseVNode("div",_hoisted_64$1,[createBaseVNode("div",_hoisted_65$1,[_hoisted_66$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_67$1,toDisplayString(c.__("fee")),1),createBaseVNode("span",null,toDisplayString(c.getDisplayAmount(c.appointment.fee)),1)])])]),createBaseVNode("div",_hoisted_68$1,[createBaseVNode("div",_hoisted_69$1,[_hoisted_70$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_71$1,toDisplayString(c.__("question")),1),createBaseVNode("span",null,toDisplayString(c.appointment.question),1)])])]),createBaseVNode("div",_hoisted_72$1,[createBaseVNode("div",_hoisted_73$1,[_hoisted_74$1,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_75$1,toDisplayString(c.__("attachment")),1),c.appointment.attachment_url?(openBlock(),createElementBlock("img",{key:0,src:c.appointment.attachment_url,height:"100",width:"100",alt:""},null,8,_hoisted_76$1)):(openBlock(),createElementBlock("span",_hoisted_77$1,toDisplayString(c.__("n/a")),1))])])]),c.appointment.appointment_status_code==5&&c.userRating?(openBlock(),createElementBlock("div",_hoisted_78$1,[createBaseVNode("div",_hoisted_79$1,[createBaseVNode("div",_hoisted_80$1,[createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_81$1,toDisplayString(c.__("your feedback")),1),createBaseVNode("b",null,toDisplayString(c.__("rating"))+": ",1),createVNode(i,{rating:c.userRating.rating,"star-size":20,"read-only":!0,increment:.01,"show-rating":!1},null,8,["rating","increment"]),createBaseVNode("b",null,toDisplayString(c.__("comment"))+": ",1),createTextVNode(" "+toDisplayString(c.userRating.comment),1)])])])])):createCommentVNode("",!0)])])])]),createBaseVNode("div",_hoisted_82$1,[createBaseVNode("div",_hoisted_83$1,[createBaseVNode("div",_hoisted_84$1,[createBaseVNode("div",_hoisted_85$1,[createBaseVNode("h5",_hoisted_86$1,toDisplayString(c.__("rate now")),1),_hoisted_87$1]),createBaseVNode("div",_hoisted_88$1,[createBaseVNode("label",_hoisted_89,toDisplayString(c.__("rating"))+":",1),createBaseVNode("div",_hoisted_90,[createVNode(i,{modelValue:c.form.rating,"onUpdate:modelValue":O[6]||(O[6]=a=>c.form.rating=a),"onUpdate:rating":c.setRating,"star-size":25},null,8,["modelValue","onUpdate:rating"])]),createBaseVNode("div",_hoisted_91,[createBaseVNode("label",_hoisted_92,toDisplayString(c.__("comment"))+":",1),withDirectives(createBaseVNode("textarea",{"onUpdate:modelValue":O[7]||(O[7]=a=>c.form.comment=a),class:"form-control",id:"",cols:"30",rows:"3"},null,512),[[vModelText,c.form.comment]]),c.form.errors.comment?(openBlock(),createElementBlock("span",_hoisted_93,toDisplayString(c.form.errors.comment),1)):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_94,[createBaseVNode("button",_hoisted_95,toDisplayString(c.__("close")),1),createBaseVNode("button",{type:"button",onClick:O[8]||(O[8]=(...a)=>c.submit&&c.submit(...a)),class:"btn btn-primary"},toDisplayString(c.__("submit")),1)])])])])])])])}const LawFirmAppointmentDetail=_export_sfc(_sfc_main$2,[["render",_sfc_render$2]]),_sfc_main$1=defineComponent({components:{Head,AppLayout,ValidationErrors,ChatComponent,AudioCallComponent,VideoCallComponent,Link,Breadcrums},props:["appointment"],data(){return{form:this.$inertia.form({comment:"",rating:0,lawyer_id:this.appointment.lawyer_id,booked_appointment_id:this.appointment.id}),breadcrums:[{id:1,name:"Home",link:"/"},{id:2,name:"My Appointments",link:"/appointment_log"},{id:3,name:"Appointment Detail",link:""}]}},async created(){},mounted(){},computed:{userRating(){var c=this.appointment.ratings.find(O=>O.fromable_type==this.$page.props.auth.logged_in_as&&O.fromable_id==this.$page.props.auth.user[this.$page.props.auth.logged_in_as].id);return c}},methods:{close(){document.getElementById("close").click()},resetForm(){this.form=this.$inertia.form({comment:"",rating:0})},setRating(c){this.form.rating=c},submit(){this.form.post(this.route("add_appointment_rating"),{preserveState:!0,preserveScroll:!0,onSuccess:()=>{const c=document.querySelector(".modal-backdrop");c&&c.classList.remove("modal-backdrop"),this.resetForm()}})}}}),_hoisted_1={class:"container-fluid py-5 border-bottom border-dark"},_hoisted_2={class:"row"},_hoisted_3={class:"col-12"},_hoisted_4={class:"fs-2 text-center"},_hoisted_5={class:"fw-normal"},_hoisted_6={class:"fw-bold"},_hoisted_7={class:"section py-5"},_hoisted_8={class:"container"},_hoisted_9={class:"px-4 mb-0 rounded py-4",style:{"background-color":"rgb(255, 243, 219)"}},_hoisted_10={class:"row"},_hoisted_11={class:"col-12"},_hoisted_12={key:0},_hoisted_13={key:1},_hoisted_14={key:2},_hoisted_15={key:0,class:"row"},_hoisted_16={class:"col-md-6"},_hoisted_17={class:"mb-0"},_hoisted_18={key:1},_hoisted_19={class:"row"},_hoisted_20={class:"col-12"},_hoisted_21={class:"pt-4"},_hoisted_22={class:"row"},_hoisted_23={class:"col-md-4 d-flex"},_hoisted_24={class:"d-flex align-items-center mb-3"},_hoisted_25=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-calendar-x fs-1 text-primary"})],-1),_hoisted_26={class:"mb-0 text-capitalize"},_hoisted_27={key:0,class:"col-md-4 d-flex"},_hoisted_28={class:"d-flex align-items-center mb-3"},_hoisted_29=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_30={class:"mb-0 text-capitalize"},_hoisted_31={key:1,class:"col-md-4 d-flex"},_hoisted_32={class:"d-flex align-items-center mb-3"},_hoisted_33=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clock-history fs-1 text-primary"})],-1),_hoisted_34={class:"mb-0 text-capitalize"},_hoisted_35={key:2,class:"col-md-4 d-flex"},_hoisted_36={class:"d-flex align-items-center mb-3"},_hoisted_37=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-person-circle fs-1 text-primary"})],-1),_hoisted_38={class:"mb-0 text-capitalize"},_hoisted_39={key:3,class:"col-md-4 d-flex"},_hoisted_40={class:"d-flex align-items-center mb-3"},_hoisted_41=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-person-circle fs-1 text-primary"})],-1),_hoisted_42={class:"mb-0 text-capitalize"},_hoisted_43={class:"col-md-4 d-flex"},_hoisted_44={class:"d-flex align-items-center mb-3"},_hoisted_45=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-clipboard-check fs-1 text-primary"})],-1),_hoisted_46={class:"mb-0 text-capitalize"},_hoisted_47={class:"col-md-4 d-flex"},_hoisted_48={class:"d-flex align-items-center mb-3"},_hoisted_49=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-webcam fs-1 text-primary"})],-1),_hoisted_50={class:"mb-0 text-capitalize"},_hoisted_51={class:"col-md-4 d-flex"},_hoisted_52={class:"d-flex align-items-center mb-3"},_hoisted_53=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-check2-square fs-1 text-primary"})],-1),_hoisted_54={class:"mb-0 text-capitalize"},_hoisted_55={class:"col-md-4 d-flex"},_hoisted_56={class:"d-flex align-items-center mb-3"},_hoisted_57=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-coin fs-1 text-primary"})],-1),_hoisted_58={class:"mb-0 text-capitalize"},_hoisted_59={class:"col-md-4 d-flex"},_hoisted_60={class:"d-flex align-items-center mb-3"},_hoisted_61=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-question-circle fs-1 text-primary"})],-1),_hoisted_62={class:"mb-0 text-capitalize"},_hoisted_63={class:"col-md-4 d-flex"},_hoisted_64={class:"d-flex align-items-center mb-3"},_hoisted_65=createBaseVNode("div",{class:"me-3"},[createBaseVNode("i",{class:"bi bi-file-earmark-post fs-1 text-primary"})],-1),_hoisted_66={class:"mb-0 text-capitalize"},_hoisted_67=["src"],_hoisted_68={key:1},_hoisted_69={key:4,class:"row mt-5"},_hoisted_70=createBaseVNode("div",{class:"col-md-6"},null,-1),_hoisted_71={class:"col-md-6 d-flex justify-content-end"},_hoisted_72={type:"updatenStatus",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#ratingModel"},_hoisted_73={class:"modal fade",id:"ratingModel",tabindex:"-1","aria-labelledby":"ratingModelLabel","aria-hidden":"true"},_hoisted_74={class:"modal-dialog"},_hoisted_75={class:"modal-content"},_hoisted_76=createBaseVNode("div",{class:"modal-header"},[createBaseVNode("h5",{class:"modal-title",id:"ratingModelLabel"},"Rate Now"),createBaseVNode("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),_hoisted_77={class:"modal-body"},_hoisted_78={for:"rating"},_hoisted_79={class:"rating text-center fs-3 text-warning"},_hoisted_80={class:"form-group"},_hoisted_81={for:"comment"},_hoisted_82={key:0},_hoisted_83={class:"modal-footer"},_hoisted_84={type:"button",class:"btn btn-secondary",id:"close","data-bs-dismiss":"modal"},_hoisted_85={key:5},_hoisted_86={class:"col-md-4 d-flex"},_hoisted_87={class:"d-flex align-items-center mb-3"},_hoisted_88={class:"mb-0 text-capitalize"};function _sfc_render$1(c,O,y,m,d,E){const p=resolveComponent("breadcrums"),b=resolveComponent("video-call-component"),s=resolveComponent("audio-call-component"),g=resolveComponent("chat-component"),i=resolveComponent("star-rating");return openBlock(),createElementBlock("div",null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("h2",_hoisted_4,[createBaseVNode("span",_hoisted_5,toDisplayString(c.__("Hello"))+" "+toDisplayString(c.$page.props.auth.user.name)+" | ",1),createBaseVNode("span",_hoisted_6,toDisplayString(c.__("appointment detail")),1)])]),createVNode(p,{breadcrums:c.breadcrums},null,8,["breadcrums"])])]),createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[c.appointment.appointment_type_id==1&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_12,[createVNode(b,{appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==2&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_13,[createVNode(s,{appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0),c.appointment.appointment_type_id==3&&c.appointment.appointment_status_code!=5?(openBlock(),createElementBlock("div",_hoisted_14,[c.appointment.appointment_status_code==1?(openBlock(),createElementBlock("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[createBaseVNode("p",_hoisted_17,toDisplayString(c.__("Waiting for Appointment Acceptance")),1)])])):createCommentVNode("",!0),c.appointment.appointment_status_code==2?(openBlock(),createElementBlock("div",_hoisted_18,[createVNode(g,{appointment:c.appointment},null,8,["appointment"])])):createCommentVNode("",!0)])):createCommentVNode("",!0)])])]),createBaseVNode("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[createBaseVNode("div",_hoisted_21,[createBaseVNode("div",_hoisted_22,[createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[_hoisted_25,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_26,toDisplayString(c.__("booking date")),1),createBaseVNode("span",null,toDisplayString(c.appointment.date),1)])])]),c.appointment.is_schedule_required?(openBlock(),createElementBlock("div",_hoisted_27,[createBaseVNode("div",_hoisted_28,[_hoisted_29,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_30,toDisplayString(c.__("start time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.start_time),1)])])])):createCommentVNode("",!0),c.appointment.is_schedule_required?(openBlock(),createElementBlock("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,[_hoisted_33,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_34,toDisplayString(c.__("end time")),1),createBaseVNode("span",null,toDisplayString(c.appointment.end_time),1)])])])):createCommentVNode("",!0),c.appointment.lawyer_name?(openBlock(),createElementBlock("div",_hoisted_35,[createBaseVNode("div",_hoisted_36,[_hoisted_37,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_38,toDisplayString(c.__("lawyer")),1),createBaseVNode("span",null,toDisplayString(c.appointment.lawyer_name),1)])])])):createCommentVNode("",!0),c.appointment.law_firm_name?(openBlock(),createElementBlock("div",_hoisted_39,[createBaseVNode("div",_hoisted_40,[_hoisted_41,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_42,toDisplayString(c.__("law_firm")),1),createBaseVNode("span",null,toDisplayString(c.appointment.law_firm_name),1)])])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_43,[createBaseVNode("div",_hoisted_44,[_hoisted_45,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_46,toDisplayString(c.__("appointment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_status_name),1)])])]),createBaseVNode("div",_hoisted_47,[createBaseVNode("div",_hoisted_48,[_hoisted_49,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_50,toDisplayString(c.__("appointment type")),1),createBaseVNode("span",null,toDisplayString(c.appointment.appointment_type_name),1)])])]),createBaseVNode("div",_hoisted_51,[createBaseVNode("div",_hoisted_52,[_hoisted_53,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_54,toDisplayString(c.__("payment status")),1),createBaseVNode("span",null,toDisplayString(c.appointment.is_paid?c.__("paid"):c.__("un Paid")),1)])])]),createBaseVNode("div",_hoisted_55,[createBaseVNode("div",_hoisted_56,[_hoisted_57,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_58,toDisplayString(c.__("fee")),1),createBaseVNode("span",null,toDisplayString(c.getDisplayAmount(c.appointment.fee)),1)])])]),createBaseVNode("div",_hoisted_59,[createBaseVNode("div",_hoisted_60,[_hoisted_61,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_62,toDisplayString(c.__("question")),1),createBaseVNode("span",null,toDisplayString(c.appointment.question),1)])])]),createBaseVNode("div",_hoisted_63,[createBaseVNode("div",_hoisted_64,[_hoisted_65,createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_66,toDisplayString(c.__("attachment")),1),c.appointment.attachment_url?(openBlock(),createElementBlock("img",{key:0,src:c.appointment.attachment_url,height:"100",width:"100",alt:""},null,8,_hoisted_67)):(openBlock(),createElementBlock("span",_hoisted_68,toDisplayString(c.__("n/a")),1))])])]),c.appointment.appointment_status_code==5&&!c.userRating?(openBlock(),createElementBlock("div",_hoisted_69,[_hoisted_70,createBaseVNode("div",_hoisted_71,[createBaseVNode("button",_hoisted_72,toDisplayString(c.__("rate now")),1)]),createBaseVNode("div",_hoisted_73,[createBaseVNode("div",_hoisted_74,[createBaseVNode("div",_hoisted_75,[_hoisted_76,createBaseVNode("div",_hoisted_77,[createBaseVNode("label",_hoisted_78,toDisplayString(c.__("rating"))+":",1),createBaseVNode("div",_hoisted_79,[createVNode(i,{modelValue:c.form.rating,"onUpdate:modelValue":O[0]||(O[0]=a=>c.form.rating=a),"onUpdate:rating":c.setRating,"star-size":25},null,8,["modelValue","onUpdate:rating"])]),createBaseVNode("div",_hoisted_80,[createBaseVNode("label",_hoisted_81,toDisplayString(c.__("comment"))+":",1),withDirectives(createBaseVNode("textarea",{"onUpdate:modelValue":O[1]||(O[1]=a=>c.form.comment=a),class:"form-control",id:"",cols:"30",rows:"3"},null,512),[[vModelText,c.form.comment]]),c.form.errors.comment?(openBlock(),createElementBlock("span",_hoisted_82,toDisplayString(c.form.errors.comment),1)):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_83,[createBaseVNode("button",_hoisted_84,toDisplayString(c.__("close")),1),createBaseVNode("button",{type:"button",onClick:O[2]||(O[2]=(...a)=>c.submit&&c.submit(...a)),class:"btn btn-primary"},toDisplayString(c.__("submit")),1)])])])])])):createCommentVNode("",!0),c.appointment.appointment_status_code==5&&c.userRating?(openBlock(),createElementBlock("div",_hoisted_85,[createBaseVNode("div",_hoisted_86,[createBaseVNode("div",_hoisted_87,[createBaseVNode("div",null,[createBaseVNode("h5",_hoisted_88,toDisplayString(c.__("feedback")),1),createBaseVNode("b",null,toDisplayString(c.__("rating"))+": ",1),createVNode(i,{rating:c.userRating.rating,"star-size":20,"read-only":!0,increment:.01,"show-rating":!1},null,8,["rating","increment"]),createBaseVNode("b",null,toDisplayString(c.__("comment"))+": ",1),createTextVNode(" "+toDisplayString(c.userRating.comment),1)])])])])):createCommentVNode("",!0)])])])])])])])}const CustomerAppointmentDetail=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]),_sfc_main=defineComponent({components:{AppLayout,Navbar,PageHeader,LawyerAppointmentDetail,CustomerAppointmentDetail,LawFirmAppointmentDetail},props:["appointment"],created(){}});function _sfc_render(c,O,y,m,d,E){const p=resolveComponent("lawyer-appointment-detail"),b=resolveComponent("law-firm-appointment-detail"),s=resolveComponent("customer-appointment-detail"),g=resolveComponent("app-layout");return openBlock(),createBlock(g,{title:"Appointment Log Detail"},{default:withCtx(()=>[c.$page.props.auth.logged_in_as=="lawyer"?(openBlock(),createBlock(p,{key:0,appointment:c.appointment},null,8,["appointment"])):createCommentVNode("",!0),c.$page.props.auth.logged_in_as=="law_firm"?(openBlock(),createBlock(b,{key:1,appointment:c.appointment},null,8,["appointment"])):createCommentVNode("",!0),c.$page.props.auth.logged_in_as=="customer"?(openBlock(),createBlock(s,{key:2,appointment:c.appointment},null,8,["appointment"])):createCommentVNode("",!0)]),_:1})}const AppointmentLogDetail=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{AppointmentLogDetail as default};
